(function(m,w){typeof exports=="object"&&typeof module<"u"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(m=typeof globalThis<"u"?globalThis:m||self,w(m["canvas-animation"]={}))})(this,function(m){"use strict";var pa=Object.defineProperty;var _a=(m,w,X)=>w in m?pa(m,w,{enumerable:!0,configurable:!0,writable:!0,value:X}):m[w]=X;var et=(m,w,X)=>(_a(m,typeof w!="symbol"?w+"":w,X),X);function w(r,e){return typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=.001:r==e}function X(){var r=0;return Object.assign(function(){return r},{advance:t=>{r+=t}})}function vr(r){let e=new Set;for(;r=Reflect.getPrototypeOf(r);)Reflect.ownKeys(r).forEach(i=>e.add(i));return e}class kr{constructor(e=void 0){this.info=e,this.promise=new Promise((t,i)=>{this.reject=i,this.resolve=t})}}function wr(r){let e=1e12,t=-1e12,i=1e12,a=-1e12;return r.forEach(s=>{s.x<e&&(e=s.x),s.x>t&&(t=s.x),s.y<i&&(i=s.y),s.y>a&&(a=s.y)}),{x:[e,t],y:[i,a]}}var tt=(r=>(r[r.DEFAULT=0]="DEFAULT",r[r.ALWAYS=1]="ALWAYS",r[r.WHEN_UPDATED=2]="WHEN_UPDATED",r))(tt||{});class k{constructor(e){if(this.valueFn=void 0,this.transform=void 0,this.cacheTransform=!1,this._cachedValue=null,this.computeArg=void 0,this.recompute=0,this.needsUpdate=!1,this.animation=null,this.label=null,this._computedValue=null,this._lastTickValue=void 0,this._animatedValue=null,this._hasComputed=!1,this._timeProvider=null,this.currentTime=0,this._changedLastTick=!1,this._listeners=[],this._animationCompleteCallbacks=[],e==null||e==null||!(e.hasOwnProperty("value")||e.hasOwnProperty("valueFn")))typeof e=="function"?this.valueFn=e:this.value=e;else{let t=e;t.valueFn!==void 0?this.valueFn=t.valueFn:t.value!==void 0?this.value=t.value:console.error("One of `value` or `valueFn` must be defined to create an Attribute"),this.transform=t.transform??null,this.cacheTransform=t.cacheTransform??!1,this._cachedValue=null,this.computeArg=t.computeArg??null,this.recompute=t.recompute??0}}copy(e={}){let t={...this,...e};return e.value!==void 0&&(t.valueFn=void 0),e.valueFn!==void 0&&(t.value=void 0),new k(t)}addListener(e){this._listeners.push(e)}removeListener(e){let t=this._listeners.indexOf(e);t>=0&&(this._listeners=this._listeners.splice(t,1))}setTimeProvider(e){this._timeProvider=e}_getComputeArg(){return this.computeArg!==void 0?this.computeArg:this}compute(){this.valueFn&&(this._computedValue=this.valueFn(this._getComputeArg()))}advance(e=void 0){return(this.animation!=null||this.needsUpdate||this.valueFn)&&(this._timeProvider===null?this.currentTime+=e:this.currentTime=this._timeProvider()),this.animation==null&&this._animationCompleteCallbacks.length>0&&(console.warn("Found animation-complete callbacks for a non-existent animation"),this._cleanUpAnimation(!0)),this._lastTickValue=this.getUntransformed(),this.animation!=null||this.needsUpdate?(this.needsUpdate=!1,this._changedLastTick=!0,!0):(this._changedLastTick=!1,!1)}_computeAnimation(e=!0){if(!this.animation)return;this._timeProvider&&(this.currentTime=this._timeProvider());let{animator:t,start:i,initial:a}=this.animation,s=t.evaluate(a,Math.min(this.currentTime-i,t.duration));this._animationFinished()&&e?(this.valueFn?this.compute():this.value=s,this._cleanUpAnimation(!1),this._animatedValue=null):this._animatedValue=s}_animationFinished(){return this.animation?this.animation.animator.duration+20<=this.currentTime-this.animation.start:!0}_performTransform(e){let t;if(this.transform){let i=this._cachedValue;if(i&&w(i.raw,e))t=i.result;else{let a=e;t=this.transform(e,this._getComputeArg()),this.cacheTransform&&(this._cachedValue={raw:a,result:t})}}else t=e;return t}_cleanUpAnimation(e=!1){this.animation=null,this._animationCompleteCallbacks.forEach(t=>{!e||!t.info.rejectOnCancel?t.resolve(this):t.reject({newValue:this.last()})}),this._animationCompleteCallbacks=[]}get(){return this._performTransform(this.getUntransformed())}getUntransformed(){this._computeAnimation();let e;return this._animatedValue!=null?e=this._animatedValue:this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),e=this._computedValue):e=this.value,this._lastTickValue===void 0&&(this._lastTickValue=e),e}getPreload(e=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let i=this.get();return{start:i,end:i,startTime:e||this.currentTime,endTime:e||this.currentTime}}let t=this.getPreloadUntransformed(e);return{start:this._performTransform(t.start),end:this._performTransform(t.end),startTime:t.startTime,endTime:t.endTime}}getPreloadUntransformed(e=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let s=this.getUntransformed();return{start:s,end:s,startTime:e||this.currentTime,endTime:e||this.currentTime}}if(this._animationFinished())return this._computeAnimation(),this.getPreloadUntransformed(e);let t;this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),t=this._computedValue):t=this.value;let i=this.animation.animator.finalValue;i===void 0&&console.error("Animations on preloadable attributes must have a final value");let a=(e||this.currentTime)-this.currentTime;return{start:t,end:i,startTime:this.animation.start+a,endTime:this.animation.start+this.animation.animator.duration+a}}set(e){typeof e=="function"?(this.value!=null&&(this._computedValue=this.value),this.valueFn=e,this.value=void 0,this._animatedValue=null,this._lastTickValue=void 0):(this.value=e,this.valueFn=null,this._animatedValue=null,this._lastTickValue=e),this.needsUpdate=!0,this.animation&&this._cleanUpAnimation(!0),this._listeners.forEach(t=>t(this,!1))}data(){return this.valueFn?this.valueFn(this._getComputeArg()):this.value}last(){return this.animation&&this._computeAnimation(!1),this._lastTickValue!==void 0?this._lastTickValue:this._animatedValue!=null?this._animatedValue:this.value!==void 0?this.value:this._computedValue}future(){return this.animation?this.animation.animator.finalValue:this._animatedValue!=null?this._animatedValue:this.value!==void 0?this.value:this._computedValue}updateTransform(){this._cachedValue=null}animating(){return this.animation!=null}animate(e){this._timeProvider&&(this.currentTime=this._timeProvider()),this.animation&&(this.valueFn?this._computedValue=this._animatedValue:this.value=this._animatedValue,this._cleanUpAnimation(!0)),this.animation={animator:e,initial:this.last(),start:this.currentTime},this._computeAnimation(),this._listeners.forEach(t=>t(this,!0))}wait(e=!0){if(!this.animation)return new Promise((i,a)=>i(this));let t=new kr({rejectOnCancel:e});return this._animationCompleteCallbacks.push(t),t.promise}changed(){return this._changedLastTick}}function v(r,e){let t=r.length;Array.isArray(r[0])||(r=[r]),Array.isArray(e[0])||(e=e.map(n=>[n]));let i=e[0].length,a=e[0].map((n,o)=>e.map(h=>h[o])),s=r.map(n=>a.map(o=>{let h=0;if(!Array.isArray(n)){for(let l of o)h+=n*l;return h}for(let l=0;l<n.length;l++)h+=n[l]*(o[l]||0);return h}));return t===1&&(s=s[0]),i===1?s.map(n=>n[0]):s}function Q(r){return I(r)==="string"}function I(r){return(Object.prototype.toString.call(r).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function ue(r,e){r=+r,e=+e;let t=(Math.floor(r)+"").length;if(e>t)return+r.toFixed(e-t);{let i=10**(t-e);return Math.round(r/i)*i}}function rt(r){if(!r)return;r=r.trim();const e=/^([a-z]+)\((.+?)\)$/i,t=/^-?[\d.]+$/;let i=r.match(e);if(i){let a=[];return i[2].replace(/\/?\s*([-\w.]+(?:%|deg)?)/g,(s,n)=>{/%$/.test(n)?(n=new Number(n.slice(0,-1)/100),n.type="<percentage>"):/deg$/.test(n)?(n=new Number(+n.slice(0,-3)),n.type="<angle>",n.unit="deg"):t.test(n)&&(n=new Number(n),n.type="<number>"),s.startsWith("/")&&(n=n instanceof Number?n:new Number(n),n.alpha=!0),a.push(n)}),{name:i[1].toLowerCase(),rawName:i[1],rawArgs:i[2],args:a}}}function it(r){return r[r.length-1]}function ce(r,e,t){return isNaN(r)?e:isNaN(e)?r:r+(e-r)*t}function at(r,e,t){return(t-r)/(e-r)}function Pe(r,e,t){return ce(e[0],e[1],at(r[0],r[1],t))}function st(r){return r.map(e=>e.split("|").map(t=>{t=t.trim();let i=t.match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(i){let a=new String(i[1]);return a.range=[+i[2],+i[3]],a}return t}))}var Sr=Object.freeze({__proto__:null,interpolate:ce,interpolateInv:at,isString:Q,last:it,mapRange:Pe,multiplyMatrices:v,parseCoordGrammar:st,parseFunction:rt,toPrecision:ue,type:I});class xr{add(e,t,i){if(typeof arguments[0]!="string"){for(var e in arguments[0])this.add(e,arguments[0][e],arguments[1]);return}(Array.isArray(e)?e:[e]).forEach(function(a){this[a]=this[a]||[],t&&this[a][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}}const j=new xr;var Y={gamut_mapping:"lch.c",precision:5,deltaE:"76"};const B={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function Re(r){return Array.isArray(r)?r:B[r]}function de(r,e,t,i={}){if(r=Re(r),e=Re(e),!r||!e)throw new TypeError(`Missing white point to convert ${r?"":"from"}${!r&&!e?"/":""}${e?"":"to"}`);if(r===e)return t;let a={W1:r,W2:e,XYZ:t,options:i};if(j.run("chromatic-adaptation-start",a),a.M||(a.W1===B.D65&&a.W2===B.D50?a.M=[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]]:a.W1===B.D50&&a.W2===B.D65&&(a.M=[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]])),j.run("chromatic-adaptation-end",a),a.M)return v(a.M,a.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}const Cr=75e-6,L=class L{constructor(e){var a,s,n;this.id=e.id,this.name=e.name,this.base=e.base?L.get(e.base):null,this.aliases=e.aliases,this.base&&(this.fromBase=e.fromBase,this.toBase=e.toBase);let t=e.coords??this.base.coords;for(let o in t)"name"in t[o]||(t[o].name=o);this.coords=t;let i=e.white??this.base.white??"D65";this.white=Re(i),this.formats=e.formats??{};for(let o in this.formats){let h=this.formats[o];h.type||(h.type="function"),h.name||(h.name=o)}e.cssId&&!((a=this.formats.functions)!=null&&a.color)?(this.formats.color={id:e.cssId},Object.defineProperty(this,"cssId",{value:e.cssId})):(s=this.formats)!=null&&s.color&&!((n=this.formats)!=null&&n.color.id)&&(this.formats.color.id=this.id),this.referred=e.referred,Object.defineProperty(this,"path",{value:Tr(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),j.run("colorspace-init-end",this)}inGamut(e,{epsilon:t=Cr}={}){if(this.isPolar)return e=this.toBase(e),this.base.inGamut(e,{epsilon:t});let i=Object.values(this.coords);return e.every((a,s)=>{let n=i[s];if(n.type!=="angle"&&n.range){if(Number.isNaN(a))return!0;let[o,h]=n.range;return(o===void 0||a>=o-t)&&(h===void 0||a<=h+t)}return!0})}get cssId(){var e,t;return((t=(e=this.formats.functions)==null?void 0:e.color)==null?void 0:t.id)||this.id}get isPolar(){for(let e in this.coords)if(this.coords[e].type==="angle")return!0;return!1}getFormat(e){if(typeof e=="object")return e=nt(e,this),e;let t;return e==="default"?t=Object.values(this.formats)[0]:t=this.formats[e],t?(t=nt(t,this),t):null}equals(e){return e?this===e||this.id===e.id:!1}to(e,t){if(arguments.length===1&&([e,t]=[e.space,e.coords]),e=L.get(e),this.equals(e))return t;t=t.map(o=>Number.isNaN(o)?0:o);let i=this.path,a=e.path,s,n;for(let o=0;o<i.length&&i[o].equals(a[o]);o++)s=i[o],n=o;if(!s)throw new Error(`Cannot convert between color spaces ${this} and ${e}: no connection space was found`);for(let o=i.length-1;o>n;o--)t=i[o].toBase(t);for(let o=n+1;o<a.length;o++)t=a[o].fromBase(t);return t}from(e,t){return arguments.length===1&&([e,t]=[e.space,e.coords]),e=L.get(e),e.to(this,t)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let e=[];for(let t in this.coords){let i=this.coords[t],a=i.range||i.refRange;e.push((a==null?void 0:a.min)??0)}return e}static get all(){return[...new Set(Object.values(L.registry))]}static register(e,t){if(arguments.length===1&&(t=arguments[0],e=t.id),t=this.get(t),this.registry[e]&&this.registry[e]!==t)throw new Error(`Duplicate color space registration: '${e}'`);if(this.registry[e]=t,arguments.length===1&&t.aliases)for(let i of t.aliases)this.register(i,t);return t}static get(e,...t){if(!e||e instanceof L)return e;if(I(e)==="string"){let a=L.registry[e.toLowerCase()];if(!a)throw new TypeError(`No color space found with id = "${e}"`);return a}if(t.length)return L.get(...t);throw new TypeError(`${e} is not a valid color space`)}static resolveCoord(e,t){var h;let i=I(e),a,s;if(i==="string"?e.includes(".")?[a,s]=e.split("."):[a,s]=[,e]:Array.isArray(e)?[a,s]=e:(a=e.space,s=e.coordId),a=L.get(a),a||(a=t),!a)throw new TypeError(`Cannot resolve coordinate reference ${e}: No color space specified and relative references are not allowed here`);if(i=I(s),i==="number"||i==="string"&&s>=0){let l=Object.entries(a.coords)[s];if(l)return{space:a,id:l[0],index:s,...l[1]}}a=L.get(a);let n=s.toLowerCase(),o=0;for(let l in a.coords){let u=a.coords[l];if(l.toLowerCase()===n||((h=u.name)==null?void 0:h.toLowerCase())===n)return{space:a,id:l,index:o,...u};o++}throw new TypeError(`No "${s}" coordinate found in ${a.name}. Its coordinates are: ${Object.keys(a.coords).join(", ")}`)}};et(L,"registry",{}),et(L,"DEFAULT_FORMAT",{type:"functions",name:"color"});let f=L;function Tr(r){let e=[r];for(let t=r;t=t.base;)e.push(t);return e}function nt(r,{coords:e}={}){if(r.coords&&!r.coordGrammar){r.type||(r.type="function"),r.name||(r.name="color"),r.coordGrammar=st(r.coords);let t=Object.entries(e).map(([i,a],s)=>{let n=r.coordGrammar[s][0],o=a.range||a.refRange,h=n.range,l="";return n=="<percentage>"?(h=[0,100],l="%"):n=="<angle>"&&(l="deg"),{fromRange:o,toRange:h,suffix:l}});r.serializeCoords=(i,a)=>i.map((s,n)=>{let{fromRange:o,toRange:h,suffix:l}=t[n];return o&&h&&(s=Pe(o,h,s)),s=ue(s,a),l&&(s+=l),s})}return r}var A=new f({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class C extends f{constructor(e){e.coords||(e.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),e.base||(e.base=A),e.toXYZ_M&&e.fromXYZ_M&&(e.toBase??(e.toBase=t=>{let i=v(e.toXYZ_M,t);return this.white!==this.base.white&&(i=de(this.white,this.base.white,i)),i}),e.fromBase??(e.fromBase=t=>(t=de(this.base.white,this.white,t),v(e.fromXYZ_M,t)))),e.referred??(e.referred="display"),super(e)}}function ot(r,{meta:e}={}){var i,a,s,n,o;let t={str:(i=String(r))==null?void 0:i.trim()};if(j.run("parse-start",t),t.color)return t.color;if(t.parsed=rt(t.str),t.parsed){let h=t.parsed.name;if(h==="color"){let l=t.parsed.args.shift(),u=t.parsed.rawArgs.indexOf("/")>0?t.parsed.args.pop():1;for(let d of f.all){let g=d.getFormat("color");if(g&&(l===g.id||(a=g.ids)!=null&&a.includes(l))){const y=Object.keys(d.coords).map((M,b)=>t.parsed.args[b]||0);return e&&(e.formatId="color"),{spaceId:d.id,coords:y,alpha:u}}}let c="";if(l in f.registry){let d=(o=(n=(s=f.registry[l].formats)==null?void 0:s.functions)==null?void 0:n.color)==null?void 0:o.id;d&&(c=`Did you mean color(${d})?`)}throw new TypeError(`Cannot parse color(${l}). `+(c||"Missing a plugin?"))}else for(let l of f.all){let u=l.getFormat(h);if(u&&u.type==="function"){let c=1;(u.lastAlpha||it(t.parsed.args).alpha)&&(c=t.parsed.args.pop());let d=t.parsed.args,g;return u.coordGrammar&&(g=Object.entries(l.coords).map(([y,M],b)=>{var N;let S=u.coordGrammar[b],x=(N=d[b])==null?void 0:N.type,R=S.find(V=>V==x);if(!R){let V=M.name||y;throw new TypeError(`${x} not allowed for ${V} in ${h}()`)}let D=R.range;x==="<percentage>"&&(D||(D=[0,1]));let z=M.range||M.refRange;return D&&z&&(d[b]=Pe(D,z,d[b])),R})),e&&Object.assign(e,{formatId:u.name,types:g}),{spaceId:l.id,coords:d,alpha:c}}}}else for(let h of f.all)for(let l in h.formats){let u=h.formats[l];if(u.type!=="custom"||u.test&&!u.test(t.str))continue;let c=u.parse(t.str);if(c)return c.alpha??(c.alpha=1),e&&(e.formatId=l),c}throw new TypeError(`Could not parse ${r} as a color. Missing a plugin?`)}function p(r){if(!r)throw new TypeError("Empty color reference");Q(r)&&(r=ot(r));let e=r.space||r.spaceId;return e instanceof f||(r.space=f.get(e)),r.alpha===void 0&&(r.alpha=1),r}function K(r,e){return e=f.get(e),e.from(r)}function E(r,e){let{space:t,index:i}=f.resolveCoord(e,r.space);return K(r,t)[i]}function ht(r,e,t){return e=f.get(e),r.coords=e.to(r.space,t),r}function q(r,e,t){if(r=p(r),arguments.length===2&&I(arguments[1])==="object"){let i=arguments[1];for(let a in i)q(r,a,i[a])}else{typeof t=="function"&&(t=t(E(r,e)));let{space:i,index:a}=f.resolveCoord(e,r.space),s=K(r,i);s[a]=t,ht(r,i,s)}return r}var Be=new f({id:"xyz-d50",name:"XYZ D50",white:"D50",base:A,fromBase:r=>de(A.white,"D50",r),toBase:r=>de("D50",A.white,r),formats:{color:{}}});const Lr=216/24389,lt=24/116,fe=24389/27;let Fe=B.D50;var T=new f({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Fe,base:Be,fromBase(r){let t=r.map((i,a)=>i/Fe[a]).map(i=>i>Lr?Math.cbrt(i):(fe*i+16)/116);return[116*t[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])]},toBase(r){let e=[];return e[1]=(r[0]+16)/116,e[0]=r[1]/500+e[1],e[2]=e[1]-r[2]/200,[e[0]>lt?Math.pow(e[0],3):(116*e[0]-16)/fe,r[0]>8?Math.pow((r[0]+16)/116,3):r[0]/fe,e[2]>lt?Math.pow(e[2],3):(116*e[2]-16)/fe].map((i,a)=>i*Fe[a])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function me(r){return(r%360+360)%360}function Dr(r,e){if(r==="raw")return e;let[t,i]=e.map(me),a=i-t;return r==="increasing"?a<0&&(i+=360):r==="decreasing"?a>0&&(t+=360):r==="longer"?-180<a&&a<180&&(a>0?t+=360:i+=360):r==="shorter"&&(a>180?t+=360:a<-180&&(i+=360)),[t,i]}var ee=new f({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:T,fromBase(r){let[e,t,i]=r,a;const s=.02;return Math.abs(t)<s&&Math.abs(i)<s?a=NaN:a=Math.atan2(i,t)*180/Math.PI,[e,Math.sqrt(t**2+i**2),me(a)]},toBase(r){let[e,t,i]=r;return t<0&&(t=0),isNaN(i)&&(i=0),[e,t*Math.cos(i*Math.PI/180),t*Math.sin(i*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const ut=25**7,ge=Math.PI,ct=180/ge,W=ge/180;function ze(r,e,{kL:t=1,kC:i=1,kH:a=1}={}){let[s,n,o]=T.from(r),h=ee.from(T,[s,n,o])[1],[l,u,c]=T.from(e),d=ee.from(T,[l,u,c])[1];h<0&&(h=0),d<0&&(d=0);let y=((h+d)/2)**7,M=.5*(1-Math.sqrt(y/(y+ut))),b=(1+M)*n,S=(1+M)*u,x=Math.sqrt(b**2+o**2),R=Math.sqrt(S**2+c**2),D=b===0&&o===0?0:Math.atan2(o,b),z=S===0&&c===0?0:Math.atan2(c,S);D<0&&(D+=2*ge),z<0&&(z+=2*ge),D*=ct,z*=ct;let N=l-s,V=R-x,$=z-D,oe=D+z,gr=Math.abs($),he;x*R===0?he=0:gr<=180?he=$:$>180?he=$-360:$<-180?he=$+360:console.log("the unthinkable has happened");let pr=2*Math.sqrt(R*x)*Math.sin(he*W/2),ca=(s+l)/2,Ke=(x+R)/2,_r=Math.pow(Ke,7),O;x*R===0?O=oe:gr<=180?O=oe/2:oe<360?O=(oe+360)/2:O=(oe-360)/2;let yr=(ca-50)**2,da=1+.015*yr/Math.sqrt(20+yr),Mr=1+.045*Ke,le=1;le-=.17*Math.cos((O-30)*W),le+=.24*Math.cos(2*O*W),le+=.32*Math.cos((3*O+6)*W),le-=.2*Math.cos((4*O-63)*W);let br=1+.015*Ke*le,fa=30*Math.exp(-1*((O-275)/25)**2),ma=2*Math.sqrt(_r/(_r+ut)),ga=-1*Math.sin(2*fa*W)*ma,Ee=(N/(t*da))**2;return Ee+=(V/(i*Mr))**2,Ee+=(pr/(a*br))**2,Ee+=ga*(V/(i*Mr))*(pr/(a*br)),Math.sqrt(Ee)}const Ar=75e-6;function te(r,e=r.space,{epsilon:t=Ar}={}){r=p(r),e=f.get(e);let i=r.coords;return e!==r.space&&(i=e.from(r)),e.inGamut(i,{epsilon:t})}function re(r){return{space:r.space,coords:r.coords.slice(),alpha:r.alpha}}function U(r,{method:e=Y.gamut_mapping,space:t=r.space}={}){if(Q(arguments[1])&&(t=arguments[1]),t=f.get(t),te(r,t,{epsilon:0}))return p(r);let i=P(r,t);if(e!=="clip"&&!te(r,t)){let a=U(re(i),{method:"clip",space:t});if(ze(r,a)>2){let s=f.resolveCoord(e),n=s.space,o=s.id,h=P(i,n),u=(s.range||s.refRange)[0],c=.01,d=u,g=E(h,o);for(;g-d>c;){let y=re(h);y=U(y,{space:t,method:"clip"}),ze(h,y)-2<c?d=E(h,o):g=E(h,o),q(h,o,(d+g)/2)}i=P(h,t)}else i=a}if(e==="clip"||!te(i,t,{epsilon:0})){let a=Object.values(t.coords).map(s=>s.range||[]);i.coords=i.coords.map((s,n)=>{let[o,h]=a[n];return o!==void 0&&(s=Math.max(o,s)),h!==void 0&&(s=Math.min(s,h)),s})}return t!==r.space&&(i=P(i,r.space)),r.coords=i.coords,r}U.returns="color";function P(r,e,{inGamut:t}={}){r=p(r),e=f.get(e);let i=e.from(r),a={space:e,coords:i,alpha:r.alpha};return t&&(a=U(a)),a}P.returns="color";function pe(r,{precision:e=Y.precision,format:t="default",inGamut:i=!0,...a}={}){var h;let s;r=p(r);let n=t;t=r.space.getFormat(t)??r.space.getFormat("default")??f.DEFAULT_FORMAT,i||(i=t.toGamut);let o=r.coords;if(o=o.map(l=>l||0),i&&!te(r)&&(o=U(re(r),i===!0?void 0:i).coords),t.type==="custom")if(a.precision=e,t.serialize)s=t.serialize(o,r.alpha,a);else throw new TypeError(`format ${n} can only be used to parse colors, not for serialization`);else{let l=t.name||"color";t.serializeCoords?o=t.serializeCoords(o,e):e!==null&&(o=o.map(g=>ue(g,e)));let u=[...o];if(l==="color"){let g=t.id||((h=t.ids)==null?void 0:h[0])||r.space.id;u.unshift(g)}let c=r.alpha;e!==null&&(c=ue(c,e));let d=r.alpha<1&&!t.noAlpha?`${t.commas?",":" /"} ${c}`:"";s=`${l}(${u.join(t.commas?", ":" ")}${d})`}return s}const Er=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],Pr=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]];var _e=new C({id:"rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:Er,fromXYZ_M:Pr,formats:{color:{}}});const ye=1.09929682680944,dt=.018053968510807;var ft=new C({id:"rec2020",name:"REC.2020",base:_e,toBase(r){return r.map(function(e){return e<dt*4.5?e/4.5:Math.pow((e+ye-1)/ye,1/.45)})},fromBase(r){return r.map(function(e){return e>=dt?ye*Math.pow(e,.45)-(ye-1):4.5*e})},formats:{color:{}}});const Rr=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],Br=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]];var mt=new C({id:"p3-linear",name:"Linear P3",white:"D65",toXYZ_M:Rr,fromXYZ_M:Br});const Fr=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],zr=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]];var gt=new C({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:Fr,fromXYZ_M:zr,formats:{color:{}}}),pt={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]};let _t=Array(3).fill("<percentage> | <number>[0, 255]"),yt=Array(3).fill("<number>[0, 255]");var ie=new C({id:"srgb",name:"sRGB",base:gt,fromBase:r=>r.map(e=>{let t=e<0?-1:1,i=e*t;return i>.0031308?t*(1.055*i**(1/2.4)-.055):12.92*e}),toBase:r=>r.map(e=>{let t=e<0?-1:1,i=e*t;return i<.04045?e/12.92:t*((i+.055)/1.055)**2.4}),formats:{rgb:{coords:_t},rgb_number:{name:"rgb",commas:!0,coords:yt,noAlpha:!0},color:{},rgba:{coords:_t,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:yt},hex:{type:"custom",toGamut:!0,test:r=>/^#([a-f0-9]{3,4}){1,2}$/i.test(r),parse(r){r.length<=5&&(r=r.replace(/[a-f0-9]/gi,"$&$&"));let e=[];return r.replace(/[a-f0-9]{2}/gi,t=>{e.push(parseInt(t,16)/255)}),{spaceId:"srgb",coords:e.slice(0,3),alpha:e.slice(3)[0]}},serialize:(r,e,{collapse:t=!0}={})=>{e<1&&r.push(e),r=r.map(s=>Math.round(s*255));let i=t&&r.every(s=>s%17===0);return"#"+r.map(s=>i?(s/17).toString(16):s.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:r=>/^[a-z]+$/i.test(r),parse(r){r=r.toLowerCase();let e={spaceId:"srgb",coords:null,alpha:1};if(r==="transparent"?(e.coords=pt.black,e.alpha=0):e.coords=pt[r],e.coords)return e}}}}),Mt=new C({id:"p3",name:"P3",base:mt,fromBase:ie.fromBase,toBase:ie.toBase,formats:{color:{id:"display-p3"}}});if(Y.display_space=ie,typeof CSS<"u"&&CSS.supports)for(let r of[T,ft,Mt]){let e=r.getMinCoords(),i=pe({space:r,coords:e,alpha:1});if(CSS.supports("color",i)){Y.display_space=r;break}}function Yr(r,{space:e=Y.display_space,...t}={}){let i=pe(r,t);if(typeof CSS>"u"||CSS.supports("color",i)||!Y.display_space)i=new String(i),i.color=r;else{let a=P(r,e);i=new String(pe(a,t)),i.color=a}return i}function bt(r,e,t="lab"){t=f.get(t);let i=t.from(r),a=t.from(e);return Math.sqrt(i.reduce((s,n,o)=>{let h=a[o];return isNaN(n)||isNaN(h)?s:s+(h-n)**2},0))}function $r(r,e){return r=p(r),e=p(e),r.space===e.space&&r.alpha===e.alpha&&r.coords.every((t,i)=>t===e.coords[i])}function G(r){return E(r,[A,"y"])}function vt(r,e){q(r,[A,"y"],e)}function Or(r){Object.defineProperty(r.prototype,"luminance",{get(){return G(this)},set(e){vt(this,e)}})}var Xr=Object.freeze({__proto__:null,getLuminance:G,register:Or,setLuminance:vt});function Ir(r,e){r=p(r),e=p(e);let t=Math.max(G(r),0),i=Math.max(G(e),0);return i>t&&([t,i]=[i,t]),(t+.05)/(i+.05)}const jr=.56,qr=.57,Ur=.62,Gr=.65,kt=.022,Zr=1.414,Hr=.1,Vr=5e-4,Nr=1.14,wt=.027,Wr=1.14;function St(r){return r>=kt?r:r+(kt-r)**Zr}function J(r){let e=r<0?-1:1,t=Math.abs(r);return e*Math.pow(t,2.4)}function Jr(r,e){e=p(e),r=p(r);let t,i,a,s,n,o;e=P(e,"srgb"),[s,n,o]=e.coords;let h=J(s)*.2126729+J(n)*.7151522+J(o)*.072175;r=P(r,"srgb"),[s,n,o]=r.coords;let l=J(s)*.2126729+J(n)*.7151522+J(o)*.072175,u=St(h),c=St(l),d=c>u;return Math.abs(c-u)<Vr?i=0:d?(t=c**jr-u**qr,i=t*Nr):(t=c**Gr-u**Ur,i=t*Wr),Math.abs(i)<Hr?a=0:i>0?a=i-wt:a=i+wt,a*100}function Qr(r,e){r=p(r),e=p(e);let t=Math.max(G(r),0),i=Math.max(G(e),0);i>t&&([t,i]=[i,t]);let a=t+i;return a===0?0:(t-i)/a}const Kr=5e4;function ei(r,e){r=p(r),e=p(e);let t=Math.max(G(r),0),i=Math.max(G(e),0);return i>t&&([t,i]=[i,t]),i===0?Kr:(t-i)/i}function ti(r,e){r=p(r),e=p(e);let t=E(r,[T,"l"]),i=E(e,[T,"l"]);return Math.abs(t-i)}const ri=216/24389,xt=24/116,Me=24389/27;let Ye=B.D65;var $e=new f({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Ye,base:A,fromBase(r){let t=r.map((i,a)=>i/Ye[a]).map(i=>i>ri?Math.cbrt(i):(Me*i+16)/116);return[116*t[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])]},toBase(r){let e=[];return e[1]=(r[0]+16)/116,e[0]=r[1]/500+e[1],e[2]=e[1]-r[2]/200,[e[0]>xt?Math.pow(e[0],3):(116*e[0]-16)/Me,r[0]>8?Math.pow((r[0]+16)/116,3):r[0]/Me,e[2]>xt?Math.pow(e[2],3):(116*e[2]-16)/Me].map((i,a)=>i*Ye[a])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});const Oe=Math.pow(5,.5)*.5+.5;function ii(r,e){r=p(r),e=p(e);let t=E(r,[$e,"l"]),i=E(e,[$e,"l"]),a=Math.abs(Math.pow(t,Oe)-Math.pow(i,Oe)),s=Math.pow(a,1/Oe)*Math.SQRT2-40;return s<7.5?0:s}var be=Object.freeze({__proto__:null,contrastAPCA:Jr,contrastDeltaPhi:ii,contrastLstar:ti,contrastMichelson:Qr,contrastWCAG21:Ir,contrastWeber:ei});function ai(r,e,t={}){Q(t)&&(t={algorithm:t});let{algorithm:i,...a}=t;if(!i){let s=Object.keys(be).map(n=>n.replace(/^contrast/,"")).join(", ");throw new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${s}`)}r=p(r),e=p(e);for(let s in be)if("contrast"+i.toLowerCase()===s.toLowerCase())return be[s](r,e,a);throw new TypeError(`Unknown contrast algorithm: ${i}`)}function Ct(r){let[e,t,i]=K(r,A),a=e+15*t+3*i;return[4*e/a,9*t/a]}function Tt(r){let[e,t,i]=K(r,A),a=e+t+i;return[e/a,t/a]}function si(r){Object.defineProperty(r.prototype,"uv",{get(){return Ct(this)}}),Object.defineProperty(r.prototype,"xy",{get(){return Tt(this)}})}var ni=Object.freeze({__proto__:null,register:si,uv:Ct,xy:Tt});function oi(r,e){return bt(r,e,"lab")}const Lt=Math.PI/180;function hi(r,e,{l:t=2,c:i=1}={}){let[a,s,n]=T.from(r),[,o,h]=ee.from(T,[a,s,n]),[l,u,c]=T.from(e),d=ee.from(T,[l,u,c])[1];o<0&&(o=0),d<0&&(d=0);let g=a-l,y=o-d,M=s-u,b=n-c,S=M**2+b**2-y**2,x=.511;a>=16&&(x=.040975*a/(1+.01765*a));let R=.0638*o/(1+.0131*o)+.638,D;Number.isNaN(h)&&(h=0),h>=164&&h<=345?D=.56+Math.abs(.2*Math.cos((h+168)*Lt)):D=.36+Math.abs(.4*Math.cos((h+35)*Lt));let z=Math.pow(o,4),N=Math.sqrt(z/(z+1900)),V=R*(N*D+1-N),$=(g/(t*x))**2;return $+=(y/(i*R))**2,$+=S/V**2,Math.sqrt($)}const Dt=203;var Xe=new f({id:"xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:A,fromBase(r){return r.map(e=>Math.max(e*Dt,0))},toBase(r){return r.map(e=>Math.max(e/Dt,0))}});const ve=1.15,ke=.66,At=2610/2**14,li=2**14/2610,Et=3424/2**12,Pt=2413/2**7,Rt=2392/2**7,ui=1.7*2523/2**5,Bt=2**5/(1.7*2523),we=-.56,Ie=16295499532821565e-27,ci=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],di=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],fi=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],mi=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]];var Ft=new f({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:Xe,fromBase(r){let[e,t,i]=r,a=ve*e-(ve-1)*i,s=ke*t-(ke-1)*e,o=v(ci,[a,s,i]).map(function(d){let g=Et+Pt*(d/1e4)**At,y=1+Rt*(d/1e4)**At;return(g/y)**ui}),[h,l,u]=v(fi,o);return[(1+we)*h/(1+we*h)-Ie,l,u]},toBase(r){let[e,t,i]=r,a=(e+Ie)/(1+we-we*(e+Ie)),n=v(mi,[a,t,i]).map(function(d){let g=Et-d**Bt,y=Rt*d**Bt-Pt;return 1e4*(g/y)**li}),[o,h,l]=v(di,n),u=(o+(ve-1)*l)/ve,c=(h+(ke-1)*u)/ke;return[u,c,l]},formats:{color:{}}}),je=new f({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:Ft,fromBase(r){let[e,t,i]=r,a;const s=2e-4;return Math.abs(t)<s&&Math.abs(i)<s?a=NaN:a=Math.atan2(i,t)*180/Math.PI,[e,Math.sqrt(t**2+i**2),me(a)]},toBase(r){return[r[0],r[1]*Math.cos(r[2]*Math.PI/180),r[1]*Math.sin(r[2]*Math.PI/180)]},formats:{color:{}}});function gi(r,e){let[t,i,a]=je.from(r),[s,n,o]=je.from(e),h=t-s,l=i-n;Number.isNaN(a)&&Number.isNaN(o)?(a=0,o=0):Number.isNaN(a)?a=o:Number.isNaN(o)&&(o=a);let u=a-o,c=2*Math.sqrt(i*n)*Math.sin(u/2*(Math.PI/180));return Math.sqrt(h**2+l**2+c**2)}const zt=3424/4096,Yt=2413/128,$t=2392/128,Ot=2610/16384,pi=2523/32,_i=16384/2610,Xt=32/2523,yi=[[.3592,.6976,-.0358],[-.1922,1.1004,.0755],[.007,.0749,.8434]],Mi=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],bi=[[.9999888965628402,.008605050147287059,.11103437159861648],[1.00001110343716,-.008605050147287059,-.11103437159861648],[1.0000320633910054,.56004913547279,-.3206339100541203]],vi=[[2.0701800566956137,-1.326456876103021,.20661600684785517],[.3649882500326575,.6804673628522352,-.04542175307585323],[-.04959554223893211,-.04942116118675749,1.1879959417328034]];var qe=new f({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:Xe,fromBase(r){let e=v(yi,r);return ki(e)},toBase(r){let e=wi(r);return v(vi,e)},formats:{color:{}}});function ki(r){let e=r.map(function(t){let i=zt+Yt*(t/1e4)**Ot,a=1+$t*(t/1e4)**Ot;return(i/a)**pi});return v(Mi,e)}function wi(r){return v(bi,r).map(function(i){let a=Math.max(i**Xt-zt,0),s=Yt-$t*i**Xt;return 1e4*(a/s)**_i})}function Si(r,e){let[t,i,a]=qe.from(r),[s,n,o]=qe.from(e);return 720*Math.sqrt((t-s)**2+.25*(i-n)**2+(a-o)**2)}const xi=[[.8190224432164319,.3619062562801221,-.12887378261216414],[.0329836671980271,.9292868468965546,.03614466816999844],[.048177199566046255,.26423952494422764,.6335478258136937]],Ci=[[1.2268798733741557,-.5578149965554813,.28139105017721583],[-.04057576262431372,1.1122868293970594,-.07171106666151701],[-.07637294974672142,-.4214933239627914,1.5869240244272418]],Ti=[[.2104542553,.793617785,-.0040720468],[1.9779984951,-2.428592205,.4505937099],[.0259040371,.7827717662,-.808675766]],Li=[[.9999999984505198,.39633779217376786,.2158037580607588],[1.0000000088817609,-.10556134232365635,-.06385417477170591],[1.0000000546724108,-.08948418209496575,-1.2914855378640917]];var Se=new f({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"L"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:A,fromBase(r){let t=v(xi,r).map(i=>Math.cbrt(i));return v(Ti,t)},toBase(r){let t=v(Li,r).map(i=>i**3);return v(Ci,t)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function Di(r,e){let[t,i,a]=Se.from(r),[s,n,o]=Se.from(e),h=t-s,l=i-n,u=a-o;return Math.sqrt(h**2+l**2+u**2)}var xe={deltaE76:oi,deltaECMC:hi,deltaE2000:ze,deltaEJz:gi,deltaEITP:Si,deltaEOK:Di};function ae(r,e,t={}){Q(t)&&(t={method:t});let{method:i=Y.deltaE,...a}=t;r=p(r),e=p(e);for(let s in xe)if("deltae"+i.toLowerCase()===s.toLowerCase())return xe[s](r,e,a);throw new TypeError(`Unknown deltaE method: ${i}`)}function Ai(r,e=.25){let i=[f.get("oklch","lch"),"l"];return q(r,i,a=>a*(1+e))}function Ei(r,e=.25){let i=[f.get("oklch","lch"),"l"];return q(r,i,a=>a*(1-e))}var Pi=Object.freeze({__proto__:null,darken:Ei,lighten:Ai});function It(r,e,t=.5,i={}){[r,e]=[p(r),p(e)],I(t)==="object"&&([t,i]=[.5,t]);let{space:a,outputSpace:s,premultiplied:n}=i;return se(r,e,{space:a,outputSpace:s,premultiplied:n})(t)}function jt(r,e,t={}){let i;Ue(r)&&([i,t]=[r,e],[r,e]=i.rangeArgs.colors);let{maxDeltaE:a,deltaEMethod:s,steps:n=2,maxSteps:o=1e3,...h}=t;i||([r,e]=[p(r),p(e)],i=se(r,e,h));let l=ae(r,e),u=a>0?Math.max(n,Math.ceil(l/a)+1):n,c=[];if(o!==void 0&&(u=Math.min(u,o)),u===1)c=[{p:.5,color:i(.5)}];else{let d=1/(u-1);c=Array.from({length:u},(g,y)=>{let M=y*d;return{p:M,color:i(M)}})}if(a>0){let d=c.reduce((g,y,M)=>{if(M===0)return 0;let b=ae(y.color,c[M-1].color,s);return Math.max(g,b)},0);for(;d>a;){d=0;for(let g=1;g<c.length&&c.length<o;g++){let y=c[g-1],M=c[g],b=(M.p+y.p)/2,S=i(b);d=Math.max(d,ae(S,y.color),ae(S,M.color)),c.splice(g,0,{p:b,color:i(b)}),g++}}}return c=c.map(d=>d.color),c}function se(r,e,t={}){if(Ue(r)){let[h,l]=[r,e];return se(...h.rangeArgs.colors,{...h.rangeArgs.options,...l})}let{space:i,outputSpace:a,progression:s,premultiplied:n}=t;r=p(r),e=p(e),r=re(r),e=re(e);let o={colors:[r,e],options:t};if(i?i=f.get(i):i=f.registry[Y.interpolationSpace]||r.space,a=a?f.get(a):i,r=P(r,i),e=P(e,i),r=U(r),e=U(e),i.coords.h&&i.coords.h.type==="angle"){let h=t.hue=t.hue||"shorter",l=[i,"h"],[u,c]=[E(r,l),E(e,l)];[u,c]=Dr(h,[u,c]),q(r,l,u),q(e,l,c)}return n&&(r.coords=r.coords.map(h=>h*r.alpha),e.coords=e.coords.map(h=>h*e.alpha)),Object.assign(h=>{h=s?s(h):h;let l=r.coords.map((d,g)=>{let y=e.coords[g];return ce(d,y,h)}),u=ce(r.alpha,e.alpha,h),c={space:i,coords:l,alpha:u};return n&&(c.coords=c.coords.map(d=>d/u)),a!==i&&(c=P(c,a)),c},{rangeArgs:o})}function Ue(r){return I(r)==="function"&&!!r.rangeArgs}Y.interpolationSpace="lab";function Ri(r){r.defineFunction("mix",It,{returns:"color"}),r.defineFunction("range",se,{returns:"function<color>"}),r.defineFunction("steps",jt,{returns:"array<color>"})}var Bi=Object.freeze({__proto__:null,isRange:Ue,mix:It,range:se,register:Ri,steps:jt}),qt=new f({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:ie,fromBase:r=>{let e=Math.max(...r),t=Math.min(...r),[i,a,s]=r,[n,o,h]=[NaN,0,(t+e)/2],l=e-t;if(l!==0){switch(o=h===0||h===1?0:(e-h)/Math.min(h,1-h),e){case i:n=(a-s)/l+(a<s?6:0);break;case a:n=(s-i)/l+2;break;case s:n=(i-a)/l+4}n=n*60}return[n,o*100,h*100]},toBase:r=>{let[e,t,i]=r;e=e%360,e<0&&(e+=360),t/=100,i/=100;function a(s){let n=(s+e/30)%12,o=t*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(n-3,9-n,1))}return[a(0),a(8),a(4)]},formats:{hsl:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),Ut=new f({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:qt,fromBase(r){let[e,t,i]=r;t/=100,i/=100;let a=i+t*Math.min(i,1-i);return[e,a===0?0:200*(1-i/a),100*a]},toBase(r){let[e,t,i]=r;t/=100,i/=100;let a=i*(1-t/2);return[e,a===0||a===1?0:(i-a)/Math.min(a,1-a)*100,a*100]},formats:{color:{toGamut:!0}}}),Fi=new f({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:Ut,fromBase(r){let[e,t,i]=r;return[e,i*(100-t)/100,100-i]},toBase(r){let[e,t,i]=r;t/=100,i/=100;let a=t+i;if(a>=1){let o=t/a;return[e,0,o*100]}let s=1-i,n=s===0?0:1-t/s;return[e,n*100,s*100]},formats:{hwb:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]}}});const zi=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],Yi=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]];var Gt=new C({id:"a98rgb-linear",name:"Linear Adobe® 98 RGB compatible",white:"D65",toXYZ_M:zi,fromXYZ_M:Yi}),$i=new C({id:"a98rgb",name:"Adobe® 98 RGB compatible",base:Gt,toBase:r=>r.map(e=>Math.pow(Math.abs(e),563/256)*Math.sign(e)),fromBase:r=>r.map(e=>Math.pow(Math.abs(e),256/563)*Math.sign(e)),formats:{color:{id:"a98-rgb"}}});const Oi=[[.7977604896723027,.13518583717574031,.0313493495815248],[.2880711282292934,.7118432178101014,8565396060525902e-20],[0,0,.8251046025104601]],Xi=[[1.3457989731028281,-.25558010007997534,-.05110628506753401],[-.5446224939028347,1.5082327413132781,.02053603239147973],[0,0,1.2119675456389454]];var Zt=new C({id:"prophoto-linear",name:"Linear ProPhoto",white:"D50",base:Be,toXYZ_M:Oi,fromXYZ_M:Xi});const Ii=1/512,ji=16/512;var qi=new C({id:"prophoto",name:"ProPhoto",base:Zt,toBase(r){return r.map(e=>e<ji?e/16:e**1.8)},fromBase(r){return r.map(e=>e>=Ii?e**(1/1.8):16*e)},formats:{color:{id:"prophoto-rgb"}}}),Ui=new f({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:Se,fromBase(r){let[e,t,i]=r,a;const s=2e-4;return Math.abs(t)<s&&Math.abs(i)<s?a=NaN:a=Math.atan2(i,t)*180/Math.PI,[e,Math.sqrt(t**2+i**2),me(a)]},toBase(r){let[e,t,i]=r,a,s;return isNaN(i)?(a=0,s=0):(a=t*Math.cos(i*Math.PI/180),s=t*Math.sin(i*Math.PI/180)),[e,a,s]},formats:{oklch:{coords:["<number> | <percentage>","<number> | <percentage>[0,1]","<number> | <angle>"]}}});const Ht=203,Vt=2610/2**14,Gi=2**14/2610,Zi=2523/2**5,Nt=2**5/2523,Wt=3424/2**12,Jt=2413/2**7,Qt=2392/2**7;var Hi=new C({id:"rec2100pq",name:"REC.2100-PQ",base:_e,toBase(r){return r.map(function(e){return(Math.max(e**Nt-Wt,0)/(Jt-Qt*e**Nt))**Gi*1e4/Ht})},fromBase(r){return r.map(function(e){let t=Math.max(e*Ht/1e4,0),i=Wt+Jt*t**Vt,a=1+Qt*t**Vt;return(i/a)**Zi})},formats:{color:{id:"rec2100-pq"}}});const Kt=.17883277,er=.28466892,tr=.55991073,Ge=3.7743;var Vi=new C({id:"rec2100hlg",cssid:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:_e,toBase(r){return r.map(function(e){return e<=.5?e**2/3*Ge:(Math.exp((e-tr)/Kt)+er)/12*Ge})},fromBase(r){return r.map(function(e){return e/=Ge,e<=1/12?Math.sqrt(3*e):Kt*Math.log(12*e-er)+tr})},formats:{color:{id:"rec2100-hlg"}}});const rr={};j.add("chromatic-adaptation-start",r=>{r.options.method&&(r.M=ir(r.W1,r.W2,r.options.method))}),j.add("chromatic-adaptation-end",r=>{r.M||(r.M=ir(r.W1,r.W2,r.options.method))});function Ce({id:r,toCone_M:e,fromCone_M:t}){rr[r]=arguments[0]}function ir(r,e,t="Bradford"){let i=rr[t],[a,s,n]=v(i.toCone_M,r),[o,h,l]=v(i.toCone_M,e),u=[[o/a,0,0],[0,h/s,0],[0,0,l/n]],c=v(u,i.toCone_M);return v(i.fromCone_M,c)}Ce({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599364,-1.1293816,.2198974],[.3611914,.6388125,-64e-7],[0,0,1.0890636]]}),Ce({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929,-.1470543,.1599627],[.4323053,.5183603,.0492912],[-.0085287,.0400428,.9684867]]}),Ce({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238,-.278869,.1827452],[.454369,.4735332,.0720978],[-.0096276,-.005698,1.0153256]]}),Ce({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.011254630531685,.1491867754444518],[.3875265432361372,.6214474419314753,-.008973985167612518],[-.01584149884933386,-.03412293802851557,1.04996443687785]]}),Object.assign(B,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),B.ACES=[.32168/.33767,1,(1-.32168-.33767)/.33767];const Ni=[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],Wi=[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]];var ar=new C({id:"acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:B.ACES,toXYZ_M:Ni,fromXYZ_M:Wi,formats:{color:{}}});const Te=2**-16,Ze=-.35828683,Le=(Math.log2(65504)+9.72)/17.52;var Ji=new C({id:"acescc",name:"ACEScc",coords:{r:{range:[Ze,Le],name:"Red"},g:{range:[Ze,Le],name:"Green"},b:{range:[Ze,Le],name:"Blue"}},referred:"scene",base:ar,toBase(r){const e=-.3013698630136986;return r.map(function(t){return t<=e?(2**(t*17.52-9.72)-Te)*2:t<Le?2**(t*17.52-9.72):65504})},fromBase(r){return r.map(function(e){return e<=0?(Math.log2(Te)+9.72)/17.52:e<Te?(Math.log2(Te+e*.5)+9.72)/17.52:(Math.log2(e)+9.72)/17.52})},formats:{color:{}}}),sr=Object.freeze({__proto__:null,A98RGB:$i,A98RGB_Linear:Gt,ACEScc:Ji,ACEScg:ar,HSL:qt,HSV:Ut,HWB:Fi,ICTCP:qe,JzCzHz:je,Jzazbz:Ft,LCH:ee,Lab:T,Lab_D65:$e,OKLCH:Ui,OKLab:Se,P3:Mt,P3_Linear:mt,ProPhoto:qi,ProPhoto_Linear:Zt,REC_2020:ft,REC_2020_Linear:_e,REC_2100_HLG:Vi,REC_2100_PQ:Hi,XYZ_ABS_D65:Xe,XYZ_D50:Be,XYZ_D65:A,sRGB:ie,sRGB_Linear:gt});class _{constructor(...e){let t;e.length===1&&(t=p(e[0]));let i,a,s;t?(i=t.space||t.spaceId,a=t.coords,s=t.alpha):[i,a,s]=e,Object.defineProperty(this,"space",{value:f.get(i),writable:!1,enumerable:!0,configurable:!0}),this.coords=a?a.slice():[0,0,0],this.alpha=s<1?s:1;for(let n=0;n<this.coords.length;n++)this.coords[n]==="NaN"&&(this.coords[n]=NaN);for(let n in this.space.coords)Object.defineProperty(this,n,{get:()=>this.get(n),set:o=>this.set(n,o)})}get spaceId(){return this.space.id}clone(){return new _(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...e){let t=Yr(this,...e);return t.color=new _(t.color),t}static get(e,...t){return e instanceof _?e:new _(e,...t)}static defineFunction(e,t,i=t){let{instance:a=!0,returns:s}=i,n=function(...o){let h=t(...o);if(s==="color")h=_.get(h);else if(s==="function<color>"){let l=h;h=function(...u){let c=l(...u);return _.get(c)},Object.assign(h,l)}else s==="array<color>"&&(h=h.map(l=>_.get(l)));return h};e in _||(_[e]=n),a&&(_.prototype[e]=function(...o){return n(this,...o)})}static defineFunctions(e){for(let t in e)_.defineFunction(t,e[t],e[t])}static extend(e){if(e.register)e.register(_);else for(let t in e)_.defineFunction(t,e[t])}}_.defineFunctions({get:E,getAll:K,set:q,setAll:ht,to:P,equals:$r,inGamut:te,toGamut:U,distance:bt,toString:pe}),Object.assign(_,{util:Sr,hooks:j,WHITES:B,Space:f,spaces:f.registry,parse:ot,defaults:Y});for(let r of Object.keys(sr))f.register(sr[r]);for(let r in f.registry)He(r,f.registry[r]);j.add("colorspace-init-end",r=>{var e;He(r.id,r),(e=r.aliases)==null||e.forEach(t=>{He(t,r)})});function He(r,e){Object.keys(e.coords),Object.values(e.coords).map(i=>i.name);let t=r.replace(/-/g,"_");Object.defineProperty(_.prototype,t,{get(){let i=this.getAll(r);return typeof Proxy>"u"?i:new Proxy(i,{has:(a,s)=>{try{return f.resolveCoord([e,s]),!0}catch{}return Reflect.has(a,s)},get:(a,s,n)=>{if(s&&typeof s!="symbol"&&!(s in a)){let{index:o}=f.resolveCoord([e,s]);if(o>=0)return a[o]}return Reflect.get(a,s,n)},set:(a,s,n,o)=>{if(s&&typeof s!="symbol"&&!(s in a)||s>=0){let{index:h}=f.resolveCoord([e,s]);if(h>=0)return a[h]=n,this.setAll(r,a),!0}return Reflect.set(a,s,n,o)}})},set(i){this.setAll(r,i)},configurable:!0,enumerable:!0})}_.extend(xe),_.extend({deltaE:ae}),Object.assign(_,{deltaEMethods:xe}),_.extend(Pi),_.extend({contrast:ai}),_.extend(ni),_.extend(Xr),_.extend(Bi),_.extend(be);function Ve(r){return r}function Z(r){return r*r*(3-2*r)}function Ne(r,e,t,i){return r*e+t*i}function nr(r,e,t,i){let a=[Math.round((r.r*e+t.r*i)*255),Math.round((r.g*e+t.g*i)*255),Math.round((r.b*e+t.b*i)*255)];return`rgb(${a[0]}, ${a[1]}, ${a[2]})`}function or(r,e,t,i){return r.map((a,s)=>Ne(a,e,t[s],i))}function De(r){if(typeof r=="number")return Ne;if(typeof r=="string"){let e={};return(t,i,a,s)=>(e[t]||(e[t]=new _(t).srgb),e[a]||(e[a]=new _(a).srgb),nr(e[t],i,e[a],s))}else if(Array.isArray(r))return or;return(e,t,i,a)=>t<1?e:i}function H(r,e=void 0){return e===void 0&&(e=De(r)),{finalValue:r,interpolate:(t,i)=>e(t,1-Math.min(i,1),r,Math.min(i,1))}}function Qi(r,e=void 0){return e===void 0&&(e=De(r())),{interpolate:(t,i)=>e(t,1-Math.min(i,1),r(),Math.min(i,1))}}function Ki(r,e=void 0){return e===void 0&&(e=De(r[0])),{interpolate:(t,i)=>{let a=Math.min(i,1)*(r.length-1)-1,s=Math.min(a-Math.floor(a),1);return a<0?e(t,1-s,r[0],s):e(r[Math.floor(a)],1-s,r[Math.floor(a)+1],s)}}}class F{constructor(e,t=1e3,i=Ve){this.duration=0,this.finalValue=void 0,this.interpolator=null,this.duration=t,e.hasOwnProperty("finalValue")?this.finalValue=e.finalValue:this.finalValue=void 0,this.interpolator=e,this.curve=i}evaluate(e,t){let i=this.curve(this.duration>0?t/this.duration:1);return this.interpolator.interpolate(e,i)}withDelay(e){return e?new ea(this,e):this}}class ea extends F{constructor(e,t){super(e.interpolator,e.duration+t,e.curve),this.delay=t}evaluate(e,t){return t<=this.delay?e:super.evaluate(e,(t-this.delay)*this.duration/(this.duration-this.delay))}}function ta(r,e=1e3,t=Ve){return new F(H(r),e,t)}var hr=(r=>(r.Waiting="waiting",r.Entering="entering",r.Visible="visible",r.Exiting="exiting",r.Completed="completed",r))(hr||{}),lr=(r=>(r.Show="show",r.Hide="hide",r))(lr||{});class ur{constructor(e={}){this.markStates=new Map,this.marksByID=new Map,this.queuedAnimations=new Map,this._flushTimer=null,this.defer=!1,this.saveExitedMarks=!1,this._callbacks={initialize:e.initialize||(()=>{}),enter:e.enter||(()=>{}),exit:e.exit||(()=>{})}}setVisibleMarks(e){return e.forEach(t=>{this.markStates.set(t,"visible"),this.marksByID.set(t.id,t)}),this}configure(e={}){return this.defer=e.defer??this.defer,this.saveExitedMarks=e.saveExitedMarks??this.saveExitedMarks,this}onInitialize(e){this._callbacks.initialize=e||(()=>{})}onEnter(e){this._callbacks.enter=e||(()=>{})}onExit(e){this._callbacks.exit=e||(()=>{})}_perform(e,t){if(e){if(t=="show"){if(this.markStates.get(e)==="visible")return;this.markStates.set(e,"entering"),this.marksByID.set(e.id,e);let i=this._callbacks.enter(e);i&&i instanceof Promise?i.then(()=>{this.markStates.has(e)&&this.markStates.get(e)=="entering"&&this.markStates.set(e,"visible")},()=>{}):this.markStates.set(e,"visible")}else if(t=="hide"){let i=this.markStates.get(e)??null;if(i==="waiting"||i==="completed")return;this.markStates.set(e,"exiting"),this.marksByID.set(e.id,e);let a=this._callbacks.exit(e);a&&a instanceof Promise?a.then(()=>{this.markStates.has(e)&&this.markStates.get(e)=="exiting"&&(this.saveExitedMarks?this.markStates.set(e,"completed"):(this.marksByID.delete(e.id),this.markStates.delete(e)))},()=>{}):this.saveExitedMarks?this.markStates.set(e,"completed"):(this.marksByID.delete(e.id),this.markStates.delete(e))}}}_enqueue(e,t){let i=this.markStates.get(e);if(i===void 0)return!1;if(t=="show"){if(i=="entering"||i=="visible")return!1;this.markStates.set(e,"entering")}else if(t=="hide"){if(i=="exiting"||i=="completed")return!1;this.markStates.set(e,"exiting")}else console.error("Unknown action enqueued:",t);return this.defer?(this.queuedAnimations.set(e,t),this._flushTimer||(this._flushTimer=window.setTimeout(()=>this._flush(),0))):this._perform(e,t),!0}_flush(){this._flushTimer=null,this.queuedAnimations.forEach((e,t)=>{this._perform(t,e)}),this.queuedAnimations.clear()}show(e){return this.markStates.has(e)||(this._callbacks.initialize(e),this.markStates.set(e,"waiting"),this.marksByID.set(e.id,e)),this._enqueue(e,"show")}hide(e){return this.markStates.has(e)?this._enqueue(e,"hide"):!1}getMarkByID(e,t=!1){let i=this.marksByID.get(e);if(i&&t){let a=this.markStates.get(i);if(a==="exiting"||a==="completed")return}return i}forEach(e){let t=0;this.markStates.forEach((i,a)=>{(i==="entering"||i==="visible"||i==="exiting")&&(e(a,t),t++)})}getMarks(){return Array.from(this.markStates.keys())}getVisibleMarks(){return Array.from(this.markStates.keys()).filter(e=>["waiting","entering","visible"].includes(this.markStates.get(e)))}}function cr(r,e,t){return Object.fromEntries(Object.entries(r).map(([i,a])=>[i,typeof a=="function"?a(e,t):a]))}class We{constructor(e=[],t={animationDuration:1e3,animationCurve:Z}){this.timeProvider=null,this.lazyUpdates=!0,this.useStaging=!0,this.stage=null,this.animatingMarks=new Set,this.updatedMarks=new Set,this.preloadableProperties=new Set,this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!1,this._updateListeners={},this._eventListeners={},this.timeProvider=X(),this.lazyUpdates=!0,this._defaultDuration=1e3,this._defaultCurve=Z,this.configure(t),this.marks=e,this.marksByID=new Map,this.marks.forEach(i=>{if(this.marksByID.has(i.id)){console.error(`ID '${i.id}' is duplicated in mark render group`);return}this.marksByID.set(i.id,i),this._setupMark(i)}),this.stage&&this.stage.setVisibleMarks(this.marks)}configure(e){return e.timeProvider!==void 0&&(this.timeProvider=e.timeProvider),e.lazyUpdates!==void 0&&(this.lazyUpdates=e.lazyUpdates),e.animationDuration!==void 0&&(this._defaultDuration=e.animationDuration),e.animationCurve!==void 0&&(this._defaultCurve=e.animationCurve),this.marks&&this.getMarks().forEach(t=>this._configureMark(t)),this.useStaging=e.useStaging??this.useStaging,this.useStaging?(this.stage=new ur,this.marks&&this.stage.setVisibleMarks(this.marks)):this.stage=null,this}configureStaging(e,t=void 0){return this.useStaging||console.error("Can't configure staging without setting useStaging to true"),this.stage.onInitialize(e.initialize),this.stage.onEnter(e.enter),this.stage.onExit(e.exit),t&&this.stage.configure(t),this}_setupMark(e){this._configureMark(e),e.addListener((t,i,a)=>{this.updatedMarks.add(t),!this.preloadableProperties.has(i)&&a&&this.animatingMarks.add(t),this._changedLastTick=!0}),e.addGraphListener((t,i,a,s)=>{a.forEach(n=>{!s.includes(n)&&n.sourceMarks().length==1&&this.removeMark(n)}),s.forEach(n=>{a.includes(n)||this.addMark(n)})})}_configureMark(e){e.setTimeProvider(this.timeProvider),e.configure({animationDuration:this._defaultDuration,animationCurve:this._defaultCurve}),Object.entries(this._updateListeners).forEach(([t,i])=>e.onUpdate(t,i)),Object.entries(this._eventListeners).forEach(([t,i])=>e.onEvent(t,i))}onUpdate(e,t){return this._updateListeners[e]=t,this.getMarks().forEach(i=>i.onUpdate(e,t)),this}onEvent(e,t){return this._eventListeners[e]=t,this.getMarks().forEach(i=>i.onEvent(e,t)),this}dispatch(e,t=void 0){let i=this.getMarks().map(a=>a.dispatch(e,t)).filter(a=>a instanceof Promise);if(i.length>0)return new Promise((a,s)=>{Promise.all(i).then(()=>a()).catch(s)})}forceUpdate(){return this._forceUpdate=!0,this}currentTime(){return this.timeProvider()}getMarks(){return this.marks}registerPreloadableProperty(e){return this.preloadableProperties.add(e),this}advance(e){this.timeProvider.advance(e);let t=this.lazyUpdates?[...this.animatingMarks,...this.updatedMarks]:this.getMarks();if(this.updatedMarks=new Set,t.length==0&&!this._forceUpdate&&!this._markListChanged)return this._changedLastTick=!1,!1;for(let i of t)i.advance()||this.animatingMarks.delete(i);return this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!0,!0}marksAnimating(){return this.animatingMarks.size>0}animateTo(e,t,i={}){return this.forEach((a,s)=>{a.animateTo(e,typeof t=="function"?t(a,s):t,cr(i,a,s))}),this}animate(e,t={}){return this.preloadableProperties.has(e)&&t.interpolator?(console.error("Cannot apply custom interpolator function on preloadable property."),this):(this.forEach((a,s)=>{let n=cr(t,a,s);a.animate(e,n)}),this)}update(e,t=void 0){return this.forEach((i,a)=>{i.setAttr(e,t===void 0?void 0:typeof t=="function"?t(i,a):t)}),this}wait(e,t=!0){return Promise.all(this.map(i=>i.wait(e,t)))}getMarkByID(e){return this.marksByID.get(e)}forEach(e){this.getMarks().forEach(e)}map(e){return this.getMarks().map(e)}filter(e){let t=Object.assign({},this),i=this.getMarks().filter(e);return Object.keys(this).forEach(a=>{t[a]=this[a]}),t.marks=i,t.marksByID=new Map,i.forEach(a=>{t.marksByID.set(a.id,a)}),vr(this).forEach(a=>{a=="getMarks"?t[a]=()=>i:t[a]=(...s)=>{let n=this.getMarks(),o=this.marksByID;this.marks=i,this.marksByID=t.marksByID;let h=this[a](...s);return this.marks=n,this.marksByID=o,h===this?t:h}}),t}updateTransform(e){return this.getMarks().forEach(t=>t.updateTransform(e)),this}addMark(e){if(this.marksByID.has(e.id))return console.error("Attempted to add mark with ID that exists:",e.id),this;this.marks.push(e),this.marksByID.set(e.id,e),this._setupMark(e),this._markListChanged=!0,this.stage&&this.stage.show(e)}removeMark(e){let t=this.marks.indexOf(e);if(t<0)return console.warn("Attempted to remove mark that does not exist"),this;this.marks.splice(t,1),this.marksByID.delete(e.id),this._markListChanged=!0,this.stage&&this.stage.hide(e)}count(){return this.getMarks().length}changed(e=void 0){return e===void 0?this._changedLastTick:this._changedLastTick&&this.getMarks().some(t=>t.changed(e))}}function ra(r=[]){return new We(r)}const ia=5e3;class ne{constructor(e,t){this._timeProvider=null,this._listeners=[],this._graphListeners=[],this._defaultDuration=1e3,this._defaultCurve=Z,this._changedLastTick=!1,this._adjacency={},this._reverseAdjacency=new Set,this._updateListeners={},this._eventListeners={},this.framesWithUpdate=0,this.id=e,t===void 0&&console.error("Mark constructor requires an ID and an object defining attributes");let i={};Object.keys(t).forEach(a=>{let s=new k(Object.assign(Object.assign({},t[a]),{computeArg:this}));s.addListener((n,o)=>this._attributesChanged(a,o)),i[a]=s}),this.attributes=i}configure(e){return e.animationDuration!==void 0&&(this._defaultDuration=e.animationDuration),e.animationCurve!==void 0&&(this._defaultCurve=e.animationCurve),this}onUpdate(e,t){return this._updateListeners[e]=t,this}onEvent(e,t){return this._eventListeners[e]=t,this}dispatch(e,t=void 0){if(this._eventListeners[e])return this._eventListeners[e](this,t,e)}addListener(e){return this._listeners.push(e),this}removeListener(e){let t=this._listeners.indexOf(e);return t>=0&&(this._listeners=this._listeners.splice(t,1)),this}addGraphListener(e){return this._graphListeners.push(e),this}removeGraphListener(e){let t=this._graphListeners.indexOf(e);return t>=0&&(this._graphListeners=this._graphListeners.splice(t,1)),this}_attributesChanged(e,t){this._changedLastTick=!0,this._listeners.forEach(i=>i(this,e,t)),this._updateListeners[e]&&this._updateListeners[e](this,this.attributes[e].future())}setTimeProvider(e){return this._timeProvider=e,Object.values(this.attributes).forEach(t=>t.setTimeProvider(this._timeProvider)),this}advance(e=void 0){let t=!1;return Object.values(this.attributes).forEach(i=>{i.advance(e)&&(t=!0)}),t?(this.framesWithUpdate+=1,this.framesWithUpdate>ia&&console.warn("Marks are being updated excessively!"),this._changedLastTick=!0,!0):(this.framesWithUpdate=0,this._changedLastTick=!1,!1)}setAttr(e,t=void 0){let i=this.attributes[e];i===void 0&&console.error(`No attribute named '${String(e)}'`);let a=i.last();return t===void 0?i.compute():i.set(t),w(a,i.data())||this._listeners.forEach(s=>s(this,e,!1)),this}attr(e,t=!0){return this.attributes[e]||console.error(`No attribute named '${String(e)}'`),t?this.attributes[e].get():this.attributes[e].getUntransformed()}data(e){return this.attributes[e]===void 0&&console.error(`No attribute named '${String(e)}'`),this.attributes[e].data()}updateTransform(e){return this.attributes[e]===void 0&&console.error(`No attribute named '${String(e)}'`),this.attributes[e].updateTransform(),this}animateTo(e,t,i={}){if(!this.attributes.hasOwnProperty(e))return console.error(`No attribute named '${String(e)}'`),this;if(typeof t=="function")return this.attributes[e].set(t),this.animate(e,{duration:i.duration,curve:i.curve}),this;let a=i.duration===void 0?this._defaultDuration:i.duration,s=i.curve===void 0?this._defaultCurve:i.curve,n=new F(H(t),a,s).withDelay(i.delay||0);return this.attributes[e].animate(n),this}animate(e,t={}){if(!this.attributes.hasOwnProperty(e))return console.error(`Attempting to animate undefined property ${String(e)}`),this;let i;if(t instanceof F)i=t;else if(t.interpolator!==void 0){let a=t.interpolator;i=new F(a,t.duration!==void 0?t.duration:this._defaultDuration,t.curve!==void 0?t.curve:this._defaultCurve).withDelay(t.delay||0)}else{let a=this.data(e);if(!w(a,this.attributes[e].last())||!w(a,this.attributes[e].future())){let s=t.duration!==void 0?t.duration:this._defaultDuration,n=t.curve!==void 0?t.curve:this._defaultCurve;i=new F(H(a),s,n).withDelay(t.delay||0)}else return this}return this.attributes[e].animate(i),this}wait(e,t=!0){let i=Array.isArray(e)?e:[e];return Promise.all(i.map(a=>this.attributes[a].wait(t)))}changed(e=void 0){return e===void 0?this._changedLastTick:Array.isArray(e)?this._changedLastTick&&e.some(t=>this.attributes[t].changed()):this._changedLastTick&&this.attributes[e].changed()}copy(e,t={}){return new ne(e,{...this.attributes,...Object.fromEntries(Object.entries(t).map(([i,a])=>a instanceof k?[i,a]:typeof a=="function"?[i,this.attributes[i].copy({valueFn:a})]:[i,this.attributes[i].copy({value:a})]))})}adj(e,t=void 0){if(t!==void 0){let i=this._adjacency[e]??new Set;this._graphListeners.forEach(a=>a(this,e,Array.from(i),t)),i.forEach(a=>a._removeEdgeFrom(this)),this._adjacency[e]=new Set(t),t.forEach(a=>a._addEdgeFrom(this));return}return Array.from(this._adjacency[e]??new Set)}sourceMarks(){return Array.from(this._reverseAdjacency)}_addEdgeFrom(e){return this._reverseAdjacency.add(e),this}_removeEdgeFrom(e){return this._reverseAdjacency.delete(e),this}}class aa{constructor(e){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof e.advance=="function"?this.toAdvance=[e]:this.toAdvance=e,this.start()}onChange(e){return this._callbacks.push(e),this}start(){return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(e=>e()),requestAnimationFrame(e=>this.tick(e)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(e){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(t=>t.advance(e-this._lastTick)).some(t=>t)&&this._callbacks.forEach(t=>t()),this.stopped||requestAnimationFrame(t=>this.tick(t)),this._lastTick=e}}class sa{constructor(e){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof e.advance=="function"?this.toAdvance=[e]:this.toAdvance=e,this.start()}onChange(e){return this._callbacks.push(e),this}start(){if(this.stopped)return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(e=>e()),requestAnimationFrame(e=>this.tick(e)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(e){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(t=>t.advance(e-this._lastTick)).some(t=>t)?(this._callbacks.forEach(t=>t()),this.stopped||requestAnimationFrame(t=>this.tick(t)),this._lastTick=e):this.stop()}}function Ae(r,e,t){t>0?(r[0].animate(new F(H(e[0]),t,Z)),r[1].animate(new F(H(e[1]),t,Z))):(r[0].set(e[0]),r[1].set(e[1]))}class na{constructor(e={}){this.animationDuration=1e3,this.squareAspect=!0,this._xDomain=[new k(0),new k(1)],this._yDomain=[new k(0),new k(1)],this._xRange=[new k(0),new k(1)],this._yRange=[new k(0),new k(1)],this._xScaleFactor=new k(1),this._yScaleFactor=new k(1),this._translateX=new k(0),this._translateY=new k(0),this._calculatingTransform=!1,this.timeProvider=X(),this.controller=null,this._updatedNoAdvance=!1,this.listeners=[],this.xScale=Object.assign(t=>((t-this.xDomain()[0])*this.xRSpan()/this.xDSpan()+this.xRange()[0])*this._xScaleFactor.get()+this._translateX.get(),{domain:()=>{let t=this.xRange();return[this.xScale.invert(t[0]),this.xScale.invert(t[1])]},range:()=>[this._xRange[0].get(),this._xRange[1].get()],invert:t=>((t-this._translateX.get())/this._xScaleFactor.get()-this.xRange()[0])*this.xDSpan()/this.xRSpan()+this.xDomain()[0]}),this.yScale=Object.assign(t=>((t-this.yDomain()[0])*this.yRSpan()/this.yDSpan()+this.yRange()[0])*this._yScaleFactor.get()+this._translateY.get(),{domain:()=>{let t=this.yRange();return[this.yScale.invert(t[0]),this.yScale.invert(t[1])]},range:()=>[this._yRange[0].get(),this._yRange[1].get()],invert:t=>((t-this._translateY.get())/this._yScaleFactor.get()-this.yRange()[0])*this.yDSpan()/this.yRSpan()+this.yDomain()[0]}),this.xDomain([0,1]),this.yDomain([0,1]),this.xRange([0,1]),this.yRange([0,1]),this.configure(e),this._xScaleFactor.setTimeProvider(this.timeProvider),this._yScaleFactor.setTimeProvider(this.timeProvider),this._translateX.setTimeProvider(this.timeProvider),this._translateY.setTimeProvider(this.timeProvider)}configure(e={}){return this.animationDuration=e.animationDuration!==void 0?e.animationDuration:1e3,this.minScale=e.minScale!==void 0?e.minScale:.1,this.maxScale=e.maxScale!==void 0?e.maxScale:14,this}xDomain(e=void 0,t=!1){return e===void 0?[this._xDomain[0].get(),this._xDomain[1].get()]:(Ae(this._xDomain,e,t?this.animationDuration:0),this)}yDomain(e=void 0,t=!1){return e===void 0?[this._yDomain[0].get(),this._yDomain[1].get()]:(Ae(this._yDomain,e,t?this.animationDuration:0),this)}xRange(e=void 0,t=!1){return e===void 0?[this._xRange[0].get(),this._xRange[1].get()]:(Ae(this._xRange,e,t?this.animationDuration:0),this)}yRange(e=void 0,t=!1){return e===void 0?[this._yRange[0].get(),this._yRange[1].get()]:(Ae(this._yRange,e,t?this.animationDuration:0),this)}xDSpan(){return this._xDomain[1].get()-this._xDomain[0].get()}yDSpan(){return this._yDomain[1].get()-this._yDomain[0].get()}xRSpan(){return this._xRange[1].get()-this._xRange[0].get()}yRSpan(){return this._yRange[1].get()-this._yRange[0].get()}makeSquareAspect(){let e=this.xRSpan()/this.xDSpan(),t=this.yRSpan()/this.yDSpan(),i=this.yDomain(),a=this.xDomain();if(e<t){let s=(i[0]+i[1])*.5,n=this.yRSpan()/e;this.yDomain([s-n*.5,s+n*.5])}else{let s=(a[0]+a[1])*.5,n=this.xRSpan()/t;this.xDomain([s-n*.5,s+n*.5])}return this}onUpdate(e){return this.listeners.push(e),this}isNeutral(){return Math.abs(this._xScaleFactor.get()-1)<=.01&&Math.abs(this._yScaleFactor.get()-1)<=.01&&Math.abs(this._translateX.get())<=5&&Math.abs(this._translateY.get())<=5}advance(e=void 0){return this.timeProvider.advance(e),[this._xDomain[0].advance(e),this._xDomain[1].advance(e),this._yDomain[0].advance(e),this._yDomain[1].advance(e),this._xRange[0].advance(e),this._xRange[1].advance(e),this._yRange[0].advance(e),this._yRange[1].advance(e),this._xScaleFactor.advance(e),this._yScaleFactor.advance(e),this._translateX.advance(e),this._translateY.advance(e)].some(i=>i)?(this._updatedNoAdvance=!1,this.listeners.forEach(i=>i(this)),!0):(this._updatedNoAdvance||(this.listeners.forEach(i=>i(this)),this._updatedNoAdvance=!0),!1)}scaleBy(e,t=null){this.unfollow();let i=this._translateX.get(),a=this._translateY.get(),s=this._xScaleFactor.get(),n=this._yScaleFactor.get();t?t=[(t[0]-i)/s,(t[1]-a)/n]:t=[(this.xRange[0]+this.xRange[1])*.5,(this.yRange[0]+this.yRange[1])*.5];let o=typeof e=="number"?e:e[0],h=typeof e=="number"?e:e[1],l=s+o;return l<=this.maxScale&&l>=this.minScale&&(this._xScaleFactor.set(l),this._translateX.set(i-o*t[0])),l=n+h,l<=this.maxScale&&l>=this.minScale&&(this._yScaleFactor.set(l),this._translateY.set(a-h*t[1])),this}translateBy(e,t){return this.unfollow(),this._translateX.set(this._translateX.get()+e),this._translateY.set(this._translateY.get()+t),this}transform(e=void 0,t=!1){if(e!==void 0){if(this.unfollow(),t){let i=a=>new F(H(a),this.animationDuration,Z);e.kx!==void 0?this._xScaleFactor.animate(i(e.kx)):e.k!==void 0&&this._xScaleFactor.animate(i(e.k)),e.ky!==void 0?this._yScaleFactor.animate(i(e.ky)):e.k!==void 0&&this._yScaleFactor.animate(i(e.k)),e.x!==void 0&&this._translateX.animate(i(e.x)),e.y!==void 0&&this._translateY.animate(i(e.y))}else e.kx!==void 0?this._xScaleFactor.set(e.kx):e.k!==void 0&&this._xScaleFactor.set(e.k),e.ky!==void 0?this._yScaleFactor.set(e.ky):e.k!==void 0&&this._yScaleFactor.set(e.k),e.x!==void 0&&this._translateX.set(e.x),e.y!==void 0&&this._translateY.set(e.y);return this}else{let i=this._xScaleFactor.last(),a=this._yScaleFactor.last();return{k:(i+a)*.5,kx:i,ky:a,x:this._translateX.last(),y:this._translateY.last()}}}reset(e=!1){return this.transform({k:1,x:0,y:0},e)}zoomTo(e,t=!0){return this.transform(e.transform(this),t)}_calculateControllerTransform(){this._calculatingTransform=!0;let e=this.controller.transform(this);return this._calculatingTransform=!1,e}follow(e,t=!0){if(this.controller=e,this._xScaleFactor.set(()=>{if(this._calculatingTransform)return this._xScaleFactor.last();let i=this._calculateControllerTransform();return i.kx||i.k}),this._yScaleFactor.set(()=>{if(this._calculatingTransform)return this._yScaleFactor.last();let i=this._calculateControllerTransform();return i.ky||i.k}),this._translateX.set(()=>this._calculatingTransform?this._translateX.last():this._calculateControllerTransform().x),this._translateY.set(()=>this._calculatingTransform?this._translateY.last():this._calculateControllerTransform().y),t){let i=a=>new F(H(a),this.animationDuration,Z);this._xScaleFactor.animate(i(this._xScaleFactor.data())),this._yScaleFactor.animate(i(this._yScaleFactor.data())),this._translateX.animate(i(this._translateX.data())),this._translateY.animate(i(this._translateY.data()))}return this}unfollow(){return this.controller!=null&&(this._xScaleFactor.set(this._xScaleFactor.get()),this._yScaleFactor.set(this._yScaleFactor.get()),this._translateX.set(this._translateX.get()),this._translateY.set(this._translateY.get())),this.controller=null,this}wait(e=!0){return Promise.all([...this._xDomain,...this._yDomain,...this._xRange,...this._yRange,this._xScaleFactor,this._yScaleFactor,this._translateX,this._translateY].map(t=>t.wait(e)))}}class Je{constructor(e,t={}){this.lastCompute=void 0,this.marks=e,this.centerMark=t.centerMark!==void 0?t.centerMark:void 0,this.centerMark&&!this.marks.includes(this.centerMark)&&(this.marks=[...this.marks,this.centerMark]),this.xAttr=t.xAttr!==void 0?t.xAttr:"x",this.yAttr=t.yAttr!==void 0?t.yAttr:"y",this.padding=t.padding!==void 0?t.padding:20,this.transformCoordinates=t.transformCoordinates??!1,this.inverseTransformCoordinates=t.inverseTransformCoordinates??!1}transform(e){if(this.lastCompute&&this.lastCompute.scales===e&&this.lastCompute.time==e.timeProvider())return this.lastCompute.result;let t=this.marks.map(S=>this._getMarkLocation(e,S)),i,a,s,n,o=this.centerMark!==void 0?this._getMarkLocation(e,this.centerMark):null,h=e.transform(),{x:l,y:u}=wr(t);if(o){let S=Math.max(l[1]-o.x,o.x-l[0]),x=Math.max(u[1]-o.y,o.y-u[0]);l=[o.x-S,o.x+S],u=[o.y-x,o.y+x]}let c,d;Math.abs(l[1]-l[0])>0?c=(Math.abs(e.xRSpan())-this.padding*2)/(l[1]-l[0])/(Math.abs(e.xRSpan())/Math.abs(e.xDSpan())):c=h.kx,Math.abs(u[1]-u[0])>0?d=(Math.abs(e.yRSpan())-this.padding*2)/(u[1]-u[0])/(Math.abs(e.yRSpan())/Math.abs(e.yDSpan())):d=h.ky;let g=h.ky/h.kx;c=Math.min(c,e.maxScale),d=Math.min(d,e.maxScale),d<c*g?(s=d/g,n=d):(s=c,n=c*g),i=(l[0]+l[1])*.5,a=(u[0]+u[1])*.5,i=(i-e.xDomain()[0])*e.xRSpan()/e.xDSpan()+e.xRange()[0],a=(a-e.yDomain()[0])*e.yRSpan()/e.yDSpan()+e.yRange()[0];let y=-i*s+(e.xRange()[0]+e.xRange()[1])*.5,M=-a*n+(e.yRange()[0]+e.yRange()[1])*.5,b={kx:s,ky:n,x:y,y:M};return this.lastCompute={scales:e,time:e.timeProvider(),result:b},b}_getMarkLocation(e,t){let i={x:t.attr(this.xAttr,this.transformCoordinates),y:t.attr(this.yAttr,this.transformCoordinates)};return this.inverseTransformCoordinates&&(i={x:e.xScale.invert(i.x),y:e.yScale.invert(i.y)}),i}}function oa(r,e={}){return new Je([r],{centerMark:r,...e})}function ha(r,e={}){return new Je(r,{...e})}class la{constructor(e={}){this.markCollections=[],this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this._avgMarksPerBin=null,this._coordinateAttributes=e.coordinateAttributes??["x","y"],this._transformCoordinates=e.transformCoordinates??!0,this._avgMarksPerBin=e.marksPerBin??null}add(e){return this.markCollections.push(e),this}remove(e){let t=this.markCollections.indexOf(e);return t<0&&console.error("Tried to remove mark collection which does not exist:",e),this.markCollections.splice(t,1),this}invalidate(){return this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this}compute(){return console.log("computing interaction map"),this._extents=new Array(this._coordinateAttributes.length).fill([1e12,-1e12]),this._numMarks=0,this._forEachMark(e=>{this._coordinateAttributes.forEach((t,i)=>{let a=e.attr(t,this._transformCoordinates);a<this._extents[i][0]&&(this._extents[i][0]=a),a>this._extents[i][1]&&(this._extents[i][1]=a)}),this._numMarks+=1}),this._numMarks==0?this:(this._numBins=Math.round(this._numMarks/(this._avgMarksPerBin??Math.min(Math.max(1,this._numMarks/100),10))),this._binSizes=this._extents.map(e=>Math.ceil((e[1]-e[0])/this._numBins)),this._positionMap=new Map,this._forEachMark(e=>{let t=this._coordinateAttributes.map(a=>e.attr(a,this._transformCoordinates)),i=this._getPositionID(t);this._positionMap.has(i)?this._positionMap.get(i).push(e):this._positionMap.set(i,[e])}),this)}_forEachMark(e){this.markCollections.forEach(t=>{if(t instanceof We)t.forEach(e);else if(t instanceof ne)e(t);else if(typeof t.forEach=="function")t.forEach(e);else if(typeof t=="function"){let i=t();i instanceof ne?e(i):i.forEach(e)}else console.error("Unrecognized mark collection type in position map:",t)})}_getPositionID(e){return(this._numBins===null||!this._extents||!this._binSizes)&&console.error("Cannot hash position without computing first"),e.length!=this._coordinateAttributes.length&&console.error(`Need exactly ${this._coordinateAttributes.length} coordinates, got ${e.length}`),e.reduce((t,i,a)=>t*this._numBins+Math.floor((i-this._extents[a][0])/this._binSizes[a]),0)}marksNear(e,t,i=!0){if(this._positionMap||this.compute(),this._numMarks==0)return[];let a=this._recursiveBinWalk(e,t);return i?a.map(n=>{let o=this._coordinateAttributes.map(h=>n.attr(h,this._transformCoordinates));return[n,Math.sqrt(o.reduce((h,l,u)=>h+(l-e[u])*(l-e[u]),0))]}).filter(([n,o])=>o<=t).sort((n,o)=>n[1]-o[1]).map(([n,o])=>n):a}_recursiveBinWalk(e,t,i=[]){let a=i.length;if(a==e.length)return this._positionMap.get(this._getPositionID(i))??[];let s=Math.ceil(t/this._binSizes[a]),n=new Array(s*2+1).fill(0).map((h,l)=>(l-s)*this._binSizes[a]+e[a]),o=[];return n.forEach(h=>{o=[...o,...this._recursiveBinWalk(e,t,[...i,h])]}),o}}var dr=(r=>(r.none="no-preference",r.more="more",r.less="less",r))(dr||{}),fr=(r=>(r.light="light",r.dark="dark",r))(fr||{});class mr{constructor(){this._hasChanged=!1;let e=window.matchMedia("(prefers-reduced-motion: reduce)");this._prefersReducedMotion=e.matches,e.addEventListener("change",h=>this._handleMotion(h));let t=window.matchMedia("(prefers-reduced-transparency: reduce)");this._prefersReducedTransparency=t.matches,t.addEventListener("change",h=>this._handleTransparency(h));let i=window.matchMedia("(prefers-contrast: none)");this._contrastPreference="no-preference",i.addEventListener("change",h=>this._handleContrastNone(h));let a=window.matchMedia("(prefers-contrast: more)");a.matches&&(this._contrastPreference="more"),a.addEventListener("change",h=>this._handleContrastMore(h));let s=window.matchMedia("(prefers-contrast: less)");a.matches&&(this._contrastPreference="less"),s.addEventListener("change",h=>this._handleContrastLess(h));let n=window.matchMedia("(prefers-color-scheme: light)");this._colorSchemePreference="light",n.addEventListener("change",h=>this._handleColorSchemeLight(h));let o=window.matchMedia("(prefers-color-scheme: dark)");o.matches&&(this._colorSchemePreference="dark"),o.addEventListener("change",h=>this._handleColorSchemeDark(h))}_handleMotion(e){this._prefersReducedMotion=e.matches,this._hasChanged=!0}_handleTransparency(e){this._prefersReducedTransparency=e.matches,this._hasChanged=!0}_handleContrastMore(e){e.matches&&(this._contrastPreference="more"),this._hasChanged=!0}_handleContrastLess(e){e.matches&&(this._contrastPreference="less"),this._hasChanged=!0}_handleContrastNone(e){e.matches&&(this._contrastPreference="no-preference"),this._hasChanged=!0}_handleColorSchemeLight(e){e.matches&&(this._colorSchemePreference="light"),this._hasChanged=!0}_handleColorSchemeDark(e){e.matches&&(this._colorSchemePreference="dark"),this._hasChanged=!0}get prefersReducedMotion(){return this._prefersReducedMotion}get prefersReducedTransparency(){return this._prefersReducedTransparency}get contrastPreference(){return this._contrastPreference}get colorSchemePreference(){return this._colorSchemePreference}advance(e){return this._hasChanged?(this._hasChanged=!1,!0):!1}}let Qe;function ua(){return Qe||(Qe=new mr),Qe}m.Animator=F,m.Attribute=k,m.AttributeRecompute=tt,m.ColorSchemePreference=fr,m.ContrastPreference=dr,m.LazyTicker=sa,m.Mark=ne,m.MarkFollower=Je,m.MarkRenderGroup=We,m.PositionMap=la,m.RenderContext=mr,m.Scales=na,m.StageManager=ur,m.StagingAction=lr,m.StagingState=hr,m.Ticker=aa,m.autoMixingFunction=De,m.basicAnimationTo=ta,m.centerOn=oa,m.colorMixingFunction=nr,m.createRenderGroup=ra,m.curveEaseInOut=Z,m.curveLinear=Ve,m.getRenderContext=ua,m.interpolateAlongPath=Ki,m.interpolateTo=H,m.interpolateToFunction=Qi,m.markBox=ha,m.numericalArrayMixingFunction=or,m.numericalMixingFunction=Ne,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
