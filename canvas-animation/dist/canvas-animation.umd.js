(function(m,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(m=typeof globalThis<"u"?globalThis:m||self,p(m["canvas-animation"]={}))})(this,function(m){"use strict";var ua=Object.defineProperty;var ca=(m,p,R)=>p in m?ua(m,p,{enumerable:!0,configurable:!0,writable:!0,value:R}):m[p]=R;var Qt=(m,p,R)=>(ca(m,typeof p!="symbol"?p+"":p,R),R);function p(r,t){let e=r.length;Array.isArray(r[0])||(r=[r]),Array.isArray(t[0])||(t=t.map(s=>[s]));let i=t[0].length,a=t[0].map((s,o)=>t.map(l=>l[o])),n=r.map(s=>a.map(o=>{let l=0;if(!Array.isArray(s)){for(let h of o)l+=s*h;return l}for(let h=0;h<s.length;h++)l+=s[h]*(o[h]||0);return l}));return e===1&&(n=n[0]),i===1?n.map(s=>s[0]):n}function R(r){return O(r)==="string"}function O(r){return(Object.prototype.toString.call(r).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function ot(r,t){r=+r,t=+t;let e=(Math.floor(r)+"").length;if(t>e)return+r.toFixed(t-e);{let i=10**(e-t);return Math.round(r/i)*i}}function Kt(r){if(!r)return;r=r.trim();const t=/^([a-z]+)\((.+?)\)$/i,e=/^-?[\d.]+$/;let i=r.match(t);if(i){let a=[];return i[2].replace(/\/?\s*([-\w.]+(?:%|deg)?)/g,(n,s)=>{/%$/.test(s)?(s=new Number(s.slice(0,-1)/100),s.type="<percentage>"):/deg$/.test(s)?(s=new Number(+s.slice(0,-3)),s.type="<angle>",s.unit="deg"):e.test(s)&&(s=new Number(s),s.type="<number>"),n.startsWith("/")&&(s=s instanceof Number?s:new Number(s),s.alpha=!0),a.push(s)}),{name:i[1].toLowerCase(),rawName:i[1],rawArgs:i[2],args:a}}}function te(r){return r[r.length-1]}function lt(r,t,e){return isNaN(r)?t:isNaN(t)?r:r+(t-r)*e}function ee(r,t,e){return(e-r)/(t-r)}function Lt(r,t,e){return lt(t[0],t[1],ee(r[0],r[1],e))}function re(r){return r.map(t=>t.split("|").map(e=>{e=e.trim();let i=e.match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(i){let a=new String(i[1]);return a.range=[+i[2],+i[3]],a}return e}))}var gr=Object.freeze({__proto__:null,interpolate:lt,interpolateInv:ee,isString:R,last:te,mapRange:Lt,multiplyMatrices:p,parseCoordGrammar:re,parseFunction:Kt,toPrecision:ot,type:O});class pr{add(t,e,i){if(typeof arguments[0]!="string"){for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1]);return}(Array.isArray(t)?t:[t]).forEach(function(a){this[a]=this[a]||[],e&&this[a][i?"unshift":"push"](e)},this)}run(t,e){this[t]=this[t]||[],this[t].forEach(function(i){i.call(e&&e.context?e.context:e,e)})}}const X=new pr;var z={gamut_mapping:"lch.c",precision:5,deltaE:"76"};const E={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function Pt(r){return Array.isArray(r)?r:E[r]}function ht(r,t,e,i={}){if(r=Pt(r),t=Pt(t),!r||!t)throw new TypeError(`Missing white point to convert ${r?"":"from"}${!r&&!t?"/":""}${t?"":"to"}`);if(r===t)return e;let a={W1:r,W2:t,XYZ:e,options:i};if(X.run("chromatic-adaptation-start",a),a.M||(a.W1===E.D65&&a.W2===E.D50?a.M=[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]]:a.W1===E.D50&&a.W2===E.D65&&(a.M=[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]])),X.run("chromatic-adaptation-end",a),a.M)return p(a.M,a.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}const _r=75e-6,C=class C{constructor(t){var a,n,s;this.id=t.id,this.name=t.name,this.base=t.base?C.get(t.base):null,this.aliases=t.aliases,this.base&&(this.fromBase=t.fromBase,this.toBase=t.toBase);let e=t.coords??this.base.coords;for(let o in e)"name"in e[o]||(e[o].name=o);this.coords=e;let i=t.white??this.base.white??"D65";this.white=Pt(i),this.formats=t.formats??{};for(let o in this.formats){let l=this.formats[o];l.type||(l.type="function"),l.name||(l.name=o)}t.cssId&&!((a=this.formats.functions)!=null&&a.color)?(this.formats.color={id:t.cssId},Object.defineProperty(this,"cssId",{value:t.cssId})):(n=this.formats)!=null&&n.color&&!((s=this.formats)!=null&&s.color.id)&&(this.formats.color.id=this.id),this.referred=t.referred,Object.defineProperty(this,"path",{value:br(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),X.run("colorspace-init-end",this)}inGamut(t,{epsilon:e=_r}={}){if(this.isPolar)return t=this.toBase(t),this.base.inGamut(t,{epsilon:e});let i=Object.values(this.coords);return t.every((a,n)=>{let s=i[n];if(s.type!=="angle"&&s.range){if(Number.isNaN(a))return!0;let[o,l]=s.range;return(o===void 0||a>=o-e)&&(l===void 0||a<=l+e)}return!0})}get cssId(){var t,e;return((e=(t=this.formats.functions)==null?void 0:t.color)==null?void 0:e.id)||this.id}get isPolar(){for(let t in this.coords)if(this.coords[t].type==="angle")return!0;return!1}getFormat(t){if(typeof t=="object")return t=ie(t,this),t;let e;return t==="default"?e=Object.values(this.formats)[0]:e=this.formats[t],e?(e=ie(e,this),e):null}equals(t){return t?this===t||this.id===t.id:!1}to(t,e){if(arguments.length===1&&([t,e]=[t.space,t.coords]),t=C.get(t),this.equals(t))return e;e=e.map(o=>Number.isNaN(o)?0:o);let i=this.path,a=t.path,n,s;for(let o=0;o<i.length&&i[o].equals(a[o]);o++)n=i[o],s=o;if(!n)throw new Error(`Cannot convert between color spaces ${this} and ${t}: no connection space was found`);for(let o=i.length-1;o>s;o--)e=i[o].toBase(e);for(let o=s+1;o<a.length;o++)e=a[o].fromBase(e);return e}from(t,e){return arguments.length===1&&([t,e]=[t.space,t.coords]),t=C.get(t),t.to(this,e)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let t=[];for(let e in this.coords){let i=this.coords[e],a=i.range||i.refRange;t.push((a==null?void 0:a.min)??0)}return t}static get all(){return[...new Set(Object.values(C.registry))]}static register(t,e){if(arguments.length===1&&(e=arguments[0],t=e.id),e=this.get(e),this.registry[t]&&this.registry[t]!==e)throw new Error(`Duplicate color space registration: '${t}'`);if(this.registry[t]=e,arguments.length===1&&e.aliases)for(let i of e.aliases)this.register(i,e);return e}static get(t,...e){if(!t||t instanceof C)return t;if(O(t)==="string"){let a=C.registry[t.toLowerCase()];if(!a)throw new TypeError(`No color space found with id = "${t}"`);return a}if(e.length)return C.get(...e);throw new TypeError(`${t} is not a valid color space`)}static resolveCoord(t,e){var l;let i=O(t),a,n;if(i==="string"?t.includes(".")?[a,n]=t.split("."):[a,n]=[,t]:Array.isArray(t)?[a,n]=t:(a=t.space,n=t.coordId),a=C.get(a),a||(a=e),!a)throw new TypeError(`Cannot resolve coordinate reference ${t}: No color space specified and relative references are not allowed here`);if(i=O(n),i==="number"||i==="string"&&n>=0){let h=Object.entries(a.coords)[n];if(h)return{space:a,id:h[0],index:n,...h[1]}}a=C.get(a);let s=n.toLowerCase(),o=0;for(let h in a.coords){let u=a.coords[h];if(h.toLowerCase()===s||((l=u.name)==null?void 0:l.toLowerCase())===s)return{space:a,id:h,index:o,...u};o++}throw new TypeError(`No "${n}" coordinate found in ${a.name}. Its coordinates are: ${Object.keys(a.coords).join(", ")}`)}};Qt(C,"registry",{}),Qt(C,"DEFAULT_FORMAT",{type:"functions",name:"color"});let f=C;function br(r){let t=[r];for(let e=r;e=e.base;)t.push(e);return t}function ie(r,{coords:t}={}){if(r.coords&&!r.coordGrammar){r.type||(r.type="function"),r.name||(r.name="color"),r.coordGrammar=re(r.coords);let e=Object.entries(t).map(([i,a],n)=>{let s=r.coordGrammar[n][0],o=a.range||a.refRange,l=s.range,h="";return s=="<percentage>"?(l=[0,100],h="%"):s=="<angle>"&&(h="deg"),{fromRange:o,toRange:l,suffix:h}});r.serializeCoords=(i,a)=>i.map((n,s)=>{let{fromRange:o,toRange:l,suffix:h}=e[s];return o&&l&&(n=Lt(o,l,n)),n=ot(n,a),h&&(n+=h),n})}return r}var A=new f({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class S extends f{constructor(t){t.coords||(t.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),t.base||(t.base=A),t.toXYZ_M&&t.fromXYZ_M&&(t.toBase??(t.toBase=e=>{let i=p(t.toXYZ_M,e);return this.white!==this.base.white&&(i=ht(this.white,this.base.white,i)),i}),t.fromBase??(t.fromBase=e=>(e=ht(this.base.white,this.white,e),p(t.fromXYZ_M,e)))),t.referred??(t.referred="display"),super(t)}}function ae(r,{meta:t}={}){var i,a,n,s,o;let e={str:(i=String(r))==null?void 0:i.trim()};if(X.run("parse-start",e),e.color)return e.color;if(e.parsed=Kt(e.str),e.parsed){let l=e.parsed.name;if(l==="color"){let h=e.parsed.args.shift(),u=e.parsed.rawArgs.indexOf("/")>0?e.parsed.args.pop():1;for(let d of f.all){let g=d.getFormat("color");if(g&&(h===g.id||(a=g.ids)!=null&&a.includes(h))){const M=Object.keys(d.coords).map((y,v)=>e.parsed.args[v]||0);return t&&(t.formatId="color"),{spaceId:d.id,coords:M,alpha:u}}}let c="";if(h in f.registry){let d=(o=(s=(n=f.registry[h].formats)==null?void 0:n.functions)==null?void 0:s.color)==null?void 0:o.id;d&&(c=`Did you mean color(${d})?`)}throw new TypeError(`Cannot parse color(${h}). `+(c||"Missing a plugin?"))}else for(let h of f.all){let u=h.getFormat(l);if(u&&u.type==="function"){let c=1;(u.lastAlpha||te(e.parsed.args).alpha)&&(c=e.parsed.args.pop());let d=e.parsed.args,g;return u.coordGrammar&&(g=Object.entries(h.coords).map(([M,y],v)=>{var N;let w=u.coordGrammar[v],k=(N=d[v])==null?void 0:N.type,P=w.find(G=>G==k);if(!P){let G=y.name||M;throw new TypeError(`${k} not allowed for ${G} in ${l}()`)}let T=P.range;k==="<percentage>"&&(T||(T=[0,1]));let B=y.range||y.refRange;return T&&B&&(d[v]=Lt(T,B,d[v])),P})),t&&Object.assign(t,{formatId:u.name,types:g}),{spaceId:h.id,coords:d,alpha:c}}}}else for(let l of f.all)for(let h in l.formats){let u=l.formats[h];if(u.type!=="custom"||u.test&&!u.test(e.str))continue;let c=u.parse(e.str);if(c)return c.alpha??(c.alpha=1),t&&(t.formatId=h),c}throw new TypeError(`Could not parse ${r} as a color. Missing a plugin?`)}function _(r){if(!r)throw new TypeError("Empty color reference");R(r)&&(r=ae(r));let t=r.space||r.spaceId;return t instanceof f||(r.space=f.get(t)),r.alpha===void 0&&(r.alpha=1),r}function J(r,t){return t=f.get(t),t.from(r)}function D(r,t){let{space:e,index:i}=f.resolveCoord(t,r.space);return J(r,e)[i]}function ne(r,t,e){return t=f.get(t),r.coords=t.to(r.space,e),r}function I(r,t,e){if(r=_(r),arguments.length===2&&O(arguments[1])==="object"){let i=arguments[1];for(let a in i)I(r,a,i[a])}else{typeof e=="function"&&(e=e(D(r,t)));let{space:i,index:a}=f.resolveCoord(t,r.space),n=J(r,i);n[a]=e,ne(r,i,n)}return r}var Rt=new f({id:"xyz-d50",name:"XYZ D50",white:"D50",base:A,fromBase:r=>ht(A.white,"D50",r),toBase:r=>ht("D50",A.white,r),formats:{color:{}}});const Mr=216/24389,se=24/116,ut=24389/27;let Et=E.D50;var x=new f({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Et,base:Rt,fromBase(r){let e=r.map((i,a)=>i/Et[a]).map(i=>i>Mr?Math.cbrt(i):(ut*i+16)/116);return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},toBase(r){let t=[];return t[1]=(r[0]+16)/116,t[0]=r[1]/500+t[1],t[2]=t[1]-r[2]/200,[t[0]>se?Math.pow(t[0],3):(116*t[0]-16)/ut,r[0]>8?Math.pow((r[0]+16)/116,3):r[0]/ut,t[2]>se?Math.pow(t[2],3):(116*t[2]-16)/ut].map((i,a)=>i*Et[a])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function ct(r){return(r%360+360)%360}function yr(r,t){if(r==="raw")return t;let[e,i]=t.map(ct),a=i-e;return r==="increasing"?a<0&&(i+=360):r==="decreasing"?a>0&&(e+=360):r==="longer"?-180<a&&a<180&&(a>0?e+=360:i+=360):r==="shorter"&&(a>180?e+=360:a<-180&&(i+=360)),[e,i]}var Q=new f({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:x,fromBase(r){let[t,e,i]=r,a;const n=.02;return Math.abs(e)<n&&Math.abs(i)<n?a=NaN:a=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),ct(a)]},toBase(r){let[t,e,i]=r;return e<0&&(e=0),isNaN(i)&&(i=0),[t,e*Math.cos(i*Math.PI/180),e*Math.sin(i*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const oe=25**7,dt=Math.PI,le=180/dt,H=dt/180;function Bt(r,t,{kL:e=1,kC:i=1,kH:a=1}={}){let[n,s,o]=x.from(r),l=Q.from(x,[n,s,o])[1],[h,u,c]=x.from(t),d=Q.from(x,[h,u,c])[1];l<0&&(l=0),d<0&&(d=0);let M=((l+d)/2)**7,y=.5*(1-Math.sqrt(M/(M+oe))),v=(1+y)*s,w=(1+y)*u,k=Math.sqrt(v**2+o**2),P=Math.sqrt(w**2+c**2),T=v===0&&o===0?0:Math.atan2(o,v),B=w===0&&c===0?0:Math.atan2(c,w);T<0&&(T+=2*dt),B<0&&(B+=2*dt),T*=le,B*=le;let N=h-n,G=P-k,Y=B-T,at=T+B,hr=Math.abs(Y),nt;k*P===0?nt=0:hr<=180?nt=Y:Y>180?nt=Y-360:Y<-180?nt=Y+360:console.log("the unthinkable has happened");let ur=2*Math.sqrt(P*k)*Math.sin(nt*H/2),na=(n+h)/2,Jt=(k+P)/2,cr=Math.pow(Jt,7),$;k*P===0?$=at:hr<=180?$=at/2:at<360?$=(at+360)/2:$=(at-360)/2;let dr=(na-50)**2,sa=1+.015*dr/Math.sqrt(20+dr),fr=1+.045*Jt,st=1;st-=.17*Math.cos(($-30)*H),st+=.24*Math.cos(2*$*H),st+=.32*Math.cos((3*$+6)*H),st-=.2*Math.cos((4*$-63)*H);let mr=1+.015*Jt*st,oa=30*Math.exp(-1*(($-275)/25)**2),la=2*Math.sqrt(cr/(cr+oe)),ha=-1*Math.sin(2*oa*H)*la,Dt=(N/(e*sa))**2;return Dt+=(G/(i*fr))**2,Dt+=(ur/(a*mr))**2,Dt+=ha*(G/(i*fr))*(ur/(a*mr)),Math.sqrt(Dt)}const vr=75e-6;function K(r,t=r.space,{epsilon:e=vr}={}){r=_(r),t=f.get(t);let i=r.coords;return t!==r.space&&(i=t.from(r)),t.inGamut(i,{epsilon:e})}function tt(r){return{space:r.space,coords:r.coords.slice(),alpha:r.alpha}}function j(r,{method:t=z.gamut_mapping,space:e=r.space}={}){if(R(arguments[1])&&(e=arguments[1]),e=f.get(e),K(r,e,{epsilon:0}))return _(r);let i=L(r,e);if(t!=="clip"&&!K(r,e)){let a=j(tt(i),{method:"clip",space:e});if(Bt(r,a)>2){let n=f.resolveCoord(t),s=n.space,o=n.id,l=L(i,s),u=(n.range||n.refRange)[0],c=.01,d=u,g=D(l,o);for(;g-d>c;){let M=tt(l);M=j(M,{space:e,method:"clip"}),Bt(l,M)-2<c?d=D(l,o):g=D(l,o),I(l,o,(d+g)/2)}i=L(l,e)}else i=a}if(t==="clip"||!K(i,e,{epsilon:0})){let a=Object.values(e.coords).map(n=>n.range||[]);i.coords=i.coords.map((n,s)=>{let[o,l]=a[s];return o!==void 0&&(n=Math.max(o,n)),l!==void 0&&(n=Math.min(n,l)),n})}return e!==r.space&&(i=L(i,r.space)),r.coords=i.coords,r}j.returns="color";function L(r,t,{inGamut:e}={}){r=_(r),t=f.get(t);let i=t.from(r),a={space:t,coords:i,alpha:r.alpha};return e&&(a=j(a)),a}L.returns="color";function ft(r,{precision:t=z.precision,format:e="default",inGamut:i=!0,...a}={}){var l;let n;r=_(r);let s=e;e=r.space.getFormat(e)??r.space.getFormat("default")??f.DEFAULT_FORMAT,i||(i=e.toGamut);let o=r.coords;if(o=o.map(h=>h||0),i&&!K(r)&&(o=j(tt(r),i===!0?void 0:i).coords),e.type==="custom")if(a.precision=t,e.serialize)n=e.serialize(o,r.alpha,a);else throw new TypeError(`format ${s} can only be used to parse colors, not for serialization`);else{let h=e.name||"color";e.serializeCoords?o=e.serializeCoords(o,t):t!==null&&(o=o.map(g=>ot(g,t)));let u=[...o];if(h==="color"){let g=e.id||((l=e.ids)==null?void 0:l[0])||r.space.id;u.unshift(g)}let c=r.alpha;t!==null&&(c=ot(c,t));let d=r.alpha<1&&!e.noAlpha?`${e.commas?",":" /"} ${c}`:"";n=`${h}(${u.join(e.commas?", ":" ")}${d})`}return n}const wr=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],kr=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]];var mt=new S({id:"rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:wr,fromXYZ_M:kr,formats:{color:{}}});const gt=1.09929682680944,he=.018053968510807;var ue=new S({id:"rec2020",name:"REC.2020",base:mt,toBase(r){return r.map(function(t){return t<he*4.5?t/4.5:Math.pow((t+gt-1)/gt,1/.45)})},fromBase(r){return r.map(function(t){return t>=he?gt*Math.pow(t,.45)-(gt-1):4.5*t})},formats:{color:{}}});const Sr=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],xr=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]];var ce=new S({id:"p3-linear",name:"Linear P3",white:"D65",toXYZ_M:Sr,fromXYZ_M:xr});const Cr=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],Tr=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]];var de=new S({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:Cr,fromXYZ_M:Tr,formats:{color:{}}}),fe={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]};let me=Array(3).fill("<percentage> | <number>[0, 255]"),ge=Array(3).fill("<number>[0, 255]");var et=new S({id:"srgb",name:"sRGB",base:de,fromBase:r=>r.map(t=>{let e=t<0?-1:1,i=t*e;return i>.0031308?e*(1.055*i**(1/2.4)-.055):12.92*t}),toBase:r=>r.map(t=>{let e=t<0?-1:1,i=t*e;return i<.04045?t/12.92:e*((i+.055)/1.055)**2.4}),formats:{rgb:{coords:me},rgb_number:{name:"rgb",commas:!0,coords:ge,noAlpha:!0},color:{},rgba:{coords:me,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:ge},hex:{type:"custom",toGamut:!0,test:r=>/^#([a-f0-9]{3,4}){1,2}$/i.test(r),parse(r){r.length<=5&&(r=r.replace(/[a-f0-9]/gi,"$&$&"));let t=[];return r.replace(/[a-f0-9]{2}/gi,e=>{t.push(parseInt(e,16)/255)}),{spaceId:"srgb",coords:t.slice(0,3),alpha:t.slice(3)[0]}},serialize:(r,t,{collapse:e=!0}={})=>{t<1&&r.push(t),r=r.map(n=>Math.round(n*255));let i=e&&r.every(n=>n%17===0);return"#"+r.map(n=>i?(n/17).toString(16):n.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:r=>/^[a-z]+$/i.test(r),parse(r){r=r.toLowerCase();let t={spaceId:"srgb",coords:null,alpha:1};if(r==="transparent"?(t.coords=fe.black,t.alpha=0):t.coords=fe[r],t.coords)return t}}}}),pe=new S({id:"p3",name:"P3",base:ce,fromBase:et.fromBase,toBase:et.toBase,formats:{color:{id:"display-p3"}}});if(z.display_space=et,typeof CSS<"u"&&CSS.supports)for(let r of[x,ue,pe]){let t=r.getMinCoords(),i=ft({space:r,coords:t,alpha:1});if(CSS.supports("color",i)){z.display_space=r;break}}function Ar(r,{space:t=z.display_space,...e}={}){let i=ft(r,e);if(typeof CSS>"u"||CSS.supports("color",i)||!z.display_space)i=new String(i),i.color=r;else{let a=L(r,t);i=new String(ft(a,e)),i.color=a}return i}function _e(r,t,e="lab"){e=f.get(e);let i=e.from(r),a=e.from(t);return Math.sqrt(i.reduce((n,s,o)=>{let l=a[o];return isNaN(s)||isNaN(l)?n:n+(l-s)**2},0))}function Dr(r,t){return r=_(r),t=_(t),r.space===t.space&&r.alpha===t.alpha&&r.coords.every((e,i)=>e===t.coords[i])}function q(r){return D(r,[A,"y"])}function be(r,t){I(r,[A,"y"],t)}function Lr(r){Object.defineProperty(r.prototype,"luminance",{get(){return q(this)},set(t){be(this,t)}})}var Pr=Object.freeze({__proto__:null,getLuminance:q,register:Lr,setLuminance:be});function Rr(r,t){r=_(r),t=_(t);let e=Math.max(q(r),0),i=Math.max(q(t),0);return i>e&&([e,i]=[i,e]),(e+.05)/(i+.05)}const Er=.56,Br=.57,zr=.62,Fr=.65,Me=.022,Yr=1.414,$r=.1,Or=5e-4,Xr=1.14,ye=.027,Ir=1.14;function ve(r){return r>=Me?r:r+(Me-r)**Yr}function V(r){let t=r<0?-1:1,e=Math.abs(r);return t*Math.pow(e,2.4)}function jr(r,t){t=_(t),r=_(r);let e,i,a,n,s,o;t=L(t,"srgb"),[n,s,o]=t.coords;let l=V(n)*.2126729+V(s)*.7151522+V(o)*.072175;r=L(r,"srgb"),[n,s,o]=r.coords;let h=V(n)*.2126729+V(s)*.7151522+V(o)*.072175,u=ve(l),c=ve(h),d=c>u;return Math.abs(c-u)<Or?i=0:d?(e=c**Er-u**Br,i=e*Xr):(e=c**Fr-u**zr,i=e*Ir),Math.abs(i)<$r?a=0:i>0?a=i-ye:a=i+ye,a*100}function qr(r,t){r=_(r),t=_(t);let e=Math.max(q(r),0),i=Math.max(q(t),0);i>e&&([e,i]=[i,e]);let a=e+i;return a===0?0:(e-i)/a}const Gr=5e4;function Zr(r,t){r=_(r),t=_(t);let e=Math.max(q(r),0),i=Math.max(q(t),0);return i>e&&([e,i]=[i,e]),i===0?Gr:(e-i)/i}function Ur(r,t){r=_(r),t=_(t);let e=D(r,[x,"l"]),i=D(t,[x,"l"]);return Math.abs(e-i)}const Nr=216/24389,we=24/116,pt=24389/27;let zt=E.D65;var Ft=new f({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:zt,base:A,fromBase(r){let e=r.map((i,a)=>i/zt[a]).map(i=>i>Nr?Math.cbrt(i):(pt*i+16)/116);return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},toBase(r){let t=[];return t[1]=(r[0]+16)/116,t[0]=r[1]/500+t[1],t[2]=t[1]-r[2]/200,[t[0]>we?Math.pow(t[0],3):(116*t[0]-16)/pt,r[0]>8?Math.pow((r[0]+16)/116,3):r[0]/pt,t[2]>we?Math.pow(t[2],3):(116*t[2]-16)/pt].map((i,a)=>i*zt[a])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});const Yt=Math.pow(5,.5)*.5+.5;function Hr(r,t){r=_(r),t=_(t);let e=D(r,[Ft,"l"]),i=D(t,[Ft,"l"]),a=Math.abs(Math.pow(e,Yt)-Math.pow(i,Yt)),n=Math.pow(a,1/Yt)*Math.SQRT2-40;return n<7.5?0:n}var _t=Object.freeze({__proto__:null,contrastAPCA:jr,contrastDeltaPhi:Hr,contrastLstar:Ur,contrastMichelson:qr,contrastWCAG21:Rr,contrastWeber:Zr});function Vr(r,t,e={}){R(e)&&(e={algorithm:e});let{algorithm:i,...a}=e;if(!i){let n=Object.keys(_t).map(s=>s.replace(/^contrast/,"")).join(", ");throw new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${n}`)}r=_(r),t=_(t);for(let n in _t)if("contrast"+i.toLowerCase()===n.toLowerCase())return _t[n](r,t,a);throw new TypeError(`Unknown contrast algorithm: ${i}`)}function ke(r){let[t,e,i]=J(r,A),a=t+15*e+3*i;return[4*t/a,9*e/a]}function Se(r){let[t,e,i]=J(r,A),a=t+e+i;return[t/a,e/a]}function Wr(r){Object.defineProperty(r.prototype,"uv",{get(){return ke(this)}}),Object.defineProperty(r.prototype,"xy",{get(){return Se(this)}})}var Jr=Object.freeze({__proto__:null,register:Wr,uv:ke,xy:Se});function Qr(r,t){return _e(r,t,"lab")}const xe=Math.PI/180;function Kr(r,t,{l:e=2,c:i=1}={}){let[a,n,s]=x.from(r),[,o,l]=Q.from(x,[a,n,s]),[h,u,c]=x.from(t),d=Q.from(x,[h,u,c])[1];o<0&&(o=0),d<0&&(d=0);let g=a-h,M=o-d,y=n-u,v=s-c,w=y**2+v**2-M**2,k=.511;a>=16&&(k=.040975*a/(1+.01765*a));let P=.0638*o/(1+.0131*o)+.638,T;Number.isNaN(l)&&(l=0),l>=164&&l<=345?T=.56+Math.abs(.2*Math.cos((l+168)*xe)):T=.36+Math.abs(.4*Math.cos((l+35)*xe));let B=Math.pow(o,4),N=Math.sqrt(B/(B+1900)),G=P*(N*T+1-N),Y=(g/(e*k))**2;return Y+=(M/(i*P))**2,Y+=w/G**2,Math.sqrt(Y)}const Ce=203;var $t=new f({id:"xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:A,fromBase(r){return r.map(t=>Math.max(t*Ce,0))},toBase(r){return r.map(t=>Math.max(t/Ce,0))}});const bt=1.15,Mt=.66,Te=2610/2**14,ti=2**14/2610,Ae=3424/2**12,De=2413/2**7,Le=2392/2**7,ei=1.7*2523/2**5,Pe=2**5/(1.7*2523),yt=-.56,Ot=16295499532821565e-27,ri=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],ii=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],ai=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],ni=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]];var Re=new f({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:$t,fromBase(r){let[t,e,i]=r,a=bt*t-(bt-1)*i,n=Mt*e-(Mt-1)*t,o=p(ri,[a,n,i]).map(function(d){let g=Ae+De*(d/1e4)**Te,M=1+Le*(d/1e4)**Te;return(g/M)**ei}),[l,h,u]=p(ai,o);return[(1+yt)*l/(1+yt*l)-Ot,h,u]},toBase(r){let[t,e,i]=r,a=(t+Ot)/(1+yt-yt*(t+Ot)),s=p(ni,[a,e,i]).map(function(d){let g=Ae-d**Pe,M=Le*d**Pe-De;return 1e4*(g/M)**ti}),[o,l,h]=p(ii,s),u=(o+(bt-1)*h)/bt,c=(l+(Mt-1)*u)/Mt;return[u,c,h]},formats:{color:{}}}),Xt=new f({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:Re,fromBase(r){let[t,e,i]=r,a;const n=2e-4;return Math.abs(e)<n&&Math.abs(i)<n?a=NaN:a=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),ct(a)]},toBase(r){return[r[0],r[1]*Math.cos(r[2]*Math.PI/180),r[1]*Math.sin(r[2]*Math.PI/180)]},formats:{color:{}}});function si(r,t){let[e,i,a]=Xt.from(r),[n,s,o]=Xt.from(t),l=e-n,h=i-s;Number.isNaN(a)&&Number.isNaN(o)?(a=0,o=0):Number.isNaN(a)?a=o:Number.isNaN(o)&&(o=a);let u=a-o,c=2*Math.sqrt(i*s)*Math.sin(u/2*(Math.PI/180));return Math.sqrt(l**2+h**2+c**2)}const Ee=3424/4096,Be=2413/128,ze=2392/128,Fe=2610/16384,oi=2523/32,li=16384/2610,Ye=32/2523,hi=[[.3592,.6976,-.0358],[-.1922,1.1004,.0755],[.007,.0749,.8434]],ui=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],ci=[[.9999888965628402,.008605050147287059,.11103437159861648],[1.00001110343716,-.008605050147287059,-.11103437159861648],[1.0000320633910054,.56004913547279,-.3206339100541203]],di=[[2.0701800566956137,-1.326456876103021,.20661600684785517],[.3649882500326575,.6804673628522352,-.04542175307585323],[-.04959554223893211,-.04942116118675749,1.1879959417328034]];var It=new f({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:$t,fromBase(r){let t=p(hi,r);return fi(t)},toBase(r){let t=mi(r);return p(di,t)},formats:{color:{}}});function fi(r){let t=r.map(function(e){let i=Ee+Be*(e/1e4)**Fe,a=1+ze*(e/1e4)**Fe;return(i/a)**oi});return p(ui,t)}function mi(r){return p(ci,r).map(function(i){let a=Math.max(i**Ye-Ee,0),n=Be-ze*i**Ye;return 1e4*(a/n)**li})}function gi(r,t){let[e,i,a]=It.from(r),[n,s,o]=It.from(t);return 720*Math.sqrt((e-n)**2+.25*(i-s)**2+(a-o)**2)}const pi=[[.8190224432164319,.3619062562801221,-.12887378261216414],[.0329836671980271,.9292868468965546,.03614466816999844],[.048177199566046255,.26423952494422764,.6335478258136937]],_i=[[1.2268798733741557,-.5578149965554813,.28139105017721583],[-.04057576262431372,1.1122868293970594,-.07171106666151701],[-.07637294974672142,-.4214933239627914,1.5869240244272418]],bi=[[.2104542553,.793617785,-.0040720468],[1.9779984951,-2.428592205,.4505937099],[.0259040371,.7827717662,-.808675766]],Mi=[[.9999999984505198,.39633779217376786,.2158037580607588],[1.0000000088817609,-.10556134232365635,-.06385417477170591],[1.0000000546724108,-.08948418209496575,-1.2914855378640917]];var vt=new f({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"L"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:A,fromBase(r){let e=p(pi,r).map(i=>Math.cbrt(i));return p(bi,e)},toBase(r){let e=p(Mi,r).map(i=>i**3);return p(_i,e)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function yi(r,t){let[e,i,a]=vt.from(r),[n,s,o]=vt.from(t),l=e-n,h=i-s,u=a-o;return Math.sqrt(l**2+h**2+u**2)}var wt={deltaE76:Qr,deltaECMC:Kr,deltaE2000:Bt,deltaEJz:si,deltaEITP:gi,deltaEOK:yi};function rt(r,t,e={}){R(e)&&(e={method:e});let{method:i=z.deltaE,...a}=e;r=_(r),t=_(t);for(let n in wt)if("deltae"+i.toLowerCase()===n.toLowerCase())return wt[n](r,t,a);throw new TypeError(`Unknown deltaE method: ${i}`)}function vi(r,t=.25){let i=[f.get("oklch","lch"),"l"];return I(r,i,a=>a*(1+t))}function wi(r,t=.25){let i=[f.get("oklch","lch"),"l"];return I(r,i,a=>a*(1-t))}var ki=Object.freeze({__proto__:null,darken:wi,lighten:vi});function $e(r,t,e=.5,i={}){[r,t]=[_(r),_(t)],O(e)==="object"&&([e,i]=[.5,e]);let{space:a,outputSpace:n,premultiplied:s}=i;return it(r,t,{space:a,outputSpace:n,premultiplied:s})(e)}function Oe(r,t,e={}){let i;jt(r)&&([i,e]=[r,t],[r,t]=i.rangeArgs.colors);let{maxDeltaE:a,deltaEMethod:n,steps:s=2,maxSteps:o=1e3,...l}=e;i||([r,t]=[_(r),_(t)],i=it(r,t,l));let h=rt(r,t),u=a>0?Math.max(s,Math.ceil(h/a)+1):s,c=[];if(o!==void 0&&(u=Math.min(u,o)),u===1)c=[{p:.5,color:i(.5)}];else{let d=1/(u-1);c=Array.from({length:u},(g,M)=>{let y=M*d;return{p:y,color:i(y)}})}if(a>0){let d=c.reduce((g,M,y)=>{if(y===0)return 0;let v=rt(M.color,c[y-1].color,n);return Math.max(g,v)},0);for(;d>a;){d=0;for(let g=1;g<c.length&&c.length<o;g++){let M=c[g-1],y=c[g],v=(y.p+M.p)/2,w=i(v);d=Math.max(d,rt(w,M.color),rt(w,y.color)),c.splice(g,0,{p:v,color:i(v)}),g++}}}return c=c.map(d=>d.color),c}function it(r,t,e={}){if(jt(r)){let[l,h]=[r,t];return it(...l.rangeArgs.colors,{...l.rangeArgs.options,...h})}let{space:i,outputSpace:a,progression:n,premultiplied:s}=e;r=_(r),t=_(t),r=tt(r),t=tt(t);let o={colors:[r,t],options:e};if(i?i=f.get(i):i=f.registry[z.interpolationSpace]||r.space,a=a?f.get(a):i,r=L(r,i),t=L(t,i),r=j(r),t=j(t),i.coords.h&&i.coords.h.type==="angle"){let l=e.hue=e.hue||"shorter",h=[i,"h"],[u,c]=[D(r,h),D(t,h)];[u,c]=yr(l,[u,c]),I(r,h,u),I(t,h,c)}return s&&(r.coords=r.coords.map(l=>l*r.alpha),t.coords=t.coords.map(l=>l*t.alpha)),Object.assign(l=>{l=n?n(l):l;let h=r.coords.map((d,g)=>{let M=t.coords[g];return lt(d,M,l)}),u=lt(r.alpha,t.alpha,l),c={space:i,coords:h,alpha:u};return s&&(c.coords=c.coords.map(d=>d/u)),a!==i&&(c=L(c,a)),c},{rangeArgs:o})}function jt(r){return O(r)==="function"&&!!r.rangeArgs}z.interpolationSpace="lab";function Si(r){r.defineFunction("mix",$e,{returns:"color"}),r.defineFunction("range",it,{returns:"function<color>"}),r.defineFunction("steps",Oe,{returns:"array<color>"})}var xi=Object.freeze({__proto__:null,isRange:jt,mix:$e,range:it,register:Si,steps:Oe}),Xe=new f({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:et,fromBase:r=>{let t=Math.max(...r),e=Math.min(...r),[i,a,n]=r,[s,o,l]=[NaN,0,(e+t)/2],h=t-e;if(h!==0){switch(o=l===0||l===1?0:(t-l)/Math.min(l,1-l),t){case i:s=(a-n)/h+(a<n?6:0);break;case a:s=(n-i)/h+2;break;case n:s=(i-a)/h+4}s=s*60}return[s,o*100,l*100]},toBase:r=>{let[t,e,i]=r;t=t%360,t<0&&(t+=360),e/=100,i/=100;function a(n){let s=(n+t/30)%12,o=e*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(s-3,9-s,1))}return[a(0),a(8),a(4)]},formats:{hsl:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),Ie=new f({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:Xe,fromBase(r){let[t,e,i]=r;e/=100,i/=100;let a=i+e*Math.min(i,1-i);return[t,a===0?0:200*(1-i/a),100*a]},toBase(r){let[t,e,i]=r;e/=100,i/=100;let a=i*(1-e/2);return[t,a===0||a===1?0:(i-a)/Math.min(a,1-a)*100,a*100]},formats:{color:{toGamut:!0}}}),Ci=new f({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:Ie,fromBase(r){let[t,e,i]=r;return[t,i*(100-e)/100,100-i]},toBase(r){let[t,e,i]=r;e/=100,i/=100;let a=e+i;if(a>=1){let o=e/a;return[t,0,o*100]}let n=1-i,s=n===0?0:1-e/n;return[t,s*100,n*100]},formats:{hwb:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]}}});const Ti=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],Ai=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]];var je=new S({id:"a98rgb-linear",name:"Linear Adobe® 98 RGB compatible",white:"D65",toXYZ_M:Ti,fromXYZ_M:Ai}),Di=new S({id:"a98rgb",name:"Adobe® 98 RGB compatible",base:je,toBase:r=>r.map(t=>Math.pow(Math.abs(t),563/256)*Math.sign(t)),fromBase:r=>r.map(t=>Math.pow(Math.abs(t),256/563)*Math.sign(t)),formats:{color:{id:"a98-rgb"}}});const Li=[[.7977604896723027,.13518583717574031,.0313493495815248],[.2880711282292934,.7118432178101014,8565396060525902e-20],[0,0,.8251046025104601]],Pi=[[1.3457989731028281,-.25558010007997534,-.05110628506753401],[-.5446224939028347,1.5082327413132781,.02053603239147973],[0,0,1.2119675456389454]];var qe=new S({id:"prophoto-linear",name:"Linear ProPhoto",white:"D50",base:Rt,toXYZ_M:Li,fromXYZ_M:Pi});const Ri=1/512,Ei=16/512;var Bi=new S({id:"prophoto",name:"ProPhoto",base:qe,toBase(r){return r.map(t=>t<Ei?t/16:t**1.8)},fromBase(r){return r.map(t=>t>=Ri?t**(1/1.8):16*t)},formats:{color:{id:"prophoto-rgb"}}}),zi=new f({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:vt,fromBase(r){let[t,e,i]=r,a;const n=2e-4;return Math.abs(e)<n&&Math.abs(i)<n?a=NaN:a=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),ct(a)]},toBase(r){let[t,e,i]=r,a,n;return isNaN(i)?(a=0,n=0):(a=e*Math.cos(i*Math.PI/180),n=e*Math.sin(i*Math.PI/180)),[t,a,n]},formats:{oklch:{coords:["<number> | <percentage>","<number> | <percentage>[0,1]","<number> | <angle>"]}}});const Ge=203,Ze=2610/2**14,Fi=2**14/2610,Yi=2523/2**5,Ue=2**5/2523,Ne=3424/2**12,He=2413/2**7,Ve=2392/2**7;var $i=new S({id:"rec2100pq",name:"REC.2100-PQ",base:mt,toBase(r){return r.map(function(t){return(Math.max(t**Ue-Ne,0)/(He-Ve*t**Ue))**Fi*1e4/Ge})},fromBase(r){return r.map(function(t){let e=Math.max(t*Ge/1e4,0),i=Ne+He*e**Ze,a=1+Ve*e**Ze;return(i/a)**Yi})},formats:{color:{id:"rec2100-pq"}}});const We=.17883277,Je=.28466892,Qe=.55991073,qt=3.7743;var Oi=new S({id:"rec2100hlg",cssid:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:mt,toBase(r){return r.map(function(t){return t<=.5?t**2/3*qt:(Math.exp((t-Qe)/We)+Je)/12*qt})},fromBase(r){return r.map(function(t){return t/=qt,t<=1/12?Math.sqrt(3*t):We*Math.log(12*t-Je)+Qe})},formats:{color:{id:"rec2100-hlg"}}});const Ke={};X.add("chromatic-adaptation-start",r=>{r.options.method&&(r.M=tr(r.W1,r.W2,r.options.method))}),X.add("chromatic-adaptation-end",r=>{r.M||(r.M=tr(r.W1,r.W2,r.options.method))});function kt({id:r,toCone_M:t,fromCone_M:e}){Ke[r]=arguments[0]}function tr(r,t,e="Bradford"){let i=Ke[e],[a,n,s]=p(i.toCone_M,r),[o,l,h]=p(i.toCone_M,t),u=[[o/a,0,0],[0,l/n,0],[0,0,h/s]],c=p(u,i.toCone_M);return p(i.fromCone_M,c)}kt({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599364,-1.1293816,.2198974],[.3611914,.6388125,-64e-7],[0,0,1.0890636]]}),kt({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929,-.1470543,.1599627],[.4323053,.5183603,.0492912],[-.0085287,.0400428,.9684867]]}),kt({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238,-.278869,.1827452],[.454369,.4735332,.0720978],[-.0096276,-.005698,1.0153256]]}),kt({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.011254630531685,.1491867754444518],[.3875265432361372,.6214474419314753,-.008973985167612518],[-.01584149884933386,-.03412293802851557,1.04996443687785]]}),Object.assign(E,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),E.ACES=[.32168/.33767,1,(1-.32168-.33767)/.33767];const Xi=[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],Ii=[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]];var er=new S({id:"acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:E.ACES,toXYZ_M:Xi,fromXYZ_M:Ii,formats:{color:{}}});const St=2**-16,Gt=-.35828683,xt=(Math.log2(65504)+9.72)/17.52;var ji=new S({id:"acescc",name:"ACEScc",coords:{r:{range:[Gt,xt],name:"Red"},g:{range:[Gt,xt],name:"Green"},b:{range:[Gt,xt],name:"Blue"}},referred:"scene",base:er,toBase(r){const t=-.3013698630136986;return r.map(function(e){return e<=t?(2**(e*17.52-9.72)-St)*2:e<xt?2**(e*17.52-9.72):65504})},fromBase(r){return r.map(function(t){return t<=0?(Math.log2(St)+9.72)/17.52:t<St?(Math.log2(St+t*.5)+9.72)/17.52:(Math.log2(t)+9.72)/17.52})},formats:{color:{}}}),rr=Object.freeze({__proto__:null,A98RGB:Di,A98RGB_Linear:je,ACEScc:ji,ACEScg:er,HSL:Xe,HSV:Ie,HWB:Ci,ICTCP:It,JzCzHz:Xt,Jzazbz:Re,LCH:Q,Lab:x,Lab_D65:Ft,OKLCH:zi,OKLab:vt,P3:pe,P3_Linear:ce,ProPhoto:Bi,ProPhoto_Linear:qe,REC_2020:ue,REC_2020_Linear:mt,REC_2100_HLG:Oi,REC_2100_PQ:$i,XYZ_ABS_D65:$t,XYZ_D50:Rt,XYZ_D65:A,sRGB:et,sRGB_Linear:de});class b{constructor(...t){let e;t.length===1&&(e=_(t[0]));let i,a,n;e?(i=e.space||e.spaceId,a=e.coords,n=e.alpha):[i,a,n]=t,Object.defineProperty(this,"space",{value:f.get(i),writable:!1,enumerable:!0,configurable:!0}),this.coords=a?a.slice():[0,0,0],this.alpha=n<1?n:1;for(let s=0;s<this.coords.length;s++)this.coords[s]==="NaN"&&(this.coords[s]=NaN);for(let s in this.space.coords)Object.defineProperty(this,s,{get:()=>this.get(s),set:o=>this.set(s,o)})}get spaceId(){return this.space.id}clone(){return new b(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...t){let e=Ar(this,...t);return e.color=new b(e.color),e}static get(t,...e){return t instanceof b?t:new b(t,...e)}static defineFunction(t,e,i=e){let{instance:a=!0,returns:n}=i,s=function(...o){let l=e(...o);if(n==="color")l=b.get(l);else if(n==="function<color>"){let h=l;l=function(...u){let c=h(...u);return b.get(c)},Object.assign(l,h)}else n==="array<color>"&&(l=l.map(h=>b.get(h)));return l};t in b||(b[t]=s),a&&(b.prototype[t]=function(...o){return s(this,...o)})}static defineFunctions(t){for(let e in t)b.defineFunction(e,t[e],t[e])}static extend(t){if(t.register)t.register(b);else for(let e in t)b.defineFunction(e,t[e])}}b.defineFunctions({get:D,getAll:J,set:I,setAll:ne,to:L,equals:Dr,inGamut:K,toGamut:j,distance:_e,toString:ft}),Object.assign(b,{util:gr,hooks:X,WHITES:E,Space:f,spaces:f.registry,parse:ae,defaults:z});for(let r of Object.keys(rr))f.register(rr[r]);for(let r in f.registry)Zt(r,f.registry[r]);X.add("colorspace-init-end",r=>{var t;Zt(r.id,r),(t=r.aliases)==null||t.forEach(e=>{Zt(e,r)})});function Zt(r,t){Object.keys(t.coords),Object.values(t.coords).map(i=>i.name);let e=r.replace(/-/g,"_");Object.defineProperty(b.prototype,e,{get(){let i=this.getAll(r);return typeof Proxy>"u"?i:new Proxy(i,{has:(a,n)=>{try{return f.resolveCoord([t,n]),!0}catch{}return Reflect.has(a,n)},get:(a,n,s)=>{if(n&&typeof n!="symbol"&&!(n in a)){let{index:o}=f.resolveCoord([t,n]);if(o>=0)return a[o]}return Reflect.get(a,n,s)},set:(a,n,s,o)=>{if(n&&typeof n!="symbol"&&!(n in a)||n>=0){let{index:l}=f.resolveCoord([t,n]);if(l>=0)return a[l]=s,this.setAll(r,a),!0}return Reflect.set(a,n,s,o)}})},set(i){this.setAll(r,i)},configurable:!0,enumerable:!0})}b.extend(wt),b.extend({deltaE:rt}),Object.assign(b,{deltaEMethods:wt}),b.extend(ki),b.extend({contrast:Vr}),b.extend(Jr),b.extend(Pr),b.extend(xi),b.extend(_t);function Ut(r){return r}function Z(r){return r*r*(3-2*r)}function ir(r,t,e,i){return r*t+e*i}function ar(r,t,e,i){let a=[Math.round((r.r*t+e.r*i)*255),Math.round((r.g*t+e.g*i)*255),Math.round((r.b*t+e.b*i)*255)];return`rgb(${a[0]}, ${a[1]}, ${a[2]})`}function Ct(r){if(typeof r=="number")return ir;if(typeof r=="string"){let t={};return(e,i,a,n)=>(t[e]||(t[e]=new b(e).srgb),t[a]||(t[a]=new b(a).srgb),ar(t[e],i,t[a],n))}return(t,e,i,a)=>e<1?t:i}function U(r,t=void 0){return t===void 0&&(t=Ct(r)),{finalValue:r,interpolate:(e,i)=>t(e,1-Math.min(i,1),r,Math.min(i,1))}}function qi(r,t=void 0){return t===void 0&&(t=Ct(r())),{interpolate:(e,i)=>t(e,1-Math.min(i,1),r(),Math.min(i,1))}}function Gi(r,t=void 0){return t===void 0&&(t=Ct(r[0])),{interpolate:(e,i)=>{let a=Math.min(i,1)*(r.length-1)-1,n=Math.min(a-Math.floor(a),1);return a<0?t(e,1-n,r[0],n):t(r[Math.floor(a)],1-n,r[Math.floor(a)+1],n)}}}class F{constructor(t,e=1e3,i=Ut){this.duration=0,this.finalValue=void 0,this.interpolator=null,this.duration=e,t.hasOwnProperty("finalValue")?this.finalValue=t.finalValue:this.finalValue=void 0,this.interpolator=t,this.curve=i}evaluate(t,e){let i=this.curve(this.duration>0?e/this.duration:1);return this.interpolator.interpolate(t,i)}withDelay(t){return t?new Zi(this,t):this}}class Tt extends F{constructor(t,e){super(U(t),e,Z)}}class Zi extends F{constructor(t,e){super(t.interpolator,t.duration+e,t.curve),this.delay=e}evaluate(t,e){return e<=this.delay?t:super.evaluate(t,(e-this.delay)*this.duration/(this.duration-this.delay))}}function Ui(r,t=1e3,e=Ut){return new F(U(r),t,e)}function At(r,t){return typeof r=="number"&&typeof t=="number"?Math.abs(r-t)<=.001:r==t}function nr(){var r=0;return Object.assign(function(){return r},{advance:e=>{r+=e}})}function Ni(r){let t=new Set;for(;r=Reflect.getPrototypeOf(r);)Reflect.ownKeys(r).forEach(i=>t.add(i));return t}class Hi{constructor(t=void 0){this.info=t,this.promise=new Promise((e,i)=>{this.reject=i,this.resolve=e})}}function Vi(r){let t=1e12,e=-1e12,i=1e12,a=-1e12;return r.forEach(n=>{n.x<t&&(t=n.x),n.x>e&&(e=n.x),n.y<i&&(i=n.y),n.y>a&&(a=n.y)}),{x:[t,e],y:[i,a]}}var sr=(r=>(r[r.DEFAULT=0]="DEFAULT",r[r.ALWAYS=1]="ALWAYS",r[r.WHEN_UPDATED=2]="WHEN_UPDATED",r))(sr||{});class W{constructor(t){if(this.valueFn=void 0,this.transform=void 0,this.cacheTransform=!1,this._cachedValue=null,this.computeArg=void 0,this.recompute=0,this.needsUpdate=!1,this.animation=null,this.label=null,this._getterValue=null,this._computedLastValue=null,this._hasComputed=!1,this._timeProvider=null,this.currentTime=0,this._changedLastTick=!1,this._listeners=[],this._animationCompleteCallbacks=[],t==null||t==null||!(t.hasOwnProperty("value")||t.hasOwnProperty("valueFn")))typeof t=="function"?this.valueFn=t:this.value=t;else{let e=t;e.valueFn!==void 0?this.valueFn=e.valueFn:e.value!==void 0?this.value=e.value:console.error("One of `value` or `valueFn` must be defined to create an Attribute"),this.transform=e.transform??null,this.cacheTransform=e.cacheTransform??!1,this._cachedValue=null,this.computeArg=e.computeArg??null,this.recompute=e.recompute??0}}addListener(t){this._listeners.push(t)}removeListener(t){let e=this._listeners.indexOf(t);e>=0&&(this._listeners=this._listeners.splice(e,1))}setTimeProvider(t){this._timeProvider=t}_getComputeArg(){return this.computeArg!==void 0?this.computeArg:this}compute(){this.valueFn&&(this._computedLastValue=this.valueFn(this._getComputeArg()))}advance(t=void 0){return(this.animation!=null||this.needsUpdate||this.valueFn)&&(this._timeProvider===null?this.currentTime+=t:this.currentTime=this._timeProvider()),this.animation==null&&this._animationCompleteCallbacks.length>0&&(console.warn("Found animation-complete callbacks for a non-existent animation"),this._cleanUpAnimation(!0)),this._animationFinished()&&this._computeAnimation(),this.animation!=null||this.needsUpdate?(this.needsUpdate=!1,this._changedLastTick=!0,!0):(this.recompute===1&&this.compute(),this._changedLastTick=!1,!1)}_computeAnimation(t=!0){if(!this.animation)return;this._timeProvider&&(this.currentTime=this._timeProvider());let{animator:e,start:i}=this.animation,a=e.evaluate(this.valueFn?this._computedLastValue:this.value,Math.min(this.currentTime-i,e.duration));this._animationFinished()&&t?(this.valueFn?this.compute():this.value=a,this._cleanUpAnimation(!1),this._getterValue=null):this._getterValue=a}_animationFinished(){return this.animation?this.animation.animator.duration-20<=this.currentTime-this.animation.start:!0}_transform(t){let e;if(this.transform){let i=this._cachedValue;if(i&&At(i.raw,t))e=i.result;else{let a=t;e=this.transform(t,this._getComputeArg()),this.cacheTransform&&(this._cachedValue={raw:a,result:e})}}else e=t;return e}_cleanUpAnimation(t=!1){this.animation=null,this._animationCompleteCallbacks.forEach(e=>{!t||!e.info.rejectOnCancel?e.resolve(this):e.reject({newValue:this.last()})}),this._animationCompleteCallbacks=[]}get(){return this._transform(this.getUntransformed())}getUntransformed(){this._computeAnimation();let t;return this._getterValue!=null?t=this._getterValue:this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),t=this._computedLastValue):t=this.value,t}getPreload(t=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let i=this.get();return{start:i,end:i,startTime:t||this.currentTime,endTime:t||this.currentTime}}let e=this.getPreloadUntransformed(t);return{start:this._transform(e.start),end:this._transform(e.end),startTime:e.startTime,endTime:e.endTime}}getPreloadUntransformed(t=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let n=this.getUntransformed();return{start:n,end:n,startTime:t||this.currentTime,endTime:t||this.currentTime}}if(!(this.animation.animator instanceof Tt))return console.error("Calling getPreload for a non-preloadable animation is forbidden. If using MarkSet, make sure this attribute is registered as preloadable."),null;if(this._animationFinished())return this._computeAnimation(),this.getPreloadUntransformed(t);let e;this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),e=this._computedLastValue):e=this.value;let i=this.animation.animator.finalValue,a=(t||this.currentTime)-this.currentTime;return{start:e,end:i,startTime:this.animation.start+a,endTime:this.animation.start+this.animation.animator.duration+a}}set(t){typeof t=="function"?(this.value!=null&&(this._computedLastValue=this.value),this.valueFn=t,this.value=void 0,this._getterValue=null):(this.value=t,this.valueFn=null,this._getterValue=null),this.needsUpdate=!0,this.animation&&this._cleanUpAnimation(!0),this._listeners.forEach(e=>e(this,!1))}data(){return this.valueFn?this.valueFn(this._getComputeArg()):this.value}last(){return this.animation&&this._computeAnimation(!1),this._getterValue!=null?this._getterValue:this.value!==void 0?this.value:this._computedLastValue}future(){return this.animation?this.animation.animator.finalValue:this.last()}updateTransform(){this._cachedValue=null}animate(t){this._timeProvider&&(this.currentTime=this._timeProvider()),this.animation&&(this.valueFn?this._computedLastValue=this.last():this.value=this.last(),this._cleanUpAnimation(!0)),this.animation={animator:t,start:this.currentTime},this._computeAnimation(),this._listeners.forEach(e=>e(this,!0))}wait(t=!0){if(!this.animation)return new Promise((i,a)=>i(this));let e=new Hi({rejectOnCancel:t});return this._animationCompleteCallbacks.push(e),e.promise}changed(){return this._changedLastTick}}function Nt(r,t,e){return Object.fromEntries(Object.entries(r).map(([i,a])=>[i,typeof a=="function"?a(t,e):a]))}class Ht{constructor(t=[],e={animationDuration:1e3,animationCurve:Z}){this.timeProvider=null,this.lazyUpdates=!0,this.animatingMarks=new Set,this.updatedMarks=new Set,this.preloadableProperties=new Set,this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!1,this.timeProvider=nr(),this.lazyUpdates=!0,this._defaultDuration=1e3,this._defaultCurve=Z,this.configure(e),this.marks=t,this.marksByID=new Map,this.marks.forEach(i=>{if(this.marksByID.has(i.id)){console.error(`ID '${i.id}' is duplicated in mark render group`);return}this.marksByID.set(i.id,i),this._configureMark(i)})}configure(t){return t.timeProvider!==void 0&&(this.timeProvider=t.timeProvider),t.lazyUpdates!==void 0&&(this.lazyUpdates=t.lazyUpdates),t.animationDuration!==void 0&&(this._defaultDuration=t.animationDuration),t.animationCurve!==void 0&&(this._defaultCurve=t.animationCurve),this.marks&&this.getMarks().forEach(e=>this._configureMark(e)),this}_configureMark(t){t.setTimeProvider(this.timeProvider),t.configure({animationDuration:this._defaultDuration,animationCurve:this._defaultCurve}),t.addListener((e,i,a)=>{this.updatedMarks.add(e),!this.preloadableProperties.has(i)&&a&&this.animatingMarks.add(e),this._changedLastTick=!0})}forceUpdate(){return this._forceUpdate=!0,this}currentTime(){return this.timeProvider()}getMarks(){return this.marks}registerPreloadableProperty(t){return this.preloadableProperties.add(t),this}advance(t){this.timeProvider.advance(t);let e=this.lazyUpdates?[...this.animatingMarks,...this.updatedMarks]:this.getMarks();if(this.updatedMarks=new Set,e.length==0&&!this._forceUpdate&&!this._markListChanged)return this._changedLastTick=!1,!1;for(let i of e)i.advance()||this.animatingMarks.delete(i);return this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!0,!0}marksAnimating(){return this.animatingMarks.size>0}animateTo(t,e,i={}){return this.preloadableProperties.has(t)?this.forEach((n,s)=>{let o=Nt(i,n,s),l=o.duration===void 0?this._defaultDuration:o.duration;n.animate(t,new Tt(typeof e=="function"?e(n,s):e,l).withDelay(o.delay||0))}):this.forEach((n,s)=>{n.animateTo(t,typeof e=="function"?e(n,s):e,Nt(i,n,s))}),this}animate(t,e={}){let i=this.preloadableProperties.has(t);return i&&e.interpolator?(console.error("Cannot apply custom interpolator function on preloadable property."),this):(this.forEach((a,n)=>{let s=Nt(e,a,n);if(i){let o=s.duration===void 0?this._defaultDuration:s.duration,l=a.data(t);a.animate(t,new Tt(l,o).withDelay(s.delay||0))}else a.animate(t,s)}),this)}update(t,e=void 0){return this.forEach((i,a)=>{i.setAttr(t,e===void 0?void 0:typeof e=="function"?e(i,a):e)}),this}wait(t,e=!0){return Promise.all(this.map(i=>i.wait(t,e)))}getMarkByID(t){return this.marksByID.get(t)}forEach(t){this.getMarks().forEach(t)}map(t){return this.getMarks().map(t)}filter(t){let e=Object.assign({},this),i=this.getMarks().filter(t);return Object.keys(this).forEach(a=>{e[a]=this[a]}),e.marks=i,e.marksByID=new Map,i.forEach(a=>{e.marksByID.set(a.id,a)}),Ni(this).forEach(a=>{a=="getMarks"?e[a]=()=>i:e[a]=(...n)=>{let s=this.getMarks();this.marks=i;let o=this[a](...n);return this.marks=s,o===this?e:o}}),e}updateTransform(t){return this.getMarks().forEach(e=>e.updateTransform(t)),this}addMark(t){if(this.marksByID.has(t.id))return console.error("Attempted to add mark with ID that exists:",t.id),this;this.marks.push(t),this.marksByID.set(t.id,t),this._configureMark(t),this._markListChanged=!0}removeMark(t){let e=this.marks.indexOf(t);if(e<0)return console.warn("Attempted to remove mark that does not exist"),this;this.marks.splice(e,1),this.marksByID.delete(t.id),this._markListChanged=!0}count(){return this.getMarks().length}changed(t=void 0){return t===void 0?this._changedLastTick:this._changedLastTick&&this.getMarks().some(e=>e.changed(t))}}function Wi(r=[]){return new Ht(r)}const Ji=5e3;class Vt{constructor(t,e){this._timeProvider=null,this._listeners=[],this._defaultDuration=1e3,this._defaultCurve=Z,this._changedLastTick=!1,this.framesWithUpdate=0,this.id=t,e===void 0&&console.error("Mark constructor requires an ID and an object defining attributes");let i={};Object.keys(e).forEach(a=>{let n=new W(Object.assign(Object.assign({},e[a]),{computeArg:this}));n.addListener((s,o)=>this._attributesChanged(a,o)),i[a]=n}),this.attributes=i}configure(t){return t.animationDuration!==void 0&&(this._defaultDuration=t.animationDuration),t.animationCurve!==void 0&&(this._defaultCurve=t.animationCurve),this}addListener(t){return this._listeners.push(t),this}removeListener(t){let e=this._listeners.indexOf(t);return e>=0&&(this._listeners=this._listeners.splice(e,1)),this}_attributesChanged(t,e){this._changedLastTick=!0,this._listeners.forEach(i=>i(this,t,e))}setTimeProvider(t){return this._timeProvider=t,Object.values(this.attributes).forEach(e=>e.setTimeProvider(this._timeProvider)),this}advance(t=void 0){let e=!1;return Object.values(this.attributes).forEach(i=>{i.advance(t)&&(e=!0)}),e?(this.framesWithUpdate+=1,this.framesWithUpdate>Ji&&console.warn("Marks are being updated excessively!"),this._changedLastTick=!0,!0):(this.framesWithUpdate=0,this._changedLastTick=!1,!1)}setAttr(t,e=void 0){let i=this.attributes[t];i===void 0&&console.error(`No attribute named '${String(t)}'`);let a=i.last();return e===void 0?i.compute():i.set(e),At(a,i.data())||this._listeners.forEach(n=>n(this,t,!1)),this}attr(t,e=!0){return this.attributes[t]||console.error(`No attribute named '${String(t)}'`),e?this.attributes[t].get():this.attributes[t].getUntransformed()}data(t){return this.attributes[t]===void 0&&console.error(`No attribute named '${String(t)}'`),this.attributes[t].data()}updateTransform(t){return this.attributes[t]===void 0&&console.error(`No attribute named '${String(t)}'`),this.attributes[t].updateTransform(),this}animateTo(t,e,i={}){if(!this.attributes.hasOwnProperty(t))return console.error(`No attribute named '${String(t)}'`),this;if(typeof e=="function")return this.attributes[t].set(e),this.animate(t,{duration:i.duration,curve:i.curve}),this;let a=i.duration===void 0?this._defaultDuration:i.duration,n=i.curve===void 0?this._defaultCurve:i.curve,s=new F(U(e),a,n).withDelay(i.delay||0);return this.attributes[t].animate(s),this}animate(t,e={}){if(!this.attributes.hasOwnProperty(t))return console.error(`Attempting to animate undefined property ${String(t)}`),this;let i;if(e instanceof F)i=e;else if(e.interpolator!==void 0){let a=e.interpolator;i=new F(a,e.duration!==void 0?e.duration:this._defaultDuration,e.curve!==void 0?e.curve:this._defaultCurve).withDelay(e.delay||0)}else{let a=this.data(t);if(!At(a,this.attributes[t].last())||!At(a,this.attributes[t].future()))i=new F(U(a),e.duration!==void 0?e.duration:this._defaultDuration,e.curve!==void 0?e.curve:this._defaultCurve).withDelay(e.delay||0);else return this}return this.attributes[t].animate(i),this}wait(t,e=!0){let i=Array.isArray(t)?t:[t];return Promise.all(i.map(a=>this.attributes[a].wait(e)))}changed(t=void 0){return t===void 0?this._changedLastTick:Array.isArray(t)?this._changedLastTick&&t.some(e=>this.attributes[e].changed()):this._changedLastTick&&this.attributes[t].changed()}}class Qi{constructor(t){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof t.advance=="function"?this.toAdvance=[t]:this.toAdvance=t,this.start()}onChange(t){return this._callbacks.push(t),this}start(){return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(t=>t()),requestAnimationFrame(t=>this.tick(t)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(t){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(e=>e.advance(t-this._lastTick)).some(e=>e)&&this._callbacks.forEach(e=>e()),this.stopped||requestAnimationFrame(e=>this.tick(e)),this._lastTick=t}}class Ki{constructor(t){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof t.advance=="function"?this.toAdvance=[t]:this.toAdvance=t,this.start()}onChange(t){return this._callbacks.push(t),this}start(){if(this.stopped)return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(t=>t()),requestAnimationFrame(t=>this.tick(t)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(t){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(e=>e.advance(t-this._lastTick)).some(e=>e)?(this._callbacks.forEach(e=>e()),this.stopped||requestAnimationFrame(e=>this.tick(e)),this._lastTick=t):this.stop()}}var or=(r=>(r.Waiting="waiting",r.Entering="entering",r.Visible="visible",r.Exiting="exiting",r))(or||{}),lr=(r=>(r.Show="show",r.Hide="hide",r))(lr||{});class ta{constructor(t){this.pool=new Map,this.queuedAnimations=new Map,this._flushTimer=null,this._renderGroup=null,this.defer=!1,t.create||console.error("StageManager requires a create callback"),this._callbacks={create:t.create,show:t.show||(async()=>{}),hide:t.hide||(async()=>{}),destroy:t.destroy||(()=>{})}}configure(t={}){return t.defer!==void 0&&(this.defer=t.defer),this}attach(t){return this._renderGroup=t,this}_perform(t,e){let i=this.pool.get(t);if(!(!i||!i.element)){if(e=="show"){if(i.lastState=="visible")return;i.lastState="entering",this._callbacks.show(i.element,i.info).then(()=>{i.state=="entering"&&(i.state="visible",i.lastState="visible")},()=>{})}else if(e=="hide"){if(i.lastState=="exiting"||i.lastState=="waiting")return;i.lastState="exiting",this._callbacks.hide(i.element,i.info).then(()=>{let a=this.pool.get(t);a&&a.lastState=="exiting"&&(this._renderGroup&&this._renderGroup.removeMark(a.element),this._callbacks.destroy(t,a.info),this.pool.delete(t))},()=>{})}}}_enqueue(t,e){let i=this.pool.get(t);if(!i.element)return!1;if(e=="show"){if(i.state=="entering"||i.state=="visible")return!1;i.state="entering"}else if(e=="hide"){if(i.state=="exiting")return!1;i.state="exiting"}else console.error("Unknown action enqueued:",e);return this.defer?(this.queuedAnimations.set(t,e),this._flushTimer||(this._flushTimer=window.setTimeout(()=>this._flush(),0))):this._perform(t,e),!0}_flush(){this._flushTimer=null,this.queuedAnimations.forEach((t,e)=>{this._perform(e,t)}),this.queuedAnimations.clear()}show(t,e=void 0){if(!this.pool.has(t)){let i=e!=null?typeof e=="function"?e(t):e:null,a=this._callbacks.create(t,i);this._renderGroup&&this._renderGroup.addMark(a),this.pool.set(t,{element:a,info:i,state:"waiting",lastState:"waiting"})}return this._enqueue(t,"show")}hide(t){return this.pool.has(t)?this._enqueue(t,"hide"):!1}getInfo(t){return this.pool.has(t)?this.pool.get(t).info:null}getElement(t){return this.pool.has(t)?this.pool.get(t).element:null}getAll(){return new Map(this.pool)}getAllIDs(){return Array.from(this.pool.keys())}getAllVisible(){let t=new Map;for(let[e,i]of this.pool)(i.state=="visible"||i.state=="entering")&&i.element&&t.set(e,i);return t}getAllVisibleIDs(){return Array.from(this.pool.keys()).filter(t=>(this.pool.get(t).state=="visible"||this.pool.get(t).state=="entering")&&!!this.pool.get(t).element)}isVisible(t){return this.pool.has(t)&&(this.pool.get(t).state=="visible"||this.pool.get(t).state=="entering")}}class ea{constructor(t={}){this.animationDuration=1e3,this.squareAspect=!0,this._xScaleFactor=new W(1),this._yScaleFactor=new W(1),this._translateX=new W(0),this._translateY=new W(0),this.timeProvider=nr(),this.controller=null,this._updatedNoAdvance=!1,this.listeners=[],this.xScale=Object.assign(e=>((e-this._xDomain[0])*this.xRSpan()/this.xDSpan()+this._xRange[0])*this._xScaleFactor.get()+this._translateX.get(),{domain:(e=void 0)=>e===void 0?this._xDomain:(this._xDomain=e,this.xScale),range:(e=void 0)=>e===void 0?this._xRange:(this._xRange=e,this.xScale),invert:e=>((e-this._translateX.get())/this._xScaleFactor.get()-this._xRange[0])*this.xDSpan()/this.xRSpan()+this._xDomain[0]}),this.yScale=Object.assign(e=>((e-this._yDomain[0])*this.yRSpan()/this.yDSpan()+this._yRange[0])*this._yScaleFactor.get()+this._translateY.get(),{domain:(e=void 0)=>e===void 0?this._yDomain:(this._yDomain=e,this.yScale),range:(e=void 0)=>e===void 0?this._yRange:(this._yRange=e,this.yScale),invert:e=>((e-this._translateY.get())/this._yScaleFactor.get()-this._yRange[0])*this.yDSpan()/this.yRSpan()+this._yDomain[0]}),this.xDomain([0,1]),this.yDomain([0,1]),this.xRange([0,1]),this.yRange([0,1]),this.configure(t),this._xScaleFactor.setTimeProvider(this.timeProvider),this._yScaleFactor.setTimeProvider(this.timeProvider),this._translateX.setTimeProvider(this.timeProvider),this._translateY.setTimeProvider(this.timeProvider)}configure(t={}){return this.animationDuration=t.animationDuration!==void 0?t.animationDuration:1e3,this.minScale=t.minScale!==void 0?t.minScale:.1,this.maxScale=t.maxScale!==void 0?t.maxScale:14,this}xDomain(t=void 0){return t===void 0?this.xScale.domain():(this.xScale.domain(t),this)}yDomain(t=void 0){return t===void 0?this.yScale.domain():(this.yScale.domain(t),this)}xRange(t=void 0){return t===void 0?this.xScale.range():(this.xScale.range(t),this)}yRange(t=void 0){return t===void 0?this.yScale.range():(this.yScale.range(t),this)}xDSpan(){return this._xDomain[1]-this._xDomain[0]}yDSpan(){return this._yDomain[1]-this._yDomain[0]}xRSpan(){return this._xRange[1]-this._xRange[0]}yRSpan(){return this._yRange[1]-this._yRange[0]}makeSquareAspect(){let t=this.xRSpan()/this.xDSpan(),e=this.yRSpan()/this.yDSpan();if(t<e){let i=(this._yDomain[0]+this._yDomain[1])*.5,a=this.yRSpan()/t;this.yDomain([i-a*.5,i+a*.5])}else{let i=(this._xDomain[0]+this._xDomain[1])*.5,a=this.xRSpan()/e;this.xDomain([i-a*.5,i+a*.5])}return this}onUpdate(t){return this.listeners.push(t),this}isNeutral(){return Math.abs(this._xScaleFactor.get()-1)<=.01&&Math.abs(this._yScaleFactor.get()-1)<=.01&&Math.abs(this._translateX.get())<=5&&Math.abs(this._translateY.get())<=5}advance(t=void 0){return this.timeProvider.advance(t),[this._xScaleFactor.advance(t),this._yScaleFactor.advance(t),this._translateX.advance(t),this._translateY.advance(t)].some(i=>i)?(this._updatedNoAdvance=!1,this.listeners.forEach(i=>i(this)),!0):(this._updatedNoAdvance||(this.listeners.forEach(i=>i(this)),this._updatedNoAdvance=!0),!1)}scaleBy(t,e=null){this.unfollow();let i=this._translateX.get(),a=this._translateY.get(),n=this._xScaleFactor.get(),s=this._yScaleFactor.get();e?e=[(e[0]-i)/n,(e[1]-a)/s]:e=[(this.xRange[0]+this.xRange[1])*.5,(this.yRange[0]+this.yRange[1])*.5];let o=typeof t=="number"?t:t[0],l=typeof t=="number"?t:t[1],h=n+o;return h<=this.maxScale&&h>=this.minScale&&(this._xScaleFactor.set(h),this._translateX.set(i-o*e[0])),h=s+l,h<=this.maxScale&&h>=this.minScale&&(this._yScaleFactor.set(h),this._translateY.set(a-l*e[1])),this}translateBy(t,e){return this.unfollow(),this._translateX.set(this._translateX.get()+t),this._translateY.set(this._translateY.get()+e),this}transform(t=void 0,e=!1){if(t!==void 0){if(this.unfollow(),e){let i=a=>new F(U(a),this.animationDuration,Z);t.kx!==void 0?this._xScaleFactor.animate(i(t.kx)):t.k!==void 0&&this._xScaleFactor.animate(i(t.k)),t.ky!==void 0?this._yScaleFactor.animate(i(t.ky)):t.k!==void 0&&this._yScaleFactor.animate(i(t.k)),t.x!==void 0&&this._translateX.animate(i(t.x)),t.y!==void 0&&this._translateY.animate(i(t.y))}else t.kx!==void 0?this._xScaleFactor.set(t.kx):t.k!==void 0&&this._xScaleFactor.set(t.k),t.ky!==void 0?this._yScaleFactor.set(t.ky):t.k!==void 0&&this._yScaleFactor.set(t.k),t.x!==void 0&&this._translateX.set(t.x),t.y!==void 0&&this._translateY.set(t.y);return this}else{let i=this._xScaleFactor.last(),a=this._yScaleFactor.last();return{k:(i+a)*.5,kx:i,ky:a,x:this._translateX.last(),y:this._translateY.last()}}}reset(t=!1){return this.transform({k:1,x:0,y:0},t)}zoomTo(t,e=!0){return this.transform(t.transform(this),e)}follow(t,e=!0){if(this.controller=t,this._xScaleFactor.set(()=>{let i=this.controller.transform(this);return i.kx||i.k}),this._yScaleFactor.set(()=>{let i=this.controller.transform(this);return i.ky||i.k}),this._translateX.set(()=>this.controller.transform(this).x),this._translateY.set(()=>this.controller.transform(this).y),e){let i=a=>new F(U(a),this.animationDuration,Z);this._xScaleFactor.animate(i(this._xScaleFactor.data())),this._yScaleFactor.animate(i(this._yScaleFactor.data())),this._translateX.animate(i(this._translateX.data())),this._translateY.animate(i(this._translateY.data()))}return this}unfollow(){return this.controller!=null&&(this._xScaleFactor.set(this._xScaleFactor.get()),this._yScaleFactor.set(this._yScaleFactor.get()),this._translateX.set(this._translateX.get()),this._translateY.set(this._translateY.get())),this.controller=null,this}}class Wt{constructor(t,e={}){this.lastCompute=void 0,this.marks=t,this.centerMark=e.centerMark!==void 0?e.centerMark:void 0,this.centerMark&&!this.marks.includes(this.centerMark)&&(this.marks=[...this.marks,this.centerMark]),this.xAttr=e.xAttr!==void 0?e.xAttr:"x",this.yAttr=e.yAttr!==void 0?e.yAttr:"y",this.padding=e.padding!==void 0?e.padding:20,this.transformCoordinates=e.transformCoordinates!==void 0?e.transformCoordinates:!1}transform(t){if(this.lastCompute&&this.lastCompute.scales===t&&this.lastCompute.time==t.timeProvider())return this.lastCompute.result;let e=this.marks.map(w=>this._getMarkLocation(w)),i,a,n,s,o=this.centerMark!==void 0?this._getMarkLocation(this.centerMark):null,l=t.transform(),{x:h,y:u}=Vi(e);if(o){let w=Math.max(h[1]-o.x,o.x-h[0]),k=Math.max(u[1]-o.y,o.y-u[0]);h=[o.x-w,o.x+w],u=[o.y-k,o.y+k]}let c,d;Math.abs(h[1]-h[0])>0?c=(Math.abs(t.xRSpan())-this.padding*2)/(h[1]-h[0])/(Math.abs(t.xRSpan())/Math.abs(t.xDSpan())):c=l.kx,Math.abs(u[1]-u[0])>0?d=(Math.abs(t.yRSpan())-this.padding*2)/(u[1]-u[0])/(Math.abs(t.yRSpan())/Math.abs(t.yDSpan())):d=l.ky;let g=l.ky/l.kx;c=Math.min(c,t.maxScale),d=Math.min(d,t.maxScale),d<c*g?(n=d/g,s=d):(n=c,s=c*g),i=(h[0]+h[1])*.5,a=(u[0]+u[1])*.5,i=(i-t.xDomain()[0])*t.xRSpan()/t.xDSpan()+t.xRange()[0],a=(a-t.yDomain()[0])*t.yRSpan()/t.yDSpan()+t.yRange()[0];let M=-i*n+(t.xRange()[0]+t.xRange()[1])*.5,y=-a*s+(t.yRange()[0]+t.yRange()[1])*.5,v={kx:n,ky:s,x:M,y};return this.lastCompute={scales:t,time:t.timeProvider(),result:v},v}_getMarkLocation(t){return{x:t.attr(this.xAttr,this.transformCoordinates),y:t.attr(this.yAttr,this.transformCoordinates)}}}function ra(r,t={}){return new Wt([r],{centerMark:r,...t})}function ia(r,t={}){return new Wt(r,{...t})}class aa{constructor(t={}){this.markCollections=[],this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this._avgMarksPerBin=null,this._coordinateAttributes=t.coordinateAttributes??["x","y"],this._transformCoordinates=t.transformCoordinates??!0,this._avgMarksPerBin=t.marksPerBin??null}add(t){return this.markCollections.push(t),this}remove(t){let e=this.markCollections.indexOf(t);return e<0&&console.error("Tried to remove mark collection which does not exist:",t),this.markCollections.splice(e,1),this}invalidate(){return this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this}compute(){return console.log("computing interaction map"),this._extents=new Array(this._coordinateAttributes.length).fill([1e12,-1e12]),this._numMarks=0,this._forEachMark(t=>{this._coordinateAttributes.forEach((e,i)=>{let a=t.attr(e,this._transformCoordinates);a<this._extents[i][0]&&(this._extents[i][0]=a),a>this._extents[i][1]&&(this._extents[i][1]=a)}),this._numMarks+=1}),this._numMarks==0?this:(this._numBins=Math.round(this._numMarks/(this._avgMarksPerBin??Math.min(Math.max(1,this._numMarks/100),10))),this._binSizes=this._extents.map(t=>Math.ceil((t[1]-t[0])/this._numBins)),this._positionMap=new Map,this._forEachMark(t=>{let e=this._coordinateAttributes.map(a=>t.attr(a,this._transformCoordinates)),i=this._getPositionID(e);this._positionMap.has(i)?this._positionMap.get(i).push(t):this._positionMap.set(i,[t])}),this)}_forEachMark(t){this.markCollections.forEach(e=>{if(e instanceof Ht)e.forEach(t);else if(e instanceof Vt)t(e);else if(typeof e.forEach=="function")e.forEach(t);else if(typeof e=="function"){let i=e();i instanceof Vt?t(i):i.forEach(t)}else console.error("Unrecognized mark collection type in position map:",e)})}_getPositionID(t){return(this._numBins===null||!this._extents||!this._binSizes)&&console.error("Cannot hash position without computing first"),t.length!=this._coordinateAttributes.length&&console.error(`Need exactly ${this._coordinateAttributes.length} coordinates, got ${t.length}`),t.reduce((e,i,a)=>e*this._numBins+Math.floor((i-this._extents[a][0])/this._binSizes[a]),0)}marksNear(t,e,i=!0){if(this._positionMap||this.compute(),this._numMarks==0)return[];let a=this._recursiveBinWalk(t,e);return i?a.map(s=>{let o=this._coordinateAttributes.map(l=>s.attr(l,this._transformCoordinates));return[s,Math.sqrt(o.reduce((l,h,u)=>l+(h-t[u])*(h-t[u]),0))]}).filter(([s,o])=>o<=e).map(([s,o])=>s):a}_recursiveBinWalk(t,e,i=[]){let a=i.length;if(a==t.length)return this._positionMap.get(this._getPositionID(i))??[];let n=Math.ceil(e/this._binSizes[a]),s=new Array(n*2+1).fill(0).map((l,h)=>(h-n)*this._binSizes[a]+t[a]),o=[];return s.forEach(l=>{o=[...o,...this._recursiveBinWalk(t,n,[...i,l])]}),o}}m.Animator=F,m.Attribute=W,m.AttributeRecompute=sr,m.LazyTicker=Ki,m.Mark=Vt,m.MarkFollower=Wt,m.MarkRenderGroup=Ht,m.PositionMap=aa,m.PreloadableAnimator=Tt,m.Scales=ea,m.StageManager=ta,m.StagingAction=lr,m.StagingState=or,m.Ticker=Qi,m.autoMixingFunction=Ct,m.basicAnimationTo=Ui,m.centerOn=ra,m.colorMixingFunction=ar,m.createRenderGroup=Wi,m.curveEaseInOut=Z,m.curveLinear=Ut,m.interpolateAlongPath=Gi,m.interpolateTo=U,m.interpolateToFunction=qi,m.markBox=ia,m.numericalMixingFunction=ir,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
