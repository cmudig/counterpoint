(function(m,w){typeof exports=="object"&&typeof module<"u"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(m=typeof globalThis<"u"?globalThis:m||self,w(m["counterpoint-vis"]={}))})(this,function(m){"use strict";var pa=Object.defineProperty;var _a=(m,w,X)=>w in m?pa(m,w,{enumerable:!0,configurable:!0,writable:!0,value:X}):m[w]=X;var Kt=(m,w,X)=>(_a(m,typeof w!="symbol"?w+"":w,X),X);function w(r,t){return typeof r=="number"&&typeof t=="number"?Math.abs(r-t)<=.001:r==t}function X(){var r=0;return Object.assign(function(){return r},{advance:e=>{r+=e}})}function ki(r){let t=new Set;for(;r=Reflect.getPrototypeOf(r);)Reflect.ownKeys(r).forEach(i=>t.add(i));return t}class wi{constructor(t=void 0){this.info=t,this.promise=new Promise((e,i)=>{this.reject=i,this.resolve=e})}}function Si(r){let t=1e12,e=-1e12,i=1e12,a=-1e12;return r.forEach(s=>{s.x<t&&(t=s.x),s.x>e&&(e=s.x),s.y<i&&(i=s.y),s.y>a&&(a=s.y)}),{x:[t,e],y:[i,a]}}var te=(r=>(r[r.DEFAULT=0]="DEFAULT",r[r.ALWAYS=1]="ALWAYS",r[r.WHEN_UPDATED=2]="WHEN_UPDATED",r))(te||{});class M{constructor(t){if(this.valueFn=void 0,this.transform=void 0,this.cacheTransform=!1,this._cachedValue=null,this.computeArg=void 0,this.recompute=0,this.needsUpdate=!1,this.animation=null,this.label=null,this._computedValue=null,this._lastTickValue=void 0,this._animatedValue=null,this._hasComputed=!1,this._timeProvider=null,this.currentTime=0,this._changedLastTick=!1,this._preload=!1,this._listeners=[],this._animationCompleteCallbacks=[],this._animationCompleteTimeout=null,t==null||t==null||!(t.hasOwnProperty("value")||t.hasOwnProperty("valueFn")))typeof t=="function"?this.valueFn=t:this.value=t;else{let e=t;e.valueFn!==void 0?this.valueFn=e.valueFn:e.value!==void 0?this.value=e.value:console.error("One of `value` or `valueFn` must be defined to create an Attribute"),this.transform=e.transform??null,this.cacheTransform=e.cacheTransform??!1,this._cachedValue=null,this.computeArg=e.computeArg??null,this.recompute=e.recompute??0,this._preload=e.preload??!1}}registerPreloadable(){return this._preload=!0,this}copy(t={}){let e={...this,...t};return t.value!==void 0&&(e.valueFn=void 0),t.valueFn!==void 0&&(e.value=void 0),new M(e)}addListener(t){this._listeners.push(t)}removeListener(t){let e=this._listeners.indexOf(t);e>=0&&(this._listeners=this._listeners.splice(e,1))}setTimeProvider(t){this._timeProvider=t}_getComputeArg(){return this.computeArg!==void 0?this.computeArg:this}compute(){this.valueFn&&(this._computedValue=this.valueFn(this._getComputeArg()))}advance(t=void 0){return(this.animation!=null||this.needsUpdate||this.valueFn)&&(this._timeProvider===null?this.currentTime+=t:this.currentTime=this._timeProvider()),this.animation==null&&this._animationCompleteCallbacks.length>0&&(console.warn("Found animation-complete callbacks for a non-existent animation"),this._cleanUpAnimation(!0)),this._lastTickValue=void 0,this._lastTickValue=this.getUntransformed(),this.animation!=null||this.needsUpdate?(this.needsUpdate=!1,this._changedLastTick=!0,!0):(this._changedLastTick=!1,!1)}_computeAnimation(t=!0){if(!this.animation)return;this._timeProvider&&(this.currentTime=this._timeProvider());let{animator:e,start:i,initial:a}=this.animation,s=e.evaluate(a,Math.min(this.currentTime-i,e.duration));this._animationFinished()&&t?(this.valueFn?this.compute():this.value=s,this._cleanUpAnimation(!1),this._animatedValue=null):this._animatedValue=s}_animationFinished(){return this.animation?this.animation.animator.duration+20<=this.currentTime-this.animation.start:!0}_performTransform(t){let e;if(this.transform){let i=this._cachedValue;if(i&&w(i.raw,t))e=i.result;else{let a=t;e=this.transform(t,this._getComputeArg()),this.cacheTransform&&(this._cachedValue={raw:a,result:e})}}else e=t;return e}_cleanUpAnimation(t=!1){this._preload&&this.animation&&!t&&(this.valueFn?(this.compute(),this._lastTickValue=this._computedValue):(this.value=this.animation.animator.finalValue,this._lastTickValue=this.value)),this.animation=null,this._animatedValue=null,this._animationCompleteCallbacks.forEach(e=>{!t||!e.info.rejectOnCancel?e.resolve(this):e.reject({newValue:this.last()})}),this._animationCompleteCallbacks=[],this._animationCompleteTimeout&&(clearTimeout(this._animationCompleteTimeout),this._animationCompleteTimeout=null)}get(){return this._performTransform(this.getUntransformed())}getUntransformed(){if(this._lastTickValue!==void 0&&!this.needsUpdate&&this._timeProvider!==null&&this.currentTime==this._timeProvider())return this._lastTickValue;this._computeAnimation();let t;return this._animatedValue!=null?t=this._animatedValue:this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),t=this._computedValue):t=this.value,this._lastTickValue=t,t}getPreload(t=null){if(this._preload||console.error("Cannot call getPreload on a non-preloadable attribute."),this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let i=this.get();return{start:i,end:i,startTime:t||this.currentTime,endTime:t||this.currentTime}}let e=this.getPreloadUntransformed(t);return{start:this._performTransform(e.start),end:this._performTransform(e.end),startTime:e.startTime,endTime:e.endTime}}getPreloadUntransformed(t=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let s=this.getUntransformed();return{start:s,end:s,startTime:t||this.currentTime,endTime:t||this.currentTime}}if(this._animationFinished())return this._computeAnimation(),this.getPreloadUntransformed(t);let e;this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),e=this._computedValue):e=this.value;let i=this.animation.animator.finalValue;i===void 0&&console.error("Animations on preloadable attributes must have a final value");let a=(t||this.currentTime)-this.currentTime;return{start:e,end:i,startTime:this.animation.start+a,endTime:this.animation.start+this.animation.animator.duration+a}}set(t){typeof t=="function"?(this.value!=null&&(this._computedValue=this.getUntransformed()),this.valueFn=t,this.value=void 0,this._animatedValue=null):(this.value=t,this.valueFn=null,this._animatedValue=null),this.needsUpdate=!0,this._lastTickValue=void 0,this.animation&&this._cleanUpAnimation(!0),this._listeners.forEach(e=>e(this,!1))}data(){return this.valueFn?this.valueFn(this._getComputeArg()):this.value}last(){return this.animation&&this._preload&&this._computeAnimation(!1),this._lastTickValue!==void 0?this._lastTickValue:this._animatedValue!=null?this._animatedValue:this.value!==void 0?this.value:this._computedValue}future(){return this.animation?this.animation.animator.finalValue:this._animatedValue!=null?this._animatedValue:this.value!==void 0?this.value:this._computedValue}updateTransform(){this._cachedValue=null}animating(){return this.animation!=null}animate(t){return this._timeProvider&&(this.currentTime=this._timeProvider()),this.animation&&(this._computeAnimation(),this.valueFn?this._computedValue=this._animatedValue:this.value=this._animatedValue,this._lastTickValue=this._animatedValue,this._cleanUpAnimation(!0)),this.animation={animator:t,initial:this.last(),start:this.currentTime},this._computeAnimation(),this._listeners.forEach(e=>e(this,!0)),this}wait(t=!0){if(!this.animation)return new Promise((i,a)=>i(this));let e=new wi({rejectOnCancel:t});if(this._animationCompleteCallbacks.push(e),this._preload){let{endTime:i}=this.getPreloadUntransformed(),a=this._timeProvider();this._animationCompleteTimeout||(this._animationCompleteTimeout=setTimeout(()=>{this._cleanUpAnimation()},i-a))}return e.promise}freeze(){return this.animation&&this._cleanUpAnimation(!0),this.value=this.last(),this.valueFn=void 0,this}changed(){return this._changedLastTick}}function k(r,t){let e=r.length;Array.isArray(r[0])||(r=[r]),Array.isArray(t[0])||(t=t.map(n=>[n]));let i=t[0].length,a=t[0].map((n,o)=>t.map(h=>h[o])),s=r.map(n=>a.map(o=>{let h=0;if(!Array.isArray(n)){for(let l of o)h+=n*l;return h}for(let l=0;l<n.length;l++)h+=n[l]*(o[l]||0);return h}));return e===1&&(s=s[0]),i===1?s.map(n=>n[0]):s}function K(r){return j(r)==="string"}function j(r){return(Object.prototype.toString.call(r).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function ut(r,t){r=+r,t=+t;let e=(Math.floor(r)+"").length;if(t>e)return+r.toFixed(t-e);{let i=10**(e-t);return Math.round(r/i)*i}}function ee(r){if(!r)return;r=r.trim();const t=/^([a-z]+)\((.+?)\)$/i,e=/^-?[\d.]+$/;let i=r.match(t);if(i){let a=[];return i[2].replace(/\/?\s*([-\w.]+(?:%|deg)?)/g,(s,n)=>{/%$/.test(n)?(n=new Number(n.slice(0,-1)/100),n.type="<percentage>"):/deg$/.test(n)?(n=new Number(+n.slice(0,-3)),n.type="<angle>",n.unit="deg"):e.test(n)&&(n=new Number(n),n.type="<number>"),s.startsWith("/")&&(n=n instanceof Number?n:new Number(n),n.alpha=!0),a.push(n)}),{name:i[1].toLowerCase(),rawName:i[1],rawArgs:i[2],args:a}}}function ie(r){return r[r.length-1]}function ct(r,t,e){return isNaN(r)?t:isNaN(t)?r:r+(t-r)*e}function re(r,t,e){return(e-r)/(t-r)}function Et(r,t,e){return ct(t[0],t[1],re(r[0],r[1],e))}function ae(r){return r.map(t=>t.split("|").map(e=>{e=e.trim();let i=e.match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(i){let a=new String(i[1]);return a.range=[+i[2],+i[3]],a}return e}))}var xi=Object.freeze({__proto__:null,interpolate:ct,interpolateInv:re,isString:K,last:ie,mapRange:Et,multiplyMatrices:k,parseCoordGrammar:ae,parseFunction:ee,toPrecision:ut,type:j});class Ci{add(t,e,i){if(typeof arguments[0]!="string"){for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1]);return}(Array.isArray(t)?t:[t]).forEach(function(a){this[a]=this[a]||[],e&&this[a][i?"unshift":"push"](e)},this)}run(t,e){this[t]=this[t]||[],this[t].forEach(function(i){i.call(e&&e.context?e.context:e,e)})}}const I=new Ci;var O={gamut_mapping:"lch.c",precision:5,deltaE:"76"};const B={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function Rt(r){return Array.isArray(r)?r:B[r]}function dt(r,t,e,i={}){if(r=Rt(r),t=Rt(t),!r||!t)throw new TypeError(`Missing white point to convert ${r?"":"from"}${!r&&!t?"/":""}${t?"":"to"}`);if(r===t)return e;let a={W1:r,W2:t,XYZ:e,options:i};if(I.run("chromatic-adaptation-start",a),a.M||(a.W1===B.D65&&a.W2===B.D50?a.M=[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]]:a.W1===B.D50&&a.W2===B.D65&&(a.M=[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]])),I.run("chromatic-adaptation-end",a),a.M)return k(a.M,a.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}const Ti=75e-6,A=class A{constructor(t){var a,s,n;this.id=t.id,this.name=t.name,this.base=t.base?A.get(t.base):null,this.aliases=t.aliases,this.base&&(this.fromBase=t.fromBase,this.toBase=t.toBase);let e=t.coords??this.base.coords;for(let o in e)"name"in e[o]||(e[o].name=o);this.coords=e;let i=t.white??this.base.white??"D65";this.white=Rt(i),this.formats=t.formats??{};for(let o in this.formats){let h=this.formats[o];h.type||(h.type="function"),h.name||(h.name=o)}t.cssId&&!((a=this.formats.functions)!=null&&a.color)?(this.formats.color={id:t.cssId},Object.defineProperty(this,"cssId",{value:t.cssId})):(s=this.formats)!=null&&s.color&&!((n=this.formats)!=null&&n.color.id)&&(this.formats.color.id=this.id),this.referred=t.referred,Object.defineProperty(this,"path",{value:Ai(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),I.run("colorspace-init-end",this)}inGamut(t,{epsilon:e=Ti}={}){if(this.isPolar)return t=this.toBase(t),this.base.inGamut(t,{epsilon:e});let i=Object.values(this.coords);return t.every((a,s)=>{let n=i[s];if(n.type!=="angle"&&n.range){if(Number.isNaN(a))return!0;let[o,h]=n.range;return(o===void 0||a>=o-e)&&(h===void 0||a<=h+e)}return!0})}get cssId(){var t,e;return((e=(t=this.formats.functions)==null?void 0:t.color)==null?void 0:e.id)||this.id}get isPolar(){for(let t in this.coords)if(this.coords[t].type==="angle")return!0;return!1}getFormat(t){if(typeof t=="object")return t=se(t,this),t;let e;return t==="default"?e=Object.values(this.formats)[0]:e=this.formats[t],e?(e=se(e,this),e):null}equals(t){return t?this===t||this.id===t.id:!1}to(t,e){if(arguments.length===1&&([t,e]=[t.space,t.coords]),t=A.get(t),this.equals(t))return e;e=e.map(o=>Number.isNaN(o)?0:o);let i=this.path,a=t.path,s,n;for(let o=0;o<i.length&&i[o].equals(a[o]);o++)s=i[o],n=o;if(!s)throw new Error(`Cannot convert between color spaces ${this} and ${t}: no connection space was found`);for(let o=i.length-1;o>n;o--)e=i[o].toBase(e);for(let o=n+1;o<a.length;o++)e=a[o].fromBase(e);return e}from(t,e){return arguments.length===1&&([t,e]=[t.space,t.coords]),t=A.get(t),t.to(this,e)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let t=[];for(let e in this.coords){let i=this.coords[e],a=i.range||i.refRange;t.push((a==null?void 0:a.min)??0)}return t}static get all(){return[...new Set(Object.values(A.registry))]}static register(t,e){if(arguments.length===1&&(e=arguments[0],t=e.id),e=this.get(e),this.registry[t]&&this.registry[t]!==e)throw new Error(`Duplicate color space registration: '${t}'`);if(this.registry[t]=e,arguments.length===1&&e.aliases)for(let i of e.aliases)this.register(i,e);return e}static get(t,...e){if(!t||t instanceof A)return t;if(j(t)==="string"){let a=A.registry[t.toLowerCase()];if(!a)throw new TypeError(`No color space found with id = "${t}"`);return a}if(e.length)return A.get(...e);throw new TypeError(`${t} is not a valid color space`)}static resolveCoord(t,e){var h;let i=j(t),a,s;if(i==="string"?t.includes(".")?[a,s]=t.split("."):[a,s]=[,t]:Array.isArray(t)?[a,s]=t:(a=t.space,s=t.coordId),a=A.get(a),a||(a=e),!a)throw new TypeError(`Cannot resolve coordinate reference ${t}: No color space specified and relative references are not allowed here`);if(i=j(s),i==="number"||i==="string"&&s>=0){let l=Object.entries(a.coords)[s];if(l)return{space:a,id:l[0],index:s,...l[1]}}a=A.get(a);let n=s.toLowerCase(),o=0;for(let l in a.coords){let u=a.coords[l];if(l.toLowerCase()===n||((h=u.name)==null?void 0:h.toLowerCase())===n)return{space:a,id:l,index:o,...u};o++}throw new TypeError(`No "${s}" coordinate found in ${a.name}. Its coordinates are: ${Object.keys(a.coords).join(", ")}`)}};Kt(A,"registry",{}),Kt(A,"DEFAULT_FORMAT",{type:"functions",name:"color"});let f=A;function Ai(r){let t=[r];for(let e=r;e=e.base;)t.push(e);return t}function se(r,{coords:t}={}){if(r.coords&&!r.coordGrammar){r.type||(r.type="function"),r.name||(r.name="color"),r.coordGrammar=ae(r.coords);let e=Object.entries(t).map(([i,a],s)=>{let n=r.coordGrammar[s][0],o=a.range||a.refRange,h=n.range,l="";return n=="<percentage>"?(h=[0,100],l="%"):n=="<angle>"&&(l="deg"),{fromRange:o,toRange:h,suffix:l}});r.serializeCoords=(i,a)=>i.map((s,n)=>{let{fromRange:o,toRange:h,suffix:l}=e[n];return o&&h&&(s=Et(o,h,s)),s=ut(s,a),l&&(s+=l),s})}return r}var L=new f({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class C extends f{constructor(t){t.coords||(t.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),t.base||(t.base=L),t.toXYZ_M&&t.fromXYZ_M&&(t.toBase??(t.toBase=e=>{let i=k(t.toXYZ_M,e);return this.white!==this.base.white&&(i=dt(this.white,this.base.white,i)),i}),t.fromBase??(t.fromBase=e=>(e=dt(this.base.white,this.white,e),k(t.fromXYZ_M,e)))),t.referred??(t.referred="display"),super(t)}}function ne(r,{meta:t}={}){var i,a,s,n,o;let e={str:(i=String(r))==null?void 0:i.trim()};if(I.run("parse-start",e),e.color)return e.color;if(e.parsed=ee(e.str),e.parsed){let h=e.parsed.name;if(h==="color"){let l=e.parsed.args.shift(),u=e.parsed.rawArgs.indexOf("/")>0?e.parsed.args.pop():1;for(let d of f.all){let g=d.getFormat("color");if(g&&(l===g.id||(a=g.ids)!=null&&a.includes(l))){const y=Object.keys(d.coords).map((b,v)=>e.parsed.args[v]||0);return t&&(t.formatId="color"),{spaceId:d.id,coords:y,alpha:u}}}let c="";if(l in f.registry){let d=(o=(n=(s=f.registry[l].formats)==null?void 0:s.functions)==null?void 0:n.color)==null?void 0:o.id;d&&(c=`Did you mean color(${d})?`)}throw new TypeError(`Cannot parse color(${l}). `+(c||"Missing a plugin?"))}else for(let l of f.all){let u=l.getFormat(h);if(u&&u.type==="function"){let c=1;(u.lastAlpha||ie(e.parsed.args).alpha)&&(c=e.parsed.args.pop());let d=e.parsed.args,g;return u.coordGrammar&&(g=Object.entries(l.coords).map(([y,b],v)=>{var N;let S=u.coordGrammar[v],x=(N=d[v])==null?void 0:N.type,R=S.find(H=>H==x);if(!R){let H=b.name||y;throw new TypeError(`${x} not allowed for ${H} in ${h}()`)}let D=R.range;x==="<percentage>"&&(D||(D=[0,1]));let F=b.range||b.refRange;return D&&F&&(d[v]=Et(D,F,d[v])),R})),t&&Object.assign(t,{formatId:u.name,types:g}),{spaceId:l.id,coords:d,alpha:c}}}}else for(let h of f.all)for(let l in h.formats){let u=h.formats[l];if(u.type!=="custom"||u.test&&!u.test(e.str))continue;let c=u.parse(e.str);if(c)return c.alpha??(c.alpha=1),t&&(t.formatId=l),c}throw new TypeError(`Could not parse ${r} as a color. Missing a plugin?`)}function p(r){if(!r)throw new TypeError("Empty color reference");K(r)&&(r=ne(r));let t=r.space||r.spaceId;return t instanceof f||(r.space=f.get(t)),r.alpha===void 0&&(r.alpha=1),r}function tt(r,t){return t=f.get(t),t.from(r)}function P(r,t){let{space:e,index:i}=f.resolveCoord(t,r.space);return tt(r,e)[i]}function oe(r,t,e){return t=f.get(t),r.coords=t.to(r.space,e),r}function U(r,t,e){if(r=p(r),arguments.length===2&&j(arguments[1])==="object"){let i=arguments[1];for(let a in i)U(r,a,i[a])}else{typeof e=="function"&&(e=e(P(r,t)));let{space:i,index:a}=f.resolveCoord(t,r.space),s=tt(r,i);s[a]=e,oe(r,i,s)}return r}var Bt=new f({id:"xyz-d50",name:"XYZ D50",white:"D50",base:L,fromBase:r=>dt(L.white,"D50",r),toBase:r=>dt("D50",L.white,r),formats:{color:{}}});const Di=216/24389,he=24/116,ft=24389/27;let zt=B.D50;var T=new f({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:zt,base:Bt,fromBase(r){let e=r.map((i,a)=>i/zt[a]).map(i=>i>Di?Math.cbrt(i):(ft*i+16)/116);return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},toBase(r){let t=[];return t[1]=(r[0]+16)/116,t[0]=r[1]/500+t[1],t[2]=t[1]-r[2]/200,[t[0]>he?Math.pow(t[0],3):(116*t[0]-16)/ft,r[0]>8?Math.pow((r[0]+16)/116,3):r[0]/ft,t[2]>he?Math.pow(t[2],3):(116*t[2]-16)/ft].map((i,a)=>i*zt[a])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function mt(r){return(r%360+360)%360}function Li(r,t){if(r==="raw")return t;let[e,i]=t.map(mt),a=i-e;return r==="increasing"?a<0&&(i+=360):r==="decreasing"?a>0&&(e+=360):r==="longer"?-180<a&&a<180&&(a>0?e+=360:i+=360):r==="shorter"&&(a>180?e+=360:a<-180&&(i+=360)),[e,i]}var et=new f({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:T,fromBase(r){let[t,e,i]=r,a;const s=.02;return Math.abs(e)<s&&Math.abs(i)<s?a=NaN:a=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),mt(a)]},toBase(r){let[t,e,i]=r;return e<0&&(e=0),isNaN(i)&&(i=0),[t,e*Math.cos(i*Math.PI/180),e*Math.sin(i*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const le=25**7,gt=Math.PI,ue=180/gt,J=gt/180;function Ft(r,t,{kL:e=1,kC:i=1,kH:a=1}={}){let[s,n,o]=T.from(r),h=et.from(T,[s,n,o])[1],[l,u,c]=T.from(t),d=et.from(T,[l,u,c])[1];h<0&&(h=0),d<0&&(d=0);let y=((h+d)/2)**7,b=.5*(1-Math.sqrt(y/(y+le))),v=(1+b)*n,S=(1+b)*u,x=Math.sqrt(v**2+o**2),R=Math.sqrt(S**2+c**2),D=v===0&&o===0?0:Math.atan2(o,v),F=S===0&&c===0?0:Math.atan2(c,S);D<0&&(D+=2*gt),F<0&&(F+=2*gt),D*=ue,F*=ue;let N=l-s,H=R-x,Y=F-D,ot=D+F,pi=Math.abs(Y),ht;x*R===0?ht=0:pi<=180?ht=Y:Y>180?ht=Y-360:Y<-180?ht=Y+360:console.log("the unthinkable has happened");let _i=2*Math.sqrt(R*x)*Math.sin(ht*J/2),ca=(s+l)/2,Qt=(x+R)/2,yi=Math.pow(Qt,7),$;x*R===0?$=ot:pi<=180?$=ot/2:ot<360?$=(ot+360)/2:$=(ot-360)/2;let Mi=(ca-50)**2,da=1+.015*Mi/Math.sqrt(20+Mi),bi=1+.045*Qt,lt=1;lt-=.17*Math.cos(($-30)*J),lt+=.24*Math.cos(2*$*J),lt+=.32*Math.cos((3*$+6)*J),lt-=.2*Math.cos((4*$-63)*J);let vi=1+.015*Qt*lt,fa=30*Math.exp(-1*(($-275)/25)**2),ma=2*Math.sqrt(yi/(yi+le)),ga=-1*Math.sin(2*fa*J)*ma,Pt=(N/(e*da))**2;return Pt+=(H/(i*bi))**2,Pt+=(_i/(a*vi))**2,Pt+=ga*(H/(i*bi))*(_i/(a*vi)),Math.sqrt(Pt)}const Pi=75e-6;function it(r,t=r.space,{epsilon:e=Pi}={}){r=p(r),t=f.get(t);let i=r.coords;return t!==r.space&&(i=t.from(r)),t.inGamut(i,{epsilon:e})}function rt(r){return{space:r.space,coords:r.coords.slice(),alpha:r.alpha}}function q(r,{method:t=O.gamut_mapping,space:e=r.space}={}){if(K(arguments[1])&&(e=arguments[1]),e=f.get(e),it(r,e,{epsilon:0}))return p(r);let i=E(r,e);if(t!=="clip"&&!it(r,e)){let a=q(rt(i),{method:"clip",space:e});if(Ft(r,a)>2){let s=f.resolveCoord(t),n=s.space,o=s.id,h=E(i,n),u=(s.range||s.refRange)[0],c=.01,d=u,g=P(h,o);for(;g-d>c;){let y=rt(h);y=q(y,{space:e,method:"clip"}),Ft(h,y)-2<c?d=P(h,o):g=P(h,o),U(h,o,(d+g)/2)}i=E(h,e)}else i=a}if(t==="clip"||!it(i,e,{epsilon:0})){let a=Object.values(e.coords).map(s=>s.range||[]);i.coords=i.coords.map((s,n)=>{let[o,h]=a[n];return o!==void 0&&(s=Math.max(o,s)),h!==void 0&&(s=Math.min(s,h)),s})}return e!==r.space&&(i=E(i,r.space)),r.coords=i.coords,r}q.returns="color";function E(r,t,{inGamut:e}={}){r=p(r),t=f.get(t);let i=t.from(r),a={space:t,coords:i,alpha:r.alpha};return e&&(a=q(a)),a}E.returns="color";function pt(r,{precision:t=O.precision,format:e="default",inGamut:i=!0,...a}={}){var h;let s;r=p(r);let n=e;e=r.space.getFormat(e)??r.space.getFormat("default")??f.DEFAULT_FORMAT,i||(i=e.toGamut);let o=r.coords;if(o=o.map(l=>l||0),i&&!it(r)&&(o=q(rt(r),i===!0?void 0:i).coords),e.type==="custom")if(a.precision=t,e.serialize)s=e.serialize(o,r.alpha,a);else throw new TypeError(`format ${n} can only be used to parse colors, not for serialization`);else{let l=e.name||"color";e.serializeCoords?o=e.serializeCoords(o,t):t!==null&&(o=o.map(g=>ut(g,t)));let u=[...o];if(l==="color"){let g=e.id||((h=e.ids)==null?void 0:h[0])||r.space.id;u.unshift(g)}let c=r.alpha;t!==null&&(c=ut(c,t));let d=r.alpha<1&&!e.noAlpha?`${e.commas?",":" /"} ${c}`:"";s=`${l}(${u.join(e.commas?", ":" ")}${d})`}return s}const Ei=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],Ri=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]];var _t=new C({id:"rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:Ei,fromXYZ_M:Ri,formats:{color:{}}});const yt=1.09929682680944,ce=.018053968510807;var de=new C({id:"rec2020",name:"REC.2020",base:_t,toBase(r){return r.map(function(t){return t<ce*4.5?t/4.5:Math.pow((t+yt-1)/yt,1/.45)})},fromBase(r){return r.map(function(t){return t>=ce?yt*Math.pow(t,.45)-(yt-1):4.5*t})},formats:{color:{}}});const Bi=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],zi=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]];var fe=new C({id:"p3-linear",name:"Linear P3",white:"D65",toXYZ_M:Bi,fromXYZ_M:zi});const Fi=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],Oi=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]];var me=new C({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:Fi,fromXYZ_M:Oi,formats:{color:{}}}),ge={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]};let pe=Array(3).fill("<percentage> | <number>[0, 255]"),_e=Array(3).fill("<number>[0, 255]");var at=new C({id:"srgb",name:"sRGB",base:me,fromBase:r=>r.map(t=>{let e=t<0?-1:1,i=t*e;return i>.0031308?e*(1.055*i**(1/2.4)-.055):12.92*t}),toBase:r=>r.map(t=>{let e=t<0?-1:1,i=t*e;return i<.04045?t/12.92:e*((i+.055)/1.055)**2.4}),formats:{rgb:{coords:pe},rgb_number:{name:"rgb",commas:!0,coords:_e,noAlpha:!0},color:{},rgba:{coords:pe,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:_e},hex:{type:"custom",toGamut:!0,test:r=>/^#([a-f0-9]{3,4}){1,2}$/i.test(r),parse(r){r.length<=5&&(r=r.replace(/[a-f0-9]/gi,"$&$&"));let t=[];return r.replace(/[a-f0-9]{2}/gi,e=>{t.push(parseInt(e,16)/255)}),{spaceId:"srgb",coords:t.slice(0,3),alpha:t.slice(3)[0]}},serialize:(r,t,{collapse:e=!0}={})=>{t<1&&r.push(t),r=r.map(s=>Math.round(s*255));let i=e&&r.every(s=>s%17===0);return"#"+r.map(s=>i?(s/17).toString(16):s.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:r=>/^[a-z]+$/i.test(r),parse(r){r=r.toLowerCase();let t={spaceId:"srgb",coords:null,alpha:1};if(r==="transparent"?(t.coords=ge.black,t.alpha=0):t.coords=ge[r],t.coords)return t}}}}),ye=new C({id:"p3",name:"P3",base:fe,fromBase:at.fromBase,toBase:at.toBase,formats:{color:{id:"display-p3"}}});if(O.display_space=at,typeof CSS<"u"&&CSS.supports)for(let r of[T,de,ye]){let t=r.getMinCoords(),i=pt({space:r,coords:t,alpha:1});if(CSS.supports("color",i)){O.display_space=r;break}}function Yi(r,{space:t=O.display_space,...e}={}){let i=pt(r,e);if(typeof CSS>"u"||CSS.supports("color",i)||!O.display_space)i=new String(i),i.color=r;else{let a=E(r,t);i=new String(pt(a,e)),i.color=a}return i}function Me(r,t,e="lab"){e=f.get(e);let i=e.from(r),a=e.from(t);return Math.sqrt(i.reduce((s,n,o)=>{let h=a[o];return isNaN(n)||isNaN(h)?s:s+(h-n)**2},0))}function $i(r,t){return r=p(r),t=p(t),r.space===t.space&&r.alpha===t.alpha&&r.coords.every((e,i)=>e===t.coords[i])}function G(r){return P(r,[L,"y"])}function be(r,t){U(r,[L,"y"],t)}function Xi(r){Object.defineProperty(r.prototype,"luminance",{get(){return G(this)},set(t){be(this,t)}})}var ji=Object.freeze({__proto__:null,getLuminance:G,register:Xi,setLuminance:be});function Ii(r,t){r=p(r),t=p(t);let e=Math.max(G(r),0),i=Math.max(G(t),0);return i>e&&([e,i]=[i,e]),(e+.05)/(i+.05)}const Ui=.56,qi=.57,Gi=.62,Zi=.65,ve=.022,Vi=1.414,Hi=.1,Wi=5e-4,Ni=1.14,ke=.027,Ji=1.14;function we(r){return r>=ve?r:r+(ve-r)**Vi}function Q(r){let t=r<0?-1:1,e=Math.abs(r);return t*Math.pow(e,2.4)}function Qi(r,t){t=p(t),r=p(r);let e,i,a,s,n,o;t=E(t,"srgb"),[s,n,o]=t.coords;let h=Q(s)*.2126729+Q(n)*.7151522+Q(o)*.072175;r=E(r,"srgb"),[s,n,o]=r.coords;let l=Q(s)*.2126729+Q(n)*.7151522+Q(o)*.072175,u=we(h),c=we(l),d=c>u;return Math.abs(c-u)<Wi?i=0:d?(e=c**Ui-u**qi,i=e*Ni):(e=c**Zi-u**Gi,i=e*Ji),Math.abs(i)<Hi?a=0:i>0?a=i-ke:a=i+ke,a*100}function Ki(r,t){r=p(r),t=p(t);let e=Math.max(G(r),0),i=Math.max(G(t),0);i>e&&([e,i]=[i,e]);let a=e+i;return a===0?0:(e-i)/a}const tr=5e4;function er(r,t){r=p(r),t=p(t);let e=Math.max(G(r),0),i=Math.max(G(t),0);return i>e&&([e,i]=[i,e]),i===0?tr:(e-i)/i}function ir(r,t){r=p(r),t=p(t);let e=P(r,[T,"l"]),i=P(t,[T,"l"]);return Math.abs(e-i)}const rr=216/24389,Se=24/116,Mt=24389/27;let Ot=B.D65;var Yt=new f({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Ot,base:L,fromBase(r){let e=r.map((i,a)=>i/Ot[a]).map(i=>i>rr?Math.cbrt(i):(Mt*i+16)/116);return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},toBase(r){let t=[];return t[1]=(r[0]+16)/116,t[0]=r[1]/500+t[1],t[2]=t[1]-r[2]/200,[t[0]>Se?Math.pow(t[0],3):(116*t[0]-16)/Mt,r[0]>8?Math.pow((r[0]+16)/116,3):r[0]/Mt,t[2]>Se?Math.pow(t[2],3):(116*t[2]-16)/Mt].map((i,a)=>i*Ot[a])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});const $t=Math.pow(5,.5)*.5+.5;function ar(r,t){r=p(r),t=p(t);let e=P(r,[Yt,"l"]),i=P(t,[Yt,"l"]),a=Math.abs(Math.pow(e,$t)-Math.pow(i,$t)),s=Math.pow(a,1/$t)*Math.SQRT2-40;return s<7.5?0:s}var bt=Object.freeze({__proto__:null,contrastAPCA:Qi,contrastDeltaPhi:ar,contrastLstar:ir,contrastMichelson:Ki,contrastWCAG21:Ii,contrastWeber:er});function sr(r,t,e={}){K(e)&&(e={algorithm:e});let{algorithm:i,...a}=e;if(!i){let s=Object.keys(bt).map(n=>n.replace(/^contrast/,"")).join(", ");throw new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${s}`)}r=p(r),t=p(t);for(let s in bt)if("contrast"+i.toLowerCase()===s.toLowerCase())return bt[s](r,t,a);throw new TypeError(`Unknown contrast algorithm: ${i}`)}function xe(r){let[t,e,i]=tt(r,L),a=t+15*e+3*i;return[4*t/a,9*e/a]}function Ce(r){let[t,e,i]=tt(r,L),a=t+e+i;return[t/a,e/a]}function nr(r){Object.defineProperty(r.prototype,"uv",{get(){return xe(this)}}),Object.defineProperty(r.prototype,"xy",{get(){return Ce(this)}})}var or=Object.freeze({__proto__:null,register:nr,uv:xe,xy:Ce});function hr(r,t){return Me(r,t,"lab")}const Te=Math.PI/180;function lr(r,t,{l:e=2,c:i=1}={}){let[a,s,n]=T.from(r),[,o,h]=et.from(T,[a,s,n]),[l,u,c]=T.from(t),d=et.from(T,[l,u,c])[1];o<0&&(o=0),d<0&&(d=0);let g=a-l,y=o-d,b=s-u,v=n-c,S=b**2+v**2-y**2,x=.511;a>=16&&(x=.040975*a/(1+.01765*a));let R=.0638*o/(1+.0131*o)+.638,D;Number.isNaN(h)&&(h=0),h>=164&&h<=345?D=.56+Math.abs(.2*Math.cos((h+168)*Te)):D=.36+Math.abs(.4*Math.cos((h+35)*Te));let F=Math.pow(o,4),N=Math.sqrt(F/(F+1900)),H=R*(N*D+1-N),Y=(g/(e*x))**2;return Y+=(y/(i*R))**2,Y+=S/H**2,Math.sqrt(Y)}const Ae=203;var Xt=new f({id:"xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:L,fromBase(r){return r.map(t=>Math.max(t*Ae,0))},toBase(r){return r.map(t=>Math.max(t/Ae,0))}});const vt=1.15,kt=.66,De=2610/2**14,ur=2**14/2610,Le=3424/2**12,Pe=2413/2**7,Ee=2392/2**7,cr=1.7*2523/2**5,Re=2**5/(1.7*2523),wt=-.56,jt=16295499532821565e-27,dr=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],fr=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],mr=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],gr=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]];var Be=new f({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:Xt,fromBase(r){let[t,e,i]=r,a=vt*t-(vt-1)*i,s=kt*e-(kt-1)*t,o=k(dr,[a,s,i]).map(function(d){let g=Le+Pe*(d/1e4)**De,y=1+Ee*(d/1e4)**De;return(g/y)**cr}),[h,l,u]=k(mr,o);return[(1+wt)*h/(1+wt*h)-jt,l,u]},toBase(r){let[t,e,i]=r,a=(t+jt)/(1+wt-wt*(t+jt)),n=k(gr,[a,e,i]).map(function(d){let g=Le-d**Re,y=Ee*d**Re-Pe;return 1e4*(g/y)**ur}),[o,h,l]=k(fr,n),u=(o+(vt-1)*l)/vt,c=(h+(kt-1)*u)/kt;return[u,c,l]},formats:{color:{}}}),It=new f({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:Be,fromBase(r){let[t,e,i]=r,a;const s=2e-4;return Math.abs(e)<s&&Math.abs(i)<s?a=NaN:a=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),mt(a)]},toBase(r){return[r[0],r[1]*Math.cos(r[2]*Math.PI/180),r[1]*Math.sin(r[2]*Math.PI/180)]},formats:{color:{}}});function pr(r,t){let[e,i,a]=It.from(r),[s,n,o]=It.from(t),h=e-s,l=i-n;Number.isNaN(a)&&Number.isNaN(o)?(a=0,o=0):Number.isNaN(a)?a=o:Number.isNaN(o)&&(o=a);let u=a-o,c=2*Math.sqrt(i*n)*Math.sin(u/2*(Math.PI/180));return Math.sqrt(h**2+l**2+c**2)}const ze=3424/4096,Fe=2413/128,Oe=2392/128,Ye=2610/16384,_r=2523/32,yr=16384/2610,$e=32/2523,Mr=[[.3592,.6976,-.0358],[-.1922,1.1004,.0755],[.007,.0749,.8434]],br=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],vr=[[.9999888965628402,.008605050147287059,.11103437159861648],[1.00001110343716,-.008605050147287059,-.11103437159861648],[1.0000320633910054,.56004913547279,-.3206339100541203]],kr=[[2.0701800566956137,-1.326456876103021,.20661600684785517],[.3649882500326575,.6804673628522352,-.04542175307585323],[-.04959554223893211,-.04942116118675749,1.1879959417328034]];var Ut=new f({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:Xt,fromBase(r){let t=k(Mr,r);return wr(t)},toBase(r){let t=Sr(r);return k(kr,t)},formats:{color:{}}});function wr(r){let t=r.map(function(e){let i=ze+Fe*(e/1e4)**Ye,a=1+Oe*(e/1e4)**Ye;return(i/a)**_r});return k(br,t)}function Sr(r){return k(vr,r).map(function(i){let a=Math.max(i**$e-ze,0),s=Fe-Oe*i**$e;return 1e4*(a/s)**yr})}function xr(r,t){let[e,i,a]=Ut.from(r),[s,n,o]=Ut.from(t);return 720*Math.sqrt((e-s)**2+.25*(i-n)**2+(a-o)**2)}const Cr=[[.8190224432164319,.3619062562801221,-.12887378261216414],[.0329836671980271,.9292868468965546,.03614466816999844],[.048177199566046255,.26423952494422764,.6335478258136937]],Tr=[[1.2268798733741557,-.5578149965554813,.28139105017721583],[-.04057576262431372,1.1122868293970594,-.07171106666151701],[-.07637294974672142,-.4214933239627914,1.5869240244272418]],Ar=[[.2104542553,.793617785,-.0040720468],[1.9779984951,-2.428592205,.4505937099],[.0259040371,.7827717662,-.808675766]],Dr=[[.9999999984505198,.39633779217376786,.2158037580607588],[1.0000000088817609,-.10556134232365635,-.06385417477170591],[1.0000000546724108,-.08948418209496575,-1.2914855378640917]];var St=new f({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"L"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:L,fromBase(r){let e=k(Cr,r).map(i=>Math.cbrt(i));return k(Ar,e)},toBase(r){let e=k(Dr,r).map(i=>i**3);return k(Tr,e)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function Lr(r,t){let[e,i,a]=St.from(r),[s,n,o]=St.from(t),h=e-s,l=i-n,u=a-o;return Math.sqrt(h**2+l**2+u**2)}var xt={deltaE76:hr,deltaECMC:lr,deltaE2000:Ft,deltaEJz:pr,deltaEITP:xr,deltaEOK:Lr};function st(r,t,e={}){K(e)&&(e={method:e});let{method:i=O.deltaE,...a}=e;r=p(r),t=p(t);for(let s in xt)if("deltae"+i.toLowerCase()===s.toLowerCase())return xt[s](r,t,a);throw new TypeError(`Unknown deltaE method: ${i}`)}function Pr(r,t=.25){let i=[f.get("oklch","lch"),"l"];return U(r,i,a=>a*(1+t))}function Er(r,t=.25){let i=[f.get("oklch","lch"),"l"];return U(r,i,a=>a*(1-t))}var Rr=Object.freeze({__proto__:null,darken:Er,lighten:Pr});function Xe(r,t,e=.5,i={}){[r,t]=[p(r),p(t)],j(e)==="object"&&([e,i]=[.5,e]);let{space:a,outputSpace:s,premultiplied:n}=i;return nt(r,t,{space:a,outputSpace:s,premultiplied:n})(e)}function je(r,t,e={}){let i;qt(r)&&([i,e]=[r,t],[r,t]=i.rangeArgs.colors);let{maxDeltaE:a,deltaEMethod:s,steps:n=2,maxSteps:o=1e3,...h}=e;i||([r,t]=[p(r),p(t)],i=nt(r,t,h));let l=st(r,t),u=a>0?Math.max(n,Math.ceil(l/a)+1):n,c=[];if(o!==void 0&&(u=Math.min(u,o)),u===1)c=[{p:.5,color:i(.5)}];else{let d=1/(u-1);c=Array.from({length:u},(g,y)=>{let b=y*d;return{p:b,color:i(b)}})}if(a>0){let d=c.reduce((g,y,b)=>{if(b===0)return 0;let v=st(y.color,c[b-1].color,s);return Math.max(g,v)},0);for(;d>a;){d=0;for(let g=1;g<c.length&&c.length<o;g++){let y=c[g-1],b=c[g],v=(b.p+y.p)/2,S=i(v);d=Math.max(d,st(S,y.color),st(S,b.color)),c.splice(g,0,{p:v,color:i(v)}),g++}}}return c=c.map(d=>d.color),c}function nt(r,t,e={}){if(qt(r)){let[h,l]=[r,t];return nt(...h.rangeArgs.colors,{...h.rangeArgs.options,...l})}let{space:i,outputSpace:a,progression:s,premultiplied:n}=e;r=p(r),t=p(t),r=rt(r),t=rt(t);let o={colors:[r,t],options:e};if(i?i=f.get(i):i=f.registry[O.interpolationSpace]||r.space,a=a?f.get(a):i,r=E(r,i),t=E(t,i),r=q(r),t=q(t),i.coords.h&&i.coords.h.type==="angle"){let h=e.hue=e.hue||"shorter",l=[i,"h"],[u,c]=[P(r,l),P(t,l)];[u,c]=Li(h,[u,c]),U(r,l,u),U(t,l,c)}return n&&(r.coords=r.coords.map(h=>h*r.alpha),t.coords=t.coords.map(h=>h*t.alpha)),Object.assign(h=>{h=s?s(h):h;let l=r.coords.map((d,g)=>{let y=t.coords[g];return ct(d,y,h)}),u=ct(r.alpha,t.alpha,h),c={space:i,coords:l,alpha:u};return n&&(c.coords=c.coords.map(d=>d/u)),a!==i&&(c=E(c,a)),c},{rangeArgs:o})}function qt(r){return j(r)==="function"&&!!r.rangeArgs}O.interpolationSpace="lab";function Br(r){r.defineFunction("mix",Xe,{returns:"color"}),r.defineFunction("range",nt,{returns:"function<color>"}),r.defineFunction("steps",je,{returns:"array<color>"})}var zr=Object.freeze({__proto__:null,isRange:qt,mix:Xe,range:nt,register:Br,steps:je}),Ie=new f({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:at,fromBase:r=>{let t=Math.max(...r),e=Math.min(...r),[i,a,s]=r,[n,o,h]=[NaN,0,(e+t)/2],l=t-e;if(l!==0){switch(o=h===0||h===1?0:(t-h)/Math.min(h,1-h),t){case i:n=(a-s)/l+(a<s?6:0);break;case a:n=(s-i)/l+2;break;case s:n=(i-a)/l+4}n=n*60}return[n,o*100,h*100]},toBase:r=>{let[t,e,i]=r;t=t%360,t<0&&(t+=360),e/=100,i/=100;function a(s){let n=(s+t/30)%12,o=e*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(n-3,9-n,1))}return[a(0),a(8),a(4)]},formats:{hsl:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),Ue=new f({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:Ie,fromBase(r){let[t,e,i]=r;e/=100,i/=100;let a=i+e*Math.min(i,1-i);return[t,a===0?0:200*(1-i/a),100*a]},toBase(r){let[t,e,i]=r;e/=100,i/=100;let a=i*(1-e/2);return[t,a===0||a===1?0:(i-a)/Math.min(a,1-a)*100,a*100]},formats:{color:{toGamut:!0}}}),Fr=new f({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:Ue,fromBase(r){let[t,e,i]=r;return[t,i*(100-e)/100,100-i]},toBase(r){let[t,e,i]=r;e/=100,i/=100;let a=e+i;if(a>=1){let o=e/a;return[t,0,o*100]}let s=1-i,n=s===0?0:1-e/s;return[t,n*100,s*100]},formats:{hwb:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]}}});const Or=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],Yr=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]];var qe=new C({id:"a98rgb-linear",name:"Linear Adobe® 98 RGB compatible",white:"D65",toXYZ_M:Or,fromXYZ_M:Yr}),$r=new C({id:"a98rgb",name:"Adobe® 98 RGB compatible",base:qe,toBase:r=>r.map(t=>Math.pow(Math.abs(t),563/256)*Math.sign(t)),fromBase:r=>r.map(t=>Math.pow(Math.abs(t),256/563)*Math.sign(t)),formats:{color:{id:"a98-rgb"}}});const Xr=[[.7977604896723027,.13518583717574031,.0313493495815248],[.2880711282292934,.7118432178101014,8565396060525902e-20],[0,0,.8251046025104601]],jr=[[1.3457989731028281,-.25558010007997534,-.05110628506753401],[-.5446224939028347,1.5082327413132781,.02053603239147973],[0,0,1.2119675456389454]];var Ge=new C({id:"prophoto-linear",name:"Linear ProPhoto",white:"D50",base:Bt,toXYZ_M:Xr,fromXYZ_M:jr});const Ir=1/512,Ur=16/512;var qr=new C({id:"prophoto",name:"ProPhoto",base:Ge,toBase(r){return r.map(t=>t<Ur?t/16:t**1.8)},fromBase(r){return r.map(t=>t>=Ir?t**(1/1.8):16*t)},formats:{color:{id:"prophoto-rgb"}}}),Gr=new f({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:St,fromBase(r){let[t,e,i]=r,a;const s=2e-4;return Math.abs(e)<s&&Math.abs(i)<s?a=NaN:a=Math.atan2(i,e)*180/Math.PI,[t,Math.sqrt(e**2+i**2),mt(a)]},toBase(r){let[t,e,i]=r,a,s;return isNaN(i)?(a=0,s=0):(a=e*Math.cos(i*Math.PI/180),s=e*Math.sin(i*Math.PI/180)),[t,a,s]},formats:{oklch:{coords:["<number> | <percentage>","<number> | <percentage>[0,1]","<number> | <angle>"]}}});const Ze=203,Ve=2610/2**14,Zr=2**14/2610,Vr=2523/2**5,He=2**5/2523,We=3424/2**12,Ne=2413/2**7,Je=2392/2**7;var Hr=new C({id:"rec2100pq",name:"REC.2100-PQ",base:_t,toBase(r){return r.map(function(t){return(Math.max(t**He-We,0)/(Ne-Je*t**He))**Zr*1e4/Ze})},fromBase(r){return r.map(function(t){let e=Math.max(t*Ze/1e4,0),i=We+Ne*e**Ve,a=1+Je*e**Ve;return(i/a)**Vr})},formats:{color:{id:"rec2100-pq"}}});const Qe=.17883277,Ke=.28466892,ti=.55991073,Gt=3.7743;var Wr=new C({id:"rec2100hlg",cssid:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:_t,toBase(r){return r.map(function(t){return t<=.5?t**2/3*Gt:(Math.exp((t-ti)/Qe)+Ke)/12*Gt})},fromBase(r){return r.map(function(t){return t/=Gt,t<=1/12?Math.sqrt(3*t):Qe*Math.log(12*t-Ke)+ti})},formats:{color:{id:"rec2100-hlg"}}});const ei={};I.add("chromatic-adaptation-start",r=>{r.options.method&&(r.M=ii(r.W1,r.W2,r.options.method))}),I.add("chromatic-adaptation-end",r=>{r.M||(r.M=ii(r.W1,r.W2,r.options.method))});function Ct({id:r,toCone_M:t,fromCone_M:e}){ei[r]=arguments[0]}function ii(r,t,e="Bradford"){let i=ei[e],[a,s,n]=k(i.toCone_M,r),[o,h,l]=k(i.toCone_M,t),u=[[o/a,0,0],[0,h/s,0],[0,0,l/n]],c=k(u,i.toCone_M);return k(i.fromCone_M,c)}Ct({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599364,-1.1293816,.2198974],[.3611914,.6388125,-64e-7],[0,0,1.0890636]]}),Ct({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929,-.1470543,.1599627],[.4323053,.5183603,.0492912],[-.0085287,.0400428,.9684867]]}),Ct({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238,-.278869,.1827452],[.454369,.4735332,.0720978],[-.0096276,-.005698,1.0153256]]}),Ct({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.011254630531685,.1491867754444518],[.3875265432361372,.6214474419314753,-.008973985167612518],[-.01584149884933386,-.03412293802851557,1.04996443687785]]}),Object.assign(B,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),B.ACES=[.32168/.33767,1,(1-.32168-.33767)/.33767];const Nr=[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],Jr=[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]];var ri=new C({id:"acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:B.ACES,toXYZ_M:Nr,fromXYZ_M:Jr,formats:{color:{}}});const Tt=2**-16,Zt=-.35828683,At=(Math.log2(65504)+9.72)/17.52;var Qr=new C({id:"acescc",name:"ACEScc",coords:{r:{range:[Zt,At],name:"Red"},g:{range:[Zt,At],name:"Green"},b:{range:[Zt,At],name:"Blue"}},referred:"scene",base:ri,toBase(r){const t=-.3013698630136986;return r.map(function(e){return e<=t?(2**(e*17.52-9.72)-Tt)*2:e<At?2**(e*17.52-9.72):65504})},fromBase(r){return r.map(function(t){return t<=0?(Math.log2(Tt)+9.72)/17.52:t<Tt?(Math.log2(Tt+t*.5)+9.72)/17.52:(Math.log2(t)+9.72)/17.52})},formats:{color:{}}}),ai=Object.freeze({__proto__:null,A98RGB:$r,A98RGB_Linear:qe,ACEScc:Qr,ACEScg:ri,HSL:Ie,HSV:Ue,HWB:Fr,ICTCP:Ut,JzCzHz:It,Jzazbz:Be,LCH:et,Lab:T,Lab_D65:Yt,OKLCH:Gr,OKLab:St,P3:ye,P3_Linear:fe,ProPhoto:qr,ProPhoto_Linear:Ge,REC_2020:de,REC_2020_Linear:_t,REC_2100_HLG:Wr,REC_2100_PQ:Hr,XYZ_ABS_D65:Xt,XYZ_D50:Bt,XYZ_D65:L,sRGB:at,sRGB_Linear:me});class _{constructor(...t){let e;t.length===1&&(e=p(t[0]));let i,a,s;e?(i=e.space||e.spaceId,a=e.coords,s=e.alpha):[i,a,s]=t,Object.defineProperty(this,"space",{value:f.get(i),writable:!1,enumerable:!0,configurable:!0}),this.coords=a?a.slice():[0,0,0],this.alpha=s<1?s:1;for(let n=0;n<this.coords.length;n++)this.coords[n]==="NaN"&&(this.coords[n]=NaN);for(let n in this.space.coords)Object.defineProperty(this,n,{get:()=>this.get(n),set:o=>this.set(n,o)})}get spaceId(){return this.space.id}clone(){return new _(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...t){let e=Yi(this,...t);return e.color=new _(e.color),e}static get(t,...e){return t instanceof _?t:new _(t,...e)}static defineFunction(t,e,i=e){let{instance:a=!0,returns:s}=i,n=function(...o){let h=e(...o);if(s==="color")h=_.get(h);else if(s==="function<color>"){let l=h;h=function(...u){let c=l(...u);return _.get(c)},Object.assign(h,l)}else s==="array<color>"&&(h=h.map(l=>_.get(l)));return h};t in _||(_[t]=n),a&&(_.prototype[t]=function(...o){return n(this,...o)})}static defineFunctions(t){for(let e in t)_.defineFunction(e,t[e],t[e])}static extend(t){if(t.register)t.register(_);else for(let e in t)_.defineFunction(e,t[e])}}_.defineFunctions({get:P,getAll:tt,set:U,setAll:oe,to:E,equals:$i,inGamut:it,toGamut:q,distance:Me,toString:pt}),Object.assign(_,{util:xi,hooks:I,WHITES:B,Space:f,spaces:f.registry,parse:ne,defaults:O});for(let r of Object.keys(ai))f.register(ai[r]);for(let r in f.registry)Vt(r,f.registry[r]);I.add("colorspace-init-end",r=>{var t;Vt(r.id,r),(t=r.aliases)==null||t.forEach(e=>{Vt(e,r)})});function Vt(r,t){Object.keys(t.coords),Object.values(t.coords).map(i=>i.name);let e=r.replace(/-/g,"_");Object.defineProperty(_.prototype,e,{get(){let i=this.getAll(r);return typeof Proxy>"u"?i:new Proxy(i,{has:(a,s)=>{try{return f.resolveCoord([t,s]),!0}catch{}return Reflect.has(a,s)},get:(a,s,n)=>{if(s&&typeof s!="symbol"&&!(s in a)){let{index:o}=f.resolveCoord([t,s]);if(o>=0)return a[o]}return Reflect.get(a,s,n)},set:(a,s,n,o)=>{if(s&&typeof s!="symbol"&&!(s in a)||s>=0){let{index:h}=f.resolveCoord([t,s]);if(h>=0)return a[h]=n,this.setAll(r,a),!0}return Reflect.set(a,s,n,o)}})},set(i){this.setAll(r,i)},configurable:!0,enumerable:!0})}_.extend(xt),_.extend({deltaE:st}),Object.assign(_,{deltaEMethods:xt}),_.extend(Rr),_.extend({contrast:sr}),_.extend(or),_.extend(ji),_.extend(zr),_.extend(bt);function Ht(r){return r}function Z(r){return r*r*(3-2*r)}function Wt(r,t,e,i){return r*t+e*i}function si(r,t,e,i){let a=[Math.round((r.r*t+e.r*i)*255),Math.round((r.g*t+e.g*i)*255),Math.round((r.b*t+e.b*i)*255)];return`rgb(${a[0]}, ${a[1]}, ${a[2]})`}function ni(r,t,e,i){return r.map((a,s)=>Wt(a,t,e[s],i))}function Dt(r){if(typeof r=="number")return Wt;if(typeof r=="string"){let t={};return(e,i,a,s)=>(t[e]||(t[e]=new _(e).srgb),t[a]||(t[a]=new _(a).srgb),si(t[e],i,t[a],s))}else if(Array.isArray(r))return ni;return(t,e,i,a)=>e<1?t:i}function W(r,t=void 0){return t===void 0&&(t=Dt(r)),{finalValue:r,interpolate:(e,i)=>t(e,1-Math.min(i,1),r,Math.min(i,1))}}function oi(r,t=void 0){return t===void 0&&(t=Dt(r())),{interpolate:(e,i)=>t(e,1-Math.min(i,1),r(),Math.min(i,1))}}function Kr(r,t=void 0){return t===void 0&&(t=Dt(r[0])),{interpolate:(e,i)=>{let a=Math.min(i,1)*(r.length-1)-1,s=Math.min(a-Math.floor(a),1);return a<0?t(e,1-s,r[0],s):t(r[Math.floor(a)],1-s,r[Math.floor(a)+1],s)}}}class z{constructor(t,e=1e3,i=Ht){this.duration=0,this.finalValue=void 0,this.interpolator=null,this.duration=e,t.hasOwnProperty("finalValue")?this.finalValue=t.finalValue:this.finalValue=void 0,this.interpolator=t,this.curve=i}evaluate(t,e){let i=this.curve(this.duration>0?e/this.duration:1);return this.interpolator.interpolate(t,i)}withDelay(t){return t?new ta(this,t):this}}class ta extends z{constructor(t,e){super(t.interpolator,t.duration+e,t.curve),this.delay=e}evaluate(t,e){return e<=this.delay?t:super.evaluate(t,(e-this.delay)*this.duration/(this.duration-this.delay))}}function ea(r,t=1e3,e=Ht){return new z(W(r),t,e)}var hi=(r=>(r.Waiting="waiting",r.Entering="entering",r.Visible="visible",r.Exiting="exiting",r.Completed="completed",r))(hi||{}),li=(r=>(r.Show="show",r.Hide="hide",r))(li||{});class ui{constructor(t={}){this.markStates=new Map,this.marksByID=new Map,this.queuedAnimations=new Map,this._flushTimer=null,this.animatingMarks=new Set,this._updated=!1,this.defer=!1,this.saveExitedMarks=!1,this._callbacks={initialize:t.initialize||(()=>{}),enter:t.enter||(()=>{}),exit:t.exit||(()=>{})}}setVisibleMarks(t){return t.forEach(e=>{this.markStates.set(e,"visible"),this.marksByID.set(e.id,e)}),this}configure(t={}){return this.defer=t.defer??this.defer,this.saveExitedMarks=t.saveExitedMarks??this.saveExitedMarks,this}onInitialize(t){this._callbacks.initialize=t||(()=>{})}onEnter(t){this._callbacks.enter=t||(()=>{})}onExit(t){this._callbacks.exit=t||(()=>{})}advance(t){return this._updated?(this._updated=!1,!0):!1}_perform(t,e){if(t){if(e=="show"){if(this.markStates.get(t)==="visible")return;this.markStates.set(t,"entering"),this.marksByID.set(t.id,t);let i=this._callbacks.enter(t);i&&i instanceof Promise?(this.animatingMarks.add(t),i.then(()=>{this.markStates.has(t)&&this.markStates.get(t)=="entering"&&(this.markStates.set(t,"visible"),this.animatingMarks.delete(t),this._updated=!0)},()=>{this.animatingMarks.delete(t)})):this.markStates.set(t,"visible")}else if(e=="hide"){let i=this.markStates.get(t)??null;if(i==="waiting"||i==="completed")return;this.markStates.set(t,"exiting"),this.marksByID.set(t.id,t);let a=this._callbacks.exit(t);a&&a instanceof Promise?(this.animatingMarks.add(t),a.then(()=>{this.markStates.has(t)&&this.markStates.get(t)=="exiting"&&(this.saveExitedMarks?this.markStates.set(t,"completed"):(this.marksByID.delete(t.id),this.markStates.delete(t),this.animatingMarks.delete(t)),this._updated=!0)},()=>{this.animatingMarks.delete(t)})):this.saveExitedMarks?this.markStates.set(t,"completed"):(this.marksByID.delete(t.id),this.markStates.delete(t))}this._updated=!0}}_enqueue(t,e){let i=this.markStates.get(t);if(i===void 0)return!1;if(e=="show"){if(i=="entering"||i=="visible")return!1;this.markStates.set(t,"entering")}else if(e=="hide"){if(i=="exiting"||i=="completed")return!1;this.markStates.set(t,"exiting")}else console.error("Unknown action enqueued:",e);return this.defer?(this.queuedAnimations.set(t,e),this._flushTimer||(this._flushTimer=window.setTimeout(()=>this._flush(),0))):this._perform(t,e),!0}_flush(){this._flushTimer=null,this.queuedAnimations.forEach((t,e)=>{this._perform(e,t)}),this.queuedAnimations.clear()}show(t){return this.markStates.has(t)||(this._callbacks.initialize(t),this.markStates.set(t,"waiting"),this.marksByID.set(t.id,t)),this._enqueue(t,"show")}hide(t){return this.markStates.has(t)?this._enqueue(t,"hide"):!1}get(t,e=!1){let i=this.marksByID.get(t);if(i&&e){let a=this.markStates.get(i);if(a==="exiting"||a==="completed")return}return i}forEach(t){let e=0;this.markStates.forEach((i,a)=>{(i==="entering"||i==="visible"||i==="exiting")&&(t(a,e),e++)})}getMarks(){return Array.from(this.markStates.keys())}count(){return Array.from(this.markStates.keys()).filter(t=>["entering","visible","exiting"].includes(this.markStates.get(t))).length}getVisibleMarks(){return Array.from(this.markStates.keys()).filter(t=>["entering","visible","exiting"].includes(this.markStates.get(t)))}}function ci(r,t,e){return Object.fromEntries(Object.entries(r).map(([i,a])=>[i,typeof a=="function"?a(t,e):a]))}class di{constructor(t=[],e={animationDuration:1e3,animationCurve:Z}){this.timeProvider=null,this.marks=[],this.lazyUpdates=!0,this.useStaging=!0,this.stage=null,this.markArrayDirty=!1,this.animatingMarks=new Set,this.updatedMarks=new Set,this.preloadableProperties=new Set,this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!1,this._updateListeners={},this._eventListeners={},this.timeProvider=X(),this.lazyUpdates=!0,this._defaultDuration=1e3,this._defaultCurve=Z,this.configure(e),this.marks=t,this.marksByID=new Map,this.markSet=new Set,this.marks.forEach((i,a)=>{if(this.marksByID.has(i.id)){console.warn(`ID '${i.id}' is duplicated in mark render group`);return}this.marksByID.set(i.id,i),this.markSet.add(i),this._setupMark(i)}),this._setupStage()}configure(t){return t.timeProvider!==void 0&&(this.timeProvider=t.timeProvider),t.lazyUpdates!==void 0&&(this.lazyUpdates=t.lazyUpdates),t.animationDuration!==void 0&&(this._defaultDuration=t.animationDuration),t.animationCurve!==void 0&&(this._defaultCurve=t.animationCurve),t.hitTest!==void 0&&(this._hitTest=t.hitTest),this.marks&&this.getMarks().forEach(e=>this._configureMark(e)),this.useStaging=t.useStaging??this.useStaging,this._setupStage(),this}configureStaging(t,e=void 0){return this.useStaging||console.error("Can't configure staging without setting useStaging to true"),this.stage.onInitialize(t.initialize),this.stage.onEnter(t.enter),this.stage.onExit(t.exit),e&&this.stage.configure(e),this}_setupStage(){this.useStaging?(this.stage||(this.stage=new ui),this.marks&&this.stage.setVisibleMarks(this.getMarks())):this.stage=null}_setupMark(t){this._configureMark(t),t.addListener((e,i,a)=>{this.updatedMarks.add(e),!this.preloadableProperties.has(i)&&a&&this.animatingMarks.add(e),this._changedLastTick=!0}),t.addGraphListener((e,i,a,s)=>{a.forEach(n=>{!s.includes(n)&&n.sourceMarks().length==1&&this.deleteMark(n)}),s.forEach(n=>{a.includes(n)||this.addMark(n)})})}_configureMark(t){t.setTimeProvider(this.timeProvider),t.configure({animationDuration:this._defaultDuration,animationCurve:this._defaultCurve,...this._hitTest!==void 0?{hitTest:this._hitTest}:{}}),Object.entries(this._updateListeners).forEach(([e,i])=>t.onUpdate(e,i)),Object.entries(this._eventListeners).forEach(([e,i])=>t.onEvent(e,i)),this.preloadableProperties.forEach(e=>t.attributes[e].registerPreloadable())}onUpdate(t,e){return this._updateListeners[t]=e,this.getMarks().forEach(i=>i.onUpdate(t,e)),this}onEvent(t,e){return this._eventListeners[t]=e,this.getMarks().forEach(i=>i.onEvent(t,e)),this}dispatch(t,e=void 0){let i=this.getMarks().map(a=>a.dispatch(t,e)).filter(a=>a instanceof Promise);if(i.length>0)return new Promise((a,s)=>{Promise.all(i).then(()=>a()).catch(s)})}forceUpdate(){return this._forceUpdate=!0,this}currentTime(){return this.timeProvider()}getMarks(){return this.markArrayDirty&&(this.marks=Array.from(this.markSet)),this.markArrayDirty=!1,this.marks}registerPreloadableProperty(t){return this.preloadableProperties.add(t),this.getMarks().forEach(e=>e.attributes[t].registerPreloadable()),this}advance(t){var a;this.timeProvider.advance(t);let e=this.lazyUpdates?[...this.animatingMarks,...this.updatedMarks]:this.stage?this.stage.getMarks():this.getMarks();if(this.updatedMarks=new Set,!(((a=this.stage)==null?void 0:a.advance(t))??!1)&&e.length==0&&!this._forceUpdate&&!this._markListChanged)return this._changedLastTick=!1,!1;let i=new Set;for(let s of e)i.has(s)||(s.advance()||this.animatingMarks.delete(s),i.add(s));return this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!0,!0}marksAnimating(){return this.animatingMarks.size>0}animateTo(t,e,i={}){return this.forEach((a,s)=>{a.animateTo(t,typeof e=="function"?e(a,s):e,ci(i,a,s))}),this}animate(t,e={}){return this.preloadableProperties.has(t)&&e.interpolator?(console.error("Cannot apply custom interpolator function on preloadable property."),this):(this.forEach((a,s)=>{let n=ci(e,a,s);a.animate(t,n)}),this)}update(t,e=void 0){return this.forEach((i,a)=>{i.setAttr(t,e===void 0?void 0:typeof e=="function"?e(i,a):e)}),this}wait(t,e=!0){return Promise.all(this.map(i=>i.wait(t,e)))}get(t){return this.marksByID.get(t)}forEach(t){this.getMarks().forEach(t)}map(t){return this.getMarks().map(t)}filter(t){let e=Object.assign({},this),i=this.getMarks().filter(t);return Object.keys(this).forEach(a=>{e[a]=this[a]}),e.marks=i,e.marksByID=new Map,e.markSet=new Set,i.forEach(a=>{e.marksByID.set(a.id,a),e.markSet.add(a)}),ki(this).forEach(a=>{a=="getMarks"?e[a]=()=>i:e[a]=(...s)=>{let n=this.getMarks(),o=this.marksByID,h=this.markSet;this.marks=i,this.marksByID=e.marksByID,this.markSet=e.markSet;let l=this[a](...s);return this.marks=n,this.marksByID=o,this.markSet=h,l===this?e:l}}),e}updateTransform(t){return this.getMarks().forEach(e=>e.updateTransform(t)),this}addMark(t){return this.markSet.has(t)?this:(this.marks.push(t),this.marksByID.set(t.id,t),this.markSet.add(t),this._setupMark(t),this._markListChanged=!0,this.stage&&this.stage.show(t),this)}deleteMark(t){return this.markSet.has(t)?(this.marksByID.delete(t.id),this.markSet.delete(t),this.markArrayDirty=!0,this._markListChanged=!0,this.stage&&this.stage.hide(t),this):this}delete(t){return this.has(t)?this.deleteMark(this.get(t)):this}has(t){return this.marksByID.has(t)}count(){return this.markSet.size}changed(t=void 0){return t===void 0?this._changedLastTick:this._changedLastTick&&this.getMarks().some(e=>e.changed(t))}}const ia=5e3;class V{constructor(t,e){this._timeProvider=null,this._attrNames=[],this._listeners=[],this._graphListeners=[],this._defaultDuration=1e3,this._defaultCurve=Z,this._changedLastTick=!1,this._changedAttributes={},this._hitTest=null,this._adjacency={},this._reverseAdjacency=new Set,this.represented=void 0,this._updateListeners={},this._eventListeners={},this.framesWithUpdate=0,this.id=t,e===void 0&&console.error("Mark constructor requires an ID and an object defining attributes");let i={};Object.keys(e).forEach(a=>{let s=new M(Object.assign(Object.assign({},e[a]instanceof M?e[a]:new M(e[a])),{computeArg:this}));s.addListener((n,o)=>this._attributesChanged(a,o)),i[a]=s}),this.attributes=i,this._attrNames=Object.keys(i),this._changedAttributes=Object.fromEntries(this._attrNames.map(a=>[a,!0]))}configure(t){return t.animationDuration!==void 0&&(this._defaultDuration=t.animationDuration),t.animationCurve!==void 0&&(this._defaultCurve=t.animationCurve),t.hitTest!==void 0&&(this._hitTest=t.hitTest),this}onUpdate(t,e){return this._updateListeners[t]=e,this}onEvent(t,e){return this._eventListeners[t]=e,this}dispatch(t,e=void 0){if(this._eventListeners[t])return this._eventListeners[t](this,e,t)}addListener(t){return this._listeners.push(t),this}removeListener(t){let e=this._listeners.indexOf(t);return e>=0&&(this._listeners=this._listeners.splice(e,1)),this}addGraphListener(t){return this._graphListeners.push(t),this}removeGraphListener(t){let e=this._graphListeners.indexOf(t);return e>=0&&(this._graphListeners=this._graphListeners.splice(e,1)),this}_attributesChanged(t,e){this._changedLastTick=!0,this._changedAttributes[t]=!0,this._listeners.forEach(i=>i(this,t,e)),this._updateListeners[t]&&this._updateListeners[t](this,this.attributes[t].future())}hitTest(t){return this._hitTest?this._hitTest(this,t):!0}setTimeProvider(t){return this._timeProvider=t,Object.values(this.attributes).forEach(e=>e.setTimeProvider(this._timeProvider)),this}representing(t){return this.represented=t,this}advance(t=void 0){let e=!1;for(let i of this._attrNames){if(!this._changedAttributes[i])continue;this.attributes[i].advance(t)?e=!0:this._changedAttributes[i]=!1}return e?(this.framesWithUpdate+=1,this.framesWithUpdate>ia&&console.warn("Marks are being updated excessively!"),this._changedLastTick=!0,!0):(this.framesWithUpdate=0,this._changedLastTick=!1,!1)}setAttr(t,e=void 0){let i=this.attributes[t];i===void 0&&console.error(`No attribute named '${String(t)}'`);let a=i.last();return e===void 0?i.compute():i.set(e),w(a,i.data())||this._listeners.forEach(s=>s(this,t,!1)),this}attr(t,e=!0){return this.attributes[t]||console.error(`No attribute named '${String(t)}'`),e?this.attributes[t].get():this.attributes[t].getUntransformed()}get(t=!0){let e=Object.entries(t).length>0;return Object.fromEntries(this._attrNames.map(i=>{let a=e?t[i]??!0:t;return[i,a?this.attributes[i].get():this.attributes[i].getUntransformed()]}))}data(t){return this.attributes[t]===void 0&&console.error(`No attribute named '${String(t)}'`),this.attributes[t].data()}updateTransform(t){return this.attributes[t]===void 0&&console.error(`No attribute named '${String(t)}'`),this.attributes[t].updateTransform(),this}animateTo(t,e,i={}){if(!this.attributes.hasOwnProperty(t))return console.error(`No attribute named '${String(t)}'`),this;if(typeof e=="function")return this.attributes[t].set(e),this.animate(t,{duration:i.duration,curve:i.curve}),this;this.attributes[t].valueFn&&this.attributes[t].set(this.attributes[t].last());let a=i.duration===void 0?this._defaultDuration:i.duration,s=i.curve===void 0?this._defaultCurve:i.curve,n=new z(W(e),a,s).withDelay(i.delay||0);return this.attributes[t].animate(n),this}animate(t,e={}){if(!this.attributes.hasOwnProperty(t))return console.error(`Attempting to animate undefined property ${String(t)}`),this;let i;if(e instanceof z)i=e;else if(e.interpolator!==void 0){let a=e.interpolator;i=new z(a,e.duration!==void 0?e.duration:this._defaultDuration,e.curve!==void 0?e.curve:this._defaultCurve).withDelay(e.delay||0)}else{let a=this.data(t);if(!w(a,this.attributes[t].last())||!w(a,this.attributes[t].future())){let s=e.duration!==void 0?e.duration:this._defaultDuration,n=e.curve!==void 0?e.curve:this._defaultCurve;i=new z(W(a),s,n).withDelay(e.delay||0)}else return this}return this.attributes[t].animate(i),this}wait(t,e=!0){let i=Array.isArray(t)?t:[t];return Promise.all(i.map(a=>this.attributes[a].wait(e)))}freeze(t){return(Array.isArray(t)?t:[t]).forEach(i=>this.attributes[i].freeze()),this}changed(t=void 0){return t===void 0?this._changedLastTick:Array.isArray(t)?this._changedLastTick&&t.some(e=>this.attributes[e].changed()):this._changedLastTick&&this.attributes[t].changed()}copy(t,e={}){return new V(t,{...this.attributes,...Object.fromEntries(Object.entries(e).map(([i,a])=>a instanceof M?[i,a]:typeof a=="function"?[i,this.attributes[i].copy({valueFn:a})]:a.value!==void 0||a.valueFn!==void 0?[i,new M(a)]:[i,this.attributes[i].copy({value:a})]))})}adj(t,e=void 0){if(e!==void 0){let i=Array.isArray(e)?e:[e],a=this._adjacency[t]??new Set;this._graphListeners.forEach(s=>s(this,t,Array.from(a),i)),a.forEach(s=>s._removeEdgeFrom(this)),this._adjacency[t]=new Set(i),i.forEach(s=>s._addEdgeFrom(this));return}return Array.from(this._adjacency[t]??new Set)}sourceMarks(){return Array.from(this._reverseAdjacency)}_addEdgeFrom(t){return this._reverseAdjacency.add(t),this}_removeEdgeFrom(t){return this._reverseAdjacency.delete(t),this}}function ra(r){let t;if(typeof t=="function")t=r;else{let e=r;t=(i,a)=>new V(i,Object.fromEntries(Object.entries(e).map(([s,n])=>typeof n=="function"?[s,n(a[s])]:a[s]?a[s]instanceof M?[s,a[s]]:[s,new M(a[s])]:[s,n.copy()])))}return{create:(e,i)=>{let a=t(e,i);return a instanceof V?a:new V(e,a)}}}class aa{constructor(t){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof t.advance=="function"?this.toAdvance=[t]:this.toAdvance=t,this.start()}onChange(t){return this._callbacks.push(t),this}start(){return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(t=>t()),requestAnimationFrame(t=>this.tick(t)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(t){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(e=>e.advance(t-this._lastTick)).some(e=>e)&&this._callbacks.forEach(e=>e()),this.stopped||requestAnimationFrame(e=>this.tick(e)),this._lastTick=t}}class sa{constructor(t){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof t.advance=="function"?this.toAdvance=[t]:this.toAdvance=t,this.start()}onChange(t){return this._callbacks.push(t),this}start(){if(this.stopped)return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(t=>t()),requestAnimationFrame(t=>this.tick(t)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(t){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(e=>e.advance(t-this._lastTick)).some(e=>e)?(this._callbacks.forEach(e=>e()),this.stopped||requestAnimationFrame(e=>this.tick(e)),this._lastTick=t):this.stop()}}function Lt(r,t,e){e>0?(r[0].animate(new z(W(t[0]),e,Z)),r[1].animate(new z(W(t[1]),e,Z))):(r[0].set(t[0]),r[1].set(t[1]))}class na{constructor(t={}){this.animationDuration=1e3,this.squareAspect=!0,this._xDomain=[new M(0),new M(1)],this._yDomain=[new M(0),new M(1)],this._xRange=[new M(0),new M(1)],this._yRange=[new M(0),new M(1)],this._xScaleFactor=new M(1),this._yScaleFactor=new M(1),this._translateX=new M(0),this._translateY=new M(0),this._calculatingTransform=!1,this.timeProvider=X(),this.controller=null,this._updatedNoAdvance=!1,this.listeners=[],this.xScale=Object.assign(e=>((e-this.xDomain()[0])*this.xRSpan()/this.xDSpan()+this.xRange()[0])*this._xScaleFactor.get()+this._translateX.get(),{domain:()=>{let e=this.xRange();return[this.xScale.invert(e[0]),this.xScale.invert(e[1])]},range:()=>[this._xRange[0].get(),this._xRange[1].get()],invert:e=>((e-this._translateX.get())/this._xScaleFactor.get()-this.xRange()[0])*this.xDSpan()/this.xRSpan()+this.xDomain()[0]}),this.yScale=Object.assign(e=>((e-this.yDomain()[0])*this.yRSpan()/this.yDSpan()+this.yRange()[0])*this._yScaleFactor.get()+this._translateY.get(),{domain:()=>{let e=this.yRange();return[this.yScale.invert(e[0]),this.yScale.invert(e[1])]},range:()=>[this._yRange[0].get(),this._yRange[1].get()],invert:e=>((e-this._translateY.get())/this._yScaleFactor.get()-this.yRange()[0])*this.yDSpan()/this.yRSpan()+this.yDomain()[0]}),this.xDomain([0,1]),this.yDomain([0,1]),this.xRange([0,1]),this.yRange([0,1]),this.configure(t),this._xScaleFactor.setTimeProvider(this.timeProvider),this._yScaleFactor.setTimeProvider(this.timeProvider),this._translateX.setTimeProvider(this.timeProvider),this._translateY.setTimeProvider(this.timeProvider)}configure(t={}){return this.animationDuration=t.animationDuration!==void 0?t.animationDuration:1e3,this.minScale=t.minScale!==void 0?t.minScale:.1,this.maxScale=t.maxScale!==void 0?t.maxScale:14,this}xDomain(t=void 0,e=!1){return t===void 0?[this._xDomain[0].get(),this._xDomain[1].get()]:(Lt(this._xDomain,t,e?this.animationDuration:0),this)}yDomain(t=void 0,e=!1){return t===void 0?[this._yDomain[0].get(),this._yDomain[1].get()]:(Lt(this._yDomain,t,e?this.animationDuration:0),this)}xRange(t=void 0,e=!1){return t===void 0?[this._xRange[0].get(),this._xRange[1].get()]:(Lt(this._xRange,t,e?this.animationDuration:0),this)}yRange(t=void 0,e=!1){return t===void 0?[this._yRange[0].get(),this._yRange[1].get()]:(Lt(this._yRange,t,e?this.animationDuration:0),this)}xDSpan(){return this._xDomain[1].get()-this._xDomain[0].get()}yDSpan(){return this._yDomain[1].get()-this._yDomain[0].get()}xRSpan(){return this._xRange[1].get()-this._xRange[0].get()}yRSpan(){return this._yRange[1].get()-this._yRange[0].get()}makeSquareAspect(){let t=this.xRSpan()/this.xDSpan(),e=this.yRSpan()/this.yDSpan(),i=this.yDomain(),a=this.xDomain();if(t<e){let s=(i[0]+i[1])*.5,n=this.yRSpan()/t;this.yDomain([s-n*.5,s+n*.5])}else{let s=(a[0]+a[1])*.5,n=this.xRSpan()/e;this.xDomain([s-n*.5,s+n*.5])}return this}onUpdate(t){return this.listeners.push(t),this}isNeutral(){return Math.abs(this._xScaleFactor.get()-1)<=.01&&Math.abs(this._yScaleFactor.get()-1)<=.01&&Math.abs(this._translateX.get())<=5&&Math.abs(this._translateY.get())<=5}advance(t=void 0){return this.timeProvider.advance(t),[this._xDomain[0].advance(t),this._xDomain[1].advance(t),this._yDomain[0].advance(t),this._yDomain[1].advance(t),this._xRange[0].advance(t),this._xRange[1].advance(t),this._yRange[0].advance(t),this._yRange[1].advance(t),this._xScaleFactor.advance(t),this._yScaleFactor.advance(t),this._translateX.advance(t),this._translateY.advance(t)].some(i=>i)?(this._updatedNoAdvance=!1,this.listeners.forEach(i=>i(this)),!0):(this._updatedNoAdvance||(this.listeners.forEach(i=>i(this)),this._updatedNoAdvance=!0),!1)}scaleBy(t,e=null){this.unfollow();let i=this._translateX.get(),a=this._translateY.get(),s=this._xScaleFactor.get(),n=this._yScaleFactor.get();e?e=[(e[0]-i)/s,(e[1]-a)/n]:e=[(this.xRange[0]+this.xRange[1])*.5,(this.yRange[0]+this.yRange[1])*.5];let o=typeof t=="number"?t:t[0],h=typeof t=="number"?t:t[1],l=s+o;return l<=this.maxScale&&l>=this.minScale&&(this._xScaleFactor.set(l),this._translateX.set(i-o*e[0])),l=n+h,l<=this.maxScale&&l>=this.minScale&&(this._yScaleFactor.set(l),this._translateY.set(a-h*e[1])),this}translateBy(t,e){return this.unfollow(),this._translateX.set(this._translateX.get()+t),this._translateY.set(this._translateY.get()+e),this}transform(t=void 0,e=!1){if(t!==void 0){if(this.unfollow(),e){let i=a=>new z(W(a),this.animationDuration,Z);t.kx!==void 0?this._xScaleFactor.animate(i(t.kx)):t.k!==void 0&&this._xScaleFactor.animate(i(t.k)),t.ky!==void 0?this._yScaleFactor.animate(i(t.ky)):t.k!==void 0&&this._yScaleFactor.animate(i(t.k)),t.x!==void 0&&this._translateX.animate(i(t.x)),t.y!==void 0&&this._translateY.animate(i(t.y))}else t.kx!==void 0?this._xScaleFactor.set(t.kx):t.k!==void 0&&this._xScaleFactor.set(t.k),t.ky!==void 0?this._yScaleFactor.set(t.ky):t.k!==void 0&&this._yScaleFactor.set(t.k),t.x!==void 0&&this._translateX.set(t.x),t.y!==void 0&&this._translateY.set(t.y);return this}else{let i=this._xScaleFactor.last(),a=this._yScaleFactor.last();return{k:(i+a)*.5,kx:i,ky:a,x:this._translateX.last(),y:this._translateY.last()}}}reset(t=!1){return this.transform({k:1,x:0,y:0},t)}zoomTo(t,e=!0){return this.transform(t.transform(this),e)}_calculateControllerTransform(){this._calculatingTransform=!0;let t=this.controller.transform(this);return this._calculatingTransform=!1,t}follow(t,e=!0){if(this.controller=t,this._xScaleFactor.set(()=>{if(this._calculatingTransform)return this._xScaleFactor.last();let i=this._calculateControllerTransform();return i.kx||i.k}),this._yScaleFactor.set(()=>{if(this._calculatingTransform)return this._yScaleFactor.last();let i=this._calculateControllerTransform();return i.ky||i.k}),this._translateX.set(()=>this._calculatingTransform?this._translateX.last():this._calculateControllerTransform().x),this._translateY.set(()=>this._calculatingTransform?this._translateY.last():this._calculateControllerTransform().y),e){let i=a=>new z(oi(()=>a.data()),this.animationDuration,Z);this._xScaleFactor.animate(i(this._xScaleFactor)),this._yScaleFactor.animate(i(this._yScaleFactor)),this._translateX.animate(i(this._translateX)),this._translateY.animate(i(this._translateY))}return this}unfollow(){return this.controller!=null&&(this._xScaleFactor.set(this._xScaleFactor.get()),this._yScaleFactor.set(this._yScaleFactor.get()),this._translateX.set(this._translateX.get()),this._translateY.set(this._translateY.get())),this.controller=null,this}wait(t=!0){return Promise.all([...this._xDomain,...this._yDomain,...this._xRange,...this._yRange,this._xScaleFactor,this._yScaleFactor,this._translateX,this._translateY].map(e=>e.wait(t)))}}class Nt{constructor(t,e={}){this.lastCompute=void 0,this.marks=t,this.centerMark=e.centerMark!==void 0?e.centerMark:void 0,this.centerMark&&!this.marks.includes(this.centerMark)&&(this.marks=[...this.marks,this.centerMark]),this.xAttr=e.xAttr!==void 0?e.xAttr:"x",this.yAttr=e.yAttr!==void 0?e.yAttr:"y",this.padding=e.padding!==void 0?e.padding:20,this.transformCoordinates=e.transformCoordinates??!1,this.inverseTransformCoordinates=e.inverseTransformCoordinates??!1}transform(t){if(this.lastCompute&&this.lastCompute.scales===t&&this.lastCompute.time==t.timeProvider())return this.lastCompute.result;let e=this.marks.map(S=>this._getMarkLocation(t,S)),i,a,s,n,o=this.centerMark!==void 0?this._getMarkLocation(t,this.centerMark):null,h=t.transform(),{x:l,y:u}=Si(e);if(o){let S=Math.max(l[1]-o.x,o.x-l[0]),x=Math.max(u[1]-o.y,o.y-u[0]);l=[o.x-S,o.x+S],u=[o.y-x,o.y+x]}let c,d;Math.abs(l[1]-l[0])>0?c=(Math.abs(t.xRSpan())-this.padding*2)/(l[1]-l[0])/(Math.abs(t.xRSpan())/Math.abs(t.xDSpan())):c=h.kx,Math.abs(u[1]-u[0])>0?d=(Math.abs(t.yRSpan())-this.padding*2)/(u[1]-u[0])/(Math.abs(t.yRSpan())/Math.abs(t.yDSpan())):d=h.ky;let g=h.ky/h.kx;c=Math.min(c,t.maxScale),d=Math.min(d,t.maxScale),d<c*g?(s=d/g,n=d):(s=c,n=c*g),i=(l[0]+l[1])*.5,a=(u[0]+u[1])*.5,i=(i-t.xDomain()[0])*t.xRSpan()/t.xDSpan()+t.xRange()[0],a=(a-t.yDomain()[0])*t.yRSpan()/t.yDSpan()+t.yRange()[0];let y=-i*s+(t.xRange()[0]+t.xRange()[1])*.5,b=-a*n+(t.yRange()[0]+t.yRange()[1])*.5,v={kx:s,ky:n,x:y,y:b};return this.lastCompute={scales:t,time:t.timeProvider(),result:v},v}_getMarkLocation(t,e){let i={x:e.attr(this.xAttr,this.transformCoordinates),y:e.attr(this.yAttr,this.transformCoordinates)};return this.inverseTransformCoordinates&&(i={x:t.xScale.invert(i.x),y:t.yScale.invert(i.y)}),i}}function oa(r,t={}){return new Nt([r],{centerMark:r,...t})}function ha(r,t={}){return new Nt(r,{...t})}class la{constructor(t={}){this.markCollections=[],this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this._avgMarksPerBin=null,this._coordinateAttributes=t.coordinateAttributes??["x","y"],this._transformCoordinates=t.transformCoordinates??!0,this._avgMarksPerBin=t.marksPerBin??null,this._maximumHitTestDistance=t.maximumHitTestDistance??1e12}add(t){return this.markCollections.push(t),this}remove(t){let e=this.markCollections.indexOf(t);return e<0&&console.error("Tried to remove mark collection which does not exist:",t),this.markCollections.splice(e,1),this}invalidate(){return this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this}compute(){return this._extents=new Array(this._coordinateAttributes.length).fill([1e12,-1e12]),this._numMarks=0,this._forEachMark(t=>{this._coordinateAttributes.forEach((e,i)=>{let a=t.attr(e,this._transformCoordinates);a<this._extents[i][0]&&(this._extents[i][0]=a),a>this._extents[i][1]&&(this._extents[i][1]=a)}),this._numMarks+=1}),this._numMarks==0?this:(this._numBins=Math.round(this._numMarks/(this._avgMarksPerBin??Math.min(Math.max(1,this._numMarks/100),10))),this._binSizes=this._extents.map(t=>Math.ceil((t[1]-t[0])/this._numBins)),this._positionMap=new Map,this._forEachMark(t=>{let e=this._coordinateAttributes.map(a=>t.attr(a,this._transformCoordinates)),i=this._getPositionID(e);this._positionMap.has(i)?this._positionMap.get(i).push(t):this._positionMap.set(i,[t])}),this)}_forEachMark(t){this.markCollections.forEach(e=>{if(e instanceof di)e.forEach(t);else if(e instanceof V)t(e);else if(typeof e.forEach=="function")e.forEach(t);else if(typeof e=="function"){let i=e();i instanceof V?t(i):i.forEach(t)}else console.error("Unrecognized mark collection type in position map:",e)})}_getPositionID(t){return(this._numBins===null||!this._extents||!this._binSizes)&&console.error("Cannot hash position without computing first"),t.length!=this._coordinateAttributes.length&&console.error(`Need exactly ${this._coordinateAttributes.length} coordinates, got ${t.length}`),t.reduce((e,i,a)=>e*this._numBins+Math.floor((i-this._extents[a][0])/this._binSizes[a]),0)}marksNear(t,e,i=!0){if(this._positionMap||this.compute(),this._numMarks==0)return[];let a=this._recursiveBinWalk(t,e);return i?a.map(n=>{let o=this._coordinateAttributes.map(h=>n.attr(h,this._transformCoordinates));return[n,Math.sqrt(o.reduce((h,l,u)=>h+(l-t[u])*(l-t[u]),0))]}).filter(([n,o])=>o<=e).sort((n,o)=>n[1]-o[1]).map(([n,o])=>n):a}_recursiveBinWalk(t,e,i=[],a={}){let s=i.length;if(s==t.length)return this._positionMap.get(this._getPositionID(i))??[];let n=a.distanceInBins?e:Math.ceil(e/this._binSizes[s]),o=(a.outerOnly&&i.length==this._binSizes.length-1?[-n,n]:new Array(n*2+1).fill(0).map((l,u)=>u-n)).map(l=>l*this._binSizes[s]+t[s]).filter(l=>l>=this._extents[s][0]&&l<=this._extents[s][1]),h=[];return o.forEach((l,u)=>{h=[...h,...this._recursiveBinWalk(t,e,[...i,l],{...a,outerOnly:a.outerOnly&&u>0&&u<o.length-1})]}),h}hitTest(t,e=null){this._positionMap||this.compute(),e==null&&(e=this._maximumHitTestDistance);let i=this._binSizes.reduce((a,s)=>Math.min(this._numBins,Math.floor(Math.max(a,e/s))),0)+1;for(let a=0;a<i;a++){let s=this._recursiveBinWalk(t,a,[],{outerOnly:!0,distanceInBins:!0});if(s.length==0)continue;let o=s.map(h=>{let l=this._coordinateAttributes.map(u=>h.attr(u,this._transformCoordinates));return[h,Math.sqrt(l.reduce((u,c,d)=>u+(c-t[d])*(c-t[d]),0))]}).filter(([h,l])=>l<=e).sort((h,l)=>h[1]-l[1]).map(([h,l])=>h);for(let h of o)if(h.hitTest(t))return h}return null}dispatchAt(t,e,i=void 0){let a=this.hitTest(t);return a&&a.dispatch(e,i),a}}var fi=(r=>(r.none="no-preference",r.more="more",r.less="less",r))(fi||{}),mi=(r=>(r.light="light",r.dark="dark",r))(mi||{});class gi{constructor(){this._hasChanged=!1;let t=window.matchMedia("(prefers-reduced-motion: reduce)");this._prefersReducedMotion=t.matches,t.addEventListener("change",h=>this._handleMotion(h));let e=window.matchMedia("(prefers-reduced-transparency: reduce)");this._prefersReducedTransparency=e.matches,e.addEventListener("change",h=>this._handleTransparency(h));let i=window.matchMedia("(prefers-contrast: none)");this._contrastPreference="no-preference",i.addEventListener("change",h=>this._handleContrastNone(h));let a=window.matchMedia("(prefers-contrast: more)");a.matches&&(this._contrastPreference="more"),a.addEventListener("change",h=>this._handleContrastMore(h));let s=window.matchMedia("(prefers-contrast: less)");a.matches&&(this._contrastPreference="less"),s.addEventListener("change",h=>this._handleContrastLess(h));let n=window.matchMedia("(prefers-color-scheme: light)");this._colorSchemePreference="light",n.addEventListener("change",h=>this._handleColorSchemeLight(h));let o=window.matchMedia("(prefers-color-scheme: dark)");o.matches&&(this._colorSchemePreference="dark"),o.addEventListener("change",h=>this._handleColorSchemeDark(h))}_handleMotion(t){this._prefersReducedMotion=t.matches,this._hasChanged=!0}_handleTransparency(t){this._prefersReducedTransparency=t.matches,this._hasChanged=!0}_handleContrastMore(t){t.matches&&(this._contrastPreference="more"),this._hasChanged=!0}_handleContrastLess(t){t.matches&&(this._contrastPreference="less"),this._hasChanged=!0}_handleContrastNone(t){t.matches&&(this._contrastPreference="no-preference"),this._hasChanged=!0}_handleColorSchemeLight(t){t.matches&&(this._colorSchemePreference="light"),this._hasChanged=!0}_handleColorSchemeDark(t){t.matches&&(this._colorSchemePreference="dark"),this._hasChanged=!0}get prefersReducedMotion(){return this._prefersReducedMotion}get prefersReducedTransparency(){return this._prefersReducedTransparency}get contrastPreference(){return this._contrastPreference}get colorSchemePreference(){return this._colorSchemePreference}advance(t){return this._hasChanged?(this._hasChanged=!1,!0):!1}}let Jt;function ua(){return Jt||(Jt=new gi),Jt}m.Animator=z,m.Attribute=M,m.AttributeRecompute=te,m.ColorSchemePreference=mi,m.ContrastPreference=fi,m.LazyTicker=sa,m.Mark=V,m.MarkFollower=Nt,m.MarkRenderGroup=di,m.PositionMap=la,m.RenderContext=gi,m.Scales=na,m.StageManager=ui,m.StagingAction=li,m.StagingState=hi,m.Ticker=aa,m.autoMixingFunction=Dt,m.basicAnimationTo=ea,m.centerOn=oa,m.colorMixingFunction=si,m.curveEaseInOut=Z,m.curveLinear=Ht,m.defineMark=ra,m.getRenderContext=ua,m.interpolateAlongPath=Kr,m.interpolateTo=W,m.interpolateToFunction=oi,m.markBox=ha,m.numericalArrayMixingFunction=ni,m.numericalMixingFunction=Wt,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});