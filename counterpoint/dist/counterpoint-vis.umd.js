(function(m,w){typeof exports=="object"&&typeof module<"u"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(m=typeof globalThis<"u"?globalThis:m||self,w(m["counterpoint-vis"]={}))})(this,function(m){"use strict";var pa=Object.defineProperty;var _a=(m,w,I)=>w in m?pa(m,w,{enumerable:!0,configurable:!0,writable:!0,value:I}):m[w]=I;var te=(m,w,I)=>(_a(m,typeof w!="symbol"?w+"":w,I),I);function w(i,t){return typeof i=="number"&&typeof t=="number"?Math.abs(i-t)<=.001:i==t}function I(){var i=0;return Object.assign(function(){return i},{advance:e=>{i+=e}})}function vi(i){let t=new Set;for(;i=Reflect.getPrototypeOf(i);)Reflect.ownKeys(i).forEach(r=>t.add(r));return t}class ki{constructor(t=void 0){this.info=t,this.promise=new Promise((e,r)=>{this.reject=r,this.resolve=e})}}function wi(i){let t=1e12,e=-1e12,r=1e12,a=-1e12;return i.forEach(s=>{s.x<t&&(t=s.x),s.x>e&&(e=s.x),s.y<r&&(r=s.y),s.y>a&&(a=s.y)}),{x:[t,e],y:[r,a]}}var ee=(i=>(i[i.DEFAULT=0]="DEFAULT",i[i.ALWAYS=1]="ALWAYS",i[i.WHEN_UPDATED=2]="WHEN_UPDATED",i))(ee||{});class k{constructor(t){if(this.valueFn=void 0,this.transform=void 0,this.cacheTransform=!1,this._cachedValue=null,this.computeArg=void 0,this.recompute=0,this.needsUpdate=!1,this.animation=null,this.label=null,this._computedValue=null,this._lastTickValue=void 0,this._animatedValue=null,this._hasComputed=!1,this._timeProvider=null,this.currentTime=0,this._changedLastTick=!1,this._listeners=[],this._animationCompleteCallbacks=[],t==null||t==null||!(t.hasOwnProperty("value")||t.hasOwnProperty("valueFn")))typeof t=="function"?this.valueFn=t:this.value=t;else{let e=t;e.valueFn!==void 0?this.valueFn=e.valueFn:e.value!==void 0?this.value=e.value:console.error("One of `value` or `valueFn` must be defined to create an Attribute"),this.transform=e.transform??null,this.cacheTransform=e.cacheTransform??!1,this._cachedValue=null,this.computeArg=e.computeArg??null,this.recompute=e.recompute??0}}copy(t={}){let e={...this,...t};return t.value!==void 0&&(e.valueFn=void 0),t.valueFn!==void 0&&(e.value=void 0),new k(e)}addListener(t){this._listeners.push(t)}removeListener(t){let e=this._listeners.indexOf(t);e>=0&&(this._listeners=this._listeners.splice(e,1))}setTimeProvider(t){this._timeProvider=t}_getComputeArg(){return this.computeArg!==void 0?this.computeArg:this}compute(){this.valueFn&&(this._computedValue=this.valueFn(this._getComputeArg()))}advance(t=void 0){return(this.animation!=null||this.needsUpdate||this.valueFn)&&(this._timeProvider===null?this.currentTime+=t:this.currentTime=this._timeProvider()),this.animation==null&&this._animationCompleteCallbacks.length>0&&(console.warn("Found animation-complete callbacks for a non-existent animation"),this._cleanUpAnimation(!0)),this._lastTickValue=this.getUntransformed(),this.animation!=null||this.needsUpdate?(this.needsUpdate=!1,this._changedLastTick=!0,!0):(this._changedLastTick=!1,!1)}_computeAnimation(t=!0){if(!this.animation)return;this._timeProvider&&(this.currentTime=this._timeProvider());let{animator:e,start:r,initial:a}=this.animation,s=e.evaluate(a,Math.min(this.currentTime-r,e.duration));this._animationFinished()&&t?(this.valueFn?this.compute():this.value=s,this._cleanUpAnimation(!1),this._animatedValue=null):this._animatedValue=s}_animationFinished(){return this.animation?this.animation.animator.duration+20<=this.currentTime-this.animation.start:!0}_performTransform(t){let e;if(this.transform){let r=this._cachedValue;if(r&&w(r.raw,t))e=r.result;else{let a=t;e=this.transform(t,this._getComputeArg()),this.cacheTransform&&(this._cachedValue={raw:a,result:e})}}else e=t;return e}_cleanUpAnimation(t=!1){this.animation=null,this._animationCompleteCallbacks.forEach(e=>{!t||!e.info.rejectOnCancel?e.resolve(this):e.reject({newValue:this.last()})}),this._animationCompleteCallbacks=[]}get(){return this._performTransform(this.getUntransformed())}getUntransformed(){this._computeAnimation();let t;return this._animatedValue!=null?t=this._animatedValue:this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),t=this._computedValue):t=this.value,this._lastTickValue===void 0&&(this._lastTickValue=t),t}getPreload(t=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let r=this.get();return{start:r,end:r,startTime:t||this.currentTime,endTime:t||this.currentTime}}let e=this.getPreloadUntransformed(t);return{start:this._performTransform(e.start),end:this._performTransform(e.end),startTime:e.startTime,endTime:e.endTime}}getPreloadUntransformed(t=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let s=this.getUntransformed();return{start:s,end:s,startTime:t||this.currentTime,endTime:t||this.currentTime}}if(this._animationFinished())return this._computeAnimation(),this.getPreloadUntransformed(t);let e;this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),e=this._computedValue):e=this.value;let r=this.animation.animator.finalValue;r===void 0&&console.error("Animations on preloadable attributes must have a final value");let a=(t||this.currentTime)-this.currentTime;return{start:e,end:r,startTime:this.animation.start+a,endTime:this.animation.start+this.animation.animator.duration+a}}set(t){typeof t=="function"?(this.value!=null&&(this._computedValue=this.value),this.valueFn=t,this.value=void 0,this._animatedValue=null,this._lastTickValue=void 0):(this.value=t,this.valueFn=null,this._animatedValue=null,this._lastTickValue=t),this.needsUpdate=!0,this.animation&&this._cleanUpAnimation(!0),this._listeners.forEach(e=>e(this,!1))}data(){return this.valueFn?this.valueFn(this._getComputeArg()):this.value}last(){return this.animation&&this._computeAnimation(!1),this._lastTickValue!==void 0?this._lastTickValue:this._animatedValue!=null?this._animatedValue:this.value!==void 0?this.value:this._computedValue}future(){return this.animation?this.animation.animator.finalValue:this._animatedValue!=null?this._animatedValue:this.value!==void 0?this.value:this._computedValue}updateTransform(){this._cachedValue=null}animating(){return this.animation!=null}animate(t){this._timeProvider&&(this.currentTime=this._timeProvider()),this.animation&&(this.valueFn?this._computedValue=this._animatedValue:this.value=this._animatedValue,this._cleanUpAnimation(!0)),this.animation={animator:t,initial:this.last(),start:this.currentTime},this._computeAnimation(),this._listeners.forEach(e=>e(this,!0))}wait(t=!0){if(!this.animation)return new Promise((r,a)=>r(this));let e=new ki({rejectOnCancel:t});return this._animationCompleteCallbacks.push(e),e.promise}changed(){return this._changedLastTick}}function v(i,t){let e=i.length;Array.isArray(i[0])||(i=[i]),Array.isArray(t[0])||(t=t.map(n=>[n]));let r=t[0].length,a=t[0].map((n,o)=>t.map(h=>h[o])),s=i.map(n=>a.map(o=>{let h=0;if(!Array.isArray(n)){for(let l of o)h+=n*l;return h}for(let l=0;l<n.length;l++)h+=n[l]*(o[l]||0);return h}));return e===1&&(s=s[0]),r===1?s.map(n=>n[0]):s}function Q(i){return X(i)==="string"}function X(i){return(Object.prototype.toString.call(i).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function ut(i,t){i=+i,t=+t;let e=(Math.floor(i)+"").length;if(t>e)return+i.toFixed(t-e);{let r=10**(e-t);return Math.round(i/r)*r}}function ie(i){if(!i)return;i=i.trim();const t=/^([a-z]+)\((.+?)\)$/i,e=/^-?[\d.]+$/;let r=i.match(t);if(r){let a=[];return r[2].replace(/\/?\s*([-\w.]+(?:%|deg)?)/g,(s,n)=>{/%$/.test(n)?(n=new Number(n.slice(0,-1)/100),n.type="<percentage>"):/deg$/.test(n)?(n=new Number(+n.slice(0,-3)),n.type="<angle>",n.unit="deg"):e.test(n)&&(n=new Number(n),n.type="<number>"),s.startsWith("/")&&(n=n instanceof Number?n:new Number(n),n.alpha=!0),a.push(n)}),{name:r[1].toLowerCase(),rawName:r[1],rawArgs:r[2],args:a}}}function re(i){return i[i.length-1]}function ct(i,t,e){return isNaN(i)?t:isNaN(t)?i:i+(t-i)*e}function ae(i,t,e){return(e-i)/(t-i)}function Pt(i,t,e){return ct(t[0],t[1],ae(i[0],i[1],e))}function se(i){return i.map(t=>t.split("|").map(e=>{e=e.trim();let r=e.match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(r){let a=new String(r[1]);return a.range=[+r[2],+r[3]],a}return e}))}var Si=Object.freeze({__proto__:null,interpolate:ct,interpolateInv:ae,isString:Q,last:re,mapRange:Pt,multiplyMatrices:v,parseCoordGrammar:se,parseFunction:ie,toPrecision:ut,type:X});class xi{add(t,e,r){if(typeof arguments[0]!="string"){for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1]);return}(Array.isArray(t)?t:[t]).forEach(function(a){this[a]=this[a]||[],e&&this[a][r?"unshift":"push"](e)},this)}run(t,e){this[t]=this[t]||[],this[t].forEach(function(r){r.call(e&&e.context?e.context:e,e)})}}const j=new xi;var Y={gamut_mapping:"lch.c",precision:5,deltaE:"76"};const B={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function Rt(i){return Array.isArray(i)?i:B[i]}function dt(i,t,e,r={}){if(i=Rt(i),t=Rt(t),!i||!t)throw new TypeError(`Missing white point to convert ${i?"":"from"}${!i&&!t?"/":""}${t?"":"to"}`);if(i===t)return e;let a={W1:i,W2:t,XYZ:e,options:r};if(j.run("chromatic-adaptation-start",a),a.M||(a.W1===B.D65&&a.W2===B.D50?a.M=[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]]:a.W1===B.D50&&a.W2===B.D65&&(a.M=[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]])),j.run("chromatic-adaptation-end",a),a.M)return v(a.M,a.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}const Ci=75e-6,D=class D{constructor(t){var a,s,n;this.id=t.id,this.name=t.name,this.base=t.base?D.get(t.base):null,this.aliases=t.aliases,this.base&&(this.fromBase=t.fromBase,this.toBase=t.toBase);let e=t.coords??this.base.coords;for(let o in e)"name"in e[o]||(e[o].name=o);this.coords=e;let r=t.white??this.base.white??"D65";this.white=Rt(r),this.formats=t.formats??{};for(let o in this.formats){let h=this.formats[o];h.type||(h.type="function"),h.name||(h.name=o)}t.cssId&&!((a=this.formats.functions)!=null&&a.color)?(this.formats.color={id:t.cssId},Object.defineProperty(this,"cssId",{value:t.cssId})):(s=this.formats)!=null&&s.color&&!((n=this.formats)!=null&&n.color.id)&&(this.formats.color.id=this.id),this.referred=t.referred,Object.defineProperty(this,"path",{value:Ti(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),j.run("colorspace-init-end",this)}inGamut(t,{epsilon:e=Ci}={}){if(this.isPolar)return t=this.toBase(t),this.base.inGamut(t,{epsilon:e});let r=Object.values(this.coords);return t.every((a,s)=>{let n=r[s];if(n.type!=="angle"&&n.range){if(Number.isNaN(a))return!0;let[o,h]=n.range;return(o===void 0||a>=o-e)&&(h===void 0||a<=h+e)}return!0})}get cssId(){var t,e;return((e=(t=this.formats.functions)==null?void 0:t.color)==null?void 0:e.id)||this.id}get isPolar(){for(let t in this.coords)if(this.coords[t].type==="angle")return!0;return!1}getFormat(t){if(typeof t=="object")return t=ne(t,this),t;let e;return t==="default"?e=Object.values(this.formats)[0]:e=this.formats[t],e?(e=ne(e,this),e):null}equals(t){return t?this===t||this.id===t.id:!1}to(t,e){if(arguments.length===1&&([t,e]=[t.space,t.coords]),t=D.get(t),this.equals(t))return e;e=e.map(o=>Number.isNaN(o)?0:o);let r=this.path,a=t.path,s,n;for(let o=0;o<r.length&&r[o].equals(a[o]);o++)s=r[o],n=o;if(!s)throw new Error(`Cannot convert between color spaces ${this} and ${t}: no connection space was found`);for(let o=r.length-1;o>n;o--)e=r[o].toBase(e);for(let o=n+1;o<a.length;o++)e=a[o].fromBase(e);return e}from(t,e){return arguments.length===1&&([t,e]=[t.space,t.coords]),t=D.get(t),t.to(this,e)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let t=[];for(let e in this.coords){let r=this.coords[e],a=r.range||r.refRange;t.push((a==null?void 0:a.min)??0)}return t}static get all(){return[...new Set(Object.values(D.registry))]}static register(t,e){if(arguments.length===1&&(e=arguments[0],t=e.id),e=this.get(e),this.registry[t]&&this.registry[t]!==e)throw new Error(`Duplicate color space registration: '${t}'`);if(this.registry[t]=e,arguments.length===1&&e.aliases)for(let r of e.aliases)this.register(r,e);return e}static get(t,...e){if(!t||t instanceof D)return t;if(X(t)==="string"){let a=D.registry[t.toLowerCase()];if(!a)throw new TypeError(`No color space found with id = "${t}"`);return a}if(e.length)return D.get(...e);throw new TypeError(`${t} is not a valid color space`)}static resolveCoord(t,e){var h;let r=X(t),a,s;if(r==="string"?t.includes(".")?[a,s]=t.split("."):[a,s]=[,t]:Array.isArray(t)?[a,s]=t:(a=t.space,s=t.coordId),a=D.get(a),a||(a=e),!a)throw new TypeError(`Cannot resolve coordinate reference ${t}: No color space specified and relative references are not allowed here`);if(r=X(s),r==="number"||r==="string"&&s>=0){let l=Object.entries(a.coords)[s];if(l)return{space:a,id:l[0],index:s,...l[1]}}a=D.get(a);let n=s.toLowerCase(),o=0;for(let l in a.coords){let u=a.coords[l];if(l.toLowerCase()===n||((h=u.name)==null?void 0:h.toLowerCase())===n)return{space:a,id:l,index:o,...u};o++}throw new TypeError(`No "${s}" coordinate found in ${a.name}. Its coordinates are: ${Object.keys(a.coords).join(", ")}`)}};te(D,"registry",{}),te(D,"DEFAULT_FORMAT",{type:"functions",name:"color"});let f=D;function Ti(i){let t=[i];for(let e=i;e=e.base;)t.push(e);return t}function ne(i,{coords:t}={}){if(i.coords&&!i.coordGrammar){i.type||(i.type="function"),i.name||(i.name="color"),i.coordGrammar=se(i.coords);let e=Object.entries(t).map(([r,a],s)=>{let n=i.coordGrammar[s][0],o=a.range||a.refRange,h=n.range,l="";return n=="<percentage>"?(h=[0,100],l="%"):n=="<angle>"&&(l="deg"),{fromRange:o,toRange:h,suffix:l}});i.serializeCoords=(r,a)=>r.map((s,n)=>{let{fromRange:o,toRange:h,suffix:l}=e[n];return o&&h&&(s=Pt(o,h,s)),s=ut(s,a),l&&(s+=l),s})}return i}var A=new f({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class C extends f{constructor(t){t.coords||(t.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),t.base||(t.base=A),t.toXYZ_M&&t.fromXYZ_M&&(t.toBase??(t.toBase=e=>{let r=v(t.toXYZ_M,e);return this.white!==this.base.white&&(r=dt(this.white,this.base.white,r)),r}),t.fromBase??(t.fromBase=e=>(e=dt(this.base.white,this.white,e),v(t.fromXYZ_M,e)))),t.referred??(t.referred="display"),super(t)}}function oe(i,{meta:t}={}){var r,a,s,n,o;let e={str:(r=String(i))==null?void 0:r.trim()};if(j.run("parse-start",e),e.color)return e.color;if(e.parsed=ie(e.str),e.parsed){let h=e.parsed.name;if(h==="color"){let l=e.parsed.args.shift(),u=e.parsed.rawArgs.indexOf("/")>0?e.parsed.args.pop():1;for(let d of f.all){let g=d.getFormat("color");if(g&&(l===g.id||(a=g.ids)!=null&&a.includes(l))){const y=Object.keys(d.coords).map((M,b)=>e.parsed.args[b]||0);return t&&(t.formatId="color"),{spaceId:d.id,coords:y,alpha:u}}}let c="";if(l in f.registry){let d=(o=(n=(s=f.registry[l].formats)==null?void 0:s.functions)==null?void 0:n.color)==null?void 0:o.id;d&&(c=`Did you mean color(${d})?`)}throw new TypeError(`Cannot parse color(${l}). `+(c||"Missing a plugin?"))}else for(let l of f.all){let u=l.getFormat(h);if(u&&u.type==="function"){let c=1;(u.lastAlpha||re(e.parsed.args).alpha)&&(c=e.parsed.args.pop());let d=e.parsed.args,g;return u.coordGrammar&&(g=Object.entries(l.coords).map(([y,M],b)=>{var N;let S=u.coordGrammar[b],x=(N=d[b])==null?void 0:N.type,R=S.find(V=>V==x);if(!R){let V=M.name||y;throw new TypeError(`${x} not allowed for ${V} in ${h}()`)}let L=R.range;x==="<percentage>"&&(L||(L=[0,1]));let F=M.range||M.refRange;return L&&F&&(d[b]=Pt(L,F,d[b])),R})),t&&Object.assign(t,{formatId:u.name,types:g}),{spaceId:l.id,coords:d,alpha:c}}}}else for(let h of f.all)for(let l in h.formats){let u=h.formats[l];if(u.type!=="custom"||u.test&&!u.test(e.str))continue;let c=u.parse(e.str);if(c)return c.alpha??(c.alpha=1),t&&(t.formatId=l),c}throw new TypeError(`Could not parse ${i} as a color. Missing a plugin?`)}function p(i){if(!i)throw new TypeError("Empty color reference");Q(i)&&(i=oe(i));let t=i.space||i.spaceId;return t instanceof f||(i.space=f.get(t)),i.alpha===void 0&&(i.alpha=1),i}function K(i,t){return t=f.get(t),t.from(i)}function E(i,t){let{space:e,index:r}=f.resolveCoord(t,i.space);return K(i,e)[r]}function he(i,t,e){return t=f.get(t),i.coords=t.to(i.space,e),i}function q(i,t,e){if(i=p(i),arguments.length===2&&X(arguments[1])==="object"){let r=arguments[1];for(let a in r)q(i,a,r[a])}else{typeof e=="function"&&(e=e(E(i,t)));let{space:r,index:a}=f.resolveCoord(t,i.space),s=K(i,r);s[a]=e,he(i,r,s)}return i}var Bt=new f({id:"xyz-d50",name:"XYZ D50",white:"D50",base:A,fromBase:i=>dt(A.white,"D50",i),toBase:i=>dt("D50",A.white,i),formats:{color:{}}});const Di=216/24389,le=24/116,ft=24389/27;let zt=B.D50;var T=new f({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:zt,base:Bt,fromBase(i){let e=i.map((r,a)=>r/zt[a]).map(r=>r>Di?Math.cbrt(r):(ft*r+16)/116);return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},toBase(i){let t=[];return t[1]=(i[0]+16)/116,t[0]=i[1]/500+t[1],t[2]=t[1]-i[2]/200,[t[0]>le?Math.pow(t[0],3):(116*t[0]-16)/ft,i[0]>8?Math.pow((i[0]+16)/116,3):i[0]/ft,t[2]>le?Math.pow(t[2],3):(116*t[2]-16)/ft].map((r,a)=>r*zt[a])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function mt(i){return(i%360+360)%360}function Li(i,t){if(i==="raw")return t;let[e,r]=t.map(mt),a=r-e;return i==="increasing"?a<0&&(r+=360):i==="decreasing"?a>0&&(e+=360):i==="longer"?-180<a&&a<180&&(a>0?e+=360:r+=360):i==="shorter"&&(a>180?e+=360:a<-180&&(r+=360)),[e,r]}var tt=new f({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:T,fromBase(i){let[t,e,r]=i,a;const s=.02;return Math.abs(e)<s&&Math.abs(r)<s?a=NaN:a=Math.atan2(r,e)*180/Math.PI,[t,Math.sqrt(e**2+r**2),mt(a)]},toBase(i){let[t,e,r]=i;return e<0&&(e=0),isNaN(r)&&(r=0),[t,e*Math.cos(r*Math.PI/180),e*Math.sin(r*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const ue=25**7,gt=Math.PI,ce=180/gt,W=gt/180;function Ft(i,t,{kL:e=1,kC:r=1,kH:a=1}={}){let[s,n,o]=T.from(i),h=tt.from(T,[s,n,o])[1],[l,u,c]=T.from(t),d=tt.from(T,[l,u,c])[1];h<0&&(h=0),d<0&&(d=0);let y=((h+d)/2)**7,M=.5*(1-Math.sqrt(y/(y+ue))),b=(1+M)*n,S=(1+M)*u,x=Math.sqrt(b**2+o**2),R=Math.sqrt(S**2+c**2),L=b===0&&o===0?0:Math.atan2(o,b),F=S===0&&c===0?0:Math.atan2(c,S);L<0&&(L+=2*gt),F<0&&(F+=2*gt),L*=ce,F*=ce;let N=l-s,V=R-x,$=F-L,ot=L+F,gi=Math.abs($),ht;x*R===0?ht=0:gi<=180?ht=$:$>180?ht=$-360:$<-180?ht=$+360:console.log("the unthinkable has happened");let pi=2*Math.sqrt(R*x)*Math.sin(ht*W/2),ca=(s+l)/2,Kt=(x+R)/2,_i=Math.pow(Kt,7),O;x*R===0?O=ot:gi<=180?O=ot/2:ot<360?O=(ot+360)/2:O=(ot-360)/2;let yi=(ca-50)**2,da=1+.015*yi/Math.sqrt(20+yi),Mi=1+.045*Kt,lt=1;lt-=.17*Math.cos((O-30)*W),lt+=.24*Math.cos(2*O*W),lt+=.32*Math.cos((3*O+6)*W),lt-=.2*Math.cos((4*O-63)*W);let bi=1+.015*Kt*lt,fa=30*Math.exp(-1*((O-275)/25)**2),ma=2*Math.sqrt(_i/(_i+ue)),ga=-1*Math.sin(2*fa*W)*ma,Et=(N/(e*da))**2;return Et+=(V/(r*Mi))**2,Et+=(pi/(a*bi))**2,Et+=ga*(V/(r*Mi))*(pi/(a*bi)),Math.sqrt(Et)}const Ai=75e-6;function et(i,t=i.space,{epsilon:e=Ai}={}){i=p(i),t=f.get(t);let r=i.coords;return t!==i.space&&(r=t.from(i)),t.inGamut(r,{epsilon:e})}function it(i){return{space:i.space,coords:i.coords.slice(),alpha:i.alpha}}function U(i,{method:t=Y.gamut_mapping,space:e=i.space}={}){if(Q(arguments[1])&&(e=arguments[1]),e=f.get(e),et(i,e,{epsilon:0}))return p(i);let r=P(i,e);if(t!=="clip"&&!et(i,e)){let a=U(it(r),{method:"clip",space:e});if(Ft(i,a)>2){let s=f.resolveCoord(t),n=s.space,o=s.id,h=P(r,n),u=(s.range||s.refRange)[0],c=.01,d=u,g=E(h,o);for(;g-d>c;){let y=it(h);y=U(y,{space:e,method:"clip"}),Ft(h,y)-2<c?d=E(h,o):g=E(h,o),q(h,o,(d+g)/2)}r=P(h,e)}else r=a}if(t==="clip"||!et(r,e,{epsilon:0})){let a=Object.values(e.coords).map(s=>s.range||[]);r.coords=r.coords.map((s,n)=>{let[o,h]=a[n];return o!==void 0&&(s=Math.max(o,s)),h!==void 0&&(s=Math.min(s,h)),s})}return e!==i.space&&(r=P(r,i.space)),i.coords=r.coords,i}U.returns="color";function P(i,t,{inGamut:e}={}){i=p(i),t=f.get(t);let r=t.from(i),a={space:t,coords:r,alpha:i.alpha};return e&&(a=U(a)),a}P.returns="color";function pt(i,{precision:t=Y.precision,format:e="default",inGamut:r=!0,...a}={}){var h;let s;i=p(i);let n=e;e=i.space.getFormat(e)??i.space.getFormat("default")??f.DEFAULT_FORMAT,r||(r=e.toGamut);let o=i.coords;if(o=o.map(l=>l||0),r&&!et(i)&&(o=U(it(i),r===!0?void 0:r).coords),e.type==="custom")if(a.precision=t,e.serialize)s=e.serialize(o,i.alpha,a);else throw new TypeError(`format ${n} can only be used to parse colors, not for serialization`);else{let l=e.name||"color";e.serializeCoords?o=e.serializeCoords(o,t):t!==null&&(o=o.map(g=>ut(g,t)));let u=[...o];if(l==="color"){let g=e.id||((h=e.ids)==null?void 0:h[0])||i.space.id;u.unshift(g)}let c=i.alpha;t!==null&&(c=ut(c,t));let d=i.alpha<1&&!e.noAlpha?`${e.commas?",":" /"} ${c}`:"";s=`${l}(${u.join(e.commas?", ":" ")}${d})`}return s}const Ei=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],Pi=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]];var _t=new C({id:"rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:Ei,fromXYZ_M:Pi,formats:{color:{}}});const yt=1.09929682680944,de=.018053968510807;var fe=new C({id:"rec2020",name:"REC.2020",base:_t,toBase(i){return i.map(function(t){return t<de*4.5?t/4.5:Math.pow((t+yt-1)/yt,1/.45)})},fromBase(i){return i.map(function(t){return t>=de?yt*Math.pow(t,.45)-(yt-1):4.5*t})},formats:{color:{}}});const Ri=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],Bi=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]];var me=new C({id:"p3-linear",name:"Linear P3",white:"D65",toXYZ_M:Ri,fromXYZ_M:Bi});const zi=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],Fi=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]];var ge=new C({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:zi,fromXYZ_M:Fi,formats:{color:{}}}),pe={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]};let _e=Array(3).fill("<percentage> | <number>[0, 255]"),ye=Array(3).fill("<number>[0, 255]");var rt=new C({id:"srgb",name:"sRGB",base:ge,fromBase:i=>i.map(t=>{let e=t<0?-1:1,r=t*e;return r>.0031308?e*(1.055*r**(1/2.4)-.055):12.92*t}),toBase:i=>i.map(t=>{let e=t<0?-1:1,r=t*e;return r<.04045?t/12.92:e*((r+.055)/1.055)**2.4}),formats:{rgb:{coords:_e},rgb_number:{name:"rgb",commas:!0,coords:ye,noAlpha:!0},color:{},rgba:{coords:_e,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:ye},hex:{type:"custom",toGamut:!0,test:i=>/^#([a-f0-9]{3,4}){1,2}$/i.test(i),parse(i){i.length<=5&&(i=i.replace(/[a-f0-9]/gi,"$&$&"));let t=[];return i.replace(/[a-f0-9]{2}/gi,e=>{t.push(parseInt(e,16)/255)}),{spaceId:"srgb",coords:t.slice(0,3),alpha:t.slice(3)[0]}},serialize:(i,t,{collapse:e=!0}={})=>{t<1&&i.push(t),i=i.map(s=>Math.round(s*255));let r=e&&i.every(s=>s%17===0);return"#"+i.map(s=>r?(s/17).toString(16):s.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:i=>/^[a-z]+$/i.test(i),parse(i){i=i.toLowerCase();let t={spaceId:"srgb",coords:null,alpha:1};if(i==="transparent"?(t.coords=pe.black,t.alpha=0):t.coords=pe[i],t.coords)return t}}}}),Me=new C({id:"p3",name:"P3",base:me,fromBase:rt.fromBase,toBase:rt.toBase,formats:{color:{id:"display-p3"}}});if(Y.display_space=rt,typeof CSS<"u"&&CSS.supports)for(let i of[T,fe,Me]){let t=i.getMinCoords(),r=pt({space:i,coords:t,alpha:1});if(CSS.supports("color",r)){Y.display_space=i;break}}function Yi(i,{space:t=Y.display_space,...e}={}){let r=pt(i,e);if(typeof CSS>"u"||CSS.supports("color",r)||!Y.display_space)r=new String(r),r.color=i;else{let a=P(i,t);r=new String(pt(a,e)),r.color=a}return r}function be(i,t,e="lab"){e=f.get(e);let r=e.from(i),a=e.from(t);return Math.sqrt(r.reduce((s,n,o)=>{let h=a[o];return isNaN(n)||isNaN(h)?s:s+(h-n)**2},0))}function $i(i,t){return i=p(i),t=p(t),i.space===t.space&&i.alpha===t.alpha&&i.coords.every((e,r)=>e===t.coords[r])}function G(i){return E(i,[A,"y"])}function ve(i,t){q(i,[A,"y"],t)}function Oi(i){Object.defineProperty(i.prototype,"luminance",{get(){return G(this)},set(t){ve(this,t)}})}var Ii=Object.freeze({__proto__:null,getLuminance:G,register:Oi,setLuminance:ve});function Xi(i,t){i=p(i),t=p(t);let e=Math.max(G(i),0),r=Math.max(G(t),0);return r>e&&([e,r]=[r,e]),(e+.05)/(r+.05)}const ji=.56,qi=.57,Ui=.62,Gi=.65,ke=.022,Zi=1.414,Hi=.1,Vi=5e-4,Ni=1.14,we=.027,Wi=1.14;function Se(i){return i>=ke?i:i+(ke-i)**Zi}function J(i){let t=i<0?-1:1,e=Math.abs(i);return t*Math.pow(e,2.4)}function Ji(i,t){t=p(t),i=p(i);let e,r,a,s,n,o;t=P(t,"srgb"),[s,n,o]=t.coords;let h=J(s)*.2126729+J(n)*.7151522+J(o)*.072175;i=P(i,"srgb"),[s,n,o]=i.coords;let l=J(s)*.2126729+J(n)*.7151522+J(o)*.072175,u=Se(h),c=Se(l),d=c>u;return Math.abs(c-u)<Vi?r=0:d?(e=c**ji-u**qi,r=e*Ni):(e=c**Gi-u**Ui,r=e*Wi),Math.abs(r)<Hi?a=0:r>0?a=r-we:a=r+we,a*100}function Qi(i,t){i=p(i),t=p(t);let e=Math.max(G(i),0),r=Math.max(G(t),0);r>e&&([e,r]=[r,e]);let a=e+r;return a===0?0:(e-r)/a}const Ki=5e4;function tr(i,t){i=p(i),t=p(t);let e=Math.max(G(i),0),r=Math.max(G(t),0);return r>e&&([e,r]=[r,e]),r===0?Ki:(e-r)/r}function er(i,t){i=p(i),t=p(t);let e=E(i,[T,"l"]),r=E(t,[T,"l"]);return Math.abs(e-r)}const ir=216/24389,xe=24/116,Mt=24389/27;let Yt=B.D65;var $t=new f({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Yt,base:A,fromBase(i){let e=i.map((r,a)=>r/Yt[a]).map(r=>r>ir?Math.cbrt(r):(Mt*r+16)/116);return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},toBase(i){let t=[];return t[1]=(i[0]+16)/116,t[0]=i[1]/500+t[1],t[2]=t[1]-i[2]/200,[t[0]>xe?Math.pow(t[0],3):(116*t[0]-16)/Mt,i[0]>8?Math.pow((i[0]+16)/116,3):i[0]/Mt,t[2]>xe?Math.pow(t[2],3):(116*t[2]-16)/Mt].map((r,a)=>r*Yt[a])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});const Ot=Math.pow(5,.5)*.5+.5;function rr(i,t){i=p(i),t=p(t);let e=E(i,[$t,"l"]),r=E(t,[$t,"l"]),a=Math.abs(Math.pow(e,Ot)-Math.pow(r,Ot)),s=Math.pow(a,1/Ot)*Math.SQRT2-40;return s<7.5?0:s}var bt=Object.freeze({__proto__:null,contrastAPCA:Ji,contrastDeltaPhi:rr,contrastLstar:er,contrastMichelson:Qi,contrastWCAG21:Xi,contrastWeber:tr});function ar(i,t,e={}){Q(e)&&(e={algorithm:e});let{algorithm:r,...a}=e;if(!r){let s=Object.keys(bt).map(n=>n.replace(/^contrast/,"")).join(", ");throw new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${s}`)}i=p(i),t=p(t);for(let s in bt)if("contrast"+r.toLowerCase()===s.toLowerCase())return bt[s](i,t,a);throw new TypeError(`Unknown contrast algorithm: ${r}`)}function Ce(i){let[t,e,r]=K(i,A),a=t+15*e+3*r;return[4*t/a,9*e/a]}function Te(i){let[t,e,r]=K(i,A),a=t+e+r;return[t/a,e/a]}function sr(i){Object.defineProperty(i.prototype,"uv",{get(){return Ce(this)}}),Object.defineProperty(i.prototype,"xy",{get(){return Te(this)}})}var nr=Object.freeze({__proto__:null,register:sr,uv:Ce,xy:Te});function or(i,t){return be(i,t,"lab")}const De=Math.PI/180;function hr(i,t,{l:e=2,c:r=1}={}){let[a,s,n]=T.from(i),[,o,h]=tt.from(T,[a,s,n]),[l,u,c]=T.from(t),d=tt.from(T,[l,u,c])[1];o<0&&(o=0),d<0&&(d=0);let g=a-l,y=o-d,M=s-u,b=n-c,S=M**2+b**2-y**2,x=.511;a>=16&&(x=.040975*a/(1+.01765*a));let R=.0638*o/(1+.0131*o)+.638,L;Number.isNaN(h)&&(h=0),h>=164&&h<=345?L=.56+Math.abs(.2*Math.cos((h+168)*De)):L=.36+Math.abs(.4*Math.cos((h+35)*De));let F=Math.pow(o,4),N=Math.sqrt(F/(F+1900)),V=R*(N*L+1-N),$=(g/(e*x))**2;return $+=(y/(r*R))**2,$+=S/V**2,Math.sqrt($)}const Le=203;var It=new f({id:"xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:A,fromBase(i){return i.map(t=>Math.max(t*Le,0))},toBase(i){return i.map(t=>Math.max(t/Le,0))}});const vt=1.15,kt=.66,Ae=2610/2**14,lr=2**14/2610,Ee=3424/2**12,Pe=2413/2**7,Re=2392/2**7,ur=1.7*2523/2**5,Be=2**5/(1.7*2523),wt=-.56,Xt=16295499532821565e-27,cr=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],dr=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],fr=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],mr=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]];var ze=new f({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:It,fromBase(i){let[t,e,r]=i,a=vt*t-(vt-1)*r,s=kt*e-(kt-1)*t,o=v(cr,[a,s,r]).map(function(d){let g=Ee+Pe*(d/1e4)**Ae,y=1+Re*(d/1e4)**Ae;return(g/y)**ur}),[h,l,u]=v(fr,o);return[(1+wt)*h/(1+wt*h)-Xt,l,u]},toBase(i){let[t,e,r]=i,a=(t+Xt)/(1+wt-wt*(t+Xt)),n=v(mr,[a,e,r]).map(function(d){let g=Ee-d**Be,y=Re*d**Be-Pe;return 1e4*(g/y)**lr}),[o,h,l]=v(dr,n),u=(o+(vt-1)*l)/vt,c=(h+(kt-1)*u)/kt;return[u,c,l]},formats:{color:{}}}),jt=new f({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:ze,fromBase(i){let[t,e,r]=i,a;const s=2e-4;return Math.abs(e)<s&&Math.abs(r)<s?a=NaN:a=Math.atan2(r,e)*180/Math.PI,[t,Math.sqrt(e**2+r**2),mt(a)]},toBase(i){return[i[0],i[1]*Math.cos(i[2]*Math.PI/180),i[1]*Math.sin(i[2]*Math.PI/180)]},formats:{color:{}}});function gr(i,t){let[e,r,a]=jt.from(i),[s,n,o]=jt.from(t),h=e-s,l=r-n;Number.isNaN(a)&&Number.isNaN(o)?(a=0,o=0):Number.isNaN(a)?a=o:Number.isNaN(o)&&(o=a);let u=a-o,c=2*Math.sqrt(r*n)*Math.sin(u/2*(Math.PI/180));return Math.sqrt(h**2+l**2+c**2)}const Fe=3424/4096,Ye=2413/128,$e=2392/128,Oe=2610/16384,pr=2523/32,_r=16384/2610,Ie=32/2523,yr=[[.3592,.6976,-.0358],[-.1922,1.1004,.0755],[.007,.0749,.8434]],Mr=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],br=[[.9999888965628402,.008605050147287059,.11103437159861648],[1.00001110343716,-.008605050147287059,-.11103437159861648],[1.0000320633910054,.56004913547279,-.3206339100541203]],vr=[[2.0701800566956137,-1.326456876103021,.20661600684785517],[.3649882500326575,.6804673628522352,-.04542175307585323],[-.04959554223893211,-.04942116118675749,1.1879959417328034]];var qt=new f({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:It,fromBase(i){let t=v(yr,i);return kr(t)},toBase(i){let t=wr(i);return v(vr,t)},formats:{color:{}}});function kr(i){let t=i.map(function(e){let r=Fe+Ye*(e/1e4)**Oe,a=1+$e*(e/1e4)**Oe;return(r/a)**pr});return v(Mr,t)}function wr(i){return v(br,i).map(function(r){let a=Math.max(r**Ie-Fe,0),s=Ye-$e*r**Ie;return 1e4*(a/s)**_r})}function Sr(i,t){let[e,r,a]=qt.from(i),[s,n,o]=qt.from(t);return 720*Math.sqrt((e-s)**2+.25*(r-n)**2+(a-o)**2)}const xr=[[.8190224432164319,.3619062562801221,-.12887378261216414],[.0329836671980271,.9292868468965546,.03614466816999844],[.048177199566046255,.26423952494422764,.6335478258136937]],Cr=[[1.2268798733741557,-.5578149965554813,.28139105017721583],[-.04057576262431372,1.1122868293970594,-.07171106666151701],[-.07637294974672142,-.4214933239627914,1.5869240244272418]],Tr=[[.2104542553,.793617785,-.0040720468],[1.9779984951,-2.428592205,.4505937099],[.0259040371,.7827717662,-.808675766]],Dr=[[.9999999984505198,.39633779217376786,.2158037580607588],[1.0000000088817609,-.10556134232365635,-.06385417477170591],[1.0000000546724108,-.08948418209496575,-1.2914855378640917]];var St=new f({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"L"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:A,fromBase(i){let e=v(xr,i).map(r=>Math.cbrt(r));return v(Tr,e)},toBase(i){let e=v(Dr,i).map(r=>r**3);return v(Cr,e)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function Lr(i,t){let[e,r,a]=St.from(i),[s,n,o]=St.from(t),h=e-s,l=r-n,u=a-o;return Math.sqrt(h**2+l**2+u**2)}var xt={deltaE76:or,deltaECMC:hr,deltaE2000:Ft,deltaEJz:gr,deltaEITP:Sr,deltaEOK:Lr};function at(i,t,e={}){Q(e)&&(e={method:e});let{method:r=Y.deltaE,...a}=e;i=p(i),t=p(t);for(let s in xt)if("deltae"+r.toLowerCase()===s.toLowerCase())return xt[s](i,t,a);throw new TypeError(`Unknown deltaE method: ${r}`)}function Ar(i,t=.25){let r=[f.get("oklch","lch"),"l"];return q(i,r,a=>a*(1+t))}function Er(i,t=.25){let r=[f.get("oklch","lch"),"l"];return q(i,r,a=>a*(1-t))}var Pr=Object.freeze({__proto__:null,darken:Er,lighten:Ar});function Xe(i,t,e=.5,r={}){[i,t]=[p(i),p(t)],X(e)==="object"&&([e,r]=[.5,e]);let{space:a,outputSpace:s,premultiplied:n}=r;return st(i,t,{space:a,outputSpace:s,premultiplied:n})(e)}function je(i,t,e={}){let r;Ut(i)&&([r,e]=[i,t],[i,t]=r.rangeArgs.colors);let{maxDeltaE:a,deltaEMethod:s,steps:n=2,maxSteps:o=1e3,...h}=e;r||([i,t]=[p(i),p(t)],r=st(i,t,h));let l=at(i,t),u=a>0?Math.max(n,Math.ceil(l/a)+1):n,c=[];if(o!==void 0&&(u=Math.min(u,o)),u===1)c=[{p:.5,color:r(.5)}];else{let d=1/(u-1);c=Array.from({length:u},(g,y)=>{let M=y*d;return{p:M,color:r(M)}})}if(a>0){let d=c.reduce((g,y,M)=>{if(M===0)return 0;let b=at(y.color,c[M-1].color,s);return Math.max(g,b)},0);for(;d>a;){d=0;for(let g=1;g<c.length&&c.length<o;g++){let y=c[g-1],M=c[g],b=(M.p+y.p)/2,S=r(b);d=Math.max(d,at(S,y.color),at(S,M.color)),c.splice(g,0,{p:b,color:r(b)}),g++}}}return c=c.map(d=>d.color),c}function st(i,t,e={}){if(Ut(i)){let[h,l]=[i,t];return st(...h.rangeArgs.colors,{...h.rangeArgs.options,...l})}let{space:r,outputSpace:a,progression:s,premultiplied:n}=e;i=p(i),t=p(t),i=it(i),t=it(t);let o={colors:[i,t],options:e};if(r?r=f.get(r):r=f.registry[Y.interpolationSpace]||i.space,a=a?f.get(a):r,i=P(i,r),t=P(t,r),i=U(i),t=U(t),r.coords.h&&r.coords.h.type==="angle"){let h=e.hue=e.hue||"shorter",l=[r,"h"],[u,c]=[E(i,l),E(t,l)];[u,c]=Li(h,[u,c]),q(i,l,u),q(t,l,c)}return n&&(i.coords=i.coords.map(h=>h*i.alpha),t.coords=t.coords.map(h=>h*t.alpha)),Object.assign(h=>{h=s?s(h):h;let l=i.coords.map((d,g)=>{let y=t.coords[g];return ct(d,y,h)}),u=ct(i.alpha,t.alpha,h),c={space:r,coords:l,alpha:u};return n&&(c.coords=c.coords.map(d=>d/u)),a!==r&&(c=P(c,a)),c},{rangeArgs:o})}function Ut(i){return X(i)==="function"&&!!i.rangeArgs}Y.interpolationSpace="lab";function Rr(i){i.defineFunction("mix",Xe,{returns:"color"}),i.defineFunction("range",st,{returns:"function<color>"}),i.defineFunction("steps",je,{returns:"array<color>"})}var Br=Object.freeze({__proto__:null,isRange:Ut,mix:Xe,range:st,register:Rr,steps:je}),qe=new f({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:rt,fromBase:i=>{let t=Math.max(...i),e=Math.min(...i),[r,a,s]=i,[n,o,h]=[NaN,0,(e+t)/2],l=t-e;if(l!==0){switch(o=h===0||h===1?0:(t-h)/Math.min(h,1-h),t){case r:n=(a-s)/l+(a<s?6:0);break;case a:n=(s-r)/l+2;break;case s:n=(r-a)/l+4}n=n*60}return[n,o*100,h*100]},toBase:i=>{let[t,e,r]=i;t=t%360,t<0&&(t+=360),e/=100,r/=100;function a(s){let n=(s+t/30)%12,o=e*Math.min(r,1-r);return r-o*Math.max(-1,Math.min(n-3,9-n,1))}return[a(0),a(8),a(4)]},formats:{hsl:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),Ue=new f({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:qe,fromBase(i){let[t,e,r]=i;e/=100,r/=100;let a=r+e*Math.min(r,1-r);return[t,a===0?0:200*(1-r/a),100*a]},toBase(i){let[t,e,r]=i;e/=100,r/=100;let a=r*(1-e/2);return[t,a===0||a===1?0:(r-a)/Math.min(a,1-a)*100,a*100]},formats:{color:{toGamut:!0}}}),zr=new f({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:Ue,fromBase(i){let[t,e,r]=i;return[t,r*(100-e)/100,100-r]},toBase(i){let[t,e,r]=i;e/=100,r/=100;let a=e+r;if(a>=1){let o=e/a;return[t,0,o*100]}let s=1-r,n=s===0?0:1-e/s;return[t,n*100,s*100]},formats:{hwb:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]}}});const Fr=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],Yr=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]];var Ge=new C({id:"a98rgb-linear",name:"Linear Adobe® 98 RGB compatible",white:"D65",toXYZ_M:Fr,fromXYZ_M:Yr}),$r=new C({id:"a98rgb",name:"Adobe® 98 RGB compatible",base:Ge,toBase:i=>i.map(t=>Math.pow(Math.abs(t),563/256)*Math.sign(t)),fromBase:i=>i.map(t=>Math.pow(Math.abs(t),256/563)*Math.sign(t)),formats:{color:{id:"a98-rgb"}}});const Or=[[.7977604896723027,.13518583717574031,.0313493495815248],[.2880711282292934,.7118432178101014,8565396060525902e-20],[0,0,.8251046025104601]],Ir=[[1.3457989731028281,-.25558010007997534,-.05110628506753401],[-.5446224939028347,1.5082327413132781,.02053603239147973],[0,0,1.2119675456389454]];var Ze=new C({id:"prophoto-linear",name:"Linear ProPhoto",white:"D50",base:Bt,toXYZ_M:Or,fromXYZ_M:Ir});const Xr=1/512,jr=16/512;var qr=new C({id:"prophoto",name:"ProPhoto",base:Ze,toBase(i){return i.map(t=>t<jr?t/16:t**1.8)},fromBase(i){return i.map(t=>t>=Xr?t**(1/1.8):16*t)},formats:{color:{id:"prophoto-rgb"}}}),Ur=new f({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:St,fromBase(i){let[t,e,r]=i,a;const s=2e-4;return Math.abs(e)<s&&Math.abs(r)<s?a=NaN:a=Math.atan2(r,e)*180/Math.PI,[t,Math.sqrt(e**2+r**2),mt(a)]},toBase(i){let[t,e,r]=i,a,s;return isNaN(r)?(a=0,s=0):(a=e*Math.cos(r*Math.PI/180),s=e*Math.sin(r*Math.PI/180)),[t,a,s]},formats:{oklch:{coords:["<number> | <percentage>","<number> | <percentage>[0,1]","<number> | <angle>"]}}});const He=203,Ve=2610/2**14,Gr=2**14/2610,Zr=2523/2**5,Ne=2**5/2523,We=3424/2**12,Je=2413/2**7,Qe=2392/2**7;var Hr=new C({id:"rec2100pq",name:"REC.2100-PQ",base:_t,toBase(i){return i.map(function(t){return(Math.max(t**Ne-We,0)/(Je-Qe*t**Ne))**Gr*1e4/He})},fromBase(i){return i.map(function(t){let e=Math.max(t*He/1e4,0),r=We+Je*e**Ve,a=1+Qe*e**Ve;return(r/a)**Zr})},formats:{color:{id:"rec2100-pq"}}});const Ke=.17883277,ti=.28466892,ei=.55991073,Gt=3.7743;var Vr=new C({id:"rec2100hlg",cssid:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:_t,toBase(i){return i.map(function(t){return t<=.5?t**2/3*Gt:(Math.exp((t-ei)/Ke)+ti)/12*Gt})},fromBase(i){return i.map(function(t){return t/=Gt,t<=1/12?Math.sqrt(3*t):Ke*Math.log(12*t-ti)+ei})},formats:{color:{id:"rec2100-hlg"}}});const ii={};j.add("chromatic-adaptation-start",i=>{i.options.method&&(i.M=ri(i.W1,i.W2,i.options.method))}),j.add("chromatic-adaptation-end",i=>{i.M||(i.M=ri(i.W1,i.W2,i.options.method))});function Ct({id:i,toCone_M:t,fromCone_M:e}){ii[i]=arguments[0]}function ri(i,t,e="Bradford"){let r=ii[e],[a,s,n]=v(r.toCone_M,i),[o,h,l]=v(r.toCone_M,t),u=[[o/a,0,0],[0,h/s,0],[0,0,l/n]],c=v(u,r.toCone_M);return v(r.fromCone_M,c)}Ct({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599364,-1.1293816,.2198974],[.3611914,.6388125,-64e-7],[0,0,1.0890636]]}),Ct({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929,-.1470543,.1599627],[.4323053,.5183603,.0492912],[-.0085287,.0400428,.9684867]]}),Ct({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238,-.278869,.1827452],[.454369,.4735332,.0720978],[-.0096276,-.005698,1.0153256]]}),Ct({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.011254630531685,.1491867754444518],[.3875265432361372,.6214474419314753,-.008973985167612518],[-.01584149884933386,-.03412293802851557,1.04996443687785]]}),Object.assign(B,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),B.ACES=[.32168/.33767,1,(1-.32168-.33767)/.33767];const Nr=[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],Wr=[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]];var ai=new C({id:"acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:B.ACES,toXYZ_M:Nr,fromXYZ_M:Wr,formats:{color:{}}});const Tt=2**-16,Zt=-.35828683,Dt=(Math.log2(65504)+9.72)/17.52;var Jr=new C({id:"acescc",name:"ACEScc",coords:{r:{range:[Zt,Dt],name:"Red"},g:{range:[Zt,Dt],name:"Green"},b:{range:[Zt,Dt],name:"Blue"}},referred:"scene",base:ai,toBase(i){const t=-.3013698630136986;return i.map(function(e){return e<=t?(2**(e*17.52-9.72)-Tt)*2:e<Dt?2**(e*17.52-9.72):65504})},fromBase(i){return i.map(function(t){return t<=0?(Math.log2(Tt)+9.72)/17.52:t<Tt?(Math.log2(Tt+t*.5)+9.72)/17.52:(Math.log2(t)+9.72)/17.52})},formats:{color:{}}}),si=Object.freeze({__proto__:null,A98RGB:$r,A98RGB_Linear:Ge,ACEScc:Jr,ACEScg:ai,HSL:qe,HSV:Ue,HWB:zr,ICTCP:qt,JzCzHz:jt,Jzazbz:ze,LCH:tt,Lab:T,Lab_D65:$t,OKLCH:Ur,OKLab:St,P3:Me,P3_Linear:me,ProPhoto:qr,ProPhoto_Linear:Ze,REC_2020:fe,REC_2020_Linear:_t,REC_2100_HLG:Vr,REC_2100_PQ:Hr,XYZ_ABS_D65:It,XYZ_D50:Bt,XYZ_D65:A,sRGB:rt,sRGB_Linear:ge});class _{constructor(...t){let e;t.length===1&&(e=p(t[0]));let r,a,s;e?(r=e.space||e.spaceId,a=e.coords,s=e.alpha):[r,a,s]=t,Object.defineProperty(this,"space",{value:f.get(r),writable:!1,enumerable:!0,configurable:!0}),this.coords=a?a.slice():[0,0,0],this.alpha=s<1?s:1;for(let n=0;n<this.coords.length;n++)this.coords[n]==="NaN"&&(this.coords[n]=NaN);for(let n in this.space.coords)Object.defineProperty(this,n,{get:()=>this.get(n),set:o=>this.set(n,o)})}get spaceId(){return this.space.id}clone(){return new _(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...t){let e=Yi(this,...t);return e.color=new _(e.color),e}static get(t,...e){return t instanceof _?t:new _(t,...e)}static defineFunction(t,e,r=e){let{instance:a=!0,returns:s}=r,n=function(...o){let h=e(...o);if(s==="color")h=_.get(h);else if(s==="function<color>"){let l=h;h=function(...u){let c=l(...u);return _.get(c)},Object.assign(h,l)}else s==="array<color>"&&(h=h.map(l=>_.get(l)));return h};t in _||(_[t]=n),a&&(_.prototype[t]=function(...o){return n(this,...o)})}static defineFunctions(t){for(let e in t)_.defineFunction(e,t[e],t[e])}static extend(t){if(t.register)t.register(_);else for(let e in t)_.defineFunction(e,t[e])}}_.defineFunctions({get:E,getAll:K,set:q,setAll:he,to:P,equals:$i,inGamut:et,toGamut:U,distance:be,toString:pt}),Object.assign(_,{util:Si,hooks:j,WHITES:B,Space:f,spaces:f.registry,parse:oe,defaults:Y});for(let i of Object.keys(si))f.register(si[i]);for(let i in f.registry)Ht(i,f.registry[i]);j.add("colorspace-init-end",i=>{var t;Ht(i.id,i),(t=i.aliases)==null||t.forEach(e=>{Ht(e,i)})});function Ht(i,t){Object.keys(t.coords),Object.values(t.coords).map(r=>r.name);let e=i.replace(/-/g,"_");Object.defineProperty(_.prototype,e,{get(){let r=this.getAll(i);return typeof Proxy>"u"?r:new Proxy(r,{has:(a,s)=>{try{return f.resolveCoord([t,s]),!0}catch{}return Reflect.has(a,s)},get:(a,s,n)=>{if(s&&typeof s!="symbol"&&!(s in a)){let{index:o}=f.resolveCoord([t,s]);if(o>=0)return a[o]}return Reflect.get(a,s,n)},set:(a,s,n,o)=>{if(s&&typeof s!="symbol"&&!(s in a)||s>=0){let{index:h}=f.resolveCoord([t,s]);if(h>=0)return a[h]=n,this.setAll(i,a),!0}return Reflect.set(a,s,n,o)}})},set(r){this.setAll(i,r)},configurable:!0,enumerable:!0})}_.extend(xt),_.extend({deltaE:at}),Object.assign(_,{deltaEMethods:xt}),_.extend(Pr),_.extend({contrast:ar}),_.extend(nr),_.extend(Ii),_.extend(Br),_.extend(bt);function Vt(i){return i}function Z(i){return i*i*(3-2*i)}function Nt(i,t,e,r){return i*t+e*r}function ni(i,t,e,r){let a=[Math.round((i.r*t+e.r*r)*255),Math.round((i.g*t+e.g*r)*255),Math.round((i.b*t+e.b*r)*255)];return`rgb(${a[0]}, ${a[1]}, ${a[2]})`}function oi(i,t,e,r){return i.map((a,s)=>Nt(a,t,e[s],r))}function Lt(i){if(typeof i=="number")return Nt;if(typeof i=="string"){let t={};return(e,r,a,s)=>(t[e]||(t[e]=new _(e).srgb),t[a]||(t[a]=new _(a).srgb),ni(t[e],r,t[a],s))}else if(Array.isArray(i))return oi;return(t,e,r,a)=>e<1?t:r}function H(i,t=void 0){return t===void 0&&(t=Lt(i)),{finalValue:i,interpolate:(e,r)=>t(e,1-Math.min(r,1),i,Math.min(r,1))}}function Qr(i,t=void 0){return t===void 0&&(t=Lt(i())),{interpolate:(e,r)=>t(e,1-Math.min(r,1),i(),Math.min(r,1))}}function Kr(i,t=void 0){return t===void 0&&(t=Lt(i[0])),{interpolate:(e,r)=>{let a=Math.min(r,1)*(i.length-1)-1,s=Math.min(a-Math.floor(a),1);return a<0?t(e,1-s,i[0],s):t(i[Math.floor(a)],1-s,i[Math.floor(a)+1],s)}}}class z{constructor(t,e=1e3,r=Vt){this.duration=0,this.finalValue=void 0,this.interpolator=null,this.duration=e,t.hasOwnProperty("finalValue")?this.finalValue=t.finalValue:this.finalValue=void 0,this.interpolator=t,this.curve=r}evaluate(t,e){let r=this.curve(this.duration>0?e/this.duration:1);return this.interpolator.interpolate(t,r)}withDelay(t){return t?new ta(this,t):this}}class ta extends z{constructor(t,e){super(t.interpolator,t.duration+e,t.curve),this.delay=e}evaluate(t,e){return e<=this.delay?t:super.evaluate(t,(e-this.delay)*this.duration/(this.duration-this.delay))}}function ea(i,t=1e3,e=Vt){return new z(H(i),t,e)}var hi=(i=>(i.Waiting="waiting",i.Entering="entering",i.Visible="visible",i.Exiting="exiting",i.Completed="completed",i))(hi||{}),li=(i=>(i.Show="show",i.Hide="hide",i))(li||{});class ui{constructor(t={}){this.markStates=new Map,this.marksByID=new Map,this.queuedAnimations=new Map,this._flushTimer=null,this.animatingMarks=new Set,this.defer=!1,this.saveExitedMarks=!1,this._callbacks={initialize:t.initialize||(()=>{}),enter:t.enter||(()=>{}),exit:t.exit||(()=>{})}}setVisibleMarks(t){return t.forEach(e=>{this.markStates.set(e,"visible"),this.marksByID.set(e.id,e)}),this}configure(t={}){return this.defer=t.defer??this.defer,this.saveExitedMarks=t.saveExitedMarks??this.saveExitedMarks,this}onInitialize(t){this._callbacks.initialize=t||(()=>{})}onEnter(t){this._callbacks.enter=t||(()=>{})}onExit(t){this._callbacks.exit=t||(()=>{})}_perform(t,e){if(t){if(e=="show"){if(this.markStates.get(t)==="visible")return;this.markStates.set(t,"entering"),this.marksByID.set(t.id,t);let r=this._callbacks.enter(t);r&&r instanceof Promise?(this.animatingMarks.add(t),r.then(()=>{this.markStates.has(t)&&this.markStates.get(t)=="entering"&&(this.markStates.set(t,"visible"),this.animatingMarks.delete(t))},()=>{this.animatingMarks.delete(t)})):this.markStates.set(t,"visible")}else if(e=="hide"){let r=this.markStates.get(t)??null;if(r==="waiting"||r==="completed")return;this.markStates.set(t,"exiting"),this.marksByID.set(t.id,t);let a=this._callbacks.exit(t);a&&a instanceof Promise?(this.animatingMarks.add(t),a.then(()=>{this.markStates.has(t)&&this.markStates.get(t)=="exiting"&&(this.saveExitedMarks?this.markStates.set(t,"completed"):(this.marksByID.delete(t.id),this.markStates.delete(t),this.animatingMarks.delete(t)))},()=>{this.animatingMarks.delete(t)})):this.saveExitedMarks?this.markStates.set(t,"completed"):(this.marksByID.delete(t.id),this.markStates.delete(t))}}}_enqueue(t,e){let r=this.markStates.get(t);if(r===void 0)return!1;if(e=="show"){if(r=="entering"||r=="visible")return!1;this.markStates.set(t,"entering")}else if(e=="hide"){if(r=="exiting"||r=="completed")return!1;this.markStates.set(t,"exiting")}else console.error("Unknown action enqueued:",e);return this.defer?(this.queuedAnimations.set(t,e),this._flushTimer||(this._flushTimer=window.setTimeout(()=>this._flush(),0))):this._perform(t,e),!0}_flush(){this._flushTimer=null,this.queuedAnimations.forEach((t,e)=>{this._perform(e,t)}),this.queuedAnimations.clear()}show(t){return this.markStates.has(t)||(this._callbacks.initialize(t),this.markStates.set(t,"waiting"),this.marksByID.set(t.id,t)),this._enqueue(t,"show")}hide(t){return this.markStates.has(t)?this._enqueue(t,"hide"):!1}getMarkByID(t,e=!1){let r=this.marksByID.get(t);if(r&&e){let a=this.markStates.get(r);if(a==="exiting"||a==="completed")return}return r}forEach(t){let e=0;this.markStates.forEach((r,a)=>{(r==="entering"||r==="visible"||r==="exiting")&&(t(a,e),e++)})}getMarks(){return Array.from(this.markStates.keys())}count(){return this.markStates.size}getVisibleMarks(){return Array.from(this.markStates.keys()).filter(t=>["waiting","entering","visible"].includes(this.markStates.get(t)))}}function ci(i,t,e){return Object.fromEntries(Object.entries(i).map(([r,a])=>[r,typeof a=="function"?a(t,e):a]))}class Wt{constructor(t=[],e={animationDuration:1e3,animationCurve:Z}){this.timeProvider=null,this.marks=[],this.factory=null,this.lazyUpdates=!0,this.useStaging=!0,this.stage=null,this.animatingMarks=new Set,this.updatedMarks=new Set,this.preloadableProperties=new Set,this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!1,this._updateListeners={},this._eventListeners={},this.timeProvider=I(),this.lazyUpdates=!0,this._defaultDuration=1e3,this._defaultCurve=Z,this.configure(e),typeof t=="function"?this.factory=t:this.marks=t,this.marksByID=new Map,this.marks.forEach(r=>{if(this.marksByID.has(r.id)){console.error(`ID '${r.id}' is duplicated in mark render group`);return}this.marksByID.set(r.id,r),this._setupMark(r)}),this.stage&&this.stage.setVisibleMarks(this.marks)}configure(t){return t.timeProvider!==void 0&&(this.timeProvider=t.timeProvider),t.lazyUpdates!==void 0&&(this.lazyUpdates=t.lazyUpdates),t.animationDuration!==void 0&&(this._defaultDuration=t.animationDuration),t.animationCurve!==void 0&&(this._defaultCurve=t.animationCurve),this.marks&&this.getMarks().forEach(e=>this._configureMark(e)),this.useStaging=t.useStaging??this.useStaging,this.useStaging?(this.stage=new ui,this.marks&&this.stage.setVisibleMarks(this.marks)):this.stage=null,this}configureStaging(t,e=void 0){return this.useStaging||console.error("Can't configure staging without setting useStaging to true"),this.stage.onInitialize(t.initialize),this.stage.onEnter(t.enter),this.stage.onExit(t.exit),e&&this.stage.configure(e),this}_setupMark(t){this._configureMark(t),t.addListener((e,r,a)=>{this.updatedMarks.add(e),!this.preloadableProperties.has(r)&&a&&this.animatingMarks.add(e),this._changedLastTick=!0}),t.addGraphListener((e,r,a,s)=>{a.forEach(n=>{!s.includes(n)&&n.sourceMarks().length==1&&this.removeMark(n)}),s.forEach(n=>{a.includes(n)||this.addMark(n)})})}_configureMark(t){t.setTimeProvider(this.timeProvider),t.configure({animationDuration:this._defaultDuration,animationCurve:this._defaultCurve}),Object.entries(this._updateListeners).forEach(([e,r])=>t.onUpdate(e,r)),Object.entries(this._eventListeners).forEach(([e,r])=>t.onEvent(e,r))}onUpdate(t,e){return this._updateListeners[t]=e,this.getMarks().forEach(r=>r.onUpdate(t,e)),this}onEvent(t,e){return this._eventListeners[t]=e,this.getMarks().forEach(r=>r.onEvent(t,e)),this}dispatch(t,e=void 0){let r=this.getMarks().map(a=>a.dispatch(t,e)).filter(a=>a instanceof Promise);if(r.length>0)return new Promise((a,s)=>{Promise.all(r).then(()=>a()).catch(s)})}forceUpdate(){return this._forceUpdate=!0,this}currentTime(){return this.timeProvider()}getMarks(){return this.marks}registerPreloadableProperty(t){return this.preloadableProperties.add(t),this}advance(t){this.timeProvider.advance(t);let e=this.lazyUpdates?[...this.stage?this.stage.animatingMarks:[],...this.animatingMarks,...this.updatedMarks]:this.stage?this.stage.getMarks():this.getMarks();if(this.updatedMarks=new Set,e.length==0&&!this._forceUpdate&&!this._markListChanged)return this._changedLastTick=!1,!1;for(let r of e)r.advance()||this.animatingMarks.delete(r);return this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!0,!0}marksAnimating(){return this.animatingMarks.size>0}animateTo(t,e,r={}){return this.forEach((a,s)=>{a.animateTo(t,typeof e=="function"?e(a,s):e,ci(r,a,s))}),this}animate(t,e={}){return this.preloadableProperties.has(t)&&e.interpolator?(console.error("Cannot apply custom interpolator function on preloadable property."),this):(this.forEach((a,s)=>{let n=ci(e,a,s);a.animate(t,n)}),this)}update(t,e=void 0){return this.forEach((r,a)=>{r.setAttr(t,e===void 0?void 0:typeof e=="function"?e(r,a):e)}),this}wait(t,e=!0){return Promise.all(this.map(r=>r.wait(t,e)))}getMarkByID(t,e=!1){if(!this.marksByID.has(t)&&!e){let r;return this.useStaging&&(r=this.stage.getMarkByID(t)),!r&&this.factory&&(r=this.factory(t)),r}return this.marksByID.get(t)}forEach(t){this.getMarks().forEach(t)}map(t){return this.getMarks().map(t)}filter(t){let e=Object.assign({},this),r=this.getMarks().filter(t);return Object.keys(this).forEach(a=>{e[a]=this[a]}),e.marks=r,e.marksByID=new Map,r.forEach(a=>{e.marksByID.set(a.id,a)}),vi(this).forEach(a=>{a=="getMarks"?e[a]=()=>r:e[a]=(...s)=>{let n=this.getMarks(),o=this.marksByID;this.marks=r,this.marksByID=e.marksByID;let h=this[a](...s);return this.marks=n,this.marksByID=o,h===this?e:h}}),e}updateTransform(t){return this.getMarks().forEach(e=>e.updateTransform(t)),this}addMark(t){if(this.marksByID.has(t.id))return console.error("Attempted to add mark with ID that exists:",t.id),this;this.marks.push(t),this.marksByID.set(t.id,t),this._setupMark(t),this._markListChanged=!0,this.stage&&this.stage.show(t)}removeMark(t){let e=this.marks.indexOf(t);if(e<0)return console.warn("Attempted to remove mark that does not exist"),this;this.marks.splice(e,1),this.marksByID.delete(t.id),this._markListChanged=!0,this.stage&&this.stage.hide(t)}showID(t,e=void 0){let r=this.getMarkByID(t);return e&&e(r),this.has(t)?this.useStaging&&this.stage.show(r):this.addMark(r),this}hideID(t){return this.has(t)?(this.removeMark(this.getMarkByID(t)),this):this}has(t){return this.marksByID.has(t)}count(){return this.getMarks().length}changed(t=void 0){return t===void 0?this._changedLastTick:this._changedLastTick&&this.getMarks().some(e=>e.changed(t))}}function ia(i=[]){return new Wt(i)}const ra=5e3;class nt{constructor(t,e){this._timeProvider=null,this._listeners=[],this._graphListeners=[],this._defaultDuration=1e3,this._defaultCurve=Z,this._changedLastTick=!1,this._adjacency={},this._reverseAdjacency=new Set,this._updateListeners={},this._eventListeners={},this.framesWithUpdate=0,this.id=t,e===void 0&&console.error("Mark constructor requires an ID and an object defining attributes");let r={};Object.keys(e).forEach(a=>{let s=new k(Object.assign(Object.assign({},e[a]),{computeArg:this}));s.addListener((n,o)=>this._attributesChanged(a,o)),r[a]=s}),this.attributes=r}configure(t){return t.animationDuration!==void 0&&(this._defaultDuration=t.animationDuration),t.animationCurve!==void 0&&(this._defaultCurve=t.animationCurve),this}onUpdate(t,e){return this._updateListeners[t]=e,this}onEvent(t,e){return this._eventListeners[t]=e,this}dispatch(t,e=void 0){if(this._eventListeners[t])return this._eventListeners[t](this,e,t)}addListener(t){return this._listeners.push(t),this}removeListener(t){let e=this._listeners.indexOf(t);return e>=0&&(this._listeners=this._listeners.splice(e,1)),this}addGraphListener(t){return this._graphListeners.push(t),this}removeGraphListener(t){let e=this._graphListeners.indexOf(t);return e>=0&&(this._graphListeners=this._graphListeners.splice(e,1)),this}_attributesChanged(t,e){this._changedLastTick=!0,this._listeners.forEach(r=>r(this,t,e)),this._updateListeners[t]&&this._updateListeners[t](this,this.attributes[t].future())}setTimeProvider(t){return this._timeProvider=t,Object.values(this.attributes).forEach(e=>e.setTimeProvider(this._timeProvider)),this}advance(t=void 0){let e=!1;return Object.values(this.attributes).forEach(r=>{r.advance(t)&&(e=!0)}),e?(this.framesWithUpdate+=1,this.framesWithUpdate>ra&&console.warn("Marks are being updated excessively!"),this._changedLastTick=!0,!0):(this.framesWithUpdate=0,this._changedLastTick=!1,!1)}setAttr(t,e=void 0){let r=this.attributes[t];r===void 0&&console.error(`No attribute named '${String(t)}'`);let a=r.last();return e===void 0?r.compute():r.set(e),w(a,r.data())||this._listeners.forEach(s=>s(this,t,!1)),this}attr(t,e=!0){return this.attributes[t]||console.error(`No attribute named '${String(t)}'`),e?this.attributes[t].get():this.attributes[t].getUntransformed()}data(t){return this.attributes[t]===void 0&&console.error(`No attribute named '${String(t)}'`),this.attributes[t].data()}updateTransform(t){return this.attributes[t]===void 0&&console.error(`No attribute named '${String(t)}'`),this.attributes[t].updateTransform(),this}animateTo(t,e,r={}){if(!this.attributes.hasOwnProperty(t))return console.error(`No attribute named '${String(t)}'`),this;if(typeof e=="function")return this.attributes[t].set(e),this.animate(t,{duration:r.duration,curve:r.curve}),this;let a=r.duration===void 0?this._defaultDuration:r.duration,s=r.curve===void 0?this._defaultCurve:r.curve,n=new z(H(e),a,s).withDelay(r.delay||0);return this.attributes[t].animate(n),this}animate(t,e={}){if(!this.attributes.hasOwnProperty(t))return console.error(`Attempting to animate undefined property ${String(t)}`),this;let r;if(e instanceof z)r=e;else if(e.interpolator!==void 0){let a=e.interpolator;r=new z(a,e.duration!==void 0?e.duration:this._defaultDuration,e.curve!==void 0?e.curve:this._defaultCurve).withDelay(e.delay||0)}else{let a=this.data(t);if(!w(a,this.attributes[t].last())||!w(a,this.attributes[t].future())){let s=e.duration!==void 0?e.duration:this._defaultDuration,n=e.curve!==void 0?e.curve:this._defaultCurve;r=new z(H(a),s,n).withDelay(e.delay||0)}else return this}return this.attributes[t].animate(r),this}wait(t,e=!0){let r=Array.isArray(t)?t:[t];return Promise.all(r.map(a=>this.attributes[a].wait(e)))}changed(t=void 0){return t===void 0?this._changedLastTick:Array.isArray(t)?this._changedLastTick&&t.some(e=>this.attributes[e].changed()):this._changedLastTick&&this.attributes[t].changed()}copy(t,e={}){return new nt(t,{...this.attributes,...Object.fromEntries(Object.entries(e).map(([r,a])=>a instanceof k?[r,a]:typeof a=="function"?[r,this.attributes[r].copy({valueFn:a})]:[r,this.attributes[r].copy({value:a})]))})}adj(t,e=void 0){if(e!==void 0){let r=this._adjacency[t]??new Set;this._graphListeners.forEach(a=>a(this,t,Array.from(r),e)),r.forEach(a=>a._removeEdgeFrom(this)),this._adjacency[t]=new Set(e),e.forEach(a=>a._addEdgeFrom(this));return}return Array.from(this._adjacency[t]??new Set)}sourceMarks(){return Array.from(this._reverseAdjacency)}_addEdgeFrom(t){return this._reverseAdjacency.add(t),this}_removeEdgeFrom(t){return this._reverseAdjacency.delete(t),this}}class aa{constructor(t){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof t.advance=="function"?this.toAdvance=[t]:this.toAdvance=t,this.start()}onChange(t){return this._callbacks.push(t),this}start(){return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(t=>t()),requestAnimationFrame(t=>this.tick(t)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(t){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(e=>e.advance(t-this._lastTick)).some(e=>e)&&this._callbacks.forEach(e=>e()),this.stopped||requestAnimationFrame(e=>this.tick(e)),this._lastTick=t}}class sa{constructor(t){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof t.advance=="function"?this.toAdvance=[t]:this.toAdvance=t,this.start()}onChange(t){return this._callbacks.push(t),this}start(){if(this.stopped)return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(t=>t()),requestAnimationFrame(t=>this.tick(t)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(t){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(e=>e.advance(t-this._lastTick)).some(e=>e)?(this._callbacks.forEach(e=>e()),this.stopped||requestAnimationFrame(e=>this.tick(e)),this._lastTick=t):this.stop()}}function At(i,t,e){e>0?(i[0].animate(new z(H(t[0]),e,Z)),i[1].animate(new z(H(t[1]),e,Z))):(i[0].set(t[0]),i[1].set(t[1]))}class na{constructor(t={}){this.animationDuration=1e3,this.squareAspect=!0,this._xDomain=[new k(0),new k(1)],this._yDomain=[new k(0),new k(1)],this._xRange=[new k(0),new k(1)],this._yRange=[new k(0),new k(1)],this._xScaleFactor=new k(1),this._yScaleFactor=new k(1),this._translateX=new k(0),this._translateY=new k(0),this._calculatingTransform=!1,this.timeProvider=I(),this.controller=null,this._updatedNoAdvance=!1,this.listeners=[],this.xScale=Object.assign(e=>((e-this.xDomain()[0])*this.xRSpan()/this.xDSpan()+this.xRange()[0])*this._xScaleFactor.get()+this._translateX.get(),{domain:()=>{let e=this.xRange();return[this.xScale.invert(e[0]),this.xScale.invert(e[1])]},range:()=>[this._xRange[0].get(),this._xRange[1].get()],invert:e=>((e-this._translateX.get())/this._xScaleFactor.get()-this.xRange()[0])*this.xDSpan()/this.xRSpan()+this.xDomain()[0]}),this.yScale=Object.assign(e=>((e-this.yDomain()[0])*this.yRSpan()/this.yDSpan()+this.yRange()[0])*this._yScaleFactor.get()+this._translateY.get(),{domain:()=>{let e=this.yRange();return[this.yScale.invert(e[0]),this.yScale.invert(e[1])]},range:()=>[this._yRange[0].get(),this._yRange[1].get()],invert:e=>((e-this._translateY.get())/this._yScaleFactor.get()-this.yRange()[0])*this.yDSpan()/this.yRSpan()+this.yDomain()[0]}),this.xDomain([0,1]),this.yDomain([0,1]),this.xRange([0,1]),this.yRange([0,1]),this.configure(t),this._xScaleFactor.setTimeProvider(this.timeProvider),this._yScaleFactor.setTimeProvider(this.timeProvider),this._translateX.setTimeProvider(this.timeProvider),this._translateY.setTimeProvider(this.timeProvider)}configure(t={}){return this.animationDuration=t.animationDuration!==void 0?t.animationDuration:1e3,this.minScale=t.minScale!==void 0?t.minScale:.1,this.maxScale=t.maxScale!==void 0?t.maxScale:14,this}xDomain(t=void 0,e=!1){return t===void 0?[this._xDomain[0].get(),this._xDomain[1].get()]:(At(this._xDomain,t,e?this.animationDuration:0),this)}yDomain(t=void 0,e=!1){return t===void 0?[this._yDomain[0].get(),this._yDomain[1].get()]:(At(this._yDomain,t,e?this.animationDuration:0),this)}xRange(t=void 0,e=!1){return t===void 0?[this._xRange[0].get(),this._xRange[1].get()]:(At(this._xRange,t,e?this.animationDuration:0),this)}yRange(t=void 0,e=!1){return t===void 0?[this._yRange[0].get(),this._yRange[1].get()]:(At(this._yRange,t,e?this.animationDuration:0),this)}xDSpan(){return this._xDomain[1].get()-this._xDomain[0].get()}yDSpan(){return this._yDomain[1].get()-this._yDomain[0].get()}xRSpan(){return this._xRange[1].get()-this._xRange[0].get()}yRSpan(){return this._yRange[1].get()-this._yRange[0].get()}makeSquareAspect(){let t=this.xRSpan()/this.xDSpan(),e=this.yRSpan()/this.yDSpan(),r=this.yDomain(),a=this.xDomain();if(t<e){let s=(r[0]+r[1])*.5,n=this.yRSpan()/t;this.yDomain([s-n*.5,s+n*.5])}else{let s=(a[0]+a[1])*.5,n=this.xRSpan()/e;this.xDomain([s-n*.5,s+n*.5])}return this}onUpdate(t){return this.listeners.push(t),this}isNeutral(){return Math.abs(this._xScaleFactor.get()-1)<=.01&&Math.abs(this._yScaleFactor.get()-1)<=.01&&Math.abs(this._translateX.get())<=5&&Math.abs(this._translateY.get())<=5}advance(t=void 0){return this.timeProvider.advance(t),[this._xDomain[0].advance(t),this._xDomain[1].advance(t),this._yDomain[0].advance(t),this._yDomain[1].advance(t),this._xRange[0].advance(t),this._xRange[1].advance(t),this._yRange[0].advance(t),this._yRange[1].advance(t),this._xScaleFactor.advance(t),this._yScaleFactor.advance(t),this._translateX.advance(t),this._translateY.advance(t)].some(r=>r)?(this._updatedNoAdvance=!1,this.listeners.forEach(r=>r(this)),!0):(this._updatedNoAdvance||(this.listeners.forEach(r=>r(this)),this._updatedNoAdvance=!0),!1)}scaleBy(t,e=null){this.unfollow();let r=this._translateX.get(),a=this._translateY.get(),s=this._xScaleFactor.get(),n=this._yScaleFactor.get();e?e=[(e[0]-r)/s,(e[1]-a)/n]:e=[(this.xRange[0]+this.xRange[1])*.5,(this.yRange[0]+this.yRange[1])*.5];let o=typeof t=="number"?t:t[0],h=typeof t=="number"?t:t[1],l=s+o;return l<=this.maxScale&&l>=this.minScale&&(this._xScaleFactor.set(l),this._translateX.set(r-o*e[0])),l=n+h,l<=this.maxScale&&l>=this.minScale&&(this._yScaleFactor.set(l),this._translateY.set(a-h*e[1])),this}translateBy(t,e){return this.unfollow(),this._translateX.set(this._translateX.get()+t),this._translateY.set(this._translateY.get()+e),this}transform(t=void 0,e=!1){if(t!==void 0){if(this.unfollow(),e){let r=a=>new z(H(a),this.animationDuration,Z);t.kx!==void 0?this._xScaleFactor.animate(r(t.kx)):t.k!==void 0&&this._xScaleFactor.animate(r(t.k)),t.ky!==void 0?this._yScaleFactor.animate(r(t.ky)):t.k!==void 0&&this._yScaleFactor.animate(r(t.k)),t.x!==void 0&&this._translateX.animate(r(t.x)),t.y!==void 0&&this._translateY.animate(r(t.y))}else t.kx!==void 0?this._xScaleFactor.set(t.kx):t.k!==void 0&&this._xScaleFactor.set(t.k),t.ky!==void 0?this._yScaleFactor.set(t.ky):t.k!==void 0&&this._yScaleFactor.set(t.k),t.x!==void 0&&this._translateX.set(t.x),t.y!==void 0&&this._translateY.set(t.y);return this}else{let r=this._xScaleFactor.last(),a=this._yScaleFactor.last();return{k:(r+a)*.5,kx:r,ky:a,x:this._translateX.last(),y:this._translateY.last()}}}reset(t=!1){return this.transform({k:1,x:0,y:0},t)}zoomTo(t,e=!0){return this.transform(t.transform(this),e)}_calculateControllerTransform(){this._calculatingTransform=!0;let t=this.controller.transform(this);return this._calculatingTransform=!1,t}follow(t,e=!0){if(this.controller=t,this._xScaleFactor.set(()=>{if(this._calculatingTransform)return this._xScaleFactor.last();let r=this._calculateControllerTransform();return r.kx||r.k}),this._yScaleFactor.set(()=>{if(this._calculatingTransform)return this._yScaleFactor.last();let r=this._calculateControllerTransform();return r.ky||r.k}),this._translateX.set(()=>this._calculatingTransform?this._translateX.last():this._calculateControllerTransform().x),this._translateY.set(()=>this._calculatingTransform?this._translateY.last():this._calculateControllerTransform().y),e){let r=a=>new z(H(a),this.animationDuration,Z);this._xScaleFactor.animate(r(this._xScaleFactor.data())),this._yScaleFactor.animate(r(this._yScaleFactor.data())),this._translateX.animate(r(this._translateX.data())),this._translateY.animate(r(this._translateY.data()))}return this}unfollow(){return this.controller!=null&&(this._xScaleFactor.set(this._xScaleFactor.get()),this._yScaleFactor.set(this._yScaleFactor.get()),this._translateX.set(this._translateX.get()),this._translateY.set(this._translateY.get())),this.controller=null,this}wait(t=!0){return Promise.all([...this._xDomain,...this._yDomain,...this._xRange,...this._yRange,this._xScaleFactor,this._yScaleFactor,this._translateX,this._translateY].map(e=>e.wait(t)))}}class Jt{constructor(t,e={}){this.lastCompute=void 0,this.marks=t,this.centerMark=e.centerMark!==void 0?e.centerMark:void 0,this.centerMark&&!this.marks.includes(this.centerMark)&&(this.marks=[...this.marks,this.centerMark]),this.xAttr=e.xAttr!==void 0?e.xAttr:"x",this.yAttr=e.yAttr!==void 0?e.yAttr:"y",this.padding=e.padding!==void 0?e.padding:20,this.transformCoordinates=e.transformCoordinates??!1,this.inverseTransformCoordinates=e.inverseTransformCoordinates??!1}transform(t){if(this.lastCompute&&this.lastCompute.scales===t&&this.lastCompute.time==t.timeProvider())return this.lastCompute.result;let e=this.marks.map(S=>this._getMarkLocation(t,S)),r,a,s,n,o=this.centerMark!==void 0?this._getMarkLocation(t,this.centerMark):null,h=t.transform(),{x:l,y:u}=wi(e);if(o){let S=Math.max(l[1]-o.x,o.x-l[0]),x=Math.max(u[1]-o.y,o.y-u[0]);l=[o.x-S,o.x+S],u=[o.y-x,o.y+x]}let c,d;Math.abs(l[1]-l[0])>0?c=(Math.abs(t.xRSpan())-this.padding*2)/(l[1]-l[0])/(Math.abs(t.xRSpan())/Math.abs(t.xDSpan())):c=h.kx,Math.abs(u[1]-u[0])>0?d=(Math.abs(t.yRSpan())-this.padding*2)/(u[1]-u[0])/(Math.abs(t.yRSpan())/Math.abs(t.yDSpan())):d=h.ky;let g=h.ky/h.kx;c=Math.min(c,t.maxScale),d=Math.min(d,t.maxScale),d<c*g?(s=d/g,n=d):(s=c,n=c*g),r=(l[0]+l[1])*.5,a=(u[0]+u[1])*.5,r=(r-t.xDomain()[0])*t.xRSpan()/t.xDSpan()+t.xRange()[0],a=(a-t.yDomain()[0])*t.yRSpan()/t.yDSpan()+t.yRange()[0];let y=-r*s+(t.xRange()[0]+t.xRange()[1])*.5,M=-a*n+(t.yRange()[0]+t.yRange()[1])*.5,b={kx:s,ky:n,x:y,y:M};return this.lastCompute={scales:t,time:t.timeProvider(),result:b},b}_getMarkLocation(t,e){let r={x:e.attr(this.xAttr,this.transformCoordinates),y:e.attr(this.yAttr,this.transformCoordinates)};return this.inverseTransformCoordinates&&(r={x:t.xScale.invert(r.x),y:t.yScale.invert(r.y)}),r}}function oa(i,t={}){return new Jt([i],{centerMark:i,...t})}function ha(i,t={}){return new Jt(i,{...t})}class la{constructor(t={}){this.markCollections=[],this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this._avgMarksPerBin=null,this._coordinateAttributes=t.coordinateAttributes??["x","y"],this._transformCoordinates=t.transformCoordinates??!0,this._avgMarksPerBin=t.marksPerBin??null}add(t){return this.markCollections.push(t),this}remove(t){let e=this.markCollections.indexOf(t);return e<0&&console.error("Tried to remove mark collection which does not exist:",t),this.markCollections.splice(e,1),this}invalidate(){return this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this}compute(){return console.log("computing interaction map"),this._extents=new Array(this._coordinateAttributes.length).fill([1e12,-1e12]),this._numMarks=0,this._forEachMark(t=>{this._coordinateAttributes.forEach((e,r)=>{let a=t.attr(e,this._transformCoordinates);a<this._extents[r][0]&&(this._extents[r][0]=a),a>this._extents[r][1]&&(this._extents[r][1]=a)}),this._numMarks+=1}),this._numMarks==0?this:(this._numBins=Math.round(this._numMarks/(this._avgMarksPerBin??Math.min(Math.max(1,this._numMarks/100),10))),this._binSizes=this._extents.map(t=>Math.ceil((t[1]-t[0])/this._numBins)),this._positionMap=new Map,this._forEachMark(t=>{let e=this._coordinateAttributes.map(a=>t.attr(a,this._transformCoordinates)),r=this._getPositionID(e);this._positionMap.has(r)?this._positionMap.get(r).push(t):this._positionMap.set(r,[t])}),this)}_forEachMark(t){this.markCollections.forEach(e=>{if(e instanceof Wt)e.forEach(t);else if(e instanceof nt)t(e);else if(typeof e.forEach=="function")e.forEach(t);else if(typeof e=="function"){let r=e();r instanceof nt?t(r):r.forEach(t)}else console.error("Unrecognized mark collection type in position map:",e)})}_getPositionID(t){return(this._numBins===null||!this._extents||!this._binSizes)&&console.error("Cannot hash position without computing first"),t.length!=this._coordinateAttributes.length&&console.error(`Need exactly ${this._coordinateAttributes.length} coordinates, got ${t.length}`),t.reduce((e,r,a)=>e*this._numBins+Math.floor((r-this._extents[a][0])/this._binSizes[a]),0)}marksNear(t,e,r=!0){if(this._positionMap||this.compute(),this._numMarks==0)return[];let a=this._recursiveBinWalk(t,e);return r?a.map(n=>{let o=this._coordinateAttributes.map(h=>n.attr(h,this._transformCoordinates));return[n,Math.sqrt(o.reduce((h,l,u)=>h+(l-t[u])*(l-t[u]),0))]}).filter(([n,o])=>o<=e).sort((n,o)=>n[1]-o[1]).map(([n,o])=>n):a}_recursiveBinWalk(t,e,r=[]){let a=r.length;if(a==t.length)return this._positionMap.get(this._getPositionID(r))??[];let s=Math.ceil(e/this._binSizes[a]),n=new Array(s*2+1).fill(0).map((h,l)=>(l-s)*this._binSizes[a]+t[a]),o=[];return n.forEach(h=>{o=[...o,...this._recursiveBinWalk(t,e,[...r,h])]}),o}}var di=(i=>(i.none="no-preference",i.more="more",i.less="less",i))(di||{}),fi=(i=>(i.light="light",i.dark="dark",i))(fi||{});class mi{constructor(){this._hasChanged=!1;let t=window.matchMedia("(prefers-reduced-motion: reduce)");this._prefersReducedMotion=t.matches,t.addEventListener("change",h=>this._handleMotion(h));let e=window.matchMedia("(prefers-reduced-transparency: reduce)");this._prefersReducedTransparency=e.matches,e.addEventListener("change",h=>this._handleTransparency(h));let r=window.matchMedia("(prefers-contrast: none)");this._contrastPreference="no-preference",r.addEventListener("change",h=>this._handleContrastNone(h));let a=window.matchMedia("(prefers-contrast: more)");a.matches&&(this._contrastPreference="more"),a.addEventListener("change",h=>this._handleContrastMore(h));let s=window.matchMedia("(prefers-contrast: less)");a.matches&&(this._contrastPreference="less"),s.addEventListener("change",h=>this._handleContrastLess(h));let n=window.matchMedia("(prefers-color-scheme: light)");this._colorSchemePreference="light",n.addEventListener("change",h=>this._handleColorSchemeLight(h));let o=window.matchMedia("(prefers-color-scheme: dark)");o.matches&&(this._colorSchemePreference="dark"),o.addEventListener("change",h=>this._handleColorSchemeDark(h))}_handleMotion(t){this._prefersReducedMotion=t.matches,this._hasChanged=!0}_handleTransparency(t){this._prefersReducedTransparency=t.matches,this._hasChanged=!0}_handleContrastMore(t){t.matches&&(this._contrastPreference="more"),this._hasChanged=!0}_handleContrastLess(t){t.matches&&(this._contrastPreference="less"),this._hasChanged=!0}_handleContrastNone(t){t.matches&&(this._contrastPreference="no-preference"),this._hasChanged=!0}_handleColorSchemeLight(t){t.matches&&(this._colorSchemePreference="light"),this._hasChanged=!0}_handleColorSchemeDark(t){t.matches&&(this._colorSchemePreference="dark"),this._hasChanged=!0}get prefersReducedMotion(){return this._prefersReducedMotion}get prefersReducedTransparency(){return this._prefersReducedTransparency}get contrastPreference(){return this._contrastPreference}get colorSchemePreference(){return this._colorSchemePreference}advance(t){return this._hasChanged?(this._hasChanged=!1,!0):!1}}let Qt;function ua(){return Qt||(Qt=new mi),Qt}m.Animator=z,m.Attribute=k,m.AttributeRecompute=ee,m.ColorSchemePreference=fi,m.ContrastPreference=di,m.LazyTicker=sa,m.Mark=nt,m.MarkFollower=Jt,m.MarkRenderGroup=Wt,m.PositionMap=la,m.RenderContext=mi,m.Scales=na,m.StageManager=ui,m.StagingAction=li,m.StagingState=hi,m.Ticker=aa,m.autoMixingFunction=Lt,m.basicAnimationTo=ea,m.centerOn=oa,m.colorMixingFunction=ni,m.createRenderGroup=ia,m.curveEaseInOut=Z,m.curveLinear=Vt,m.getRenderContext=ua,m.interpolateAlongPath=Kr,m.interpolateTo=H,m.interpolateToFunction=Qr,m.markBox=ha,m.numericalArrayMixingFunction=oi,m.numericalMixingFunction=Nt,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
