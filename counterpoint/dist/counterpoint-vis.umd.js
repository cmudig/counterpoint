(function(m,w){typeof exports=="object"&&typeof module<"u"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(m=typeof globalThis<"u"?globalThis:m||self,w(m["counterpoint-vis"]={}))})(this,function(m){"use strict";var pa=Object.defineProperty;var _a=(m,w,X)=>w in m?pa(m,w,{enumerable:!0,configurable:!0,writable:!0,value:X}):m[w]=X;var Ke=(m,w,X)=>(_a(m,typeof w!="symbol"?w+"":w,X),X);function w(i,e){return typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=.001:i==e}function X(){var i=0;return Object.assign(function(){return i},{advance:t=>{i+=t}})}function vi(i){let e=new Set;for(;i=Reflect.getPrototypeOf(i);)Reflect.ownKeys(i).forEach(r=>e.add(r));return e}class ki{constructor(e=void 0){this.info=e,this.promise=new Promise((t,r)=>{this.reject=r,this.resolve=t})}}function wi(i){let e=1e12,t=-1e12,r=1e12,a=-1e12;return i.forEach(s=>{s.x<e&&(e=s.x),s.x>t&&(t=s.x),s.y<r&&(r=s.y),s.y>a&&(a=s.y)}),{x:[e,t],y:[r,a]}}var et=(i=>(i[i.DEFAULT=0]="DEFAULT",i[i.ALWAYS=1]="ALWAYS",i[i.WHEN_UPDATED=2]="WHEN_UPDATED",i))(et||{});class M{constructor(e){if(this.valueFn=void 0,this.transform=void 0,this.cacheTransform=!1,this._cachedValue=null,this.computeArg=void 0,this.recompute=0,this.needsUpdate=!1,this.animation=null,this.label=null,this._computedValue=null,this._lastTickValue=void 0,this._animatedValue=null,this._hasComputed=!1,this._timeProvider=null,this.currentTime=0,this._changedLastTick=!1,this._listeners=[],this._animationCompleteCallbacks=[],e==null||e==null||!(e.hasOwnProperty("value")||e.hasOwnProperty("valueFn")))typeof e=="function"?this.valueFn=e:this.value=e;else{let t=e;t.valueFn!==void 0?this.valueFn=t.valueFn:t.value!==void 0?this.value=t.value:console.error("One of `value` or `valueFn` must be defined to create an Attribute"),this.transform=t.transform??null,this.cacheTransform=t.cacheTransform??!1,this._cachedValue=null,this.computeArg=t.computeArg??null,this.recompute=t.recompute??0}}copy(e={}){let t={...this,...e};return e.value!==void 0&&(t.valueFn=void 0),e.valueFn!==void 0&&(t.value=void 0),new M(t)}addListener(e){this._listeners.push(e)}removeListener(e){let t=this._listeners.indexOf(e);t>=0&&(this._listeners=this._listeners.splice(t,1))}setTimeProvider(e){this._timeProvider=e}_getComputeArg(){return this.computeArg!==void 0?this.computeArg:this}compute(){this.valueFn&&(this._computedValue=this.valueFn(this._getComputeArg()))}advance(e=void 0){return(this.animation!=null||this.needsUpdate||this.valueFn)&&(this._timeProvider===null?this.currentTime+=e:this.currentTime=this._timeProvider()),this.animation==null&&this._animationCompleteCallbacks.length>0&&(console.warn("Found animation-complete callbacks for a non-existent animation"),this._cleanUpAnimation(!0)),this._lastTickValue=this.getUntransformed(),this.animation!=null||this.needsUpdate?(this.needsUpdate=!1,this._changedLastTick=!0,!0):(this._changedLastTick=!1,!1)}_computeAnimation(e=!0){if(!this.animation)return;this._timeProvider&&(this.currentTime=this._timeProvider());let{animator:t,start:r,initial:a}=this.animation,s=t.evaluate(a,Math.min(this.currentTime-r,t.duration));this._animationFinished()&&e?(this.valueFn?this.compute():this.value=s,this._cleanUpAnimation(!1),this._animatedValue=null):this._animatedValue=s}_animationFinished(){return this.animation?this.animation.animator.duration+20<=this.currentTime-this.animation.start:!0}_performTransform(e){let t;if(this.transform){let r=this._cachedValue;if(r&&w(r.raw,e))t=r.result;else{let a=e;t=this.transform(e,this._getComputeArg()),this.cacheTransform&&(this._cachedValue={raw:a,result:t})}}else t=e;return t}_cleanUpAnimation(e=!1){this.animation=null,this._animationCompleteCallbacks.forEach(t=>{!e||!t.info.rejectOnCancel?t.resolve(this):t.reject({newValue:this.last()})}),this._animationCompleteCallbacks=[]}get(){return this._performTransform(this.getUntransformed())}getUntransformed(){this._computeAnimation();let e;return this._animatedValue!=null?e=this._animatedValue:this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),e=this._computedValue):e=this.value,this._lastTickValue===void 0&&(this._lastTickValue=e),e}getPreload(e=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let r=this.get();return{start:r,end:r,startTime:e||this.currentTime,endTime:e||this.currentTime}}let t=this.getPreloadUntransformed(e);return{start:this._performTransform(t.start),end:this._performTransform(t.end),startTime:t.startTime,endTime:t.endTime}}getPreloadUntransformed(e=null){if(this._timeProvider&&(this.currentTime=this._timeProvider()),!this.animation){let s=this.getUntransformed();return{start:s,end:s,startTime:e||this.currentTime,endTime:e||this.currentTime}}if(this._animationFinished())return this._computeAnimation(),this.getPreloadUntransformed(e);let t;this.valueFn?((this.recompute!==2||!this._hasComputed)&&(this.compute(),this._hasComputed=!0),t=this._computedValue):t=this.value;let r=this.animation.animator.finalValue;r===void 0&&console.error("Animations on preloadable attributes must have a final value");let a=(e||this.currentTime)-this.currentTime;return{start:t,end:r,startTime:this.animation.start+a,endTime:this.animation.start+this.animation.animator.duration+a}}set(e){typeof e=="function"?(this.value!=null&&(this._computedValue=this.value),this.valueFn=e,this.value=void 0,this._animatedValue=null,this._lastTickValue=void 0):(this.value=e,this.valueFn=null,this._animatedValue=null,this._lastTickValue=e),this.needsUpdate=!0,this.animation&&this._cleanUpAnimation(!0),this._listeners.forEach(t=>t(this,!1))}data(){return this.valueFn?this.valueFn(this._getComputeArg()):this.value}last(){return this.animation&&this._computeAnimation(!1),this._lastTickValue!==void 0?this._lastTickValue:this._animatedValue!=null?this._animatedValue:this.value!==void 0?this.value:this._computedValue}future(){return this.animation?this.animation.animator.finalValue:this._animatedValue!=null?this._animatedValue:this.value!==void 0?this.value:this._computedValue}updateTransform(){this._cachedValue=null}animating(){return this.animation!=null}animate(e){return this._timeProvider&&(this.currentTime=this._timeProvider()),this.animation&&(this.valueFn?this._computedValue=this._animatedValue:this.value=this._animatedValue,this._cleanUpAnimation(!0)),this.animation={animator:e,initial:this.last(),start:this.currentTime},this._computeAnimation(),this._listeners.forEach(t=>t(this,!0)),this}wait(e=!0){if(!this.animation)return new Promise((r,a)=>r(this));let t=new ki({rejectOnCancel:e});return this._animationCompleteCallbacks.push(t),t.promise}changed(){return this._changedLastTick}}function k(i,e){let t=i.length;Array.isArray(i[0])||(i=[i]),Array.isArray(e[0])||(e=e.map(n=>[n]));let r=e[0].length,a=e[0].map((n,o)=>e.map(h=>h[o])),s=i.map(n=>a.map(o=>{let h=0;if(!Array.isArray(n)){for(let l of o)h+=n*l;return h}for(let l=0;l<n.length;l++)h+=n[l]*(o[l]||0);return h}));return t===1&&(s=s[0]),r===1?s.map(n=>n[0]):s}function K(i){return j(i)==="string"}function j(i){return(Object.prototype.toString.call(i).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function ue(i,e){i=+i,e=+e;let t=(Math.floor(i)+"").length;if(e>t)return+i.toFixed(e-t);{let r=10**(t-e);return Math.round(i/r)*r}}function tt(i){if(!i)return;i=i.trim();const e=/^([a-z]+)\((.+?)\)$/i,t=/^-?[\d.]+$/;let r=i.match(e);if(r){let a=[];return r[2].replace(/\/?\s*([-\w.]+(?:%|deg)?)/g,(s,n)=>{/%$/.test(n)?(n=new Number(n.slice(0,-1)/100),n.type="<percentage>"):/deg$/.test(n)?(n=new Number(+n.slice(0,-3)),n.type="<angle>",n.unit="deg"):t.test(n)&&(n=new Number(n),n.type="<number>"),s.startsWith("/")&&(n=n instanceof Number?n:new Number(n),n.alpha=!0),a.push(n)}),{name:r[1].toLowerCase(),rawName:r[1],rawArgs:r[2],args:a}}}function it(i){return i[i.length-1]}function ce(i,e,t){return isNaN(i)?e:isNaN(e)?i:i+(e-i)*t}function rt(i,e,t){return(t-i)/(e-i)}function Pe(i,e,t){return ce(e[0],e[1],rt(i[0],i[1],t))}function at(i){return i.map(e=>e.split("|").map(t=>{t=t.trim();let r=t.match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(r){let a=new String(r[1]);return a.range=[+r[2],+r[3]],a}return t}))}var Si=Object.freeze({__proto__:null,interpolate:ce,interpolateInv:rt,isString:K,last:it,mapRange:Pe,multiplyMatrices:k,parseCoordGrammar:at,parseFunction:tt,toPrecision:ue,type:j});class xi{add(e,t,r){if(typeof arguments[0]!="string"){for(var e in arguments[0])this.add(e,arguments[0][e],arguments[1]);return}(Array.isArray(e)?e:[e]).forEach(function(a){this[a]=this[a]||[],t&&this[a][r?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(r){r.call(t&&t.context?t.context:t,t)})}}const I=new xi;var Y={gamut_mapping:"lch.c",precision:5,deltaE:"76"};const B={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function Re(i){return Array.isArray(i)?i:B[i]}function de(i,e,t,r={}){if(i=Re(i),e=Re(e),!i||!e)throw new TypeError(`Missing white point to convert ${i?"":"from"}${!i&&!e?"/":""}${e?"":"to"}`);if(i===e)return t;let a={W1:i,W2:e,XYZ:t,options:r};if(I.run("chromatic-adaptation-start",a),a.M||(a.W1===B.D65&&a.W2===B.D50?a.M=[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]]:a.W1===B.D50&&a.W2===B.D65&&(a.M=[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]])),I.run("chromatic-adaptation-end",a),a.M)return k(a.M,a.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}const Ci=75e-6,L=class L{constructor(e){var a,s,n;this.id=e.id,this.name=e.name,this.base=e.base?L.get(e.base):null,this.aliases=e.aliases,this.base&&(this.fromBase=e.fromBase,this.toBase=e.toBase);let t=e.coords??this.base.coords;for(let o in t)"name"in t[o]||(t[o].name=o);this.coords=t;let r=e.white??this.base.white??"D65";this.white=Re(r),this.formats=e.formats??{};for(let o in this.formats){let h=this.formats[o];h.type||(h.type="function"),h.name||(h.name=o)}e.cssId&&!((a=this.formats.functions)!=null&&a.color)?(this.formats.color={id:e.cssId},Object.defineProperty(this,"cssId",{value:e.cssId})):(s=this.formats)!=null&&s.color&&!((n=this.formats)!=null&&n.color.id)&&(this.formats.color.id=this.id),this.referred=e.referred,Object.defineProperty(this,"path",{value:Ti(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),I.run("colorspace-init-end",this)}inGamut(e,{epsilon:t=Ci}={}){if(this.isPolar)return e=this.toBase(e),this.base.inGamut(e,{epsilon:t});let r=Object.values(this.coords);return e.every((a,s)=>{let n=r[s];if(n.type!=="angle"&&n.range){if(Number.isNaN(a))return!0;let[o,h]=n.range;return(o===void 0||a>=o-t)&&(h===void 0||a<=h+t)}return!0})}get cssId(){var e,t;return((t=(e=this.formats.functions)==null?void 0:e.color)==null?void 0:t.id)||this.id}get isPolar(){for(let e in this.coords)if(this.coords[e].type==="angle")return!0;return!1}getFormat(e){if(typeof e=="object")return e=st(e,this),e;let t;return e==="default"?t=Object.values(this.formats)[0]:t=this.formats[e],t?(t=st(t,this),t):null}equals(e){return e?this===e||this.id===e.id:!1}to(e,t){if(arguments.length===1&&([e,t]=[e.space,e.coords]),e=L.get(e),this.equals(e))return t;t=t.map(o=>Number.isNaN(o)?0:o);let r=this.path,a=e.path,s,n;for(let o=0;o<r.length&&r[o].equals(a[o]);o++)s=r[o],n=o;if(!s)throw new Error(`Cannot convert between color spaces ${this} and ${e}: no connection space was found`);for(let o=r.length-1;o>n;o--)t=r[o].toBase(t);for(let o=n+1;o<a.length;o++)t=a[o].fromBase(t);return t}from(e,t){return arguments.length===1&&([e,t]=[e.space,e.coords]),e=L.get(e),e.to(this,t)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let e=[];for(let t in this.coords){let r=this.coords[t],a=r.range||r.refRange;e.push((a==null?void 0:a.min)??0)}return e}static get all(){return[...new Set(Object.values(L.registry))]}static register(e,t){if(arguments.length===1&&(t=arguments[0],e=t.id),t=this.get(t),this.registry[e]&&this.registry[e]!==t)throw new Error(`Duplicate color space registration: '${e}'`);if(this.registry[e]=t,arguments.length===1&&t.aliases)for(let r of t.aliases)this.register(r,t);return t}static get(e,...t){if(!e||e instanceof L)return e;if(j(e)==="string"){let a=L.registry[e.toLowerCase()];if(!a)throw new TypeError(`No color space found with id = "${e}"`);return a}if(t.length)return L.get(...t);throw new TypeError(`${e} is not a valid color space`)}static resolveCoord(e,t){var h;let r=j(e),a,s;if(r==="string"?e.includes(".")?[a,s]=e.split("."):[a,s]=[,e]:Array.isArray(e)?[a,s]=e:(a=e.space,s=e.coordId),a=L.get(a),a||(a=t),!a)throw new TypeError(`Cannot resolve coordinate reference ${e}: No color space specified and relative references are not allowed here`);if(r=j(s),r==="number"||r==="string"&&s>=0){let l=Object.entries(a.coords)[s];if(l)return{space:a,id:l[0],index:s,...l[1]}}a=L.get(a);let n=s.toLowerCase(),o=0;for(let l in a.coords){let u=a.coords[l];if(l.toLowerCase()===n||((h=u.name)==null?void 0:h.toLowerCase())===n)return{space:a,id:l,index:o,...u};o++}throw new TypeError(`No "${s}" coordinate found in ${a.name}. Its coordinates are: ${Object.keys(a.coords).join(", ")}`)}};Ke(L,"registry",{}),Ke(L,"DEFAULT_FORMAT",{type:"functions",name:"color"});let f=L;function Ti(i){let e=[i];for(let t=i;t=t.base;)e.push(t);return e}function st(i,{coords:e}={}){if(i.coords&&!i.coordGrammar){i.type||(i.type="function"),i.name||(i.name="color"),i.coordGrammar=at(i.coords);let t=Object.entries(e).map(([r,a],s)=>{let n=i.coordGrammar[s][0],o=a.range||a.refRange,h=n.range,l="";return n=="<percentage>"?(h=[0,100],l="%"):n=="<angle>"&&(l="deg"),{fromRange:o,toRange:h,suffix:l}});i.serializeCoords=(r,a)=>r.map((s,n)=>{let{fromRange:o,toRange:h,suffix:l}=t[n];return o&&h&&(s=Pe(o,h,s)),s=ue(s,a),l&&(s+=l),s})}return i}var A=new f({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class C extends f{constructor(e){e.coords||(e.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),e.base||(e.base=A),e.toXYZ_M&&e.fromXYZ_M&&(e.toBase??(e.toBase=t=>{let r=k(e.toXYZ_M,t);return this.white!==this.base.white&&(r=de(this.white,this.base.white,r)),r}),e.fromBase??(e.fromBase=t=>(t=de(this.base.white,this.white,t),k(e.fromXYZ_M,t)))),e.referred??(e.referred="display"),super(e)}}function nt(i,{meta:e}={}){var r,a,s,n,o;let t={str:(r=String(i))==null?void 0:r.trim()};if(I.run("parse-start",t),t.color)return t.color;if(t.parsed=tt(t.str),t.parsed){let h=t.parsed.name;if(h==="color"){let l=t.parsed.args.shift(),u=t.parsed.rawArgs.indexOf("/")>0?t.parsed.args.pop():1;for(let d of f.all){let g=d.getFormat("color");if(g&&(l===g.id||(a=g.ids)!=null&&a.includes(l))){const y=Object.keys(d.coords).map((b,v)=>t.parsed.args[v]||0);return e&&(e.formatId="color"),{spaceId:d.id,coords:y,alpha:u}}}let c="";if(l in f.registry){let d=(o=(n=(s=f.registry[l].formats)==null?void 0:s.functions)==null?void 0:n.color)==null?void 0:o.id;d&&(c=`Did you mean color(${d})?`)}throw new TypeError(`Cannot parse color(${l}). `+(c||"Missing a plugin?"))}else for(let l of f.all){let u=l.getFormat(h);if(u&&u.type==="function"){let c=1;(u.lastAlpha||it(t.parsed.args).alpha)&&(c=t.parsed.args.pop());let d=t.parsed.args,g;return u.coordGrammar&&(g=Object.entries(l.coords).map(([y,b],v)=>{var W;let S=u.coordGrammar[v],x=(W=d[v])==null?void 0:W.type,R=S.find(N=>N==x);if(!R){let N=b.name||y;throw new TypeError(`${x} not allowed for ${N} in ${h}()`)}let D=R.range;x==="<percentage>"&&(D||(D=[0,1]));let F=b.range||b.refRange;return D&&F&&(d[v]=Pe(D,F,d[v])),R})),e&&Object.assign(e,{formatId:u.name,types:g}),{spaceId:l.id,coords:d,alpha:c}}}}else for(let h of f.all)for(let l in h.formats){let u=h.formats[l];if(u.type!=="custom"||u.test&&!u.test(t.str))continue;let c=u.parse(t.str);if(c)return c.alpha??(c.alpha=1),e&&(e.formatId=l),c}throw new TypeError(`Could not parse ${i} as a color. Missing a plugin?`)}function p(i){if(!i)throw new TypeError("Empty color reference");K(i)&&(i=nt(i));let e=i.space||i.spaceId;return e instanceof f||(i.space=f.get(e)),i.alpha===void 0&&(i.alpha=1),i}function ee(i,e){return e=f.get(e),e.from(i)}function E(i,e){let{space:t,index:r}=f.resolveCoord(e,i.space);return ee(i,t)[r]}function ot(i,e,t){return e=f.get(e),i.coords=e.to(i.space,t),i}function q(i,e,t){if(i=p(i),arguments.length===2&&j(arguments[1])==="object"){let r=arguments[1];for(let a in r)q(i,a,r[a])}else{typeof t=="function"&&(t=t(E(i,e)));let{space:r,index:a}=f.resolveCoord(e,i.space),s=ee(i,r);s[a]=t,ot(i,r,s)}return i}var Be=new f({id:"xyz-d50",name:"XYZ D50",white:"D50",base:A,fromBase:i=>de(A.white,"D50",i),toBase:i=>de("D50",A.white,i),formats:{color:{}}});const Li=216/24389,ht=24/116,fe=24389/27;let ze=B.D50;var T=new f({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:ze,base:Be,fromBase(i){let t=i.map((r,a)=>r/ze[a]).map(r=>r>Li?Math.cbrt(r):(fe*r+16)/116);return[116*t[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])]},toBase(i){let e=[];return e[1]=(i[0]+16)/116,e[0]=i[1]/500+e[1],e[2]=e[1]-i[2]/200,[e[0]>ht?Math.pow(e[0],3):(116*e[0]-16)/fe,i[0]>8?Math.pow((i[0]+16)/116,3):i[0]/fe,e[2]>ht?Math.pow(e[2],3):(116*e[2]-16)/fe].map((r,a)=>r*ze[a])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function me(i){return(i%360+360)%360}function Di(i,e){if(i==="raw")return e;let[t,r]=e.map(me),a=r-t;return i==="increasing"?a<0&&(r+=360):i==="decreasing"?a>0&&(t+=360):i==="longer"?-180<a&&a<180&&(a>0?t+=360:r+=360):i==="shorter"&&(a>180?t+=360:a<-180&&(r+=360)),[t,r]}var te=new f({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:T,fromBase(i){let[e,t,r]=i,a;const s=.02;return Math.abs(t)<s&&Math.abs(r)<s?a=NaN:a=Math.atan2(r,t)*180/Math.PI,[e,Math.sqrt(t**2+r**2),me(a)]},toBase(i){let[e,t,r]=i;return t<0&&(t=0),isNaN(r)&&(r=0),[e,t*Math.cos(r*Math.PI/180),t*Math.sin(r*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const lt=25**7,ge=Math.PI,ut=180/ge,J=ge/180;function Fe(i,e,{kL:t=1,kC:r=1,kH:a=1}={}){let[s,n,o]=T.from(i),h=te.from(T,[s,n,o])[1],[l,u,c]=T.from(e),d=te.from(T,[l,u,c])[1];h<0&&(h=0),d<0&&(d=0);let y=((h+d)/2)**7,b=.5*(1-Math.sqrt(y/(y+lt))),v=(1+b)*n,S=(1+b)*u,x=Math.sqrt(v**2+o**2),R=Math.sqrt(S**2+c**2),D=v===0&&o===0?0:Math.atan2(o,v),F=S===0&&c===0?0:Math.atan2(c,S);D<0&&(D+=2*ge),F<0&&(F+=2*ge),D*=ut,F*=ut;let W=l-s,N=R-x,O=F-D,oe=D+F,gi=Math.abs(O),he;x*R===0?he=0:gi<=180?he=O:O>180?he=O-360:O<-180?he=O+360:console.log("the unthinkable has happened");let pi=2*Math.sqrt(R*x)*Math.sin(he*J/2),ca=(s+l)/2,Qe=(x+R)/2,_i=Math.pow(Qe,7),$;x*R===0?$=oe:gi<=180?$=oe/2:oe<360?$=(oe+360)/2:$=(oe-360)/2;let yi=(ca-50)**2,da=1+.015*yi/Math.sqrt(20+yi),Mi=1+.045*Qe,le=1;le-=.17*Math.cos(($-30)*J),le+=.24*Math.cos(2*$*J),le+=.32*Math.cos((3*$+6)*J),le-=.2*Math.cos((4*$-63)*J);let bi=1+.015*Qe*le,fa=30*Math.exp(-1*(($-275)/25)**2),ma=2*Math.sqrt(_i/(_i+lt)),ga=-1*Math.sin(2*fa*J)*ma,Ee=(W/(t*da))**2;return Ee+=(N/(r*Mi))**2,Ee+=(pi/(a*bi))**2,Ee+=ga*(N/(r*Mi))*(pi/(a*bi)),Math.sqrt(Ee)}const Ai=75e-6;function ie(i,e=i.space,{epsilon:t=Ai}={}){i=p(i),e=f.get(e);let r=i.coords;return e!==i.space&&(r=e.from(i)),e.inGamut(r,{epsilon:t})}function re(i){return{space:i.space,coords:i.coords.slice(),alpha:i.alpha}}function U(i,{method:e=Y.gamut_mapping,space:t=i.space}={}){if(K(arguments[1])&&(t=arguments[1]),t=f.get(t),ie(i,t,{epsilon:0}))return p(i);let r=P(i,t);if(e!=="clip"&&!ie(i,t)){let a=U(re(r),{method:"clip",space:t});if(Fe(i,a)>2){let s=f.resolveCoord(e),n=s.space,o=s.id,h=P(r,n),u=(s.range||s.refRange)[0],c=.01,d=u,g=E(h,o);for(;g-d>c;){let y=re(h);y=U(y,{space:t,method:"clip"}),Fe(h,y)-2<c?d=E(h,o):g=E(h,o),q(h,o,(d+g)/2)}r=P(h,t)}else r=a}if(e==="clip"||!ie(r,t,{epsilon:0})){let a=Object.values(t.coords).map(s=>s.range||[]);r.coords=r.coords.map((s,n)=>{let[o,h]=a[n];return o!==void 0&&(s=Math.max(o,s)),h!==void 0&&(s=Math.min(s,h)),s})}return t!==i.space&&(r=P(r,i.space)),i.coords=r.coords,i}U.returns="color";function P(i,e,{inGamut:t}={}){i=p(i),e=f.get(e);let r=e.from(i),a={space:e,coords:r,alpha:i.alpha};return t&&(a=U(a)),a}P.returns="color";function pe(i,{precision:e=Y.precision,format:t="default",inGamut:r=!0,...a}={}){var h;let s;i=p(i);let n=t;t=i.space.getFormat(t)??i.space.getFormat("default")??f.DEFAULT_FORMAT,r||(r=t.toGamut);let o=i.coords;if(o=o.map(l=>l||0),r&&!ie(i)&&(o=U(re(i),r===!0?void 0:r).coords),t.type==="custom")if(a.precision=e,t.serialize)s=t.serialize(o,i.alpha,a);else throw new TypeError(`format ${n} can only be used to parse colors, not for serialization`);else{let l=t.name||"color";t.serializeCoords?o=t.serializeCoords(o,e):e!==null&&(o=o.map(g=>ue(g,e)));let u=[...o];if(l==="color"){let g=t.id||((h=t.ids)==null?void 0:h[0])||i.space.id;u.unshift(g)}let c=i.alpha;e!==null&&(c=ue(c,e));let d=i.alpha<1&&!t.noAlpha?`${t.commas?",":" /"} ${c}`:"";s=`${l}(${u.join(t.commas?", ":" ")}${d})`}return s}const Ei=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],Pi=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]];var _e=new C({id:"rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:Ei,fromXYZ_M:Pi,formats:{color:{}}});const ye=1.09929682680944,ct=.018053968510807;var dt=new C({id:"rec2020",name:"REC.2020",base:_e,toBase(i){return i.map(function(e){return e<ct*4.5?e/4.5:Math.pow((e+ye-1)/ye,1/.45)})},fromBase(i){return i.map(function(e){return e>=ct?ye*Math.pow(e,.45)-(ye-1):4.5*e})},formats:{color:{}}});const Ri=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],Bi=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]];var ft=new C({id:"p3-linear",name:"Linear P3",white:"D65",toXYZ_M:Ri,fromXYZ_M:Bi});const zi=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],Fi=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]];var mt=new C({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:zi,fromXYZ_M:Fi,formats:{color:{}}}),gt={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]};let pt=Array(3).fill("<percentage> | <number>[0, 255]"),_t=Array(3).fill("<number>[0, 255]");var ae=new C({id:"srgb",name:"sRGB",base:mt,fromBase:i=>i.map(e=>{let t=e<0?-1:1,r=e*t;return r>.0031308?t*(1.055*r**(1/2.4)-.055):12.92*e}),toBase:i=>i.map(e=>{let t=e<0?-1:1,r=e*t;return r<.04045?e/12.92:t*((r+.055)/1.055)**2.4}),formats:{rgb:{coords:pt},rgb_number:{name:"rgb",commas:!0,coords:_t,noAlpha:!0},color:{},rgba:{coords:pt,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:_t},hex:{type:"custom",toGamut:!0,test:i=>/^#([a-f0-9]{3,4}){1,2}$/i.test(i),parse(i){i.length<=5&&(i=i.replace(/[a-f0-9]/gi,"$&$&"));let e=[];return i.replace(/[a-f0-9]{2}/gi,t=>{e.push(parseInt(t,16)/255)}),{spaceId:"srgb",coords:e.slice(0,3),alpha:e.slice(3)[0]}},serialize:(i,e,{collapse:t=!0}={})=>{e<1&&i.push(e),i=i.map(s=>Math.round(s*255));let r=t&&i.every(s=>s%17===0);return"#"+i.map(s=>r?(s/17).toString(16):s.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:i=>/^[a-z]+$/i.test(i),parse(i){i=i.toLowerCase();let e={spaceId:"srgb",coords:null,alpha:1};if(i==="transparent"?(e.coords=gt.black,e.alpha=0):e.coords=gt[i],e.coords)return e}}}}),yt=new C({id:"p3",name:"P3",base:ft,fromBase:ae.fromBase,toBase:ae.toBase,formats:{color:{id:"display-p3"}}});if(Y.display_space=ae,typeof CSS<"u"&&CSS.supports)for(let i of[T,dt,yt]){let e=i.getMinCoords(),r=pe({space:i,coords:e,alpha:1});if(CSS.supports("color",r)){Y.display_space=i;break}}function Yi(i,{space:e=Y.display_space,...t}={}){let r=pe(i,t);if(typeof CSS>"u"||CSS.supports("color",r)||!Y.display_space)r=new String(r),r.color=i;else{let a=P(i,e);r=new String(pe(a,t)),r.color=a}return r}function Mt(i,e,t="lab"){t=f.get(t);let r=t.from(i),a=t.from(e);return Math.sqrt(r.reduce((s,n,o)=>{let h=a[o];return isNaN(n)||isNaN(h)?s:s+(h-n)**2},0))}function Oi(i,e){return i=p(i),e=p(e),i.space===e.space&&i.alpha===e.alpha&&i.coords.every((t,r)=>t===e.coords[r])}function G(i){return E(i,[A,"y"])}function bt(i,e){q(i,[A,"y"],e)}function $i(i){Object.defineProperty(i.prototype,"luminance",{get(){return G(this)},set(e){bt(this,e)}})}var Xi=Object.freeze({__proto__:null,getLuminance:G,register:$i,setLuminance:bt});function ji(i,e){i=p(i),e=p(e);let t=Math.max(G(i),0),r=Math.max(G(e),0);return r>t&&([t,r]=[r,t]),(t+.05)/(r+.05)}const Ii=.56,qi=.57,Ui=.62,Gi=.65,vt=.022,Zi=1.414,Hi=.1,Vi=5e-4,Ni=1.14,kt=.027,Wi=1.14;function wt(i){return i>=vt?i:i+(vt-i)**Zi}function Q(i){let e=i<0?-1:1,t=Math.abs(i);return e*Math.pow(t,2.4)}function Ji(i,e){e=p(e),i=p(i);let t,r,a,s,n,o;e=P(e,"srgb"),[s,n,o]=e.coords;let h=Q(s)*.2126729+Q(n)*.7151522+Q(o)*.072175;i=P(i,"srgb"),[s,n,o]=i.coords;let l=Q(s)*.2126729+Q(n)*.7151522+Q(o)*.072175,u=wt(h),c=wt(l),d=c>u;return Math.abs(c-u)<Vi?r=0:d?(t=c**Ii-u**qi,r=t*Ni):(t=c**Gi-u**Ui,r=t*Wi),Math.abs(r)<Hi?a=0:r>0?a=r-kt:a=r+kt,a*100}function Qi(i,e){i=p(i),e=p(e);let t=Math.max(G(i),0),r=Math.max(G(e),0);r>t&&([t,r]=[r,t]);let a=t+r;return a===0?0:(t-r)/a}const Ki=5e4;function er(i,e){i=p(i),e=p(e);let t=Math.max(G(i),0),r=Math.max(G(e),0);return r>t&&([t,r]=[r,t]),r===0?Ki:(t-r)/r}function tr(i,e){i=p(i),e=p(e);let t=E(i,[T,"l"]),r=E(e,[T,"l"]);return Math.abs(t-r)}const ir=216/24389,St=24/116,Me=24389/27;let Ye=B.D65;var Oe=new f({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"L"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Ye,base:A,fromBase(i){let t=i.map((r,a)=>r/Ye[a]).map(r=>r>ir?Math.cbrt(r):(Me*r+16)/116);return[116*t[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])]},toBase(i){let e=[];return e[1]=(i[0]+16)/116,e[0]=i[1]/500+e[1],e[2]=e[1]-i[2]/200,[e[0]>St?Math.pow(e[0],3):(116*e[0]-16)/Me,i[0]>8?Math.pow((i[0]+16)/116,3):i[0]/Me,e[2]>St?Math.pow(e[2],3):(116*e[2]-16)/Me].map((r,a)=>r*Ye[a])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});const $e=Math.pow(5,.5)*.5+.5;function rr(i,e){i=p(i),e=p(e);let t=E(i,[Oe,"l"]),r=E(e,[Oe,"l"]),a=Math.abs(Math.pow(t,$e)-Math.pow(r,$e)),s=Math.pow(a,1/$e)*Math.SQRT2-40;return s<7.5?0:s}var be=Object.freeze({__proto__:null,contrastAPCA:Ji,contrastDeltaPhi:rr,contrastLstar:tr,contrastMichelson:Qi,contrastWCAG21:ji,contrastWeber:er});function ar(i,e,t={}){K(t)&&(t={algorithm:t});let{algorithm:r,...a}=t;if(!r){let s=Object.keys(be).map(n=>n.replace(/^contrast/,"")).join(", ");throw new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${s}`)}i=p(i),e=p(e);for(let s in be)if("contrast"+r.toLowerCase()===s.toLowerCase())return be[s](i,e,a);throw new TypeError(`Unknown contrast algorithm: ${r}`)}function xt(i){let[e,t,r]=ee(i,A),a=e+15*t+3*r;return[4*e/a,9*t/a]}function Ct(i){let[e,t,r]=ee(i,A),a=e+t+r;return[e/a,t/a]}function sr(i){Object.defineProperty(i.prototype,"uv",{get(){return xt(this)}}),Object.defineProperty(i.prototype,"xy",{get(){return Ct(this)}})}var nr=Object.freeze({__proto__:null,register:sr,uv:xt,xy:Ct});function or(i,e){return Mt(i,e,"lab")}const Tt=Math.PI/180;function hr(i,e,{l:t=2,c:r=1}={}){let[a,s,n]=T.from(i),[,o,h]=te.from(T,[a,s,n]),[l,u,c]=T.from(e),d=te.from(T,[l,u,c])[1];o<0&&(o=0),d<0&&(d=0);let g=a-l,y=o-d,b=s-u,v=n-c,S=b**2+v**2-y**2,x=.511;a>=16&&(x=.040975*a/(1+.01765*a));let R=.0638*o/(1+.0131*o)+.638,D;Number.isNaN(h)&&(h=0),h>=164&&h<=345?D=.56+Math.abs(.2*Math.cos((h+168)*Tt)):D=.36+Math.abs(.4*Math.cos((h+35)*Tt));let F=Math.pow(o,4),W=Math.sqrt(F/(F+1900)),N=R*(W*D+1-W),O=(g/(t*x))**2;return O+=(y/(r*R))**2,O+=S/N**2,Math.sqrt(O)}const Lt=203;var Xe=new f({id:"xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:A,fromBase(i){return i.map(e=>Math.max(e*Lt,0))},toBase(i){return i.map(e=>Math.max(e/Lt,0))}});const ve=1.15,ke=.66,Dt=2610/2**14,lr=2**14/2610,At=3424/2**12,Et=2413/2**7,Pt=2392/2**7,ur=1.7*2523/2**5,Rt=2**5/(1.7*2523),we=-.56,je=16295499532821565e-27,cr=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],dr=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],fr=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],mr=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]];var Bt=new f({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:Xe,fromBase(i){let[e,t,r]=i,a=ve*e-(ve-1)*r,s=ke*t-(ke-1)*e,o=k(cr,[a,s,r]).map(function(d){let g=At+Et*(d/1e4)**Dt,y=1+Pt*(d/1e4)**Dt;return(g/y)**ur}),[h,l,u]=k(fr,o);return[(1+we)*h/(1+we*h)-je,l,u]},toBase(i){let[e,t,r]=i,a=(e+je)/(1+we-we*(e+je)),n=k(mr,[a,t,r]).map(function(d){let g=At-d**Rt,y=Pt*d**Rt-Et;return 1e4*(g/y)**lr}),[o,h,l]=k(dr,n),u=(o+(ve-1)*l)/ve,c=(h+(ke-1)*u)/ke;return[u,c,l]},formats:{color:{}}}),Ie=new f({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:Bt,fromBase(i){let[e,t,r]=i,a;const s=2e-4;return Math.abs(t)<s&&Math.abs(r)<s?a=NaN:a=Math.atan2(r,t)*180/Math.PI,[e,Math.sqrt(t**2+r**2),me(a)]},toBase(i){return[i[0],i[1]*Math.cos(i[2]*Math.PI/180),i[1]*Math.sin(i[2]*Math.PI/180)]},formats:{color:{}}});function gr(i,e){let[t,r,a]=Ie.from(i),[s,n,o]=Ie.from(e),h=t-s,l=r-n;Number.isNaN(a)&&Number.isNaN(o)?(a=0,o=0):Number.isNaN(a)?a=o:Number.isNaN(o)&&(o=a);let u=a-o,c=2*Math.sqrt(r*n)*Math.sin(u/2*(Math.PI/180));return Math.sqrt(h**2+l**2+c**2)}const zt=3424/4096,Ft=2413/128,Yt=2392/128,Ot=2610/16384,pr=2523/32,_r=16384/2610,$t=32/2523,yr=[[.3592,.6976,-.0358],[-.1922,1.1004,.0755],[.007,.0749,.8434]],Mr=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],br=[[.9999888965628402,.008605050147287059,.11103437159861648],[1.00001110343716,-.008605050147287059,-.11103437159861648],[1.0000320633910054,.56004913547279,-.3206339100541203]],vr=[[2.0701800566956137,-1.326456876103021,.20661600684785517],[.3649882500326575,.6804673628522352,-.04542175307585323],[-.04959554223893211,-.04942116118675749,1.1879959417328034]];var qe=new f({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:Xe,fromBase(i){let e=k(yr,i);return kr(e)},toBase(i){let e=wr(i);return k(vr,e)},formats:{color:{}}});function kr(i){let e=i.map(function(t){let r=zt+Ft*(t/1e4)**Ot,a=1+Yt*(t/1e4)**Ot;return(r/a)**pr});return k(Mr,e)}function wr(i){return k(br,i).map(function(r){let a=Math.max(r**$t-zt,0),s=Ft-Yt*r**$t;return 1e4*(a/s)**_r})}function Sr(i,e){let[t,r,a]=qe.from(i),[s,n,o]=qe.from(e);return 720*Math.sqrt((t-s)**2+.25*(r-n)**2+(a-o)**2)}const xr=[[.8190224432164319,.3619062562801221,-.12887378261216414],[.0329836671980271,.9292868468965546,.03614466816999844],[.048177199566046255,.26423952494422764,.6335478258136937]],Cr=[[1.2268798733741557,-.5578149965554813,.28139105017721583],[-.04057576262431372,1.1122868293970594,-.07171106666151701],[-.07637294974672142,-.4214933239627914,1.5869240244272418]],Tr=[[.2104542553,.793617785,-.0040720468],[1.9779984951,-2.428592205,.4505937099],[.0259040371,.7827717662,-.808675766]],Lr=[[.9999999984505198,.39633779217376786,.2158037580607588],[1.0000000088817609,-.10556134232365635,-.06385417477170591],[1.0000000546724108,-.08948418209496575,-1.2914855378640917]];var Se=new f({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"L"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:A,fromBase(i){let t=k(xr,i).map(r=>Math.cbrt(r));return k(Tr,t)},toBase(i){let t=k(Lr,i).map(r=>r**3);return k(Cr,t)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function Dr(i,e){let[t,r,a]=Se.from(i),[s,n,o]=Se.from(e),h=t-s,l=r-n,u=a-o;return Math.sqrt(h**2+l**2+u**2)}var xe={deltaE76:or,deltaECMC:hr,deltaE2000:Fe,deltaEJz:gr,deltaEITP:Sr,deltaEOK:Dr};function se(i,e,t={}){K(t)&&(t={method:t});let{method:r=Y.deltaE,...a}=t;i=p(i),e=p(e);for(let s in xe)if("deltae"+r.toLowerCase()===s.toLowerCase())return xe[s](i,e,a);throw new TypeError(`Unknown deltaE method: ${r}`)}function Ar(i,e=.25){let r=[f.get("oklch","lch"),"l"];return q(i,r,a=>a*(1+e))}function Er(i,e=.25){let r=[f.get("oklch","lch"),"l"];return q(i,r,a=>a*(1-e))}var Pr=Object.freeze({__proto__:null,darken:Er,lighten:Ar});function Xt(i,e,t=.5,r={}){[i,e]=[p(i),p(e)],j(t)==="object"&&([t,r]=[.5,t]);let{space:a,outputSpace:s,premultiplied:n}=r;return ne(i,e,{space:a,outputSpace:s,premultiplied:n})(t)}function jt(i,e,t={}){let r;Ue(i)&&([r,t]=[i,e],[i,e]=r.rangeArgs.colors);let{maxDeltaE:a,deltaEMethod:s,steps:n=2,maxSteps:o=1e3,...h}=t;r||([i,e]=[p(i),p(e)],r=ne(i,e,h));let l=se(i,e),u=a>0?Math.max(n,Math.ceil(l/a)+1):n,c=[];if(o!==void 0&&(u=Math.min(u,o)),u===1)c=[{p:.5,color:r(.5)}];else{let d=1/(u-1);c=Array.from({length:u},(g,y)=>{let b=y*d;return{p:b,color:r(b)}})}if(a>0){let d=c.reduce((g,y,b)=>{if(b===0)return 0;let v=se(y.color,c[b-1].color,s);return Math.max(g,v)},0);for(;d>a;){d=0;for(let g=1;g<c.length&&c.length<o;g++){let y=c[g-1],b=c[g],v=(b.p+y.p)/2,S=r(v);d=Math.max(d,se(S,y.color),se(S,b.color)),c.splice(g,0,{p:v,color:r(v)}),g++}}}return c=c.map(d=>d.color),c}function ne(i,e,t={}){if(Ue(i)){let[h,l]=[i,e];return ne(...h.rangeArgs.colors,{...h.rangeArgs.options,...l})}let{space:r,outputSpace:a,progression:s,premultiplied:n}=t;i=p(i),e=p(e),i=re(i),e=re(e);let o={colors:[i,e],options:t};if(r?r=f.get(r):r=f.registry[Y.interpolationSpace]||i.space,a=a?f.get(a):r,i=P(i,r),e=P(e,r),i=U(i),e=U(e),r.coords.h&&r.coords.h.type==="angle"){let h=t.hue=t.hue||"shorter",l=[r,"h"],[u,c]=[E(i,l),E(e,l)];[u,c]=Di(h,[u,c]),q(i,l,u),q(e,l,c)}return n&&(i.coords=i.coords.map(h=>h*i.alpha),e.coords=e.coords.map(h=>h*e.alpha)),Object.assign(h=>{h=s?s(h):h;let l=i.coords.map((d,g)=>{let y=e.coords[g];return ce(d,y,h)}),u=ce(i.alpha,e.alpha,h),c={space:r,coords:l,alpha:u};return n&&(c.coords=c.coords.map(d=>d/u)),a!==r&&(c=P(c,a)),c},{rangeArgs:o})}function Ue(i){return j(i)==="function"&&!!i.rangeArgs}Y.interpolationSpace="lab";function Rr(i){i.defineFunction("mix",Xt,{returns:"color"}),i.defineFunction("range",ne,{returns:"function<color>"}),i.defineFunction("steps",jt,{returns:"array<color>"})}var Br=Object.freeze({__proto__:null,isRange:Ue,mix:Xt,range:ne,register:Rr,steps:jt}),It=new f({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:ae,fromBase:i=>{let e=Math.max(...i),t=Math.min(...i),[r,a,s]=i,[n,o,h]=[NaN,0,(t+e)/2],l=e-t;if(l!==0){switch(o=h===0||h===1?0:(e-h)/Math.min(h,1-h),e){case r:n=(a-s)/l+(a<s?6:0);break;case a:n=(s-r)/l+2;break;case s:n=(r-a)/l+4}n=n*60}return[n,o*100,h*100]},toBase:i=>{let[e,t,r]=i;e=e%360,e<0&&(e+=360),t/=100,r/=100;function a(s){let n=(s+e/30)%12,o=t*Math.min(r,1-r);return r-o*Math.max(-1,Math.min(n-3,9-n,1))}return[a(0),a(8),a(4)]},formats:{hsl:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),qt=new f({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:It,fromBase(i){let[e,t,r]=i;t/=100,r/=100;let a=r+t*Math.min(r,1-r);return[e,a===0?0:200*(1-r/a),100*a]},toBase(i){let[e,t,r]=i;t/=100,r/=100;let a=r*(1-t/2);return[e,a===0||a===1?0:(r-a)/Math.min(a,1-a)*100,a*100]},formats:{color:{toGamut:!0}}}),zr=new f({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:qt,fromBase(i){let[e,t,r]=i;return[e,r*(100-t)/100,100-r]},toBase(i){let[e,t,r]=i;t/=100,r/=100;let a=t+r;if(a>=1){let o=t/a;return[e,0,o*100]}let s=1-r,n=s===0?0:1-t/s;return[e,n*100,s*100]},formats:{hwb:{toGamut:!0,coords:["<number> | <angle>","<percentage>","<percentage>"]}}});const Fr=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],Yr=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]];var Ut=new C({id:"a98rgb-linear",name:"Linear Adobe® 98 RGB compatible",white:"D65",toXYZ_M:Fr,fromXYZ_M:Yr}),Or=new C({id:"a98rgb",name:"Adobe® 98 RGB compatible",base:Ut,toBase:i=>i.map(e=>Math.pow(Math.abs(e),563/256)*Math.sign(e)),fromBase:i=>i.map(e=>Math.pow(Math.abs(e),256/563)*Math.sign(e)),formats:{color:{id:"a98-rgb"}}});const $r=[[.7977604896723027,.13518583717574031,.0313493495815248],[.2880711282292934,.7118432178101014,8565396060525902e-20],[0,0,.8251046025104601]],Xr=[[1.3457989731028281,-.25558010007997534,-.05110628506753401],[-.5446224939028347,1.5082327413132781,.02053603239147973],[0,0,1.2119675456389454]];var Gt=new C({id:"prophoto-linear",name:"Linear ProPhoto",white:"D50",base:Be,toXYZ_M:$r,fromXYZ_M:Xr});const jr=1/512,Ir=16/512;var qr=new C({id:"prophoto",name:"ProPhoto",base:Gt,toBase(i){return i.map(e=>e<Ir?e/16:e**1.8)},fromBase(i){return i.map(e=>e>=jr?e**(1/1.8):16*e)},formats:{color:{id:"prophoto-rgb"}}}),Ur=new f({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:Se,fromBase(i){let[e,t,r]=i,a;const s=2e-4;return Math.abs(t)<s&&Math.abs(r)<s?a=NaN:a=Math.atan2(r,t)*180/Math.PI,[e,Math.sqrt(t**2+r**2),me(a)]},toBase(i){let[e,t,r]=i,a,s;return isNaN(r)?(a=0,s=0):(a=t*Math.cos(r*Math.PI/180),s=t*Math.sin(r*Math.PI/180)),[e,a,s]},formats:{oklch:{coords:["<number> | <percentage>","<number> | <percentage>[0,1]","<number> | <angle>"]}}});const Zt=203,Ht=2610/2**14,Gr=2**14/2610,Zr=2523/2**5,Vt=2**5/2523,Nt=3424/2**12,Wt=2413/2**7,Jt=2392/2**7;var Hr=new C({id:"rec2100pq",name:"REC.2100-PQ",base:_e,toBase(i){return i.map(function(e){return(Math.max(e**Vt-Nt,0)/(Wt-Jt*e**Vt))**Gr*1e4/Zt})},fromBase(i){return i.map(function(e){let t=Math.max(e*Zt/1e4,0),r=Nt+Wt*t**Ht,a=1+Jt*t**Ht;return(r/a)**Zr})},formats:{color:{id:"rec2100-pq"}}});const Qt=.17883277,Kt=.28466892,ei=.55991073,Ge=3.7743;var Vr=new C({id:"rec2100hlg",cssid:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:_e,toBase(i){return i.map(function(e){return e<=.5?e**2/3*Ge:(Math.exp((e-ei)/Qt)+Kt)/12*Ge})},fromBase(i){return i.map(function(e){return e/=Ge,e<=1/12?Math.sqrt(3*e):Qt*Math.log(12*e-Kt)+ei})},formats:{color:{id:"rec2100-hlg"}}});const ti={};I.add("chromatic-adaptation-start",i=>{i.options.method&&(i.M=ii(i.W1,i.W2,i.options.method))}),I.add("chromatic-adaptation-end",i=>{i.M||(i.M=ii(i.W1,i.W2,i.options.method))});function Ce({id:i,toCone_M:e,fromCone_M:t}){ti[i]=arguments[0]}function ii(i,e,t="Bradford"){let r=ti[t],[a,s,n]=k(r.toCone_M,i),[o,h,l]=k(r.toCone_M,e),u=[[o/a,0,0],[0,h/s,0],[0,0,l/n]],c=k(u,r.toCone_M);return k(r.fromCone_M,c)}Ce({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599364,-1.1293816,.2198974],[.3611914,.6388125,-64e-7],[0,0,1.0890636]]}),Ce({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929,-.1470543,.1599627],[.4323053,.5183603,.0492912],[-.0085287,.0400428,.9684867]]}),Ce({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238,-.278869,.1827452],[.454369,.4735332,.0720978],[-.0096276,-.005698,1.0153256]]}),Ce({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.011254630531685,.1491867754444518],[.3875265432361372,.6214474419314753,-.008973985167612518],[-.01584149884933386,-.03412293802851557,1.04996443687785]]}),Object.assign(B,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),B.ACES=[.32168/.33767,1,(1-.32168-.33767)/.33767];const Nr=[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],Wr=[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]];var ri=new C({id:"acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:B.ACES,toXYZ_M:Nr,fromXYZ_M:Wr,formats:{color:{}}});const Te=2**-16,Ze=-.35828683,Le=(Math.log2(65504)+9.72)/17.52;var Jr=new C({id:"acescc",name:"ACEScc",coords:{r:{range:[Ze,Le],name:"Red"},g:{range:[Ze,Le],name:"Green"},b:{range:[Ze,Le],name:"Blue"}},referred:"scene",base:ri,toBase(i){const e=-.3013698630136986;return i.map(function(t){return t<=e?(2**(t*17.52-9.72)-Te)*2:t<Le?2**(t*17.52-9.72):65504})},fromBase(i){return i.map(function(e){return e<=0?(Math.log2(Te)+9.72)/17.52:e<Te?(Math.log2(Te+e*.5)+9.72)/17.52:(Math.log2(e)+9.72)/17.52})},formats:{color:{}}}),ai=Object.freeze({__proto__:null,A98RGB:Or,A98RGB_Linear:Ut,ACEScc:Jr,ACEScg:ri,HSL:It,HSV:qt,HWB:zr,ICTCP:qe,JzCzHz:Ie,Jzazbz:Bt,LCH:te,Lab:T,Lab_D65:Oe,OKLCH:Ur,OKLab:Se,P3:yt,P3_Linear:ft,ProPhoto:qr,ProPhoto_Linear:Gt,REC_2020:dt,REC_2020_Linear:_e,REC_2100_HLG:Vr,REC_2100_PQ:Hr,XYZ_ABS_D65:Xe,XYZ_D50:Be,XYZ_D65:A,sRGB:ae,sRGB_Linear:mt});class _{constructor(...e){let t;e.length===1&&(t=p(e[0]));let r,a,s;t?(r=t.space||t.spaceId,a=t.coords,s=t.alpha):[r,a,s]=e,Object.defineProperty(this,"space",{value:f.get(r),writable:!1,enumerable:!0,configurable:!0}),this.coords=a?a.slice():[0,0,0],this.alpha=s<1?s:1;for(let n=0;n<this.coords.length;n++)this.coords[n]==="NaN"&&(this.coords[n]=NaN);for(let n in this.space.coords)Object.defineProperty(this,n,{get:()=>this.get(n),set:o=>this.set(n,o)})}get spaceId(){return this.space.id}clone(){return new _(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...e){let t=Yi(this,...e);return t.color=new _(t.color),t}static get(e,...t){return e instanceof _?e:new _(e,...t)}static defineFunction(e,t,r=t){let{instance:a=!0,returns:s}=r,n=function(...o){let h=t(...o);if(s==="color")h=_.get(h);else if(s==="function<color>"){let l=h;h=function(...u){let c=l(...u);return _.get(c)},Object.assign(h,l)}else s==="array<color>"&&(h=h.map(l=>_.get(l)));return h};e in _||(_[e]=n),a&&(_.prototype[e]=function(...o){return n(this,...o)})}static defineFunctions(e){for(let t in e)_.defineFunction(t,e[t],e[t])}static extend(e){if(e.register)e.register(_);else for(let t in e)_.defineFunction(t,e[t])}}_.defineFunctions({get:E,getAll:ee,set:q,setAll:ot,to:P,equals:Oi,inGamut:ie,toGamut:U,distance:Mt,toString:pe}),Object.assign(_,{util:Si,hooks:I,WHITES:B,Space:f,spaces:f.registry,parse:nt,defaults:Y});for(let i of Object.keys(ai))f.register(ai[i]);for(let i in f.registry)He(i,f.registry[i]);I.add("colorspace-init-end",i=>{var e;He(i.id,i),(e=i.aliases)==null||e.forEach(t=>{He(t,i)})});function He(i,e){Object.keys(e.coords),Object.values(e.coords).map(r=>r.name);let t=i.replace(/-/g,"_");Object.defineProperty(_.prototype,t,{get(){let r=this.getAll(i);return typeof Proxy>"u"?r:new Proxy(r,{has:(a,s)=>{try{return f.resolveCoord([e,s]),!0}catch{}return Reflect.has(a,s)},get:(a,s,n)=>{if(s&&typeof s!="symbol"&&!(s in a)){let{index:o}=f.resolveCoord([e,s]);if(o>=0)return a[o]}return Reflect.get(a,s,n)},set:(a,s,n,o)=>{if(s&&typeof s!="symbol"&&!(s in a)||s>=0){let{index:h}=f.resolveCoord([e,s]);if(h>=0)return a[h]=n,this.setAll(i,a),!0}return Reflect.set(a,s,n,o)}})},set(r){this.setAll(i,r)},configurable:!0,enumerable:!0})}_.extend(xe),_.extend({deltaE:se}),Object.assign(_,{deltaEMethods:xe}),_.extend(Pr),_.extend({contrast:ar}),_.extend(nr),_.extend(Xi),_.extend(Br),_.extend(be);function Ve(i){return i}function Z(i){return i*i*(3-2*i)}function Ne(i,e,t,r){return i*e+t*r}function si(i,e,t,r){let a=[Math.round((i.r*e+t.r*r)*255),Math.round((i.g*e+t.g*r)*255),Math.round((i.b*e+t.b*r)*255)];return`rgb(${a[0]}, ${a[1]}, ${a[2]})`}function ni(i,e,t,r){return i.map((a,s)=>Ne(a,e,t[s],r))}function De(i){if(typeof i=="number")return Ne;if(typeof i=="string"){let e={};return(t,r,a,s)=>(e[t]||(e[t]=new _(t).srgb),e[a]||(e[a]=new _(a).srgb),si(e[t],r,e[a],s))}else if(Array.isArray(i))return ni;return(e,t,r,a)=>t<1?e:r}function H(i,e=void 0){return e===void 0&&(e=De(i)),{finalValue:i,interpolate:(t,r)=>e(t,1-Math.min(r,1),i,Math.min(r,1))}}function Qr(i,e=void 0){return e===void 0&&(e=De(i())),{interpolate:(t,r)=>e(t,1-Math.min(r,1),i(),Math.min(r,1))}}function Kr(i,e=void 0){return e===void 0&&(e=De(i[0])),{interpolate:(t,r)=>{let a=Math.min(r,1)*(i.length-1)-1,s=Math.min(a-Math.floor(a),1);return a<0?e(t,1-s,i[0],s):e(i[Math.floor(a)],1-s,i[Math.floor(a)+1],s)}}}class z{constructor(e,t=1e3,r=Ve){this.duration=0,this.finalValue=void 0,this.interpolator=null,this.duration=t,e.hasOwnProperty("finalValue")?this.finalValue=e.finalValue:this.finalValue=void 0,this.interpolator=e,this.curve=r}evaluate(e,t){let r=this.curve(this.duration>0?t/this.duration:1);return this.interpolator.interpolate(e,r)}withDelay(e){return e?new ea(this,e):this}}class ea extends z{constructor(e,t){super(e.interpolator,e.duration+t,e.curve),this.delay=t}evaluate(e,t){return t<=this.delay?e:super.evaluate(e,(t-this.delay)*this.duration/(this.duration-this.delay))}}function ta(i,e=1e3,t=Ve){return new z(H(i),e,t)}var oi=(i=>(i.Waiting="waiting",i.Entering="entering",i.Visible="visible",i.Exiting="exiting",i.Completed="completed",i))(oi||{}),hi=(i=>(i.Show="show",i.Hide="hide",i))(hi||{});class li{constructor(e={}){this.markStates=new Map,this.marksByID=new Map,this.queuedAnimations=new Map,this._flushTimer=null,this.animatingMarks=new Set,this.defer=!1,this.saveExitedMarks=!1,this._callbacks={initialize:e.initialize||(()=>{}),enter:e.enter||(()=>{}),exit:e.exit||(()=>{})}}setVisibleMarks(e){return e.forEach(t=>{this.markStates.set(t,"visible"),this.marksByID.set(t.id,t)}),this}configure(e={}){return this.defer=e.defer??this.defer,this.saveExitedMarks=e.saveExitedMarks??this.saveExitedMarks,this}onInitialize(e){this._callbacks.initialize=e||(()=>{})}onEnter(e){this._callbacks.enter=e||(()=>{})}onExit(e){this._callbacks.exit=e||(()=>{})}_perform(e,t){if(e){if(t=="show"){if(this.markStates.get(e)==="visible")return;this.markStates.set(e,"entering"),this.marksByID.set(e.id,e);let r=this._callbacks.enter(e);r&&r instanceof Promise?(this.animatingMarks.add(e),r.then(()=>{this.markStates.has(e)&&this.markStates.get(e)=="entering"&&(this.markStates.set(e,"visible"),this.animatingMarks.delete(e))},()=>{this.animatingMarks.delete(e)})):this.markStates.set(e,"visible")}else if(t=="hide"){let r=this.markStates.get(e)??null;if(r==="waiting"||r==="completed")return;this.markStates.set(e,"exiting"),this.marksByID.set(e.id,e);let a=this._callbacks.exit(e);a&&a instanceof Promise?(this.animatingMarks.add(e),a.then(()=>{this.markStates.has(e)&&this.markStates.get(e)=="exiting"&&(this.saveExitedMarks?this.markStates.set(e,"completed"):(this.marksByID.delete(e.id),this.markStates.delete(e),this.animatingMarks.delete(e)))},()=>{this.animatingMarks.delete(e)})):this.saveExitedMarks?this.markStates.set(e,"completed"):(this.marksByID.delete(e.id),this.markStates.delete(e))}}}_enqueue(e,t){let r=this.markStates.get(e);if(r===void 0)return!1;if(t=="show"){if(r=="entering"||r=="visible")return!1;this.markStates.set(e,"entering")}else if(t=="hide"){if(r=="exiting"||r=="completed")return!1;this.markStates.set(e,"exiting")}else console.error("Unknown action enqueued:",t);return this.defer?(this.queuedAnimations.set(e,t),this._flushTimer||(this._flushTimer=window.setTimeout(()=>this._flush(),0))):this._perform(e,t),!0}_flush(){this._flushTimer=null,this.queuedAnimations.forEach((e,t)=>{this._perform(t,e)}),this.queuedAnimations.clear()}show(e){return this.markStates.has(e)||(this._callbacks.initialize(e),this.markStates.set(e,"waiting"),this.marksByID.set(e.id,e)),this._enqueue(e,"show")}hide(e){return this.markStates.has(e)?this._enqueue(e,"hide"):!1}get(e,t=!1){let r=this.marksByID.get(e);if(r&&t){let a=this.markStates.get(r);if(a==="exiting"||a==="completed")return}return r}forEach(e){let t=0;this.markStates.forEach((r,a)=>{(r==="entering"||r==="visible"||r==="exiting")&&(e(a,t),t++)})}getMarks(){return Array.from(this.markStates.keys())}count(){return this.markStates.size}getVisibleMarks(){return Array.from(this.markStates.keys()).filter(e=>["waiting","entering","visible"].includes(this.markStates.get(e)))}}function ui(i,e,t){return Object.fromEntries(Object.entries(i).map(([r,a])=>[r,typeof a=="function"?a(e,t):a]))}class ci{constructor(e=[],t={animationDuration:1e3,animationCurve:Z}){this.timeProvider=null,this.marks=[],this.lazyUpdates=!0,this.useStaging=!0,this.stage=null,this.animatingMarks=new Set,this.updatedMarks=new Set,this.preloadableProperties=new Set,this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!1,this._updateListeners={},this._eventListeners={},this.timeProvider=X(),this.lazyUpdates=!0,this._defaultDuration=1e3,this._defaultCurve=Z,this.configure(t),this.marks=e,this.marksByID=new Map,this.marks.forEach(r=>{if(this.marksByID.has(r.id)){console.warn(`ID '${r.id}' is duplicated in mark render group`);return}this.marksByID.set(r.id,r),this._setupMark(r)}),this.stage&&this.stage.setVisibleMarks(this.marks)}configure(e){return e.timeProvider!==void 0&&(this.timeProvider=e.timeProvider),e.lazyUpdates!==void 0&&(this.lazyUpdates=e.lazyUpdates),e.animationDuration!==void 0&&(this._defaultDuration=e.animationDuration),e.animationCurve!==void 0&&(this._defaultCurve=e.animationCurve),this.marks&&this.getMarks().forEach(t=>this._configureMark(t)),this.useStaging=e.useStaging??this.useStaging,this.useStaging?(this.stage=new li,this.marks&&this.stage.setVisibleMarks(this.marks)):this.stage=null,this}configureStaging(e,t=void 0){return this.useStaging||console.error("Can't configure staging without setting useStaging to true"),this.stage.onInitialize(e.initialize),this.stage.onEnter(e.enter),this.stage.onExit(e.exit),t&&this.stage.configure(t),this}_setupMark(e){this._configureMark(e),e.addListener((t,r,a)=>{this.updatedMarks.add(t),!this.preloadableProperties.has(r)&&a&&this.animatingMarks.add(t),this._changedLastTick=!0}),e.addGraphListener((t,r,a,s)=>{a.forEach(n=>{!s.includes(n)&&n.sourceMarks().length==1&&this.deleteMark(n)}),s.forEach(n=>{a.includes(n)||this.addMark(n)})})}_configureMark(e){e.setTimeProvider(this.timeProvider),e.configure({animationDuration:this._defaultDuration,animationCurve:this._defaultCurve}),Object.entries(this._updateListeners).forEach(([t,r])=>e.onUpdate(t,r)),Object.entries(this._eventListeners).forEach(([t,r])=>e.onEvent(t,r))}onUpdate(e,t){return this._updateListeners[e]=t,this.getMarks().forEach(r=>r.onUpdate(e,t)),this}onEvent(e,t){return this._eventListeners[e]=t,this.getMarks().forEach(r=>r.onEvent(e,t)),this}dispatch(e,t=void 0){let r=this.getMarks().map(a=>a.dispatch(e,t)).filter(a=>a instanceof Promise);if(r.length>0)return new Promise((a,s)=>{Promise.all(r).then(()=>a()).catch(s)})}forceUpdate(){return this._forceUpdate=!0,this}currentTime(){return this.timeProvider()}getMarks(){return this.marks}registerPreloadableProperty(e){return this.preloadableProperties.add(e),this}advance(e){this.timeProvider.advance(e);let t=this.lazyUpdates?[...this.stage?this.stage.animatingMarks:[],...this.animatingMarks,...this.updatedMarks]:this.stage?this.stage.getMarks():this.getMarks();if(this.updatedMarks=new Set,t.length==0&&!this._forceUpdate&&!this._markListChanged)return this._changedLastTick=!1,!1;for(let r of t)r.advance()||this.animatingMarks.delete(r);return this._forceUpdate=!1,this._markListChanged=!1,this._changedLastTick=!0,!0}marksAnimating(){return this.animatingMarks.size>0}animateTo(e,t,r={}){return this.forEach((a,s)=>{a.animateTo(e,typeof t=="function"?t(a,s):t,ui(r,a,s))}),this}animate(e,t={}){return this.preloadableProperties.has(e)&&t.interpolator?(console.error("Cannot apply custom interpolator function on preloadable property."),this):(this.forEach((a,s)=>{let n=ui(t,a,s);a.animate(e,n)}),this)}update(e,t=void 0){return this.forEach((r,a)=>{r.setAttr(e,t===void 0?void 0:typeof t=="function"?t(r,a):t)}),this}wait(e,t=!0){return Promise.all(this.map(r=>r.wait(e,t)))}get(e){return this.marksByID.get(e)}forEach(e){this.getMarks().forEach(e)}map(e){return this.getMarks().map(e)}filter(e){let t=Object.assign({},this),r=this.getMarks().filter(e);return Object.keys(this).forEach(a=>{t[a]=this[a]}),t.marks=r,t.marksByID=new Map,r.forEach(a=>{t.marksByID.set(a.id,a)}),vi(this).forEach(a=>{a=="getMarks"?t[a]=()=>r:t[a]=(...s)=>{let n=this.getMarks(),o=this.marksByID;this.marks=r,this.marksByID=t.marksByID;let h=this[a](...s);return this.marks=n,this.marksByID=o,h===this?t:h}}),t}updateTransform(e){return this.getMarks().forEach(t=>t.updateTransform(e)),this}addMark(e){return this.marks.includes(e)?this:(this.marks.push(e),this.marksByID.set(e.id,e),this._setupMark(e),this._markListChanged=!0,this.stage&&this.stage.show(e),this)}deleteMark(e){let t=this.marks.indexOf(e);return t<0?this:(this.marks.splice(t,1),this.marksByID.delete(e.id),this._markListChanged=!0,this.stage&&this.stage.hide(e),this)}delete(e){return this.has(e)?this.deleteMark(this.get(e)):this}has(e){return this.marksByID.has(e)}count(){return this.getMarks().length}changed(e=void 0){return e===void 0?this._changedLastTick:this._changedLastTick&&this.getMarks().some(t=>t.changed(e))}}const ia=5e3;class V{constructor(e,t){this._timeProvider=null,this._listeners=[],this._graphListeners=[],this._defaultDuration=1e3,this._defaultCurve=Z,this._changedLastTick=!1,this._adjacency={},this._reverseAdjacency=new Set,this.represented=void 0,this._updateListeners={},this._eventListeners={},this.framesWithUpdate=0,this.id=e,t===void 0&&console.error("Mark constructor requires an ID and an object defining attributes");let r={};Object.keys(t).forEach(a=>{let s=new M(Object.assign(Object.assign({},t[a]instanceof M?t[a]:new M(t[a])),{computeArg:this}));s.addListener((n,o)=>this._attributesChanged(a,o)),r[a]=s}),this.attributes=r}configure(e){return e.animationDuration!==void 0&&(this._defaultDuration=e.animationDuration),e.animationCurve!==void 0&&(this._defaultCurve=e.animationCurve),this}onUpdate(e,t){return this._updateListeners[e]=t,this}onEvent(e,t){return this._eventListeners[e]=t,this}dispatch(e,t=void 0){if(this._eventListeners[e])return this._eventListeners[e](this,t,e)}addListener(e){return this._listeners.push(e),this}removeListener(e){let t=this._listeners.indexOf(e);return t>=0&&(this._listeners=this._listeners.splice(t,1)),this}addGraphListener(e){return this._graphListeners.push(e),this}removeGraphListener(e){let t=this._graphListeners.indexOf(e);return t>=0&&(this._graphListeners=this._graphListeners.splice(t,1)),this}_attributesChanged(e,t){this._changedLastTick=!0,this._listeners.forEach(r=>r(this,e,t)),this._updateListeners[e]&&this._updateListeners[e](this,this.attributes[e].future())}setTimeProvider(e){return this._timeProvider=e,Object.values(this.attributes).forEach(t=>t.setTimeProvider(this._timeProvider)),this}representing(e){return this.represented=e,this}advance(e=void 0){let t=!1;return Object.values(this.attributes).forEach(r=>{r.advance(e)&&(t=!0)}),t?(this.framesWithUpdate+=1,this.framesWithUpdate>ia&&console.warn("Marks are being updated excessively!"),this._changedLastTick=!0,!0):(this.framesWithUpdate=0,this._changedLastTick=!1,!1)}setAttr(e,t=void 0){let r=this.attributes[e];r===void 0&&console.error(`No attribute named '${String(e)}'`);let a=r.last();return t===void 0?r.compute():r.set(t),w(a,r.data())||this._listeners.forEach(s=>s(this,e,!1)),this}attr(e,t=!0){return this.attributes[e]||console.error(`No attribute named '${String(e)}'`),t?this.attributes[e].get():this.attributes[e].getUntransformed()}data(e){return this.attributes[e]===void 0&&console.error(`No attribute named '${String(e)}'`),this.attributes[e].data()}updateTransform(e){return this.attributes[e]===void 0&&console.error(`No attribute named '${String(e)}'`),this.attributes[e].updateTransform(),this}animateTo(e,t,r={}){if(!this.attributes.hasOwnProperty(e))return console.error(`No attribute named '${String(e)}'`),this;if(typeof t=="function")return this.attributes[e].set(t),this.animate(e,{duration:r.duration,curve:r.curve}),this;let a=r.duration===void 0?this._defaultDuration:r.duration,s=r.curve===void 0?this._defaultCurve:r.curve,n=new z(H(t),a,s).withDelay(r.delay||0);return this.attributes[e].animate(n),this}animate(e,t={}){if(!this.attributes.hasOwnProperty(e))return console.error(`Attempting to animate undefined property ${String(e)}`),this;let r;if(t instanceof z)r=t;else if(t.interpolator!==void 0){let a=t.interpolator;r=new z(a,t.duration!==void 0?t.duration:this._defaultDuration,t.curve!==void 0?t.curve:this._defaultCurve).withDelay(t.delay||0)}else{let a=this.data(e);if(!w(a,this.attributes[e].last())||!w(a,this.attributes[e].future())){let s=t.duration!==void 0?t.duration:this._defaultDuration,n=t.curve!==void 0?t.curve:this._defaultCurve;r=new z(H(a),s,n).withDelay(t.delay||0)}else return this}return this.attributes[e].animate(r),this}wait(e,t=!0){let r=Array.isArray(e)?e:[e];return Promise.all(r.map(a=>this.attributes[a].wait(t)))}changed(e=void 0){return e===void 0?this._changedLastTick:Array.isArray(e)?this._changedLastTick&&e.some(t=>this.attributes[t].changed()):this._changedLastTick&&this.attributes[e].changed()}copy(e,t={}){return new V(e,{...this.attributes,...Object.fromEntries(Object.entries(t).map(([r,a])=>a instanceof M?[r,a]:typeof a=="function"?[r,this.attributes[r].copy({valueFn:a})]:a.value!==void 0||a.valueFn!==void 0?[r,new M(a)]:[r,this.attributes[r].copy({value:a})]))})}adj(e,t=void 0){if(t!==void 0){let r=Array.isArray(t)?t:[t],a=this._adjacency[e]??new Set;this._graphListeners.forEach(s=>s(this,e,Array.from(a),r)),a.forEach(s=>s._removeEdgeFrom(this)),this._adjacency[e]=new Set(r),r.forEach(s=>s._addEdgeFrom(this));return}return Array.from(this._adjacency[e]??new Set)}sourceMarks(){return Array.from(this._reverseAdjacency)}_addEdgeFrom(e){return this._reverseAdjacency.add(e),this}_removeEdgeFrom(e){return this._reverseAdjacency.delete(e),this}}function ra(i){let e;if(typeof e=="function")e=i;else{let t=i;e=(r,a)=>new V(r,Object.fromEntries(Object.entries(t).map(([s,n])=>typeof n=="function"?[s,n(a[s])]:a[s]?a[s]instanceof M?[s,a[s]]:[s,new M(a[s])]:[s,n.copy()])))}return{create:(t,r)=>{let a=e(t,r);return a instanceof V?a:new V(t,a)}}}class aa{constructor(e){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof e.advance=="function"?this.toAdvance=[e]:this.toAdvance=e,this.start()}onChange(e){return this._callbacks.push(e),this}start(){return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(e=>e()),requestAnimationFrame(e=>this.tick(e)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(e){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(t=>t.advance(e-this._lastTick)).some(t=>t)&&this._callbacks.forEach(t=>t()),this.stopped||requestAnimationFrame(t=>this.tick(t)),this._lastTick=e}}class sa{constructor(e){this._callbacks=[],this._lastTick=void 0,this.stopped=!0,typeof e.advance=="function"?this.toAdvance=[e]:this.toAdvance=e,this.start()}onChange(e){return this._callbacks.push(e),this}start(){if(this.stopped)return this._lastTick=window.performance.now(),this.stopped=!1,this._callbacks.forEach(e=>e()),requestAnimationFrame(e=>this.tick(e)),this}stop(){return this._lastTick=void 0,this.stopped=!0,this}tick(e){this._lastTick===void 0&&(this._lastTick=window.performance.now()),this.toAdvance.map(t=>t.advance(e-this._lastTick)).some(t=>t)?(this._callbacks.forEach(t=>t()),this.stopped||requestAnimationFrame(t=>this.tick(t)),this._lastTick=e):this.stop()}}function Ae(i,e,t){t>0?(i[0].animate(new z(H(e[0]),t,Z)),i[1].animate(new z(H(e[1]),t,Z))):(i[0].set(e[0]),i[1].set(e[1]))}class na{constructor(e={}){this.animationDuration=1e3,this.squareAspect=!0,this._xDomain=[new M(0),new M(1)],this._yDomain=[new M(0),new M(1)],this._xRange=[new M(0),new M(1)],this._yRange=[new M(0),new M(1)],this._xScaleFactor=new M(1),this._yScaleFactor=new M(1),this._translateX=new M(0),this._translateY=new M(0),this._calculatingTransform=!1,this.timeProvider=X(),this.controller=null,this._updatedNoAdvance=!1,this.listeners=[],this.xScale=Object.assign(t=>((t-this.xDomain()[0])*this.xRSpan()/this.xDSpan()+this.xRange()[0])*this._xScaleFactor.get()+this._translateX.get(),{domain:()=>{let t=this.xRange();return[this.xScale.invert(t[0]),this.xScale.invert(t[1])]},range:()=>[this._xRange[0].get(),this._xRange[1].get()],invert:t=>((t-this._translateX.get())/this._xScaleFactor.get()-this.xRange()[0])*this.xDSpan()/this.xRSpan()+this.xDomain()[0]}),this.yScale=Object.assign(t=>((t-this.yDomain()[0])*this.yRSpan()/this.yDSpan()+this.yRange()[0])*this._yScaleFactor.get()+this._translateY.get(),{domain:()=>{let t=this.yRange();return[this.yScale.invert(t[0]),this.yScale.invert(t[1])]},range:()=>[this._yRange[0].get(),this._yRange[1].get()],invert:t=>((t-this._translateY.get())/this._yScaleFactor.get()-this.yRange()[0])*this.yDSpan()/this.yRSpan()+this.yDomain()[0]}),this.xDomain([0,1]),this.yDomain([0,1]),this.xRange([0,1]),this.yRange([0,1]),this.configure(e),this._xScaleFactor.setTimeProvider(this.timeProvider),this._yScaleFactor.setTimeProvider(this.timeProvider),this._translateX.setTimeProvider(this.timeProvider),this._translateY.setTimeProvider(this.timeProvider)}configure(e={}){return this.animationDuration=e.animationDuration!==void 0?e.animationDuration:1e3,this.minScale=e.minScale!==void 0?e.minScale:.1,this.maxScale=e.maxScale!==void 0?e.maxScale:14,this}xDomain(e=void 0,t=!1){return e===void 0?[this._xDomain[0].get(),this._xDomain[1].get()]:(Ae(this._xDomain,e,t?this.animationDuration:0),this)}yDomain(e=void 0,t=!1){return e===void 0?[this._yDomain[0].get(),this._yDomain[1].get()]:(Ae(this._yDomain,e,t?this.animationDuration:0),this)}xRange(e=void 0,t=!1){return e===void 0?[this._xRange[0].get(),this._xRange[1].get()]:(Ae(this._xRange,e,t?this.animationDuration:0),this)}yRange(e=void 0,t=!1){return e===void 0?[this._yRange[0].get(),this._yRange[1].get()]:(Ae(this._yRange,e,t?this.animationDuration:0),this)}xDSpan(){return this._xDomain[1].get()-this._xDomain[0].get()}yDSpan(){return this._yDomain[1].get()-this._yDomain[0].get()}xRSpan(){return this._xRange[1].get()-this._xRange[0].get()}yRSpan(){return this._yRange[1].get()-this._yRange[0].get()}makeSquareAspect(){let e=this.xRSpan()/this.xDSpan(),t=this.yRSpan()/this.yDSpan(),r=this.yDomain(),a=this.xDomain();if(e<t){let s=(r[0]+r[1])*.5,n=this.yRSpan()/e;this.yDomain([s-n*.5,s+n*.5])}else{let s=(a[0]+a[1])*.5,n=this.xRSpan()/t;this.xDomain([s-n*.5,s+n*.5])}return this}onUpdate(e){return this.listeners.push(e),this}isNeutral(){return Math.abs(this._xScaleFactor.get()-1)<=.01&&Math.abs(this._yScaleFactor.get()-1)<=.01&&Math.abs(this._translateX.get())<=5&&Math.abs(this._translateY.get())<=5}advance(e=void 0){return this.timeProvider.advance(e),[this._xDomain[0].advance(e),this._xDomain[1].advance(e),this._yDomain[0].advance(e),this._yDomain[1].advance(e),this._xRange[0].advance(e),this._xRange[1].advance(e),this._yRange[0].advance(e),this._yRange[1].advance(e),this._xScaleFactor.advance(e),this._yScaleFactor.advance(e),this._translateX.advance(e),this._translateY.advance(e)].some(r=>r)?(this._updatedNoAdvance=!1,this.listeners.forEach(r=>r(this)),!0):(this._updatedNoAdvance||(this.listeners.forEach(r=>r(this)),this._updatedNoAdvance=!0),!1)}scaleBy(e,t=null){this.unfollow();let r=this._translateX.get(),a=this._translateY.get(),s=this._xScaleFactor.get(),n=this._yScaleFactor.get();t?t=[(t[0]-r)/s,(t[1]-a)/n]:t=[(this.xRange[0]+this.xRange[1])*.5,(this.yRange[0]+this.yRange[1])*.5];let o=typeof e=="number"?e:e[0],h=typeof e=="number"?e:e[1],l=s+o;return l<=this.maxScale&&l>=this.minScale&&(this._xScaleFactor.set(l),this._translateX.set(r-o*t[0])),l=n+h,l<=this.maxScale&&l>=this.minScale&&(this._yScaleFactor.set(l),this._translateY.set(a-h*t[1])),this}translateBy(e,t){return this.unfollow(),this._translateX.set(this._translateX.get()+e),this._translateY.set(this._translateY.get()+t),this}transform(e=void 0,t=!1){if(e!==void 0){if(this.unfollow(),t){let r=a=>new z(H(a),this.animationDuration,Z);e.kx!==void 0?this._xScaleFactor.animate(r(e.kx)):e.k!==void 0&&this._xScaleFactor.animate(r(e.k)),e.ky!==void 0?this._yScaleFactor.animate(r(e.ky)):e.k!==void 0&&this._yScaleFactor.animate(r(e.k)),e.x!==void 0&&this._translateX.animate(r(e.x)),e.y!==void 0&&this._translateY.animate(r(e.y))}else e.kx!==void 0?this._xScaleFactor.set(e.kx):e.k!==void 0&&this._xScaleFactor.set(e.k),e.ky!==void 0?this._yScaleFactor.set(e.ky):e.k!==void 0&&this._yScaleFactor.set(e.k),e.x!==void 0&&this._translateX.set(e.x),e.y!==void 0&&this._translateY.set(e.y);return this}else{let r=this._xScaleFactor.last(),a=this._yScaleFactor.last();return{k:(r+a)*.5,kx:r,ky:a,x:this._translateX.last(),y:this._translateY.last()}}}reset(e=!1){return this.transform({k:1,x:0,y:0},e)}zoomTo(e,t=!0){return this.transform(e.transform(this),t)}_calculateControllerTransform(){this._calculatingTransform=!0;let e=this.controller.transform(this);return this._calculatingTransform=!1,e}follow(e,t=!0){if(this.controller=e,this._xScaleFactor.set(()=>{if(this._calculatingTransform)return this._xScaleFactor.last();let r=this._calculateControllerTransform();return r.kx||r.k}),this._yScaleFactor.set(()=>{if(this._calculatingTransform)return this._yScaleFactor.last();let r=this._calculateControllerTransform();return r.ky||r.k}),this._translateX.set(()=>this._calculatingTransform?this._translateX.last():this._calculateControllerTransform().x),this._translateY.set(()=>this._calculatingTransform?this._translateY.last():this._calculateControllerTransform().y),t){let r=a=>new z(H(a),this.animationDuration,Z);this._xScaleFactor.animate(r(this._xScaleFactor.data())),this._yScaleFactor.animate(r(this._yScaleFactor.data())),this._translateX.animate(r(this._translateX.data())),this._translateY.animate(r(this._translateY.data()))}return this}unfollow(){return this.controller!=null&&(this._xScaleFactor.set(this._xScaleFactor.get()),this._yScaleFactor.set(this._yScaleFactor.get()),this._translateX.set(this._translateX.get()),this._translateY.set(this._translateY.get())),this.controller=null,this}wait(e=!0){return Promise.all([...this._xDomain,...this._yDomain,...this._xRange,...this._yRange,this._xScaleFactor,this._yScaleFactor,this._translateX,this._translateY].map(t=>t.wait(e)))}}class We{constructor(e,t={}){this.lastCompute=void 0,this.marks=e,this.centerMark=t.centerMark!==void 0?t.centerMark:void 0,this.centerMark&&!this.marks.includes(this.centerMark)&&(this.marks=[...this.marks,this.centerMark]),this.xAttr=t.xAttr!==void 0?t.xAttr:"x",this.yAttr=t.yAttr!==void 0?t.yAttr:"y",this.padding=t.padding!==void 0?t.padding:20,this.transformCoordinates=t.transformCoordinates??!1,this.inverseTransformCoordinates=t.inverseTransformCoordinates??!1}transform(e){if(this.lastCompute&&this.lastCompute.scales===e&&this.lastCompute.time==e.timeProvider())return this.lastCompute.result;let t=this.marks.map(S=>this._getMarkLocation(e,S)),r,a,s,n,o=this.centerMark!==void 0?this._getMarkLocation(e,this.centerMark):null,h=e.transform(),{x:l,y:u}=wi(t);if(o){let S=Math.max(l[1]-o.x,o.x-l[0]),x=Math.max(u[1]-o.y,o.y-u[0]);l=[o.x-S,o.x+S],u=[o.y-x,o.y+x]}let c,d;Math.abs(l[1]-l[0])>0?c=(Math.abs(e.xRSpan())-this.padding*2)/(l[1]-l[0])/(Math.abs(e.xRSpan())/Math.abs(e.xDSpan())):c=h.kx,Math.abs(u[1]-u[0])>0?d=(Math.abs(e.yRSpan())-this.padding*2)/(u[1]-u[0])/(Math.abs(e.yRSpan())/Math.abs(e.yDSpan())):d=h.ky;let g=h.ky/h.kx;c=Math.min(c,e.maxScale),d=Math.min(d,e.maxScale),d<c*g?(s=d/g,n=d):(s=c,n=c*g),r=(l[0]+l[1])*.5,a=(u[0]+u[1])*.5,r=(r-e.xDomain()[0])*e.xRSpan()/e.xDSpan()+e.xRange()[0],a=(a-e.yDomain()[0])*e.yRSpan()/e.yDSpan()+e.yRange()[0];let y=-r*s+(e.xRange()[0]+e.xRange()[1])*.5,b=-a*n+(e.yRange()[0]+e.yRange()[1])*.5,v={kx:s,ky:n,x:y,y:b};return this.lastCompute={scales:e,time:e.timeProvider(),result:v},v}_getMarkLocation(e,t){let r={x:t.attr(this.xAttr,this.transformCoordinates),y:t.attr(this.yAttr,this.transformCoordinates)};return this.inverseTransformCoordinates&&(r={x:e.xScale.invert(r.x),y:e.yScale.invert(r.y)}),r}}function oa(i,e={}){return new We([i],{centerMark:i,...e})}function ha(i,e={}){return new We(i,{...e})}class la{constructor(e={}){this.markCollections=[],this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this._avgMarksPerBin=null,this._coordinateAttributes=e.coordinateAttributes??["x","y"],this._transformCoordinates=e.transformCoordinates??!0,this._avgMarksPerBin=e.marksPerBin??null}add(e){return this.markCollections.push(e),this}remove(e){let t=this.markCollections.indexOf(e);return t<0&&console.error("Tried to remove mark collection which does not exist:",e),this.markCollections.splice(t,1),this}invalidate(){return this._positionMap=null,this._binSizes=null,this._extents=null,this._numBins=null,this._numMarks=null,this}compute(){return this._extents=new Array(this._coordinateAttributes.length).fill([1e12,-1e12]),this._numMarks=0,this._forEachMark(e=>{this._coordinateAttributes.forEach((t,r)=>{let a=e.attr(t,this._transformCoordinates);a<this._extents[r][0]&&(this._extents[r][0]=a),a>this._extents[r][1]&&(this._extents[r][1]=a)}),this._numMarks+=1}),this._numMarks==0?this:(this._numBins=Math.round(this._numMarks/(this._avgMarksPerBin??Math.min(Math.max(1,this._numMarks/100),10))),this._binSizes=this._extents.map(e=>Math.ceil((e[1]-e[0])/this._numBins)),this._positionMap=new Map,this._forEachMark(e=>{let t=this._coordinateAttributes.map(a=>e.attr(a,this._transformCoordinates)),r=this._getPositionID(t);this._positionMap.has(r)?this._positionMap.get(r).push(e):this._positionMap.set(r,[e])}),this)}_forEachMark(e){this.markCollections.forEach(t=>{if(t instanceof ci)t.forEach(e);else if(t instanceof V)e(t);else if(typeof t.forEach=="function")t.forEach(e);else if(typeof t=="function"){let r=t();r instanceof V?e(r):r.forEach(e)}else console.error("Unrecognized mark collection type in position map:",t)})}_getPositionID(e){return(this._numBins===null||!this._extents||!this._binSizes)&&console.error("Cannot hash position without computing first"),e.length!=this._coordinateAttributes.length&&console.error(`Need exactly ${this._coordinateAttributes.length} coordinates, got ${e.length}`),e.reduce((t,r,a)=>t*this._numBins+Math.floor((r-this._extents[a][0])/this._binSizes[a]),0)}marksNear(e,t,r=!0){if(this._positionMap||this.compute(),this._numMarks==0)return[];let a=this._recursiveBinWalk(e,t);return r?a.map(n=>{let o=this._coordinateAttributes.map(h=>n.attr(h,this._transformCoordinates));return[n,Math.sqrt(o.reduce((h,l,u)=>h+(l-e[u])*(l-e[u]),0))]}).filter(([n,o])=>o<=t).sort((n,o)=>n[1]-o[1]).map(([n,o])=>n):a}_recursiveBinWalk(e,t,r=[]){let a=r.length;if(a==e.length)return this._positionMap.get(this._getPositionID(r))??[];let s=Math.ceil(t/this._binSizes[a]),n=new Array(s*2+1).fill(0).map((h,l)=>(l-s)*this._binSizes[a]+e[a]),o=[];return n.forEach(h=>{o=[...o,...this._recursiveBinWalk(e,t,[...r,h])]}),o}}var di=(i=>(i.none="no-preference",i.more="more",i.less="less",i))(di||{}),fi=(i=>(i.light="light",i.dark="dark",i))(fi||{});class mi{constructor(){this._hasChanged=!1;let e=window.matchMedia("(prefers-reduced-motion: reduce)");this._prefersReducedMotion=e.matches,e.addEventListener("change",h=>this._handleMotion(h));let t=window.matchMedia("(prefers-reduced-transparency: reduce)");this._prefersReducedTransparency=t.matches,t.addEventListener("change",h=>this._handleTransparency(h));let r=window.matchMedia("(prefers-contrast: none)");this._contrastPreference="no-preference",r.addEventListener("change",h=>this._handleContrastNone(h));let a=window.matchMedia("(prefers-contrast: more)");a.matches&&(this._contrastPreference="more"),a.addEventListener("change",h=>this._handleContrastMore(h));let s=window.matchMedia("(prefers-contrast: less)");a.matches&&(this._contrastPreference="less"),s.addEventListener("change",h=>this._handleContrastLess(h));let n=window.matchMedia("(prefers-color-scheme: light)");this._colorSchemePreference="light",n.addEventListener("change",h=>this._handleColorSchemeLight(h));let o=window.matchMedia("(prefers-color-scheme: dark)");o.matches&&(this._colorSchemePreference="dark"),o.addEventListener("change",h=>this._handleColorSchemeDark(h))}_handleMotion(e){this._prefersReducedMotion=e.matches,this._hasChanged=!0}_handleTransparency(e){this._prefersReducedTransparency=e.matches,this._hasChanged=!0}_handleContrastMore(e){e.matches&&(this._contrastPreference="more"),this._hasChanged=!0}_handleContrastLess(e){e.matches&&(this._contrastPreference="less"),this._hasChanged=!0}_handleContrastNone(e){e.matches&&(this._contrastPreference="no-preference"),this._hasChanged=!0}_handleColorSchemeLight(e){e.matches&&(this._colorSchemePreference="light"),this._hasChanged=!0}_handleColorSchemeDark(e){e.matches&&(this._colorSchemePreference="dark"),this._hasChanged=!0}get prefersReducedMotion(){return this._prefersReducedMotion}get prefersReducedTransparency(){return this._prefersReducedTransparency}get contrastPreference(){return this._contrastPreference}get colorSchemePreference(){return this._colorSchemePreference}advance(e){return this._hasChanged?(this._hasChanged=!1,!0):!1}}let Je;function ua(){return Je||(Je=new mi),Je}m.Animator=z,m.Attribute=M,m.AttributeRecompute=et,m.ColorSchemePreference=fi,m.ContrastPreference=di,m.LazyTicker=sa,m.Mark=V,m.MarkFollower=We,m.MarkRenderGroup=ci,m.PositionMap=la,m.RenderContext=mi,m.Scales=na,m.StageManager=li,m.StagingAction=hi,m.StagingState=oi,m.Ticker=aa,m.autoMixingFunction=De,m.basicAnimationTo=ta,m.centerOn=oa,m.colorMixingFunction=si,m.curveEaseInOut=Z,m.curveLinear=Ve,m.defineMark=ra,m.getRenderContext=ua,m.interpolateAlongPath=Kr,m.interpolateTo=H,m.interpolateToFunction=Qr,m.markBox=ha,m.numericalArrayMixingFunction=ni,m.numericalMixingFunction=Ne,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
